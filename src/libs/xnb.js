function decodeBase64(base64, enableUnicode) {
    var binaryString = atob(base64);
    if (enableUnicode) {
        var binaryView = new Uint8Array(binaryString.length);
        for (var i = 0, n = binaryString.length; i < n; ++i) {
            binaryView[i] = binaryString.charCodeAt(i);
        }
        return String.fromCharCode.apply(null, new Uint16Array(binaryView.buffer));
    }
    return binaryString;
}

function createURL(base64, sourcemapArg, enableUnicodeArg) {
    var sourcemap = sourcemapArg === undefined ? null : sourcemapArg;
    var enableUnicode = enableUnicodeArg === undefined ? false : enableUnicodeArg;
    var source = decodeBase64(base64, enableUnicode);
    var start = source.indexOf('\n', 10) + 1;
    var body = source.substring(start) + (sourcemap ? '\/\/# sourceMappingURL=' + sourcemap : '');
    var blob = new Blob([body], { type: 'application/javascript' });
    return URL.createObjectURL(blob);
}

function createBase64WorkerFactory(base64, sourcemapArg, enableUnicodeArg) {
    var url;
    return function WorkerFactory(options) {
        url = url || createURL(base64, sourcemapArg, enableUnicodeArg);
        return new Worker(url, options);
    };
}

const WorkerFactory = createBase64WorkerFactory('Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewoJJ3VzZSBzdHJpY3QnOwoKCS8qKiAKCSAqIHhuYi5qcyAxLjIuMQoJICogbWFkZSBieSBMeWJlbGwoIGh0dHBzOi8vZ2l0aHViLmNvbS9seWJlbGwtYXJ0LyApCgkgKiBUaGlzIGxpYnJhcnkgaXMgYmFzZWQgb24gdGhlIFhuYkNsaSBtYWRlIGJ5IExlb25ibGFkZS4KCSAqIAoJICogeG5iLmpzIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBMR1BMIDMuMCBMaWNlbnNlLgoJICogCgkqLwoKCWZ1bmN0aW9uIG93bktleXMob2JqZWN0LCBlbnVtZXJhYmxlT25seSkgewoJCXZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqZWN0KTsKCgkJaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsKCQkJdmFyIHN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9iamVjdCk7CgkJCWVudW1lcmFibGVPbmx5ICYmIChzeW1ib2xzID0gc3ltYm9scy5maWx0ZXIoZnVuY3Rpb24gKHN5bSkgewoJCQkJcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7CgkJCX0pKSwga2V5cy5wdXNoLmFwcGx5KGtleXMsIHN5bWJvbHMpOwoJCX0KCgkJcmV0dXJuIGtleXM7Cgl9CgoJZnVuY3Rpb24gX29iamVjdFNwcmVhZDIodGFyZ2V0KSB7CgkJZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsKCQkJdmFyIHNvdXJjZSA9IG51bGwgIT0gYXJndW1lbnRzW2ldID8gYXJndW1lbnRzW2ldIDoge307CgkJCWkgJSAyID8gb3duS2V5cyhPYmplY3Qoc291cmNlKSwgITApLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewoJCQkJX2RlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBzb3VyY2Vba2V5XSk7CgkJCX0pIDogT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMgPyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHNvdXJjZSkpIDogb3duS2V5cyhPYmplY3Qoc291cmNlKSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7CgkJCQlPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioc291cmNlLCBrZXkpKTsKCQkJfSk7CgkJfQoKCQlyZXR1cm4gdGFyZ2V0OwoJfQoKCWZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgdmFsdWUpIHsKCQlpZiAoa2V5IGluIG9iaikgewoJCQlPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsKCQkJCXZhbHVlOiB2YWx1ZSwKCQkJCWVudW1lcmFibGU6IHRydWUsCgkJCQljb25maWd1cmFibGU6IHRydWUsCgkJCQl3cml0YWJsZTogdHJ1ZQoJCQl9KTsKCQl9IGVsc2UgewoJCQlvYmpba2V5XSA9IHZhbHVlOwoJCX0KCgkJcmV0dXJuIG9iajsKCX0KCgljbGFzcyBYbmJFcnJvciBleHRlbmRzIEVycm9yIHsKCQljb25zdHJ1Y3RvcigpIHsKCQkJbGV0IG1lc3NhZ2UgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6ICcnOwoJCQlzdXBlcihtZXNzYWdlKTsKCQkJdGhpcy5uYW1lID0gIlhuYkVycm9yIjsKCQkJdGhpcy5tZXNzYWdlID0gbWVzc2FnZTsKCQkJRXJyb3IuY2FwdHVyZVN0YWNrVHJhY2UodGhpcywgWG5iRXJyb3IpOwoJCX0KCgl9CgoJZnVuY3Rpb24gcmVtb3ZlRXh0ZXJuQnJhY2tldChzdHIpIHsKCQlsZXQgYnJhY2tldFN0YWNrID0gW107CgkJbGV0IHJlc3VsdCA9IFtdOwoKCQlmb3IgKGxldCBpID0gMDsgaSA8IHN0ci5sZW5ndGg7IGkrKykgewoJCQlsZXQgYyA9IHN0cltpXTsKCQkJaWYgKGMgPT09ICJbIikgYnJhY2tldFN0YWNrLnB1c2goaSk7ZWxzZSBpZiAoYyA9PT0gIl0iKSB7CgkJCQlsZXQgc3RhcnRQb2ludCA9IGJyYWNrZXRTdGFjay5wb3AoKTsKCQkJCWlmIChzdGFydFBvaW50ID09PSB1bmRlZmluZWQpIHRocm93IG5ldyBFcnJvcigiSW52YWxpZCBCcmFja2V0IEZvcm0hIik7CgkJCQlpZiAoYnJhY2tldFN0YWNrLmxlbmd0aCA9PT0gMCkgcmVzdWx0LnB1c2goc3RyLnNsaWNlKHN0YXJ0UG9pbnQgKyAxLCBpKSk7CgkJCX0KCQl9CgoJCXJldHVybiByZXN1bHQ7Cgl9CgoJY2xhc3MgVHlwZVJlYWRlciB7CgkJc3RhdGljIHNldFJlYWRlcnMocmVhZGVycykgewoJCQlUeXBlUmVhZGVyLnJlYWRlcnMgPSBfb2JqZWN0U3ByZWFkMih7fSwgcmVhZGVycyk7CgkJfQoKCQlzdGF0aWMgYWRkUmVhZGVycyhyZWFkZXJzKSB7CgkJCVR5cGVSZWFkZXIucmVhZGVycyA9IF9vYmplY3RTcHJlYWQyKF9vYmplY3RTcHJlYWQyKHt9LCBUeXBlUmVhZGVyLnJlYWRlcnMpLCByZWFkZXJzKTsKCQl9CgoJCXN0YXRpYyBtYWtlU2ltcGxpZWQodHlwZSwgcmVhZGVyKSB7CgkJCWxldCBzaW1wbGUgPSB0eXBlLnNwbGl0KC9gfCwvKVswXTsKCgkJCWlmIChyZWFkZXIuaXNUeXBlT2Yoc2ltcGxlKSkgewoJCQkJaWYgKHJlYWRlci5oYXNTdWJUeXBlKCkpIHsKCQkJCQlsZXQgc3VidHlwZXMgPSBUeXBlUmVhZGVyLnBhcnNlU3VidHlwZXModHlwZSkubWFwKFR5cGVSZWFkZXIuc2ltcGxpZnlUeXBlLmJpbmQoVHlwZVJlYWRlcikpOwoJCQkJCXJldHVybiAiIi5jb25jYXQocmVhZGVyLnR5cGUoKSwgIjwiKS5jb25jYXQoc3VidHlwZXMuam9pbigiLCIpLCAiPiIpOwoJCQkJfSBlbHNlIHJldHVybiByZWFkZXIudHlwZSgpOwoJCQl9CgoJCQlyZXR1cm4gbnVsbDsKCQl9CgoJCXN0YXRpYyBzaW1wbGlmeVR5cGUodHlwZSkgewoJCQlsZXQgc2ltcGxlID0gdHlwZS5zcGxpdCgvYHwsLylbMF07CgkJCWxldCBpc0FycmF5ID0gc2ltcGxlLmVuZHNXaXRoKCdbXScpOwoJCQlpZiAoaXNBcnJheSkgcmV0dXJuICJBcnJheTwiLmNvbmNhdChzaW1wbGlmeVR5cGUoc2ltcGxlLnNsaWNlKDAsIC0yKSksICI+Iik7CgoJCQlpZiAoc2ltcGxlID09PSAnTWljcm9zb2Z0LlhuYS5GcmFtZXdvcmsuQ29udGVudC5SZWZsZWN0aXZlUmVhZGVyJykgewoJCQkJCWxldCByZWZsZWN0aXZlVHlwZSA9IFR5cGVSZWFkZXIucGFyc2VTdWJ0eXBlcyh0eXBlKS5tYXAoVHlwZVJlYWRlci5zaW1wbGlmeVR5cGUuYmluZChUeXBlUmVhZGVyKSk7CgkJCQkJcmV0dXJuICIiLmNvbmNhdChyZWZsZWN0aXZlVHlwZSk7CgkJCQl9CgoJCQlmb3IgKGxldCByZWFkZXIgb2YgT2JqZWN0LnZhbHVlcyhUeXBlUmVhZGVyLnJlYWRlcnMpKSB7CgkJCQlsZXQgcmVzdWx0ID0gVHlwZVJlYWRlci5tYWtlU2ltcGxpZWQodHlwZSwgcmVhZGVyKTsKCQkJCWlmIChyZXN1bHQgIT09IG51bGwpIHJldHVybiByZXN1bHQ7CgkJCX0KCgkJCXRocm93IG5ldyBYbmJFcnJvcigiTm9uLWltcGxlbWVudGVkIHR5cGUgZm91bmQsIGNhbm5vdCByZXNvbHZlIHR5cGUgXCIiLmNvbmNhdChzaW1wbGUsICJcIiwgXCIiKS5jb25jYXQodHlwZSwgIlwiLiIpKTsKCQl9CgoJCXN0YXRpYyBwYXJzZVN1YnR5cGVzKHR5cGUpIHsKCQkJbGV0IHN1YnR5cGUgPSB0eXBlLnNsaWNlKHR5cGUuc2VhcmNoKCJgIikgKyAxKTsKCQkJc3VidHlwZVswXTsKCQkJc3VidHlwZSA9IHJlbW92ZUV4dGVybkJyYWNrZXQoc3VidHlwZSlbMF07CgkJCWxldCBtYXRjaGVzID0gcmVtb3ZlRXh0ZXJuQnJhY2tldChzdWJ0eXBlKTsKCQkJcmV0dXJuIG1hdGNoZXM7CgkJfQoKCQlzdGF0aWMgZ2V0VHlwZUluZm8odHlwZSkgewoJCQlsZXQgbWFpblR5cGUgPSB0eXBlLm1hdGNoKC9bXjxdKy8pWzBdOwoJCQlsZXQgc3VidHlwZXMgPSB0eXBlLm1hdGNoKC88KC4rKT4vKTsKCQkJc3VidHlwZXMgPSBzdWJ0eXBlcyA/IHN1YnR5cGVzWzFdLnNwbGl0KCcsJykubWFwKHR5cGUgPT4gdHlwZS50cmltKCkpIDogW107CgkJCXJldHVybiB7CgkJCQl0eXBlOiBtYWluVHlwZSwKCQkJCXN1YnR5cGVzCgkJCX07CgkJfQoKCQlzdGF0aWMgZ2V0UmVhZGVyVHlwZUxpc3QodHlwZVN0cmluZykgewoJCQlsZXQgcmVhZGVyID0gVHlwZVJlYWRlci5nZXRSZWFkZXIodHlwZVN0cmluZyk7CgkJCXJldHVybiByZWFkZXIucGFyc2VUeXBlTGlzdCgpOwoJCX0KCgkJc3RhdGljIGdldFJlYWRlcih0eXBlU3RyaW5nKSB7CgkJCWxldCB7CgkJCQl0eXBlLAoJCQkJc3VidHlwZXMKCQkJfSA9IFR5cGVSZWFkZXIuZ2V0VHlwZUluZm8odHlwZVN0cmluZyk7CgkJCXN1YnR5cGVzID0gc3VidHlwZXMubWFwKFR5cGVSZWFkZXIuZ2V0UmVhZGVyLmJpbmQoVHlwZVJlYWRlcikpOwoJCQlpZiAoVHlwZVJlYWRlci5yZWFkZXJzLmhhc093blByb3BlcnR5KCIiLmNvbmNhdCh0eXBlLCAiUmVhZGVyIikpKSByZXR1cm4gbmV3IFR5cGVSZWFkZXIucmVhZGVyc1siIi5jb25jYXQodHlwZSwgIlJlYWRlciIpXSguLi5zdWJ0eXBlcyk7CgkJCXRocm93IG5ldyBYbmJFcnJvcigiSW52YWxpZCByZWFkZXIgdHlwZSBcIiIuY29uY2F0KHR5cGVTdHJpbmcsICJcIiBwYXNzZWQsIHVuYWJsZSB0byByZXNvbHZlISIpKTsKCQl9CgoJCXN0YXRpYyBnZXRSZWFkZXJGcm9tUmF3KHR5cGVTdHJpbmcpIHsKCQkJY29uc3Qgc2ltcGxpZmllZCA9IFR5cGVSZWFkZXIuc2ltcGxpZnlUeXBlKHR5cGVTdHJpbmcpOwoJCQlyZXR1cm4gVHlwZVJlYWRlci5nZXRSZWFkZXIoc2ltcGxpZmllZCk7CgkJfQoKCX0KCglfZGVmaW5lUHJvcGVydHkoVHlwZVJlYWRlciwgInJlYWRlcnMiLCB7fSk7CgoJY29uc3QgVVRGOF9GSVJTVF9CSVRFUyA9IFsweEMwLCAweEUwLCAweEYwXTsKCWNvbnN0IFVURjhfU0VDT05EX0JJVEVTID0gMHg4MDsKCWNvbnN0IFVURjhfTUFTSyA9IDBiMTExMTExOwoJY29uc3QgVVRGMTZfQklURVMgPSBbMHhEODAwLCAweERDMDBdOwoJY29uc3QgVVRGMTZfTUFTSyA9IDBiMTExMTExMTExMTsKCglmdW5jdGlvbiBVVEY4RW5jb2RlKGNvZGUpIHsKCQlpZiAoY29kZSA8IDB4ODApIHJldHVybiBbY29kZV07CgkJaWYgKGNvZGUgPCAweDgwMCkgcmV0dXJuIFtVVEY4X0ZJUlNUX0JJVEVTWzBdIHwgY29kZSA+PiA2LCBVVEY4X1NFQ09ORF9CSVRFUyB8IGNvZGUgJiBVVEY4X01BU0tdOwoJCWlmIChjb2RlIDwgMHgxMDAwMCkgcmV0dXJuIFtVVEY4X0ZJUlNUX0JJVEVTWzFdIHwgY29kZSA+PiAxMiwgVVRGOF9TRUNPTkRfQklURVMgfCBjb2RlID4+IDYgJiBVVEY4X01BU0ssIFVURjhfU0VDT05EX0JJVEVTIHwgY29kZSAmIFVURjhfTUFTS107CgkJcmV0dXJuIFtVVEY4X0ZJUlNUX0JJVEVTWzJdIHwgY29kZSA+PiAxOCwgVVRGOF9TRUNPTkRfQklURVMgfCBjb2RlID4+IDEyICYgVVRGOF9NQVNLLCBVVEY4X1NFQ09ORF9CSVRFUyB8IGNvZGUgPj4gNiAmIFVURjhfTUFTSywgVVRGOF9TRUNPTkRfQklURVMgfCBjb2RlICYgVVRGOF9NQVNLXTsKCX0KCglmdW5jdGlvbiBVVEYxNkVuY29kZShjb2RlKSB7CgkJaWYgKGNvZGUgPCAweEZGRkYpIHJldHVybiBbY29kZV07CgkJY29kZSAtPSAweDEwMDAwOwoJCXJldHVybiBbVVRGMTZfQklURVNbMF0gfCBjb2RlID4+IDEwICYgVVRGMTZfTUFTSywgVVRGMTZfQklURVNbMV0gfCBjb2RlICYgVVRGMTZfTUFTS107Cgl9CgoJZnVuY3Rpb24gVVRGOERlY29kZShjb2RlU2V0KSB7CgkJdmFyIF9jb2RlU2V0OwoKCQlpZiAodHlwZW9mIGNvZGVTZXQgPT09ICJudW1iZXIiKSBjb2RlU2V0ID0gW2NvZGVTZXRdOwoJCWlmICghKChfY29kZVNldCA9IGNvZGVTZXQpICE9PSBudWxsICYmIF9jb2RlU2V0ICE9PSB2b2lkIDAgJiYgX2NvZGVTZXQubGVuZ3RoKSkgdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIGNvZGVzZXQhIik7CgkJY29uc3QgY29kZVNldFJhbmdlID0gY29kZVNldC5sZW5ndGg7CgkJaWYgKGNvZGVTZXRSYW5nZSA9PT0gMSkgcmV0dXJuIGNvZGVTZXRbMF07CgkJaWYgKGNvZGVTZXRSYW5nZSA9PT0gMikgcmV0dXJuICgoY29kZVNldFswXSBeIFVURjhfRklSU1RfQklURVNbMF0pIDw8IDYpICsgKGNvZGVTZXRbMV0gXiBVVEY4X1NFQ09ORF9CSVRFUyk7CgoJCWlmIChjb2RlU2V0UmFuZ2UgPT09IDMpIHsKCQkJcmV0dXJuICgoY29kZVNldFswXSBeIFVURjhfRklSU1RfQklURVNbMV0pIDw8IDEyKSArICgoY29kZVNldFsxXSBeIFVURjhfU0VDT05EX0JJVEVTKSA8PCA2KSArIChjb2RlU2V0WzJdIF4gVVRGOF9TRUNPTkRfQklURVMpOwoJCX0KCgkJcmV0dXJuICgoY29kZVNldFswXSBeIFVURjhfRklSU1RfQklURVNbMl0pIDw8IDE4KSArICgoY29kZVNldFsxXSBeIFVURjhfU0VDT05EX0JJVEVTKSA8PCAxMikgKyAoKGNvZGVTZXRbMl0gXiBVVEY4X1NFQ09ORF9CSVRFUykgPDwgNikgKyAoY29kZVNldFszXSBeIFVURjhfU0VDT05EX0JJVEVTKTsKCX0KCglmdW5jdGlvbiBVVEYxNkRlY29kZShjb2RlU2V0KSB7CgkJdmFyIF9jb2RlU2V0MjsKCgkJaWYgKHR5cGVvZiBjb2RlU2V0ID09PSAibnVtYmVyIikgY29kZVNldCA9IFtjb2RlU2V0XTsKCQlpZiAoISgoX2NvZGVTZXQyID0gY29kZVNldCkgIT09IG51bGwgJiYgX2NvZGVTZXQyICE9PSB2b2lkIDAgJiYgX2NvZGVTZXQyLmxlbmd0aCkpIHRocm93IG5ldyBFcnJvcigiSW52YWxpZCBjb2Rlc2V0ISIpOwoJCWNvbnN0IGNvZGVTZXRSYW5nZSA9IGNvZGVTZXQubGVuZ3RoOwoJCWlmIChjb2RlU2V0UmFuZ2UgPT09IDEpIHJldHVybiBjb2RlU2V0WzBdOwoJCXJldHVybiAoKGNvZGVTZXRbMF0gJiBVVEYxNl9NQVNLKSA8PCAxMCkgKyAoY29kZVNldFsxXSAmIFVURjE2X01BU0spICsgMHgxMDAwMDsKCX0KCglmdW5jdGlvbiBzdHJpbmdUb1VuaWNvZGUoc3RyKSB7CgkJY29uc3QgdXRmMTZNYXAgPSBBcnJheS5mcm9tKHsKCQkJbGVuZ3RoOiBzdHIubGVuZ3RoCgkJfSwgKF8sIGkpID0+IHN0ci5jaGFyQ29kZUF0KGkpKTsKCQljb25zdCByZXN1bHQgPSBbXTsKCQlsZXQgaW5kZXggPSAwOwoKCQl3aGlsZSAoaW5kZXggPCBzdHIubGVuZ3RoKSB7CgkJCWxldCBjb2RlID0gdXRmMTZNYXBbaW5kZXhdOwoKCQkJaWYgKChVVEYxNl9CSVRFU1swXSAmIGNvZGUpICE9PSBVVEYxNl9CSVRFU1swXSkgewoJCQkJcmVzdWx0LnB1c2goY29kZSk7CgkJCQlpbmRleCsrOwoJCQl9IGVsc2UgewoJCQkJcmVzdWx0LnB1c2goVVRGMTZEZWNvZGUodXRmMTZNYXAuc2xpY2UoaW5kZXgsIGluZGV4ICsgMikpKTsKCQkJCWluZGV4ICs9IDI7CgkJCX0KCQl9CgoJCXJldHVybiByZXN1bHQ7Cgl9CgoJZnVuY3Rpb24gVVRGOFRvVW5pY29kZShjb2RlcykgewoJCWNvbnN0IGRhdGFBcnJheSA9IGNvZGVzIGluc3RhbmNlb2YgQXJyYXlCdWZmZXIgPyBuZXcgVWludDhBcnJheShjb2RlcykgOiBjb2RlczsKCQljb25zdCByZXN1bHQgPSBbXTsKCQlsZXQgaW5kZXggPSAwOwoKCQl3aGlsZSAoaW5kZXggPCBkYXRhQXJyYXkubGVuZ3RoKSB7CgkJCWxldCBoZWFkZXJDb2RlID0gZGF0YUFycmF5W2luZGV4XTsKCgkJCWlmICgoaGVhZGVyQ29kZSAmIDB4ODApID09PSAwKSB7CgkJCQlyZXN1bHQucHVzaChoZWFkZXJDb2RlKTsKCQkJCWluZGV4Kys7CgkJCX0gZWxzZSBpZiAoaGVhZGVyQ29kZSA8IFVURjhfRklSU1RfQklURVNbMV0pIHsKCQkJCXJlc3VsdC5wdXNoKFVURjhEZWNvZGUoZGF0YUFycmF5LnNsaWNlKGluZGV4LCBpbmRleCArIDIpKSk7CgkJCQlpbmRleCArPSAyOwoJCQl9IGVsc2UgaWYgKGhlYWRlckNvZGUgPCBVVEY4X0ZJUlNUX0JJVEVTWzJdKSB7CgkJCQlyZXN1bHQucHVzaChVVEY4RGVjb2RlKGRhdGFBcnJheS5zbGljZShpbmRleCwgaW5kZXggKyAzKSkpOwoJCQkJaW5kZXggKz0gMzsKCQkJfSBlbHNlIHsKCQkJCXJlc3VsdC5wdXNoKFVURjhEZWNvZGUoZGF0YUFycmF5LnNsaWNlKGluZGV4LCBpbmRleCArIDQpKSk7CgkJCQlpbmRleCArPSA0OwoJCQl9CgkJfQoKCQlyZXR1cm4gcmVzdWx0OwoJfQoKCWZ1bmN0aW9uIFVuaWNvZGVUb1VURjgodW5pY29kZUFycikgewoJCWNvbnN0IHJlc3VsdCA9IFtdOwoKCQlmb3IgKGxldCBjb2RlIG9mIHVuaWNvZGVBcnIpIHsKCQkJcmVzdWx0LnB1c2goLi4uVVRGOEVuY29kZShjb2RlKSk7CgkJfQoKCQlyZXR1cm4gcmVzdWx0OwoJfQoKCWZ1bmN0aW9uIFVuaWNvZGVUb1N0cmluZyh1bmljb2RlQXJyKSB7CgkJY29uc3QgcmVzdWx0ID0gW107CgoJCWZvciAobGV0IGNvZGUgb2YgdW5pY29kZUFycikgewoJCQlyZXN1bHQucHVzaCguLi5VVEYxNkVuY29kZShjb2RlKSk7CgkJfQoKCQljb25zdCBibG9ja1NpemUgPSAzMjc2ODsKCQlsZXQgcmVzdWx0U3RyID0gIiI7CgoJCWZvciAobGV0IGkgPSAwOyBpIDwgcmVzdWx0Lmxlbmd0aCAvIGJsb2NrU2l6ZTsgaSsrKSB7CgkJCXJlc3VsdFN0ciArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKC4uLnJlc3VsdC5zbGljZShpICogYmxvY2tTaXplLCAoaSArIDEpICogYmxvY2tTaXplKSk7CgkJfQoKCQlyZXR1cm4gcmVzdWx0U3RyOwoJfQoKCWZ1bmN0aW9uIHN0cmluZ1RvVVRGOChzdHIpIHsKCQlyZXR1cm4gVW5pY29kZVRvVVRGOChzdHJpbmdUb1VuaWNvZGUoc3RyKSk7Cgl9CgoJZnVuY3Rpb24gVVRGOFRvU3RyaW5nKHV0ZjhBcnJheSkgewoJCXJldHVybiBVbmljb2RlVG9TdHJpbmcoVVRGOFRvVW5pY29kZSh1dGY4QXJyYXkpKTsKCX0KCglmdW5jdGlvbiBVVEY4TGVuZ3RoKHN0cikgewoJCWNvbnN0IGNvZGVzID0gc3RyaW5nVG9Vbmljb2RlKHN0cik7CgkJcmV0dXJuIGNvZGVzLnJlZHVjZSgoc3VtLCB1bmljb2RlKSA9PiB7CgkJCWlmICh1bmljb2RlIDwgMHg4MCkgcmV0dXJuIHN1bSArIDE7CgkJCWlmICh1bmljb2RlIDwgMHg4MDApIHJldHVybiBzdW0gKyAyOwoJCQlpZiAodW5pY29kZSA8IDB4MTAwMDApIHJldHVybiBzdW0gKyAzOwoJCQlyZXR1cm4gc3VtICsgNDsKCQl9LCAwKTsKCX0KCgljb25zdCBMSVRUTEVfRU5ESUFOID0gdHJ1ZTsKCgljbGFzcyBCdWZmZXJSZWFkZXIgewoJCWNvbnN0cnVjdG9yKGJ1ZmZlcikgewoJCQlsZXQgZW5kaWFudXMgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IExJVFRMRV9FTkRJQU47CgkJCXRoaXMuX2VuZGlhbnVzID0gZW5kaWFudXM7CgkJCXRoaXMuX2J1ZmZlciA9IGJ1ZmZlci5zbGljZSgpOwoJCQl0aGlzLl9kYXRhVmlldyA9IG5ldyBEYXRhVmlldyh0aGlzLl9idWZmZXIpOwoJCQl0aGlzLl9vZmZzZXQgPSAwOwoJCQl0aGlzLl9iaXRPZmZzZXQgPSAwOwoJCX0KCgkJc2VlayhpbmRleCkgewoJCQlsZXQgb3JpZ2luID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiB0aGlzLl9vZmZzZXQ7CgkJCWNvbnN0IG9mZnNldCA9IHRoaXMuX29mZnNldDsKCQkJdGhpcy5fb2Zmc2V0ID0gTWF0aC5tYXgob3JpZ2luICsgTnVtYmVyLnBhcnNlSW50KGluZGV4KSwgMCk7CgkJCWlmICh0aGlzLl9vZmZzZXQgPCAwIHx8IHRoaXMuX29mZnNldCA+IHRoaXMuYnVmZmVyLmxlbmd0aCkgdGhyb3cgbmV3IFJhbmdlRXJyb3IoIkJ1ZmZlciBzZWVrIG91dCBvZiBib3VuZHMhICIuY29uY2F0KHRoaXMuX29mZnNldCwgIiAiKS5jb25jYXQodGhpcy5idWZmZXIubGVuZ3RoKSk7CgkJCXJldHVybiB0aGlzLl9vZmZzZXQgLSBvZmZzZXQ7CgkJfQoKCQlnZXQgYnl0ZVBvc2l0aW9uKCkgewoJCQlyZXR1cm4gTnVtYmVyLnBhcnNlSW50KHRoaXMuX29mZnNldCk7CgkJfQoKCQlzZXQgYnl0ZVBvc2l0aW9uKHZhbHVlKSB7CgkJCXRoaXMuX29mZnNldCA9IHZhbHVlOwoJCX0KCgkJZ2V0IGJpdFBvc2l0aW9uKCkgewoJCQlyZXR1cm4gTnVtYmVyLnBhcnNlSW50KHRoaXMuX2JpdE9mZnNldCk7CgkJfQoKCQlzZXQgYml0UG9zaXRpb24ob2Zmc2V0KSB7CgkJCWlmIChvZmZzZXQgPCAwKSBvZmZzZXQgPSAxNiAtIG9mZnNldDsKCQkJdGhpcy5fYml0T2Zmc2V0ID0gb2Zmc2V0ICUgMTY7CgkJCWNvbnN0IGJ5dGVTZWVrID0gKG9mZnNldCAtIE1hdGguYWJzKG9mZnNldCkgJSAxNikgLyAxNiAqIDI7CgkJCXRoaXMuc2VlayhieXRlU2Vlayk7CgkJfQoKCQlnZXQgc2l6ZSgpIHsKCQkJcmV0dXJuIHRoaXMuYnVmZmVyLmJ5dGVMZW5ndGg7CgkJfQoKCQlnZXQgYnVmZmVyKCkgewoJCQlyZXR1cm4gdGhpcy5fYnVmZmVyOwoJCX0KCgkJY29weUZyb20oYnVmZmVyKSB7CgkJCWxldCB0YXJnZXRJbmRleCA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogMDsKCQkJbGV0IHNvdXJjZUluZGV4ID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiAwOwoJCQlsZXQgbGVuZ3RoID0gYXJndW1lbnRzLmxlbmd0aCA+IDMgJiYgYXJndW1lbnRzWzNdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbM10gOiBidWZmZXIuYnl0ZUxlbmd0aDsKCQkJY29uc3Qgc291cmNlVmlldyA9IG5ldyBVaW50OEFycmF5KGJ1ZmZlcik7CgkJCWNvbnN0IGlzT3ZlcmZsb3cgPSB0aGlzLmJ1ZmZlci5ieXRlTGVuZ3RoIDwgbGVuZ3RoICsgdGFyZ2V0SW5kZXg7CgkJCWxldCB0YXJnZXRCdWZmZXIgPSB0aGlzLmJ1ZmZlcjsKCQkJbGV0IHRhcmdldFZpZXcgPSB0aGlzLl9kYXRhVmlldzsKCgkJCWlmIChpc092ZXJmbG93KSB7CgkJCQl0YXJnZXRCdWZmZXIgPSBuZXcgQXJyYXlCdWZmZXIodGhpcy5idWZmZXIuYnl0ZUxlbmd0aCArIChsZW5ndGggKyB0YXJnZXRJbmRleCAtIHRoaXMuYnVmZmVyLmJ5dGVMZW5ndGgpKTsKCQkJCXRhcmdldFZpZXcgPSBuZXcgRGF0YVZpZXcodGFyZ2V0QnVmZmVyKTsKCgkJCQlmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuYnVmZmVyLmJ5dGVMZW5ndGg7IGkrKykgewoJCQkJCXRhcmdldFZpZXcuc2V0VWludDgoaSwgdGhpcy5fZGF0YVZpZXcuZ2V0VWludDgoaSkpOwoJCQkJfQoJCQl9CgoJCQlmb3IgKGxldCBpID0gc291cmNlSW5kZXgsIGogPSB0YXJnZXRJbmRleDsgaSA8IGxlbmd0aDsgaSsrLCBqKyspIHsKCQkJCXRhcmdldFZpZXcuc2V0VWludDgoaiwgc291cmNlVmlld1tpXSk7CgkJCX0KCgkJCWlmIChpc092ZXJmbG93KSB7CgkJCQl0aGlzLl9idWZmZXIgPSB0YXJnZXRCdWZmZXI7CgkJCQl0aGlzLl9kYXRhVmlldyA9IHRhcmdldFZpZXc7CgkJCX0KCQl9CgoJCXJlYWQoY291bnQpIHsKCQkJY29uc3QgYnVmZmVyID0gdGhpcy5idWZmZXIuc2xpY2UodGhpcy5fb2Zmc2V0LCB0aGlzLl9vZmZzZXQgKyBjb3VudCk7CgkJCXRoaXMuc2Vlayhjb3VudCk7CgkJCXJldHVybiBidWZmZXI7CgkJfQoKCQlyZWFkQnl0ZSgpIHsKCQkJcmV0dXJuIHRoaXMucmVhZFVJbnQoKTsKCQl9CgoJCXJlYWRJbnQoKSB7CgkJCWNvbnN0IHZhbHVlID0gdGhpcy5fZGF0YVZpZXcuZ2V0SW50OCh0aGlzLl9vZmZzZXQpOwoKCQkJdGhpcy5zZWVrKDEpOwoJCQlyZXR1cm4gdmFsdWU7CgkJfQoKCQlyZWFkVUludCgpIHsKCQkJY29uc3QgdmFsdWUgPSB0aGlzLl9kYXRhVmlldy5nZXRVaW50OCh0aGlzLl9vZmZzZXQpOwoKCQkJdGhpcy5zZWVrKDEpOwoJCQlyZXR1cm4gdmFsdWU7CgkJfQoKCQlyZWFkVUludDE2KCkgewoJCQljb25zdCB2YWx1ZSA9IHRoaXMuX2RhdGFWaWV3LmdldFVpbnQxNih0aGlzLl9vZmZzZXQsIHRoaXMuX2VuZGlhbnVzKTsKCgkJCXRoaXMuc2VlaygyKTsKCQkJcmV0dXJuIHZhbHVlOwoJCX0KCgkJcmVhZFVJbnQzMigpIHsKCQkJY29uc3QgdmFsdWUgPSB0aGlzLl9kYXRhVmlldy5nZXRVaW50MzIodGhpcy5fb2Zmc2V0LCB0aGlzLl9lbmRpYW51cyk7CgoJCQl0aGlzLnNlZWsoNCk7CgkJCXJldHVybiB2YWx1ZTsKCQl9CgoJCXJlYWRJbnQxNigpIHsKCQkJY29uc3QgdmFsdWUgPSB0aGlzLl9kYXRhVmlldy5nZXRJbnQxNih0aGlzLl9vZmZzZXQsIHRoaXMuX2VuZGlhbnVzKTsKCgkJCXRoaXMuc2VlaygyKTsKCQkJcmV0dXJuIHZhbHVlOwoJCX0KCgkJcmVhZEludDMyKCkgewoJCQljb25zdCB2YWx1ZSA9IHRoaXMuX2RhdGFWaWV3LmdldEludDMyKHRoaXMuX29mZnNldCwgdGhpcy5fZW5kaWFudXMpOwoKCQkJdGhpcy5zZWVrKDQpOwoJCQlyZXR1cm4gdmFsdWU7CgkJfQoKCQlyZWFkU2luZ2xlKCkgewoJCQljb25zdCB2YWx1ZSA9IHRoaXMuX2RhdGFWaWV3LmdldEZsb2F0MzIodGhpcy5fb2Zmc2V0LCB0aGlzLl9lbmRpYW51cyk7CgoJCQl0aGlzLnNlZWsoNCk7CgkJCXJldHVybiB2YWx1ZTsKCQl9CgoJCXJlYWREb3VibGUoKSB7CgkJCWNvbnN0IHZhbHVlID0gdGhpcy5fZGF0YVZpZXcuZ2V0RmxvYXQzMih0aGlzLl9vZmZzZXQsIHRoaXMuX2VuZGlhbnVzKTsKCgkJCXRoaXMuc2Vlayg4KTsKCQkJcmV0dXJuIHZhbHVlOwoJCX0KCgkJcmVhZFN0cmluZygpIHsKCQkJbGV0IGNvdW50ID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiAtMTsKCQkJY29uc3QgY2hhcnMgPSBbXTsKCQkJdGhpcy5fb2Zmc2V0OwoKCQkJaWYgKGNvdW50ID09PSAtMSkgewoJCQkJd2hpbGUgKHRoaXMucGVla0J5dGUoMSkgIT0gMHgwKSBjaGFycy5wdXNoKHRoaXMucmVhZEJ5dGUoKSk7CgkJCX0gZWxzZSB7CgkJCQlmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyBpKyspIHsKCQkJCQljaGFycy5wdXNoKHRoaXMucmVhZEJ5dGUoKSk7CgkJCQl9CgkJCX0KCgkJCXJldHVybiBVVEY4VG9TdHJpbmcoY2hhcnMpOwoJCX0KCgkJcGVlayhjb3VudCkgewoJCQljb25zdCBidWZmZXIgPSB0aGlzLnJlYWQoY291bnQpOwoJCQl0aGlzLnNlZWsoLWNvdW50KTsKCQkJcmV0dXJuIGJ1ZmZlcjsKCQl9CgoJCXBlZWtCeXRlKCkgewoJCQlyZXR1cm4gdGhpcy5wZWVrVUludCgpOwoJCX0KCgkJcGVla0ludCgpIHsKCQkJY29uc3QgdmFsdWUgPSB0aGlzLl9kYXRhVmlldy5nZXRJbnQ4KHRoaXMuX29mZnNldCk7CgoJCQlyZXR1cm4gdmFsdWU7CgkJfQoKCQlwZWVrVUludCgpIHsKCQkJY29uc3QgdmFsdWUgPSB0aGlzLl9kYXRhVmlldy5nZXRVaW50OCh0aGlzLl9vZmZzZXQpOwoKCQkJcmV0dXJuIHZhbHVlOwoJCX0KCgkJcGVla1VJbnQxNigpIHsKCQkJY29uc3QgdmFsdWUgPSB0aGlzLl9kYXRhVmlldy5nZXRVaW50MTYodGhpcy5fb2Zmc2V0LCB0aGlzLl9lbmRpYW51cyk7CgoJCQlyZXR1cm4gdmFsdWU7CgkJfQoKCQlwZWVrVUludDMyKCkgewoJCQljb25zdCB2YWx1ZSA9IHRoaXMuX2RhdGFWaWV3LmdldFVpbnQzMih0aGlzLl9vZmZzZXQsIHRoaXMuX2VuZGlhbnVzKTsKCgkJCXJldHVybiB2YWx1ZTsKCQl9CgoJCXBlZWtJbnQxNigpIHsKCQkJY29uc3QgdmFsdWUgPSB0aGlzLl9kYXRhVmlldy5nZXRJbnQxNih0aGlzLl9vZmZzZXQsIHRoaXMuX2VuZGlhbnVzKTsKCgkJCXJldHVybiB2YWx1ZTsKCQl9CgoJCXBlZWtJbnQzMigpIHsKCQkJY29uc3QgdmFsdWUgPSB0aGlzLl9kYXRhVmlldy5nZXRJbnQzMih0aGlzLl9vZmZzZXQsIHRoaXMuX2VuZGlhbnVzKTsKCgkJCXJldHVybiB2YWx1ZTsKCQl9CgoJCXBlZWtTaW5nbGUoKSB7CgkJCWNvbnN0IHZhbHVlID0gdGhpcy5fZGF0YVZpZXcuZ2V0RmxvYXQzMih0aGlzLl9vZmZzZXQsIHRoaXMuX2VuZGlhbnVzKTsKCgkJCXJldHVybiB2YWx1ZTsKCQl9CgoJCXBlZWtEb3VibGUoKSB7CgkJCWNvbnN0IHZhbHVlID0gdGhpcy5fZGF0YVZpZXcuZ2V0RmxvYXQ2NCh0aGlzLl9vZmZzZXQsIHRoaXMuX2VuZGlhbnVzKTsKCgkJCXJldHVybiB2YWx1ZTsKCQl9CgoJCXBlZWtTdHJpbmcoKSB7CgkJCWxldCBjb3VudCA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogMDsKCQkJY29uc3QgY2hhcnMgPSBbXTsKCQkJY29uc3Qgc3RhcnRPZmZzZXQgPSB0aGlzLl9vZmZzZXQ7CgoJCQlpZiAoY291bnQgPT09IDApIHsKCQkJCXdoaWxlICh0aGlzLnBlZWtCeXRlKDEpICE9IDB4MCkgY2hhcnMucHVzaCh0aGlzLnJlYWRCeXRlKCkpOwoJCQl9IGVsc2UgewoJCQkJZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7CgkJCQkJY2hhcnMucHVzaCh0aGlzLnJlYWRCeXRlKCkpOwoJCQkJfQoJCQl9CgoJCQl0aGlzLmJ5dGVQb3NpdGlvbiA9IHN0YXJ0T2Zmc2V0OwoJCQlyZXR1cm4gVVRGOFRvU3RyaW5nKGNoYXJzKTsKCQl9CgoJCXJlYWQ3Qml0TnVtYmVyKCkgewoJCQlsZXQgcmVzdWx0ID0gMDsKCQkJbGV0IGJpdHNSZWFkID0gMDsKCQkJbGV0IHZhbHVlOwoKCQkJZG8gewoJCQkJdmFsdWUgPSB0aGlzLnJlYWRCeXRlKCk7CgkJCQlyZXN1bHQgfD0gKHZhbHVlICYgMHg3RikgPDwgYml0c1JlYWQ7CgkJCQliaXRzUmVhZCArPSA3OwoJCQl9IHdoaWxlICh2YWx1ZSAmIDB4ODApOwoKCQkJcmV0dXJuIHJlc3VsdDsKCQl9CgoJCXJlYWRMWlhCaXRzKGJpdHMpIHsKCQkJbGV0IGJpdHNMZWZ0ID0gYml0czsKCQkJbGV0IHJlYWQgPSAwOwoKCQkJd2hpbGUgKGJpdHNMZWZ0ID4gMCkgewoJCQkJY29uc3QgcGVlayA9IHRoaXMuX2RhdGFWaWV3LmdldFVpbnQxNih0aGlzLl9vZmZzZXQsIHRydWUpOwoKCQkJCWNvbnN0IGJpdHNJbkZyYW1lID0gTWF0aC5taW4oTWF0aC5tYXgoYml0c0xlZnQsIDApLCAxNiAtIHRoaXMuYml0UG9zaXRpb24pOwoJCQkJY29uc3Qgb2Zmc2V0ID0gMTYgLSB0aGlzLmJpdFBvc2l0aW9uIC0gYml0c0luRnJhbWU7CgkJCQljb25zdCB2YWx1ZSA9IChwZWVrICYgMiAqKiBiaXRzSW5GcmFtZSAtIDEgPDwgb2Zmc2V0KSA+PiBvZmZzZXQ7CgkJCQliaXRzTGVmdCAtPSBiaXRzSW5GcmFtZTsKCQkJCXRoaXMuYml0UG9zaXRpb24gKz0gYml0c0luRnJhbWU7CgkJCQlyZWFkIHw9IHZhbHVlIDw8IGJpdHNMZWZ0OwoJCQl9CgoJCQlyZXR1cm4gcmVhZDsKCQl9CgoJCXBlZWtMWlhCaXRzKGJpdHMpIHsKCQkJbGV0IGJpdFBvc2l0aW9uID0gdGhpcy5iaXRQb3NpdGlvbjsKCQkJbGV0IGJ5dGVQb3NpdGlvbiA9IHRoaXMuYnl0ZVBvc2l0aW9uOwoJCQljb25zdCByZWFkID0gdGhpcy5yZWFkTFpYQml0cyhiaXRzKTsKCQkJdGhpcy5iaXRQb3NpdGlvbiA9IGJpdFBvc2l0aW9uOwoJCQl0aGlzLmJ5dGVQb3NpdGlvbiA9IGJ5dGVQb3NpdGlvbjsKCQkJcmV0dXJuIHJlYWQ7CgkJfQoKCQlyZWFkTFpYSW50MTYoKSB7CgkJCWxldCBzZWVrID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB0cnVlOwoJCQljb25zdCBsc0IgPSB0aGlzLnJlYWRCeXRlKCk7CgkJCWNvbnN0IG1zQiA9IHRoaXMucmVhZEJ5dGUoKTsKCQkJaWYgKCFzZWVrKSB0aGlzLnNlZWsoLTIpOwoJCQlyZXR1cm4gbHNCIDw8IDggfCBtc0I7CgkJfQoKCQlhbGlnbigpIHsKCQkJaWYgKHRoaXMuYml0UG9zaXRpb24gPiAwKSB0aGlzLmJpdFBvc2l0aW9uICs9IDE2IC0gdGhpcy5iaXRQb3NpdGlvbjsKCQl9CgoJfQoKCWNsYXNzIEJ1ZmZlcldyaXRlciB7CgkJY29uc3RydWN0b3IoKSB7CgkJCWxldCBzaXplID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiAyMDQ4OwoJCQl0aGlzLl9idWZmZXIgPSBuZXcgQXJyYXlCdWZmZXIoc2l6ZSk7CgkJCXRoaXMuX2RhdGFWaWV3ID0gbmV3IERhdGFWaWV3KHRoaXMuX2J1ZmZlcik7CgkJCXRoaXMuYnl0ZVBvc2l0aW9uID0gMDsKCQl9CgoJCWdldCBidWZmZXIoKSB7CgkJCXJldHVybiB0aGlzLl9idWZmZXI7CgkJfQoKCQlyZWNvbm5lY3REYXRhVmlldygpIHsKCQkJdGhpcy5fZGF0YVZpZXcgPSBuZXcgRGF0YVZpZXcodGhpcy5fYnVmZmVyKTsKCQl9CgoJCXRyaW0oKSB7CgkJCWxldCBwZW5kaW5nID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiBmYWxzZTsKCQkJdGhpcy5fYnVmZmVyID0gdGhpcy5idWZmZXIuc2xpY2UoMCwgdGhpcy5ieXRlUG9zaXRpb24pOwoJCQlpZiAoIXBlbmRpbmcpIHRoaXMucmVjb25uZWN0RGF0YVZpZXcoKTsKCQl9CgoJCWFsbG9jKGJ5dGVzKSB7CgkJCWlmICh0aGlzLl9idWZmZXIuYnl0ZUxlbmd0aCA8PSB0aGlzLmJ5dGVQb3NpdGlvbiArIGJ5dGVzKSB7CgkJCQljb25zdCB0QnVmZmVyID0gbmV3IEFycmF5QnVmZmVyKHRoaXMuX2J1ZmZlci5ieXRlTGVuZ3RoICsgYnl0ZXMpOwoJCQkJY29uc3QgdERhdGFWaWV3ID0gbmV3IERhdGFWaWV3KHRCdWZmZXIpOwoKCQkJCWZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5idWZmZXIuYnl0ZUxlbmd0aDsgaSsrKSB7CgkJCQkJdERhdGFWaWV3LnNldFVpbnQ4KGksIHRoaXMuX2RhdGFWaWV3LmdldFVpbnQ4KGkpKTsKCQkJCX0KCgkJCQl0aGlzLl9idWZmZXIgPSB0QnVmZmVyOwoJCQkJdGhpcy5fZGF0YVZpZXcgPSB0RGF0YVZpZXc7CgkJCX0KCgkJCXJldHVybiB0aGlzOwoJCX0KCgkJY29uY2F0KGJ1ZmZlcikgewoJCQljb25zdCB0YXJnZXRCdWZmZXJWaWV3ID0gbmV3IFVpbnQ4QXJyYXkoYnVmZmVyKTsKCQkJY29uc3QgbmV3UG9zaXRpb24gPSB0aGlzLmJ5dGVQb3NpdGlvbiArIHRhcmdldEJ1ZmZlclZpZXcubGVuZ3RoOwoJCQl0aGlzLmFsbG9jKHRhcmdldEJ1ZmZlclZpZXcubGVuZ3RoKTsKCgkJCWZvciAobGV0IGkgPSB0aGlzLmJ5dGVQb3NpdGlvbjsgaSA8IG5ld1Bvc2l0aW9uOyBpKyspIHsKCQkJCXRoaXMuX2RhdGFWaWV3LnNldFVpbnQ4KGksIHRhcmdldEJ1ZmZlclZpZXdbaSAtIHRoaXMuYnl0ZVBvc2l0aW9uXSk7CgkJCX0KCgkJCXRoaXMuYnl0ZVBvc2l0aW9uID0gbmV3UG9zaXRpb247CgkJCXRoaXMudHJpbSgpOwoJCX0KCgkJd3JpdGUoYnl0ZXMpIHsKCQkJY29uc3QgdGFyZ2V0QnVmZmVyVmlldyA9IG5ldyBVaW50OEFycmF5KGJ5dGVzKTsKCQkJY29uc3QgbmV3UG9zaXRpb24gPSB0aGlzLmJ5dGVQb3NpdGlvbiArIHRhcmdldEJ1ZmZlclZpZXcubGVuZ3RoOwoJCQl0aGlzLmFsbG9jKHRhcmdldEJ1ZmZlclZpZXcubGVuZ3RoKTsKCgkJCWZvciAobGV0IGkgPSB0aGlzLmJ5dGVQb3NpdGlvbjsgaSA8IG5ld1Bvc2l0aW9uOyBpKyspIHsKCQkJCXRoaXMuX2RhdGFWaWV3LnNldFVpbnQ4KGksIHRhcmdldEJ1ZmZlclZpZXdbaSAtIHRoaXMuYnl0ZVBvc2l0aW9uXSk7CgkJCX0KCgkJCXRoaXMuYnl0ZVBvc2l0aW9uID0gbmV3UG9zaXRpb247CgkJfQoKCQl3cml0ZVN0cmluZyhzdHIpIHsKCQkJbGV0IHV0ZjhEYXRhID0gc3RyaW5nVG9VVEY4KHN0cik7CgkJCXRoaXMud3JpdGUodXRmOERhdGEpOwoJCX0KCgkJd3JpdGVCeXRlKGJ5dGUpIHsKCQkJdGhpcy5hbGxvYygxKS5fZGF0YVZpZXcuc2V0VWludDgodGhpcy5ieXRlUG9zaXRpb24sIGJ5dGUpOwoKCQkJdGhpcy5ieXRlUG9zaXRpb24rKzsKCQl9CgoJCXdyaXRlSW50KG51bWJlcikgewoJCQl0aGlzLmFsbG9jKDEpLl9kYXRhVmlldy5zZXRJbnQ4KHRoaXMuYnl0ZVBvc2l0aW9uLCBudW1iZXIpOwoKCQkJdGhpcy5ieXRlUG9zaXRpb24rKzsKCQl9CgoJCXdyaXRlVUludChudW1iZXIpIHsKCQkJdGhpcy5hbGxvYygxKS5fZGF0YVZpZXcuc2V0VWludDgodGhpcy5ieXRlUG9zaXRpb24sIG51bWJlcik7CgoJCQl0aGlzLmJ5dGVQb3NpdGlvbisrOwoJCX0KCgkJd3JpdGVJbnQxNihudW1iZXIpIHsKCQkJdGhpcy5hbGxvYygyKS5fZGF0YVZpZXcuc2V0SW50MTYodGhpcy5ieXRlUG9zaXRpb24sIG51bWJlciwgdHJ1ZSk7CgoJCQl0aGlzLmJ5dGVQb3NpdGlvbiArPSAyOwoJCX0KCgkJd3JpdGVVSW50MTYobnVtYmVyKSB7CgkJCXRoaXMuYWxsb2MoMikuX2RhdGFWaWV3LnNldFVpbnQxNih0aGlzLmJ5dGVQb3NpdGlvbiwgbnVtYmVyLCB0cnVlKTsKCgkJCXRoaXMuYnl0ZVBvc2l0aW9uICs9IDI7CgkJfQoKCQl3cml0ZUludDMyKG51bWJlcikgewoJCQl0aGlzLmFsbG9jKDQpLl9kYXRhVmlldy5zZXRJbnQzMih0aGlzLmJ5dGVQb3NpdGlvbiwgbnVtYmVyLCB0cnVlKTsKCgkJCXRoaXMuYnl0ZVBvc2l0aW9uICs9IDQ7CgkJfQoKCQl3cml0ZVVJbnQzMihudW1iZXIpIHsKCQkJdGhpcy5hbGxvYyg0KS5fZGF0YVZpZXcuc2V0VWludDMyKHRoaXMuYnl0ZVBvc2l0aW9uLCBudW1iZXIsIHRydWUpOwoKCQkJdGhpcy5ieXRlUG9zaXRpb24gKz0gNDsKCQl9CgoJCXdyaXRlU2luZ2xlKG51bWJlcikgewoJCQl0aGlzLmFsbG9jKDQpLl9kYXRhVmlldy5zZXRGbG9hdDMyKHRoaXMuYnl0ZVBvc2l0aW9uLCBudW1iZXIsIHRydWUpOwoKCQkJdGhpcy5ieXRlUG9zaXRpb24gKz0gNDsKCQl9CgoJCXdyaXRlRG91YmxlKG51bWJlcikgewoJCQl0aGlzLmFsbG9jKDgpLl9kYXRhVmlldy5zZXRGbG9hdDY0KHRoaXMuYnl0ZVBvc2l0aW9uLCBudW1iZXIsIHRydWUpOwoKCQkJdGhpcy5ieXRlUG9zaXRpb24gKz0gODsKCQl9CgoJCXdyaXRlN0JpdE51bWJlcihudW1iZXIpIHsKCQkJdGhpcy5hbGxvYygyKTsKCgkJCWRvIHsKCQkJCWxldCBieXRlID0gbnVtYmVyICYgMHg3RjsKCQkJCW51bWJlciA9IG51bWJlciA+PiA3OwoJCQkJaWYgKG51bWJlcikgYnl0ZSB8PSAweDgwOwoKCQkJCXRoaXMuX2RhdGFWaWV3LnNldFVpbnQ4KHRoaXMuYnl0ZVBvc2l0aW9uLCBieXRlKTsKCgkJCQl0aGlzLmJ5dGVQb3NpdGlvbisrOwoJCQl9IHdoaWxlIChudW1iZXIpOwoJCX0KCgl9CgoJLyoqIEBsaWNlbnNlCgkgKgoJICogVGhpcyBmaWxlIGlzIGhlYXZpbHkgYmFzZWQgb24gTW9ub0dhbWUncyBpbXBsZW1lbnRhdGlvbiBvZiB0aGVpciBMenhEZWNvZGVyIGF0dHJpYnV0ZWQgdG8gQWxpIFNjaXNzb25zCgkgKiB3aGljaCBpcyBkZXJpdmVkIGZyb20gbGlibXNwYWNrIGJ5IFN0dWFydCBDb2xlLgoJICoKCSAqIChDKSAyMDAzLTIwMDQgU3R1YXJ0IENhaWUuCgkgKiAoQykgMjAxMSBBbGkgU2Npc3NvbnMuCgkgKiAoQykgMjAxNyBKYW1lcyBTdGluZS4KCSAqCgkgKiBUaGUgTFpYIG1ldGhvZCB3YXMgY3JlYXRlZCBieSBKb2huYXRoYW4gRm9yYmVzIGFuZCBUb21pIFBvdXRhbmVuLCBhZGFwdGVkIGJ5IE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4KCSAqCgkgKiAKCSAqIEdOVSBMRVNTRVIgR0VORVJBTCBQVUJMSUMgTElDRU5TRSB2ZXJzaW9uIDIuMQoJICogTHp4RGVjb2RlciBpcyBmcmVlIHNvZnR3YXJlOyB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5IGl0IHVuZGVyCgkgKiB0aGUgdGVybXMgb2YgdGhlIEdOVSBMZXNzZXIgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSAoTEdQTCkgdmVyc2lvbiAyLjEgCgkgKgoJICogTUlDUk9TT0ZUIFBVQkxJQyBMSUNFTlNFCgkgKiBUaGlzIHNvdXJjZSBjb2RlIGEgZGVyaXZhdGl2ZSBvbiBMenhEZWNvZGVyIGFuZCBpcyBzdWJqZWN0IHRvIHRoZSB0ZXJtcyBvZiB0aGUgTWljcm9zb2Z0IFB1YmxpYyBMaWNlbnNlIChNcy1QTCkuIAoJICoJCgkgKiBSZWRpc3RyaWJ1dGlvbiBhbmQgdXNlIGluIHNvdXJjZSBhbmQgYmluYXJ5IGZvcm1zLCB3aXRoIG9yIHdpdGhvdXQgbW9kaWZpY2F0aW9uLCAKCSAqIGlzIHBlcm1pdHRlZCBwcm92aWRlZCB0aGF0IHJlZGlzdHJpYnV0aW9ucyBvZiB0aGUgc291cmNlIGNvZGUgcmV0YWluIHRoZSBhYm92ZSAKCSAqIGNvcHlyaWdodCBub3RpY2VzIGFuZCB0aGlzIGZpbGUgaGVhZGVyLiAKCSAqCQoJICogQWRkaXRpb25hbCBjb3B5cmlnaHQgbm90aWNlcyBzaG91bGQgYmUgYXBwZW5kZWQgdG8gdGhlIGxpc3QgYWJvdmUuIAoJICogCgkgKiBGb3IgZGV0YWlscywgc2VlIDxodHRwOi8vd3d3Lm9wZW5zb3VyY2Uub3JnL2xpY2Vuc2VzL21zLXBsLmh0bWw+LgoJICoKCSAqCgkgKiBJIG1hZGUgdGhlIG1pc3Rha2Ugb2Ygbm90IGluY2x1ZGluZyB0aGlzIGxpY2Vuc2UgeWVhcnMgYWdvLiBCaWcgdGhhbmtzIHRvIGV2ZXJ5b25lIGludm9sdmVkIGFuZCBsaWNlbnNlIGhhcyBub3cgYmVlbgoJICogYWNrbm93bGVkZWQgcHJvcGVybHkgYXMgaXQgc2hvdWxkIGhhdmUgYmVlbiBiYWNrIGluIDIwMTcuCgkgKgoJICogUmVzb3VyY2VzOgoJICoKCSAqIGNhYmV4dHJhY3QvbGlibXNwYWNrIC0gaHR0cDovL2h0dHA6Ly93d3cuY2FiZXh0cmFjdC5vcmcudWsvCgkgKiBNb25vR2FtZSBMenhEZWNvZGVyLmNzIC0gaHR0cHM6Ly9naXRodWIuY29tL01vbm9HYW1lL01vbm9HYW1lL2Jsb2IvbWFzdGVyL01vbm9HYW1lLkZyYW1ld29yay9Db250ZW50L0x6eERlY29kZXIuY3MKCSAqCgkgKi8KCWNvbnN0IE1JTl9NQVRDSCA9IDI7Cgljb25zdCBOVU1fQ0hBUlMgPSAyNTY7Cgljb25zdCBCTE9DS1RZUEUgPSB7CgkJSU5WQUxJRDogMCwKCQlWRVJCQVRJTTogMSwKCQlBTElHTkVEOiAyLAoJCVVOQ09NUFJFU1NFRDogMwoJfTsKCWNvbnN0IFBSRVRSRUVfTlVNX0VMRU1FTlRTID0gMjA7Cgljb25zdCBBTElHTkVEX05VTV9FTEVNRU5UUyA9IDg7Cgljb25zdCBOVU1fUFJJTUFSWV9MRU5HVEhTID0gNzsKCWNvbnN0IE5VTV9TRUNPTkRBUllfTEVOR1RIUyA9IDI0OTsKCWNvbnN0IFBSRVRSRUVfTUFYU1lNQk9MUyA9IFBSRVRSRUVfTlVNX0VMRU1FTlRTOwoJY29uc3QgUFJFVFJFRV9UQUJMRUJJVFMgPSA2OwoJY29uc3QgTUFJTlRSRUVfTUFYU1lNQk9MUyA9IE5VTV9DSEFSUyArIDUwICogODsKCWNvbnN0IE1BSU5UUkVFX1RBQkxFQklUUyA9IDEyOwoJY29uc3QgTEVOR1RIX01BWFNZTUJPTFMgPSBOVU1fU0VDT05EQVJZX0xFTkdUSFMgKyAxOwoJY29uc3QgTEVOR1RIX1RBQkxFQklUUyA9IDEyOwoJY29uc3QgQUxJR05FRF9NQVhTWU1CT0xTID0gQUxJR05FRF9OVU1fRUxFTUVOVFM7Cgljb25zdCBBTElHTkVEX1RBQkxFQklUUyA9IDc7CgoJY2xhc3MgTHp4IHsKCQljb25zdHJ1Y3Rvcih3aW5kb3dfYml0cykgewoJCQl0aGlzLndpbmRvd19zaXplID0gMSA8PCB3aW5kb3dfYml0czsKCQkJaWYgKHdpbmRvd19iaXRzIDwgMTUgfHwgd2luZG93X2JpdHMgPiAyMSkgdGhyb3cgbmV3IFhuYkVycm9yKCdXaW5kb3cgc2l6ZSBvdXQgb2YgcmFuZ2UhJyk7CgoJCQlpZiAoIUx6eC5leHRyYV9iaXRzLmxlbmd0aCkgewoJCQkJZm9yIChsZXQgaSA9IDAsIGogPSAwOyBpIDw9IDUwOyBpICs9IDIpIHsKCQkJCQlMenguZXh0cmFfYml0c1tpXSA9IEx6eC5leHRyYV9iaXRzW2kgKyAxXSA9IGo7CgkJCQkJaWYgKGkgIT0gMCAmJiBqIDwgMTcpIGorKzsKCQkJCX0KCQkJfQoKCQkJaWYgKCFMengucG9zaXRpb25fYmFzZS5sZW5ndGgpIHsKCQkJCWZvciAobGV0IGkgPSAwLCBqID0gMDsgaSA8PSA1MDsgaSsrKSB7CgkJCQkJTHp4LnBvc2l0aW9uX2Jhc2VbaV0gPSBqOwoJCQkJCWogKz0gMSA8PCBMenguZXh0cmFfYml0c1tpXTsKCQkJCX0KCQkJfQoKCQkJY29uc3QgcG9zbl9zbG90cyA9IHdpbmRvd19iaXRzID09IDIxID8gNTAgOiB3aW5kb3dfYml0cyA9PSAyMCA/IDQyIDogd2luZG93X2JpdHMgPDwgMTsKCQkJdGhpcy5SMCA9IHRoaXMuUjEgPSB0aGlzLlIyID0gMTsKCQkJdGhpcy5tYWluX2VsZW1lbnRzID0gTlVNX0NIQVJTICsgKHBvc25fc2xvdHMgPDwgMyk7CgkJCXRoaXMuaGVhZGVyX3JlYWQgPSBmYWxzZTsKCQkJdGhpcy5ibG9ja19yZW1haW5pbmcgPSAwOwoJCQl0aGlzLmJsb2NrX3R5cGUgPSBCTE9DS1RZUEUuSU5WQUxJRDsKCQkJdGhpcy53aW5kb3dfcG9zbiA9IDA7CgkJCXRoaXMucHJldHJlZV90YWJsZSA9IFtdOwoJCQl0aGlzLnByZXRyZWVfbGVuID0gW107CgkJCXRoaXMuYWxpZ25lZF90YWJsZSA9IFtdOwoJCQl0aGlzLmFsaWduZWRfbGVuID0gW107CgkJCXRoaXMubGVuZ3RoX3RhYmxlID0gW107CgkJCXRoaXMubGVuZ3RoX2xlbiA9IFtdOwoJCQl0aGlzLm1haW50cmVlX3RhYmxlID0gW107CgkJCXRoaXMubWFpbnRyZWVfbGVuID0gW107CgoJCQlmb3IgKGxldCBpID0gMDsgaSA8IE1BSU5UUkVFX01BWFNZTUJPTFM7IGkrKykgdGhpcy5tYWludHJlZV9sZW5baV0gPSAwOwoKCQkJZm9yIChsZXQgaSA9IDA7IGkgPCBOVU1fU0VDT05EQVJZX0xFTkdUSFM7IGkrKykgdGhpcy5sZW5ndGhfbGVuW2ldID0gMDsKCgkJCXRoaXMud2luID0gW107CgkJfQoKCQlkZWNvbXByZXNzKGJ1ZmZlciwgZnJhbWVfc2l6ZSwgYmxvY2tfc2l6ZSkgewoJCQlpZiAoIXRoaXMuaGVhZGVyX3JlYWQpIHsKCQkJCWNvbnN0IGludGVsID0gYnVmZmVyLnJlYWRMWlhCaXRzKDEpOwoJCQkJaWYgKGludGVsICE9IDApIHRocm93IG5ldyBYbmJFcnJvcigiSW50ZWwgRTggQ2FsbCBmb3VuZCwgaW52YWxpZCBmb3IgWE5CIGZpbGVzLiIpOwoJCQkJdGhpcy5oZWFkZXJfcmVhZCA9IHRydWU7CgkJCX0KCgkJCWxldCB0b2dvID0gZnJhbWVfc2l6ZTsKCgkJCXdoaWxlICh0b2dvID4gMCkgewoJCQkJaWYgKHRoaXMuYmxvY2tfcmVtYWluaW5nID09IDApIHsKCQkJCQl0aGlzLmJsb2NrX3R5cGUgPSBidWZmZXIucmVhZExaWEJpdHMoMyk7CgkJCQkJY29uc3QgaGkgPSBidWZmZXIucmVhZExaWEJpdHMoMTYpOwoJCQkJCWNvbnN0IGxvID0gYnVmZmVyLnJlYWRMWlhCaXRzKDgpOwoJCQkJCXRoaXMuYmxvY2tfcmVtYWluaW5nID0gaGkgPDwgOCB8IGxvOwoKCQkJCQlzd2l0Y2ggKHRoaXMuYmxvY2tfdHlwZSkgewoJCQkJCQljYXNlIEJMT0NLVFlQRS5BTElHTkVEOgoJCQkJCQkJZm9yIChsZXQgaSA9IDA7IGkgPCA4OyBpKyspIHRoaXMuYWxpZ25lZF9sZW5baV0gPSBidWZmZXIucmVhZExaWEJpdHMoMyk7CgoJCQkJCQkJdGhpcy5hbGlnbmVkX3RhYmxlID0gdGhpcy5kZWNvZGVUYWJsZShBTElHTkVEX01BWFNZTUJPTFMsIEFMSUdORURfVEFCTEVCSVRTLCB0aGlzLmFsaWduZWRfbGVuKTsKCgkJCQkJCWNhc2UgQkxPQ0tUWVBFLlZFUkJBVElNOgoJCQkJCQkJdGhpcy5yZWFkTGVuZ3RocyhidWZmZXIsIHRoaXMubWFpbnRyZWVfbGVuLCAwLCAyNTYpOwoJCQkJCQkJdGhpcy5yZWFkTGVuZ3RocyhidWZmZXIsIHRoaXMubWFpbnRyZWVfbGVuLCAyNTYsIHRoaXMubWFpbl9lbGVtZW50cyk7CgkJCQkJCQl0aGlzLm1haW50cmVlX3RhYmxlID0gdGhpcy5kZWNvZGVUYWJsZShNQUlOVFJFRV9NQVhTWU1CT0xTLCBNQUlOVFJFRV9UQUJMRUJJVFMsIHRoaXMubWFpbnRyZWVfbGVuKTsKCQkJCQkJCXRoaXMucmVhZExlbmd0aHMoYnVmZmVyLCB0aGlzLmxlbmd0aF9sZW4sIDAsIE5VTV9TRUNPTkRBUllfTEVOR1RIUyk7CgkJCQkJCQl0aGlzLmxlbmd0aF90YWJsZSA9IHRoaXMuZGVjb2RlVGFibGUoTEVOR1RIX01BWFNZTUJPTFMsIExFTkdUSF9UQUJMRUJJVFMsIHRoaXMubGVuZ3RoX2xlbik7CgkJCQkJCQlicmVhazsKCgkJCQkJCWNhc2UgQkxPQ0tUWVBFLlVOQ09NUFJFU1NFRDoKCQkJCQkJCWJ1ZmZlci5hbGlnbigpOwoJCQkJCQkJdGhpcy5SMCA9IGJ1ZmZlci5yZWFkSW50MzIoKTsKCQkJCQkJCXRoaXMuUjEgPSBidWZmZXIucmVhZEludDMyKCk7CgkJCQkJCQl0aGlzLlIyID0gYnVmZmVyLnJlYWRJbnQzMigpOwoJCQkJCQkJYnJlYWs7CgoJCQkJCQlkZWZhdWx0OgoJCQkJCQkJdGhyb3cgbmV3IFhuYkVycm9yKCJJbnZhbGlkIEJsb2NrdHlwZSBGb3VuZDogIi5jb25jYXQodGhpcy5ibG9ja190eXBlKSk7CgkJCQkJfQoJCQkJfQoKCQkJCWxldCB0aGlzX3J1biA9IHRoaXMuYmxvY2tfcmVtYWluaW5nOwoKCQkJCXdoaWxlICgodGhpc19ydW4gPSB0aGlzLmJsb2NrX3JlbWFpbmluZykgPiAwICYmIHRvZ28gPiAwKSB7CgkJCQkJaWYgKHRoaXNfcnVuID4gdG9nbykgdGhpc19ydW4gPSB0b2dvOwoJCQkJCXRvZ28gLT0gdGhpc19ydW47CgkJCQkJdGhpcy5ibG9ja19yZW1haW5pbmcgLT0gdGhpc19ydW47CgkJCQkJdGhpcy53aW5kb3dfcG9zbiAmPSB0aGlzLndpbmRvd19zaXplIC0gMTsKCQkJCQlpZiAodGhpcy53aW5kb3dfcG9zbiArIHRoaXNfcnVuID4gdGhpcy53aW5kb3dfc2l6ZSkgdGhyb3cgbmV3IFhuYkVycm9yKCdDYW5ub3QgcnVuIG91dHNpZGUgb2Ygd2luZG93IGZyYW1lLicpOwoKCQkJCQlzd2l0Y2ggKHRoaXMuYmxvY2tfdHlwZSkgewoJCQkJCQljYXNlIEJMT0NLVFlQRS5BTElHTkVEOgoJCQkJCQkJd2hpbGUgKHRoaXNfcnVuID4gMCkgewoJCQkJCQkJCWxldCBtYWluX2VsZW1lbnQgPSB0aGlzLnJlYWRIdWZmU3ltYm9sKGJ1ZmZlciwgdGhpcy5tYWludHJlZV90YWJsZSwgdGhpcy5tYWludHJlZV9sZW4sIE1BSU5UUkVFX01BWFNZTUJPTFMsIE1BSU5UUkVFX1RBQkxFQklUUyk7CgoJCQkJCQkJCWlmIChtYWluX2VsZW1lbnQgPCBOVU1fQ0hBUlMpIHsKCQkJCQkJCQkJdGhpcy53aW5bdGhpcy53aW5kb3dfcG9zbisrXSA9IG1haW5fZWxlbWVudDsKCQkJCQkJCQkJdGhpc19ydW4tLTsKCQkJCQkJCQkJY29udGludWU7CgkJCQkJCQkJfQoKCQkJCQkJCQltYWluX2VsZW1lbnQgLT0gTlVNX0NIQVJTOwoJCQkJCQkJCWxldCBsZW5ndGhfZm9vdGVyOwoJCQkJCQkJCWxldCBtYXRjaF9sZW5ndGggPSBtYWluX2VsZW1lbnQgJiBOVU1fUFJJTUFSWV9MRU5HVEhTOwoKCQkJCQkJCQlpZiAobWF0Y2hfbGVuZ3RoID09IE5VTV9QUklNQVJZX0xFTkdUSFMpIHsKCQkJCQkJCQkJbGVuZ3RoX2Zvb3RlciA9IHRoaXMucmVhZEh1ZmZTeW1ib2woYnVmZmVyLCB0aGlzLmxlbmd0aF90YWJsZSwgdGhpcy5sZW5ndGhfbGVuLCBMRU5HVEhfTUFYU1lNQk9MUywgTEVOR1RIX1RBQkxFQklUUyk7CgkJCQkJCQkJCW1hdGNoX2xlbmd0aCArPSBsZW5ndGhfZm9vdGVyOwoJCQkJCQkJCX0KCgkJCQkJCQkJbWF0Y2hfbGVuZ3RoICs9IE1JTl9NQVRDSDsKCQkJCQkJCQlsZXQgbWF0Y2hfb2Zmc2V0ID0gbWFpbl9lbGVtZW50ID4+IDM7CgoJCQkJCQkJCWlmIChtYXRjaF9vZmZzZXQgPiAyKSB7CgkJCQkJCQkJCWxldCBleHRyYSA9IEx6eC5leHRyYV9iaXRzW21hdGNoX29mZnNldF07CgkJCQkJCQkJCW1hdGNoX29mZnNldCA9IEx6eC5wb3NpdGlvbl9iYXNlW21hdGNoX29mZnNldF0gLSAyOwoKCQkJCQkJCQkJaWYgKGV4dHJhID4gMykgewoJCQkJCQkJCQkJZXh0cmEgLT0gMzsKCQkJCQkJCQkJCWxldCB2ZXJiYXRpbV9iaXRzID0gYnVmZmVyLnJlYWRMWlhCaXRzKGV4dHJhKTsKCQkJCQkJCQkJCW1hdGNoX29mZnNldCArPSB2ZXJiYXRpbV9iaXRzIDw8IDM7CgkJCQkJCQkJCQlsZXQgYWxpZ25lZF9iaXRzID0gdGhpcy5yZWFkSHVmZlN5bWJvbChidWZmZXIsIHRoaXMuYWxpZ25lZF90YWJsZSwgdGhpcy5hbGlnbmVkX2xlbiwgQUxJR05FRF9NQVhTWU1CT0xTLCBBTElHTkVEX1RBQkxFQklUUyk7CgkJCQkJCQkJCQltYXRjaF9vZmZzZXQgKz0gYWxpZ25lZF9iaXRzOwoJCQkJCQkJCQl9IGVsc2UgaWYgKGV4dHJhID09IDMpIHsKCQkJCQkJCQkJCW1hdGNoX29mZnNldCArPSB0aGlzLnJlYWRIdWZmU3ltYm9sKGJ1ZmZlciwgdGhpcy5hbGlnbmVkX3RhYmxlLCB0aGlzLmFsaWduZWRfbGVuLCBBTElHTkVEX01BWFNZTUJPTFMsIEFMSUdORURfVEFCTEVCSVRTKTsKCQkJCQkJCQkJfSBlbHNlIGlmIChleHRyYSA+IDApIG1hdGNoX29mZnNldCArPSBidWZmZXIucmVhZExaWEJpdHMoZXh0cmEpO2Vsc2UgbWF0Y2hfb2Zmc2V0ID0gMTsKCgkJCQkJCQkJCXRoaXMuUjIgPSB0aGlzLlIxOwoJCQkJCQkJCQl0aGlzLlIxID0gdGhpcy5SMDsKCQkJCQkJCQkJdGhpcy5SMCA9IG1hdGNoX29mZnNldDsKCQkJCQkJCQl9IGVsc2UgaWYgKG1hdGNoX29mZnNldCA9PT0gMCkgewoJCQkJCQkJCQltYXRjaF9vZmZzZXQgPSB0aGlzLlIwOwoJCQkJCQkJCX0gZWxzZSBpZiAobWF0Y2hfb2Zmc2V0ID09IDEpIHsKCQkJCQkJCQkJbWF0Y2hfb2Zmc2V0ID0gdGhpcy5SMTsKCQkJCQkJCQkJdGhpcy5SMSA9IHRoaXMuUjA7CgkJCQkJCQkJCXRoaXMuUjAgPSBtYXRjaF9vZmZzZXQ7CgkJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkJbWF0Y2hfb2Zmc2V0ID0gdGhpcy5SMjsKCQkJCQkJCQkJdGhpcy5SMiA9IHRoaXMuUjA7CgkJCQkJCQkJCXRoaXMuUjAgPSBtYXRjaF9vZmZzZXQ7CgkJCQkJCQkJfQoKCQkJCQkJCQlsZXQgcnVuZGVzdCA9IHRoaXMud2luZG93X3Bvc247CgkJCQkJCQkJbGV0IHJ1bnNyYzsKCQkJCQkJCQl0aGlzX3J1biAtPSBtYXRjaF9sZW5ndGg7CgkJCQkJCQkJaWYgKHRoaXMud2luZG93X3Bvc24gPj0gbWF0Y2hfb2Zmc2V0KSBydW5zcmMgPSBydW5kZXN0IC0gbWF0Y2hfb2Zmc2V0O2Vsc2UgewoJCQkJCQkJCQlydW5zcmMgPSBydW5kZXN0ICsgKHRoaXMud2luZG93X3NpemUgLSBtYXRjaF9vZmZzZXQpOwoJCQkJCQkJCQlsZXQgY29weV9sZW5ndGggPSBtYXRjaF9vZmZzZXQgLSB0aGlzLndpbmRvd19wb3NuOwoKCQkJCQkJCQkJaWYgKGNvcHlfbGVuZ3RoIDwgbWF0Y2hfbGVuZ3RoKSB7CgkJCQkJCQkJCQltYXRjaF9sZW5ndGggLT0gY29weV9sZW5ndGg7CgkJCQkJCQkJCQl0aGlzLndpbmRvd19wb3NuICs9IGNvcHlfbGVuZ3RoOwoKCQkJCQkJCQkJCXdoaWxlIChjb3B5X2xlbmd0aC0tID4gMCkgdGhpcy53aW5bcnVuZGVzdCsrXSA9IHRoaXMud2luW3J1bnNyYysrXTsKCgkJCQkJCQkJCQlydW5zcmMgPSAwOwoJCQkJCQkJCQl9CgkJCQkJCQkJfQoJCQkJCQkJCXRoaXMud2luZG93X3Bvc24gKz0gbWF0Y2hfbGVuZ3RoOwoKCQkJCQkJCQl3aGlsZSAobWF0Y2hfbGVuZ3RoLS0gPiAwKSB0aGlzLndpbltydW5kZXN0KytdID0gdGhpcy53aW5bcnVuc3JjKytdOwoJCQkJCQkJfQoKCQkJCQkJCWJyZWFrOwoKCQkJCQkJY2FzZSBCTE9DS1RZUEUuVkVSQkFUSU06CgkJCQkJCQl3aGlsZSAodGhpc19ydW4gPiAwKSB7CgkJCQkJCQkJbGV0IG1haW5fZWxlbWVudCA9IHRoaXMucmVhZEh1ZmZTeW1ib2woYnVmZmVyLCB0aGlzLm1haW50cmVlX3RhYmxlLCB0aGlzLm1haW50cmVlX2xlbiwgTUFJTlRSRUVfTUFYU1lNQk9MUywgTUFJTlRSRUVfVEFCTEVCSVRTKTsKCgkJCQkJCQkJaWYgKG1haW5fZWxlbWVudCA8IE5VTV9DSEFSUykgewoJCQkJCQkJCQl0aGlzLndpblt0aGlzLndpbmRvd19wb3NuKytdID0gbWFpbl9lbGVtZW50OwoJCQkJCQkJCQl0aGlzX3J1bi0tOwoJCQkJCQkJCQljb250aW51ZTsKCQkJCQkJCQl9CgoJCQkJCQkJCW1haW5fZWxlbWVudCAtPSBOVU1fQ0hBUlM7CgkJCQkJCQkJbGV0IGxlbmd0aF9mb290ZXI7CgkJCQkJCQkJbGV0IG1hdGNoX2xlbmd0aCA9IG1haW5fZWxlbWVudCAmIE5VTV9QUklNQVJZX0xFTkdUSFM7CgoJCQkJCQkJCWlmIChtYXRjaF9sZW5ndGggPT0gTlVNX1BSSU1BUllfTEVOR1RIUykgewoJCQkJCQkJCQlsZW5ndGhfZm9vdGVyID0gdGhpcy5yZWFkSHVmZlN5bWJvbChidWZmZXIsIHRoaXMubGVuZ3RoX3RhYmxlLCB0aGlzLmxlbmd0aF9sZW4sIExFTkdUSF9NQVhTWU1CT0xTLCBMRU5HVEhfVEFCTEVCSVRTKTsKCQkJCQkJCQkJbWF0Y2hfbGVuZ3RoICs9IGxlbmd0aF9mb290ZXI7CgkJCQkJCQkJfQoKCQkJCQkJCQltYXRjaF9sZW5ndGggKz0gTUlOX01BVENIOwoJCQkJCQkJCWxldCBtYXRjaF9vZmZzZXQgPSBtYWluX2VsZW1lbnQgPj4gMzsKCgkJCQkJCQkJaWYgKG1hdGNoX29mZnNldCA+IDIpIHsKCQkJCQkJCQkJaWYgKG1hdGNoX29mZnNldCAhPSAzKSB7CgkJCQkJCQkJCQlsZXQgZXh0cmEgPSBMenguZXh0cmFfYml0c1ttYXRjaF9vZmZzZXRdOwoJCQkJCQkJCQkJbGV0IHZlcmJhdGltX2JpdHMgPSBidWZmZXIucmVhZExaWEJpdHMoZXh0cmEpOwoJCQkJCQkJCQkJbWF0Y2hfb2Zmc2V0ID0gTHp4LnBvc2l0aW9uX2Jhc2VbbWF0Y2hfb2Zmc2V0XSAtIDIgKyB2ZXJiYXRpbV9iaXRzOwoJCQkJCQkJCQl9IGVsc2UgbWF0Y2hfb2Zmc2V0ID0gMTsKCgkJCQkJCQkJCXRoaXMuUjIgPSB0aGlzLlIxOwoJCQkJCQkJCQl0aGlzLlIxID0gdGhpcy5SMDsKCQkJCQkJCQkJdGhpcy5SMCA9IG1hdGNoX29mZnNldDsKCQkJCQkJCQl9IGVsc2UgaWYgKG1hdGNoX29mZnNldCA9PT0gMCkgewoJCQkJCQkJCQltYXRjaF9vZmZzZXQgPSB0aGlzLlIwOwoJCQkJCQkJCX0gZWxzZSBpZiAobWF0Y2hfb2Zmc2V0ID09IDEpIHsKCQkJCQkJCQkJbWF0Y2hfb2Zmc2V0ID0gdGhpcy5SMTsKCQkJCQkJCQkJdGhpcy5SMSA9IHRoaXMuUjA7CgkJCQkJCQkJCXRoaXMuUjAgPSBtYXRjaF9vZmZzZXQ7CgkJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkJbWF0Y2hfb2Zmc2V0ID0gdGhpcy5SMjsKCQkJCQkJCQkJdGhpcy5SMiA9IHRoaXMuUjA7CgkJCQkJCQkJCXRoaXMuUjAgPSBtYXRjaF9vZmZzZXQ7CgkJCQkJCQkJfQoKCQkJCQkJCQlsZXQgcnVuZGVzdCA9IHRoaXMud2luZG93X3Bvc247CgkJCQkJCQkJbGV0IHJ1bnNyYzsKCQkJCQkJCQl0aGlzX3J1biAtPSBtYXRjaF9sZW5ndGg7CgkJCQkJCQkJaWYgKHRoaXMud2luZG93X3Bvc24gPj0gbWF0Y2hfb2Zmc2V0KSBydW5zcmMgPSBydW5kZXN0IC0gbWF0Y2hfb2Zmc2V0O2Vsc2UgewoJCQkJCQkJCQlydW5zcmMgPSBydW5kZXN0ICsgKHRoaXMud2luZG93X3NpemUgLSBtYXRjaF9vZmZzZXQpOwoJCQkJCQkJCQlsZXQgY29weV9sZW5ndGggPSBtYXRjaF9vZmZzZXQgLSB0aGlzLndpbmRvd19wb3NuOwoKCQkJCQkJCQkJaWYgKGNvcHlfbGVuZ3RoIDwgbWF0Y2hfbGVuZ3RoKSB7CgkJCQkJCQkJCQltYXRjaF9sZW5ndGggLT0gY29weV9sZW5ndGg7CgkJCQkJCQkJCQl0aGlzLndpbmRvd19wb3NuICs9IGNvcHlfbGVuZ3RoOwoKCQkJCQkJCQkJCXdoaWxlIChjb3B5X2xlbmd0aC0tID4gMCkgdGhpcy53aW5bcnVuZGVzdCsrXSA9IHRoaXMud2luW3J1bnNyYysrXTsKCgkJCQkJCQkJCQlydW5zcmMgPSAwOwoJCQkJCQkJCQl9CgkJCQkJCQkJfQoJCQkJCQkJCXRoaXMud2luZG93X3Bvc24gKz0gbWF0Y2hfbGVuZ3RoOwoKCQkJCQkJCQl3aGlsZSAobWF0Y2hfbGVuZ3RoLS0gPiAwKSB0aGlzLndpbltydW5kZXN0KytdID0gdGhpcy53aW5bcnVuc3JjKytdOwoJCQkJCQkJfQoKCQkJCQkJCWJyZWFrOwoKCQkJCQkJY2FzZSBCTE9DS1RZUEUuVU5DT01QUkVTU0VEOgoJCQkJCQkJaWYgKGJ1ZmZlci5ieXRlUG9zaXRpb24gKyB0aGlzX3J1biA+IGJsb2NrX3NpemUpIHRocm93IG5ldyBYbmJFcnJvcignT3ZlcnJ1biEnICsgYmxvY2tfc2l6ZSArICcgJyArIGJ1ZmZlci5ieXRlUG9zaXRpb24gKyAnICcgKyB0aGlzX3J1bik7CgoJCQkJCQkJZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzX3J1bjsgaSsrKSB0aGlzLndpblt3aW5kb3dfcG9zbiArIGldID0gYnVmZmVyLmJ1ZmZlcltidWZmZXIuYnl0ZVBvc2l0aW9uICsgaV07CgoJCQkJCQkJYnVmZmVyLmJ5dGVQb3NpdGlvbiArPSB0aGlzX3J1bjsKCQkJCQkJCXRoaXMud2luZG93X3Bvc24gKz0gdGhpc19ydW47CgkJCQkJCQlicmVhazsKCgkJCQkJCWRlZmF1bHQ6CgkJCQkJCQl0aHJvdyBuZXcgWG5iRXJyb3IoJ0ludmFsaWQgYmxvY2t0eXBlIHNwZWNpZmllZCEnKTsKCQkJCQl9CgkJCQl9CgkJCX0KCgkJCWlmICh0b2dvICE9IDApIHRocm93IG5ldyBYbmJFcnJvcignRU9GIHJlYWNoZWQgd2l0aCBkYXRhIGxlZnQgdG8gZ28uJyk7CgkJCWJ1ZmZlci5hbGlnbigpOwoJCQljb25zdCBzdGFydF93aW5kb3dfcG9zID0gKHRoaXMud2luZG93X3Bvc24gPT0gMCA/IHRoaXMud2luZG93X3NpemUgOiB0aGlzLndpbmRvd19wb3NuKSAtIGZyYW1lX3NpemU7CgkJCXJldHVybiB0aGlzLndpbi5zbGljZShzdGFydF93aW5kb3dfcG9zLCBzdGFydF93aW5kb3dfcG9zICsgZnJhbWVfc2l6ZSk7CgkJfQoKCQlyZWFkTGVuZ3RocyhidWZmZXIsIHRhYmxlLCBmaXJzdCwgbGFzdCkgewoJCQlmb3IgKGxldCBpID0gMDsgaSA8IDIwOyBpKyspIHRoaXMucHJldHJlZV9sZW5baV0gPSBidWZmZXIucmVhZExaWEJpdHMoNCk7CgoJCQl0aGlzLnByZXRyZWVfdGFibGUgPSB0aGlzLmRlY29kZVRhYmxlKFBSRVRSRUVfTUFYU1lNQk9MUywgUFJFVFJFRV9UQUJMRUJJVFMsIHRoaXMucHJldHJlZV9sZW4pOwoKCQkJZm9yIChsZXQgaSA9IGZpcnN0OyBpIDwgbGFzdDspIHsKCQkJCWxldCBzeW1ib2wgPSB0aGlzLnJlYWRIdWZmU3ltYm9sKGJ1ZmZlciwgdGhpcy5wcmV0cmVlX3RhYmxlLCB0aGlzLnByZXRyZWVfbGVuLCBQUkVUUkVFX01BWFNZTUJPTFMsIFBSRVRSRUVfVEFCTEVCSVRTKTsKCgkJCQlpZiAoc3ltYm9sID09IDE3KSB7CgkJCQkJbGV0IHplcm9zID0gYnVmZmVyLnJlYWRMWlhCaXRzKDQpICsgNDsKCgkJCQkJd2hpbGUgKHplcm9zLS0gIT0gMCkgdGFibGVbaSsrXSA9IDA7CgkJCQl9IGVsc2UgaWYgKHN5bWJvbCA9PSAxOCkgewoJCQkJCWxldCB6ZXJvcyA9IGJ1ZmZlci5yZWFkTFpYQml0cyg1KSArIDIwOwoKCQkJCQl3aGlsZSAoemVyb3MtLSAhPSAwKSB0YWJsZVtpKytdID0gMDsKCQkJCX0gZWxzZSBpZiAoc3ltYm9sID09IDE5KSB7CgkJCQkJbGV0IHNhbWUgPSBidWZmZXIucmVhZExaWEJpdHMoMSkgKyA0OwoJCQkJCXN5bWJvbCA9IHRoaXMucmVhZEh1ZmZTeW1ib2woYnVmZmVyLCB0aGlzLnByZXRyZWVfdGFibGUsIHRoaXMucHJldHJlZV9sZW4sIFBSRVRSRUVfTUFYU1lNQk9MUywgUFJFVFJFRV9UQUJMRUJJVFMpOwoJCQkJCXN5bWJvbCA9IHRhYmxlW2ldIC0gc3ltYm9sOwoJCQkJCWlmIChzeW1ib2wgPCAwKSBzeW1ib2wgKz0gMTc7CgoJCQkJCXdoaWxlIChzYW1lLS0gIT0gMCkgdGFibGVbaSsrXSA9IHN5bWJvbDsKCQkJCX0gZWxzZSB7CgkJCQkJc3ltYm9sID0gdGFibGVbaV0gLSBzeW1ib2w7CgkJCQkJaWYgKHN5bWJvbCA8IDApIHN5bWJvbCArPSAxNzsKCQkJCQl0YWJsZVtpKytdID0gc3ltYm9sOwoJCQkJfQoJCQl9CgoJCQlyZXR1cm4gdGFibGU7CgkJfQoKCQlkZWNvZGVUYWJsZShzeW1ib2xzLCBiaXRzLCBsZW5ndGgpIHsKCQkJbGV0IHRhYmxlID0gW107CgkJCWxldCBwb3MgPSAwOwoJCQlsZXQgdGFibGVfbWFzayA9IDEgPDwgYml0czsKCQkJbGV0IGJpdF9tYXNrID0gdGFibGVfbWFzayA+PiAxOwoKCQkJZm9yIChsZXQgYml0X251bSA9IDE7IGJpdF9udW0gPD0gYml0czsgYml0X251bSsrKSB7CgkJCQlmb3IgKGxldCBzeW1ib2wgPSAwOyBzeW1ib2wgPCBzeW1ib2xzOyBzeW1ib2wrKykgewoJCQkJCWlmIChsZW5ndGhbc3ltYm9sXSA9PSBiaXRfbnVtKSB7CgkJCQkJCWxldCBsZWFmID0gcG9zOwoKCQkJCQkJaWYgKChwb3MgKz0gYml0X21hc2spID4gdGFibGVfbWFzaykgewoJCQkJCQkJdGhyb3cgbmV3IFhuYkVycm9yKCdPdmVycnVuIHRhYmxlIScpOwoJCQkJCQl9CgoJCQkJCQlsZXQgZmlsbCA9IGJpdF9tYXNrOwoKCQkJCQkJd2hpbGUgKGZpbGwtLSA+IDApIHRhYmxlW2xlYWYrK10gPSBzeW1ib2w7CgkJCQkJfQoJCQkJfQoKCQkJCWJpdF9tYXNrID4+PSAxOwoJCQl9CgoJCQlpZiAocG9zID09IHRhYmxlX21hc2spIHJldHVybiB0YWJsZTsKCgkJCWZvciAobGV0IHN5bWJvbCA9IHBvczsgc3ltYm9sIDwgdGFibGVfbWFzazsgc3ltYm9sKyspIHRhYmxlW3N5bWJvbF0gPSAweEZGRkY7CgoJCQlsZXQgbmV4dF9zeW1ib2wgPSB0YWJsZV9tYXNrID4+IDEgPCBzeW1ib2xzID8gc3ltYm9scyA6IHRhYmxlX21hc2sgPj4gMTsKCQkJcG9zIDw8PSAxNjsKCQkJdGFibGVfbWFzayA8PD0gMTY7CgkJCWJpdF9tYXNrID0gMSA8PCAxNTsKCgkJCWZvciAobGV0IGJpdF9udW0gPSBiaXRzICsgMTsgYml0X251bSA8PSAxNjsgYml0X251bSsrKSB7CgkJCQlmb3IgKGxldCBzeW1ib2wgPSAwOyBzeW1ib2wgPCBzeW1ib2xzOyBzeW1ib2wrKykgewoJCQkJCWlmIChsZW5ndGhbc3ltYm9sXSAhPSBiaXRfbnVtKSBjb250aW51ZTsKCQkJCQlsZXQgbGVhZiA9IHBvcyA+PiAxNjsKCgkJCQkJZm9yIChsZXQgZmlsbCA9IDA7IGZpbGwgPCBiaXRfbnVtIC0gYml0czsgZmlsbCsrKSB7CgkJCQkJCWlmICh0YWJsZVtsZWFmXSA9PSAweEZGRkYpIHsKCQkJCQkJCXRhYmxlW25leHRfc3ltYm9sIDw8IDFdID0gMHhGRkZGOwoJCQkJCQkJdGFibGVbKG5leHRfc3ltYm9sIDw8IDEpICsgMV0gPSAweEZGRkY7CgkJCQkJCQl0YWJsZVtsZWFmXSA9IG5leHRfc3ltYm9sKys7CgkJCQkJCX0KCgkJCQkJCWxlYWYgPSB0YWJsZVtsZWFmXSA8PCAxOwoJCQkJCQlpZiAocG9zID4+IDE1IC0gZmlsbCAmIDEpIGxlYWYrKzsKCQkJCQl9CgoJCQkJCXRhYmxlW2xlYWZdID0gc3ltYm9sOwoJCQkJCWlmICgocG9zICs9IGJpdF9tYXNrKSA+IHRhYmxlX21hc2spIHRocm93IG5ldyBYbmJFcnJvcignT3ZlcnJ1biB0YWJsZSBkdXJpbmcgZGVjb2RpbmcuJyk7CgkJCQl9CgoJCQkJYml0X21hc2sgPj49IDE7CgkJCX0KCgkJCWlmIChwb3MgPT0gdGFibGVfbWFzaykgcmV0dXJuIHRhYmxlOwoJCQl0aHJvdyBuZXcgWG5iRXJyb3IoJ0RlY29kZSB0YWJsZSBkaWQgbm90IHJlYWNoIHRhYmxlIG1hc2suJyk7CgkJfQoKCQlyZWFkSHVmZlN5bWJvbChidWZmZXIsIHRhYmxlLCBsZW5ndGgsIHN5bWJvbHMsIGJpdHMpIHsKCQkJbGV0IGJpdCA9IGJ1ZmZlci5wZWVrTFpYQml0cygzMikgPj4+IDA7CgkJCWxldCBpID0gdGFibGVbYnVmZmVyLnBlZWtMWlhCaXRzKGJpdHMpXTsKCgkJCWlmIChpID49IHN5bWJvbHMpIHsKCQkJCWxldCBqID0gMSA8PCAzMiAtIGJpdHM7CgoJCQkJZG8gewoJCQkJCWogPj49IDE7CgkJCQkJaSA8PD0gMTsKCQkJCQlpIHw9IChiaXQgJiBqKSAhPSAwID8gMSA6IDA7CgkJCQkJaWYgKGogPT0gMCkgcmV0dXJuIDA7CgkJCQl9IHdoaWxlICgoaSA9IHRhYmxlW2ldKSA+PSBzeW1ib2xzKTsKCQkJfQoKCQkJYnVmZmVyLmJpdFBvc2l0aW9uICs9IGxlbmd0aFtpXTsKCQkJcmV0dXJuIGk7CgkJfQoKCQlzZXQgUlJSKFgpIHsKCQkJaWYgKHRoaXMuUjAgIT0gWCAmJiB0aGlzLlIxICE9IFggJiYgdGhpcy5SMiAhPSBYKSB7CgkJCQl0aGlzLlIyID0gdGhpcy5SMTsKCQkJCXRoaXMuUjEgPSB0aGlzLlIwOwoJCQkJdGhpcy5SMCA9IFg7CgkJCX0gZWxzZSBpZiAodGhpcy5SMSA9PSBYKSB7CgkJCQlsZXQgUjEgPSB0aGlzLlIxOwoJCQkJdGhpcy5SMSA9IHRoaXMuUjA7CgkJCQl0aGlzLlIwID0gUjE7CgkJCX0gZWxzZSBpZiAodGhpcy5SMiA9PSBYKSB7CgkJCQlsZXQgUjIgPSB0aGlzLlIyOwoJCQkJdGhpcy5SMiA9IHRoaXMuUjA7CgkJCQl0aGlzLlIwID0gUjI7CgkJCX0KCQl9CgoJfQoKCUx6eC5wb3NpdGlvbl9iYXNlID0gW107CglMenguZXh0cmFfYml0cyA9IFtdOwoKCWNsYXNzIFByZXNzZXIgewoJCXN0YXRpYyBkZWNvbXByZXNzKGJ1ZmZlciwgY29tcHJlc3NlZFRvZG8sIGRlY29tcHJlc3NlZFRvZG8pIHsKCQkJbGV0IHBvcyA9IDA7CgkJCWxldCBibG9ja19zaXplOwoJCQlsZXQgZnJhbWVfc2l6ZTsKCQkJY29uc3QgbHp4ID0gbmV3IEx6eCgxNik7CgkJCWxldCBkZWNvbXByZXNzZWQgPSBuZXcgQnVmZmVyV3JpdGVyKGRlY29tcHJlc3NlZFRvZG8pOwoKCQkJd2hpbGUgKHBvcyA8IGNvbXByZXNzZWRUb2RvKSB7CgkJCQljb25zdCBmbGFnID0gYnVmZmVyLnJlYWRCeXRlKCk7CgoJCQkJaWYgKGZsYWcgPT0gMHhGRikgewoJCQkJCWZyYW1lX3NpemUgPSBidWZmZXIucmVhZExaWEludDE2KCk7CgkJCQkJYmxvY2tfc2l6ZSA9IGJ1ZmZlci5yZWFkTFpYSW50MTYoKTsKCQkJCQlwb3MgKz0gNTsKCQkJCX0gZWxzZSB7CgkJCQkJYnVmZmVyLnNlZWsoLTEpOwoJCQkJCWJsb2NrX3NpemUgPSBidWZmZXIucmVhZExaWEludDE2KHRoaXMuYnVmZmVyKTsKCQkJCQlmcmFtZV9zaXplID0gMHg4MDAwOwoJCQkJCXBvcyArPSAyOwoJCQkJfQoKCQkJCWlmIChibG9ja19zaXplID09IDAgfHwgZnJhbWVfc2l6ZSA9PSAwKSBicmVhazsKCQkJCWlmIChibG9ja19zaXplID4gMHgxMDAwMCB8fCBmcmFtZV9zaXplID4gMHgxMDAwMCkgdGhyb3cgbmV3IFhuYkVycm9yKCdJbnZhbGlkIHNpemUgcmVhZCBpbiBjb21wcmVzc2lvbiBjb250ZW50LicpOwoJCQkJZGVjb21wcmVzc2VkLndyaXRlKGx6eC5kZWNvbXByZXNzKGJ1ZmZlciwgZnJhbWVfc2l6ZSwgYmxvY2tfc2l6ZSkpOwoJCQkJcG9zICs9IGJsb2NrX3NpemU7CgkJCX0KCgkJCWNvbnNvbGUubG9nKCdGaWxlIGhhcyBiZWVuIHN1Y2Nlc3NmdWxseSBkZWNvbXByZXNzZWQhJyk7CgkJCWRlY29tcHJlc3NlZC50cmltKCk7CgkJCXJldHVybiBkZWNvbXByZXNzZWQuYnVmZmVyOwoJCX0KCgl9CgoJY2xhc3MgTFo0VXRpbHMgewoJCXN0YXRpYyBoYXNoVTMyKGEpIHsKCQkJYSA9IGEgfCAwOwoJCQlhID0gYSArIDIxMjc5MTIyMTQgKyAoYSA8PCAxMikgfCAwOwoJCQlhID0gYSBeIC05NDk4OTQ1OTYgXiBhID4+PiAxOTsKCQkJYSA9IGEgKyAzNzQ3NjEzOTMgKyAoYSA8PCA1KSB8IDA7CgkJCWEgPSBhICsgLTc0NDMzMjE4MCBeIGEgPDwgOTsKCQkJYSA9IGEgKyAtNDI5NzM0OTkgKyAoYSA8PCAzKSB8IDA7CgkJCXJldHVybiBhIF4gLTEyNTIzNzI3MjcgXiBhID4+PiAxNiB8IDA7CgkJfQoKCQlzdGF0aWMgcmVhZFU2NChiLCBuKSB7CgkJCXZhciB4ID0gMDsKCQkJeCB8PSBiW24rK10gPDwgMDsKCQkJeCB8PSBiW24rK10gPDwgODsKCQkJeCB8PSBiW24rK10gPDwgMTY7CgkJCXggfD0gYltuKytdIDw8IDI0OwoJCQl4IHw9IGJbbisrXSA8PCAzMjsKCQkJeCB8PSBiW24rK10gPDwgNDA7CgkJCXggfD0gYltuKytdIDw8IDQ4OwoJCQl4IHw9IGJbbisrXSA8PCA1NjsKCQkJcmV0dXJuIHg7CgkJfQoKCQlzdGF0aWMgcmVhZFUzMihiLCBuKSB7CgkJCXZhciB4ID0gMDsKCQkJeCB8PSBiW24rK10gPDwgMDsKCQkJeCB8PSBiW24rK10gPDwgODsKCQkJeCB8PSBiW24rK10gPDwgMTY7CgkJCXggfD0gYltuKytdIDw8IDI0OwoJCQlyZXR1cm4geDsKCQl9CgoJCXN0YXRpYyB3cml0ZVUzMihiLCBuLCB4KSB7CgkJCWJbbisrXSA9IHggPj4gMCAmIDB4ZmY7CgkJCWJbbisrXSA9IHggPj4gOCAmIDB4ZmY7CgkJCWJbbisrXSA9IHggPj4gMTYgJiAweGZmOwoJCQliW24rK10gPSB4ID4+IDI0ICYgMHhmZjsKCQl9CgoJCXN0YXRpYyBpbXVsKGEsIGIpIHsKCQkJdmFyIGFoID0gYSA+Pj4gMTY7CgkJCXZhciBhbCA9IGEgJiA2NTUzNTsKCQkJdmFyIGJoID0gYiA+Pj4gMTY7CgkJCXZhciBibCA9IGIgJiA2NTUzNTsKCQkJcmV0dXJuIGFsICogYmwgKyAoYWggKiBibCArIGFsICogYmggPDwgMTYpIHwgMDsKCQl9CgoJfQoKCS8qKiBAbGljZW5zZQoJICogT3JpZ2luYWwgQ29kZSBieTogaHR0cHM6Ly9naXRodWIuY29tL0JlbnppbmdhL2x6NGpzLwoJICovCgljb25zdCBtaW5NYXRjaCA9IDQ7Cgljb25zdCBtaW5MZW5ndGggPSAxMzsKCWNvbnN0IHNlYXJjaExpbWl0ID0gNTsKCWNvbnN0IHNraXBUcmlnZ2VyID0gNjsKCWNvbnN0IGhhc2hTaXplID0gMSA8PCAxNjsKCWNvbnN0IG1sQml0cyA9IDQ7Cgljb25zdCBtbE1hc2sgPSAoMSA8PCBtbEJpdHMpIC0gMTsKCWNvbnN0IHJ1bkJpdHMgPSA0OwoJY29uc3QgcnVuTWFzayA9ICgxIDw8IHJ1bkJpdHMpIC0gMTsKCW1ha2VCdWZmZXIoNSA8PCAyMCk7Cgljb25zdCBoYXNoVGFibGUgPSBtYWtlSGFzaFRhYmxlKCk7CgoJZnVuY3Rpb24gbWFrZUhhc2hUYWJsZSgpIHsKCQl0cnkgewoJCQlyZXR1cm4gbmV3IFVpbnQzMkFycmF5KGhhc2hTaXplKTsKCQl9IGNhdGNoIChlcnJvcikgewoJCQljb25zdCBoYXNoVGFibGUgPSBuZXcgQXJyYXkoaGFzaFNpemUpOwoKCQkJZm9yICh2YXIgaSA9IDA7IGkgPCBoYXNoU2l6ZTsgaSsrKSB7CgkJCQloYXNoVGFibGVbaV0gPSAwOwoJCQl9CgoJCQlyZXR1cm4gaGFzaFRhYmxlOwoJCX0KCX0KCglmdW5jdGlvbiBjbGVhckhhc2hUYWJsZSh0YWJsZSkgewoJCWZvciAodmFyIGkgPSAwOyBpIDwgaGFzaFNpemU7IGkrKykgewoJCQloYXNoVGFibGVbaV0gPSAwOwoJCX0KCX0KCglmdW5jdGlvbiBtYWtlQnVmZmVyKHNpemUpIHsKCQl0cnkgewoJCQlyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoc2l6ZSk7CgkJfSBjYXRjaCAoZXJyb3IpIHsKCQkJdmFyIGJ1ZiA9IG5ldyBBcnJheShzaXplKTsKCgkJCWZvciAodmFyIGkgPSAwOyBpIDwgc2l6ZTsgaSsrKSB7CgkJCQlidWZbaV0gPSAwOwoJCQl9CgoJCQlyZXR1cm4gYnVmOwoJCX0KCX0KCglmdW5jdGlvbiBjb21wcmVzc0JvdW5kKG4pIHsKCQlyZXR1cm4gbiArIG4gLyAyNTUgKyAxNiB8IDA7Cgl9CgoJZnVuY3Rpb24gZGVjb21wcmVzc0Jsb2NrKHNyYywgZHN0KSB7CgkJbGV0IHNJbmRleCA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDogMDsKCQlsZXQgc0xlbmd0aCA9IGFyZ3VtZW50cy5sZW5ndGggPiAzICYmIGFyZ3VtZW50c1szXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzNdIDogc3JjLmxlbmd0aCAtIDIgKiBzSW5kZXg7CgkJbGV0IGRJbmRleCA9IGFyZ3VtZW50cy5sZW5ndGggPiA0ICYmIGFyZ3VtZW50c1s0XSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzRdIDogMDsKCQl2YXIgbUxlbmd0aCwgbU9mZnNldCwgc0VuZCwgbiwgaTsKCQl2YXIgaGFzQ29weVdpdGhpbiA9IGRzdC5jb3B5V2l0aGluICE9PSB1bmRlZmluZWQgJiYgZHN0LmZpbGwgIT09IHVuZGVmaW5lZDsKCQlzRW5kID0gc0luZGV4ICsgc0xlbmd0aDsKCgkJd2hpbGUgKHNJbmRleCA8IHNFbmQpIHsKCQkJdmFyIHRva2VuID0gc3JjW3NJbmRleCsrXTsKCQkJdmFyIGxpdGVyYWxDb3VudCA9IHRva2VuID4+IDQ7CgoJCQlpZiAobGl0ZXJhbENvdW50ID4gMCkgewoJCQkJaWYgKGxpdGVyYWxDb3VudCA9PT0gMHhmKSB7CgkJCQkJd2hpbGUgKHRydWUpIHsKCQkJCQkJbGl0ZXJhbENvdW50ICs9IHNyY1tzSW5kZXhdOwoKCQkJCQkJaWYgKHNyY1tzSW5kZXgrK10gIT09IDB4ZmYpIHsKCQkJCQkJCWJyZWFrOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoKCQkJCWZvciAobiA9IHNJbmRleCArIGxpdGVyYWxDb3VudDsgc0luZGV4IDwgbjspIHsKCQkJCQlkc3RbZEluZGV4KytdID0gc3JjW3NJbmRleCsrXTsKCQkJCX0KCQkJfQoKCQkJaWYgKHNJbmRleCA+PSBzRW5kKSB7CgkJCQlicmVhazsKCQkJfQoKCQkJbUxlbmd0aCA9IHRva2VuICYgMHhmOwoJCQltT2Zmc2V0ID0gc3JjW3NJbmRleCsrXSB8IHNyY1tzSW5kZXgrK10gPDwgODsKCgkJCWlmIChtTGVuZ3RoID09PSAweGYpIHsKCQkJCXdoaWxlICh0cnVlKSB7CgkJCQkJbUxlbmd0aCArPSBzcmNbc0luZGV4XTsKCgkJCQkJaWYgKHNyY1tzSW5kZXgrK10gIT09IDB4ZmYpIHsKCQkJCQkJYnJlYWs7CgkJCQkJfQoJCQkJfQoJCQl9CgoJCQltTGVuZ3RoICs9IG1pbk1hdGNoOwoKCQkJaWYgKGhhc0NvcHlXaXRoaW4gJiYgbU9mZnNldCA9PT0gMSkgewoJCQkJZHN0LmZpbGwoZHN0W2RJbmRleCAtIDFdIHwgMCwgZEluZGV4LCBkSW5kZXggKyBtTGVuZ3RoKTsKCQkJCWRJbmRleCArPSBtTGVuZ3RoOwoJCQl9IGVsc2UgaWYgKGhhc0NvcHlXaXRoaW4gJiYgbU9mZnNldCA+IG1MZW5ndGggJiYgbUxlbmd0aCA+IDMxKSB7CgkJCQlkc3QuY29weVdpdGhpbihkSW5kZXgsIGRJbmRleCAtIG1PZmZzZXQsIGRJbmRleCAtIG1PZmZzZXQgKyBtTGVuZ3RoKTsKCQkJCWRJbmRleCArPSBtTGVuZ3RoOwoJCQl9IGVsc2UgewoJCQkJZm9yIChpID0gZEluZGV4IC0gbU9mZnNldCwgbiA9IGkgKyBtTGVuZ3RoOyBpIDwgbjspIHsKCQkJCQlkc3RbZEluZGV4KytdID0gZHN0W2krK10gfCAwOwoJCQkJfQoJCQl9CgkJfQoKCQlyZXR1cm4gZEluZGV4OwoJfQoKCWZ1bmN0aW9uIGNvbXByZXNzQmxvY2soc3JjLCBkc3QsIHNJbmRleCwgc0xlbmd0aCwgaGFzaFRhYmxlKSB7CgkJdmFyIG1JbmRleCwgbUFuY2hvciwgbUxlbmd0aCwgbU9mZnNldCwgbVN0ZXA7CgkJdmFyIGxpdGVyYWxDb3VudCwgZEluZGV4LCBzRW5kLCBuOwoJCWRJbmRleCA9IDA7CgkJc0VuZCA9IHNMZW5ndGggKyBzSW5kZXg7CgkJbUFuY2hvciA9IHNJbmRleDsKCgkJaWYgKHNMZW5ndGggPj0gbWluTGVuZ3RoKSB7CgkJCXZhciBzZWFyY2hNYXRjaENvdW50ID0gKDEgPDwgc2tpcFRyaWdnZXIpICsgMzsKCgkJCXdoaWxlIChzSW5kZXggKyBtaW5NYXRjaCA8IHNFbmQgLSBzZWFyY2hMaW1pdCkgewoJCQkJdmFyIHNlcSA9IExaNFV0aWxzLnJlYWRVMzIoc3JjLCBzSW5kZXgpOwoJCQkJdmFyIGhhc2ggPSBMWjRVdGlscy5oYXNoVTMyKHNlcSkgPj4+IDA7CgkJCQloYXNoID0gKGhhc2ggPj4gMTYgXiBoYXNoKSA+Pj4gMCAmIDB4ZmZmZjsKCQkJCW1JbmRleCA9IGhhc2hUYWJsZVtoYXNoXSAtIDE7CgkJCQloYXNoVGFibGVbaGFzaF0gPSBzSW5kZXggKyAxOwoKCQkJCWlmIChtSW5kZXggPCAwIHx8IHNJbmRleCAtIG1JbmRleCA+Pj4gMTYgPiAwIHx8IExaNFV0aWxzLnJlYWRVMzIoc3JjLCBtSW5kZXgpICE9PSBzZXEpIHsKCQkJCQltU3RlcCA9IHNlYXJjaE1hdGNoQ291bnQrKyA+PiBza2lwVHJpZ2dlcjsKCQkJCQlzSW5kZXggKz0gbVN0ZXA7CgkJCQkJY29udGludWU7CgkJCQl9CgoJCQkJc2VhcmNoTWF0Y2hDb3VudCA9ICgxIDw8IHNraXBUcmlnZ2VyKSArIDM7CgkJCQlsaXRlcmFsQ291bnQgPSBzSW5kZXggLSBtQW5jaG9yOwoJCQkJbU9mZnNldCA9IHNJbmRleCAtIG1JbmRleDsKCQkJCXNJbmRleCArPSBtaW5NYXRjaDsKCQkJCW1JbmRleCArPSBtaW5NYXRjaDsKCQkJCW1MZW5ndGggPSBzSW5kZXg7CgoJCQkJd2hpbGUgKHNJbmRleCA8IHNFbmQgLSBzZWFyY2hMaW1pdCAmJiBzcmNbc0luZGV4XSA9PT0gc3JjW21JbmRleF0pIHsKCQkJCQlzSW5kZXgrKzsKCQkJCQltSW5kZXgrKzsKCQkJCX0KCgkJCQltTGVuZ3RoID0gc0luZGV4IC0gbUxlbmd0aDsKCQkJCXZhciB0b2tlbiA9IG1MZW5ndGggPCBtbE1hc2sgPyBtTGVuZ3RoIDogbWxNYXNrOwoKCQkJCWlmIChsaXRlcmFsQ291bnQgPj0gcnVuTWFzaykgewoJCQkJCWRzdFtkSW5kZXgrK10gPSAocnVuTWFzayA8PCBtbEJpdHMpICsgdG9rZW47CgoJCQkJCWZvciAobiA9IGxpdGVyYWxDb3VudCAtIHJ1bk1hc2s7IG4gPj0gMHhmZjsgbiAtPSAweGZmKSB7CgkJCQkJCWRzdFtkSW5kZXgrK10gPSAweGZmOwoJCQkJCX0KCgkJCQkJZHN0W2RJbmRleCsrXSA9IG47CgkJCQl9IGVsc2UgewoJCQkJCWRzdFtkSW5kZXgrK10gPSAobGl0ZXJhbENvdW50IDw8IG1sQml0cykgKyB0b2tlbjsKCQkJCX0KCgkJCQlmb3IgKHZhciBpID0gMDsgaSA8IGxpdGVyYWxDb3VudDsgaSsrKSB7CgkJCQkJZHN0W2RJbmRleCsrXSA9IHNyY1ttQW5jaG9yICsgaV07CgkJCQl9CgoJCQkJZHN0W2RJbmRleCsrXSA9IG1PZmZzZXQ7CgkJCQlkc3RbZEluZGV4KytdID0gbU9mZnNldCA+PiA4OwoKCQkJCWlmIChtTGVuZ3RoID49IG1sTWFzaykgewoJCQkJCWZvciAobiA9IG1MZW5ndGggLSBtbE1hc2s7IG4gPj0gMHhmZjsgbiAtPSAweGZmKSB7CgkJCQkJCWRzdFtkSW5kZXgrK10gPSAweGZmOwoJCQkJCX0KCgkJCQkJZHN0W2RJbmRleCsrXSA9IG47CgkJCQl9CgoJCQkJbUFuY2hvciA9IHNJbmRleDsKCQkJfQoJCX0KCgkJaWYgKG1BbmNob3IgPT09IDApIHsKCQkJcmV0dXJuIDA7CgkJfQoKCQlsaXRlcmFsQ291bnQgPSBzRW5kIC0gbUFuY2hvcjsKCgkJaWYgKGxpdGVyYWxDb3VudCA+PSBydW5NYXNrKSB7CgkJCWRzdFtkSW5kZXgrK10gPSBydW5NYXNrIDw8IG1sQml0czsKCgkJCWZvciAobiA9IGxpdGVyYWxDb3VudCAtIHJ1bk1hc2s7IG4gPj0gMHhmZjsgbiAtPSAweGZmKSB7CgkJCQlkc3RbZEluZGV4KytdID0gMHhmZjsKCQkJfQoKCQkJZHN0W2RJbmRleCsrXSA9IG47CgkJfSBlbHNlIHsKCQkJZHN0W2RJbmRleCsrXSA9IGxpdGVyYWxDb3VudCA8PCBtbEJpdHM7CgkJfQoKCQlzSW5kZXggPSBtQW5jaG9yOwoKCQl3aGlsZSAoc0luZGV4IDwgc0VuZCkgewoJCQlkc3RbZEluZGV4KytdID0gc3JjW3NJbmRleCsrXTsKCQl9CgoJCXJldHVybiBkSW5kZXg7Cgl9CgoJZnVuY3Rpb24gY29tcHJlc3NTaW5nbGVCbG9jayhzcmMsIGRzdCkgewoJCWNsZWFySGFzaFRhYmxlKCk7CgkJcmV0dXJuIGNvbXByZXNzQmxvY2soc3JjLCBkc3QsIDAsIHNyYy5sZW5ndGgsIGhhc2hUYWJsZSk7Cgl9CgoJY2xhc3MgU3RyaW5nUmVhZGVyQ29yZSB7CgkJcmVhZChidWZmZXIpIHsKCQkJbGV0IGxlbmd0aCA9IGJ1ZmZlci5yZWFkN0JpdE51bWJlcigpOwoJCQlyZXR1cm4gYnVmZmVyLnJlYWRTdHJpbmcobGVuZ3RoKTsKCQl9CgoJCXdyaXRlKGJ1ZmZlciwgc3RyaW5nKSB7CgkJCWNvbnN0IHNpemUgPSBVVEY4TGVuZ3RoKHN0cmluZyk7CgkJCWJ1ZmZlci53cml0ZTdCaXROdW1iZXIoc2l6ZSk7CgkJCWJ1ZmZlci53cml0ZVN0cmluZyhzdHJpbmcpOwoJCX0KCgl9CgoJY2xhc3MgUmVhZGVyUmVzb2x2ZXIgewoJCWNvbnN0cnVjdG9yKHJlYWRlcnMpIHsKCQkJdGhpcy5yZWFkZXJzID0gcmVhZGVyczsKCQl9CgoJCXJlYWQoYnVmZmVyKSB7CgkJCWxldCBpbmRleCA9IGJ1ZmZlci5yZWFkN0JpdE51bWJlcigpIC0gMTsKCQkJaWYgKHRoaXMucmVhZGVyc1tpbmRleF0gPT0gbnVsbCkgdGhyb3cgbmV3IFhuYkVycm9yKCJJbnZhbGlkIHJlYWRlciBpbmRleCAiLmNvbmNhdChpbmRleCkpOwoJCQlyZXR1cm4gdGhpcy5yZWFkZXJzW2luZGV4XS5yZWFkKGJ1ZmZlciwgdGhpcyk7CgkJfQoKCQl3cml0ZShidWZmZXIsIGNvbnRlbnQpIHsKCQkJdGhpcy5yZWFkZXJzWzBdLndyaXRlKGJ1ZmZlciwgY29udGVudCwgdGhpcyk7CgkJfQoKCQlnZXRJbmRleChyZWFkZXIpIHsKCQkJZm9yIChsZXQgaSA9IDAsIGxlbiA9IHRoaXMucmVhZGVycy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewoJCQkJaWYgKHJlYWRlci50b1N0cmluZygpID09PSB0aGlzLnJlYWRlcnNbaV0udG9TdHJpbmcoKSkgcmV0dXJuIGk7CgkJCX0KCQl9CgoJfQoKCWNsYXNzIFhuYkRhdGEgewoJCWNvbnN0cnVjdG9yKGhlYWRlciwgcmVhZGVycywgY29udGVudCkgewoJCQlsZXQgewoJCQkJdGFyZ2V0LAoJCQkJZm9ybWF0VmVyc2lvbiwKCQkJCWhpZGVmLAoJCQkJY29tcHJlc3NlZAoJCQl9ID0gaGVhZGVyOwoJCQl0aGlzLmhlYWRlciA9IHsKCQkJCXRhcmdldCwKCQkJCWZvcm1hdFZlcnNpb24sCgkJCQloaWRlZiwKCQkJCWNvbXByZXNzZWQKCQkJfTsKCQkJdGhpcy5yZWFkZXJzID0gcmVhZGVyczsKCQkJdGhpcy5jb250ZW50ID0gY29udGVudDsKCQl9CgoJCWdldCB0YXJnZXQoKSB7CgkJCXZhciBfdGhpcyRoZWFkZXI7CgoJCQlzd2l0Y2ggKChfdGhpcyRoZWFkZXIgPSB0aGlzLmhlYWRlcikgPT09IG51bGwgfHwgX3RoaXMkaGVhZGVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfdGhpcyRoZWFkZXIudGFyZ2V0KSB7CgkJCQljYXNlICd3JzoKCQkJCQlyZXR1cm4gIk1pY3Jvc29mdCBXaW5kb3dzIjsKCgkJCQljYXNlICdtJzoKCQkJCQlyZXR1cm4gIldpbmRvd3MgUGhvbmUgNyI7CgoJCQkJY2FzZSAneCc6CgkJCQkJcmV0dXJuICJYYm94IDM2MCI7CgoJCQkJY2FzZSAnYSc6CgkJCQkJcmV0dXJuICJBbmRyb2lkIjsKCgkJCQljYXNlICdpJzoKCQkJCQlyZXR1cm4gImlPUyI7CgoJCQkJZGVmYXVsdDoKCQkJCQlyZXR1cm4gIlVua25vd24iOwoJCQl9CgkJfQoKCQlnZXQgZm9ybWF0VmVyc2lvbigpIHsKCQkJdmFyIF90aGlzJGhlYWRlcjI7CgoJCQlzd2l0Y2ggKChfdGhpcyRoZWFkZXIyID0gdGhpcy5oZWFkZXIpID09PSBudWxsIHx8IF90aGlzJGhlYWRlcjIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF90aGlzJGhlYWRlcjIuZm9ybWF0VmVyc2lvbikgewoJCQkJY2FzZSAweDM6CgkJCQkJcmV0dXJuICJYTkEgR2FtZSBTdHVkaW8gMy4wIjsKCgkJCQljYXNlIDB4NDoKCQkJCQlyZXR1cm4gIlhOQSBHYW1lIFN0dWRpbyAzLjEiOwoKCQkJCWNhc2UgMHg1OgoJCQkJCXJldHVybiAiWE5BIEdhbWUgU3R1ZGlvIDQuMCI7CgoJCQkJZGVmYXVsdDoKCQkJCQlyZXR1cm4gIlVua25vd24iOwoJCQl9CgkJfQoKCQlnZXQgaGlkZWYoKSB7CgkJCXZhciBfdGhpcyRoZWFkZXIzOwoKCQkJcmV0dXJuICEhKChfdGhpcyRoZWFkZXIzID0gdGhpcy5oZWFkZXIpICE9PSBudWxsICYmIF90aGlzJGhlYWRlcjMgIT09IHZvaWQgMCAmJiBfdGhpcyRoZWFkZXIzLmhpZGVmKTsKCQl9CgoJCWdldCBjb21wcmVzc2VkKCkgewoJCQl2YXIgX3RoaXMkaGVhZGVyNDsKCgkJCXJldHVybiAhISgoX3RoaXMkaGVhZGVyNCA9IHRoaXMuaGVhZGVyKSAhPT0gbnVsbCAmJiBfdGhpcyRoZWFkZXI0ICE9PSB2b2lkIDAgJiYgX3RoaXMkaGVhZGVyNC5jb21wcmVzc2VkKTsKCQl9CgoJCWdldCBjb250ZW50VHlwZSgpIHsKCQkJbGV0IHsKCQkJCWV4cG9ydDogcmF3CgkJCX0gPSB0aGlzLmNvbnRlbnQ7CgkJCWlmIChyYXcgIT09IHVuZGVmaW5lZCkgcmV0dXJuIHJhdy50eXBlOwoJCQlyZXR1cm4gIkpTT04iOwoJCX0KCgkJZ2V0IHJhd0NvbnRlbnQoKSB7CgkJCWxldCB7CgkJCQlleHBvcnQ6IHJhdwoJCQl9ID0gdGhpcy5jb250ZW50OwoJCQlpZiAocmF3ICE9PSB1bmRlZmluZWQpIHJldHVybiByYXcuZGF0YTsKCQkJcmV0dXJuIEpTT04uc3RyaW5naWZ5KHRoaXMuY29udGVudCwgKGtleSwgdmFsdWUpID0+IHsKCQkJCWlmIChrZXkgPT09ICJleHBvcnQiKSByZXR1cm4gdmFsdWUudHlwZTsKCQkJCXJldHVybiB2YWx1ZTsKCQkJfSwgNCk7CgkJfQoKCQlzdHJpbmdpZnkoKSB7CgkJCXJldHVybiBKU09OLnN0cmluZ2lmeSh7CgkJCQloZWFkZXI6IHRoaXMuaGVhZGVyLAoJCQkJcmVhZGVyczogdGhpcy5yZWFkZXJzLAoJCQkJY29udGVudDogdGhpcy5jb250ZW50CgkJCX0sIG51bGwsIDQpOwoJCX0KCgkJdG9TdHJpbmcoKSB7CgkJCXJldHVybiB0aGlzLnN0cmluZ2lmeSgpOwoJCX0KCgl9CgoJZnVuY3Rpb24gZXh0ZW5zaW9uVG9EYXRhdHlwZShleHRlbnNpb24pIHsKCQlzd2l0Y2ggKGV4dGVuc2lvbikgewoJCQljYXNlICJqc29uIjoKCQkJCXJldHVybiAiSlNPTiI7CgoJCQljYXNlICJ5YW1sIjoKCQkJCXJldHVybiAieWFtbCI7CgoJCQljYXNlICJwbmciOgoJCQkJcmV0dXJuICJUZXh0dXJlMkQiOwoKCQkJY2FzZSAiY3NvIjoKCQkJCXJldHVybiAiRWZmZWN0IjsKCgkJCWNhc2UgJ3RiaW4nOgoJCQkJcmV0dXJuICJUQmluIjsKCgkJCWNhc2UgJ3htbCc6CgkJCQlyZXR1cm4gIkJtRm9udCI7CgkJfQoKCQlyZXR1cm4gIk90aGVycyI7Cgl9CgoJY2xhc3MgWG5iQ29udGVudCB7CgkJY29uc3RydWN0b3IoZGF0YSwgZXh0KSB7CgkJCXRoaXMudHlwZSA9IGV4dGVuc2lvblRvRGF0YXR5cGUoZXh0KTsKCQkJdGhpcy5jb250ZW50ID0gZGF0YTsKCQl9CgoJfQoKCWNvbnN0IEhJREVGX01BU0sgPSAweDE7Cgljb25zdCBDT01QUkVTU0VEX0xaNF9NQVNLID0gMHg0MDsKCWNvbnN0IENPTVBSRVNTRURfTFpYX01BU0sgPSAweDgwOwoJY29uc3QgWE5CX0NPTVBSRVNTRURfUFJPTE9HVUVfU0laRSA9IDE0OwoKCWNsYXNzIFhuYkNvbnZlcnRlciB7CgkJY29uc3RydWN0b3IoKSB7CgkJCXRoaXMudGFyZ2V0ID0gJyc7CgkJCXRoaXMuZm9ybWF0VmVyc2lvbiA9IDA7CgkJCXRoaXMuaGlkZWYgPSBmYWxzZTsKCQkJdGhpcy5jb21wcmVzc2VkID0gZmFsc2U7CgkJCXRoaXMuY29tcHJlc3Npb25UeXBlID0gMDsKCQkJdGhpcy5idWZmZXIgPSBudWxsOwoJCQl0aGlzLmZpbGVTaXplID0gMDsKCQkJdGhpcy5yZWFkZXJzID0gW107CgkJCXRoaXMuc2hhcmVkUmVzb3VyY2VzID0gW107CgkJfQoKCQlsb2FkKGFycmF5QnVmZmVyKSB7CgkJCXRoaXMuYnVmZmVyID0gbmV3IEJ1ZmZlclJlYWRlcihhcnJheUJ1ZmZlcik7CgoJCQl0aGlzLl92YWxpZGF0ZUhlYWRlcigpOwoKCQkJY29uc29sZS5pbmZvKCdYTkIgZmlsZSB2YWxpZGF0ZWQgc3VjY2Vzc2Z1bGx5IScpOwoJCQl0aGlzLmZpbGVTaXplID0gdGhpcy5idWZmZXIucmVhZFVJbnQzMigpOwoJCQlpZiAodGhpcy5idWZmZXIuc2l6ZSAhPSB0aGlzLmZpbGVTaXplKSB0aHJvdyBuZXcgWG5iRXJyb3IoJ1hOQiBmaWxlIGhhcyBiZWVuIHRydW5jYXRlZCEnKTsKCgkJCWlmICh0aGlzLmNvbXByZXNzZWQpIHsKCQkJCWNvbnN0IGRlY29tcHJlc3NlZFNpemUgPSB0aGlzLmJ1ZmZlci5yZWFkVUludDMyKCk7CgoJCQkJaWYgKHRoaXMuY29tcHJlc3Npb25UeXBlID09IENPTVBSRVNTRURfTFpYX01BU0spIHsKCQkJCQljb25zdCBjb21wcmVzc2VkVG9kbyA9IHRoaXMuZmlsZVNpemUgLSBYTkJfQ09NUFJFU1NFRF9QUk9MT0dVRV9TSVpFOwoJCQkJCWNvbnN0IGRlY29tcHJlc3NlZCA9IFByZXNzZXIuZGVjb21wcmVzcyh0aGlzLmJ1ZmZlciwgY29tcHJlc3NlZFRvZG8sIGRlY29tcHJlc3NlZFNpemUpOwoJCQkJCXRoaXMuYnVmZmVyLmNvcHlGcm9tKGRlY29tcHJlc3NlZCwgWE5CX0NPTVBSRVNTRURfUFJPTE9HVUVfU0laRSwgMCwgZGVjb21wcmVzc2VkU2l6ZSk7CgkJCQkJdGhpcy5idWZmZXIuYnl0ZVBvc2l0aW9uID0gWE5CX0NPTVBSRVNTRURfUFJPTE9HVUVfU0laRTsKCQkJCX0gZWxzZSBpZiAodGhpcy5jb21wcmVzc2lvblR5cGUgPT0gQ09NUFJFU1NFRF9MWjRfTUFTSykgewoJCQkJCWNvbnN0IHRyaW1tZWQgPSB0aGlzLmJ1ZmZlci5idWZmZXIuc2xpY2UoWE5CX0NPTVBSRVNTRURfUFJPTE9HVUVfU0laRSk7CgkJCQkJY29uc3QgdHJpbW1lZEFycmF5ID0gbmV3IFVpbnQ4QXJyYXkodHJpbW1lZCk7CgkJCQkJY29uc3QgZGVjb21wcmVzc2VkID0gbmV3IFVpbnQ4QXJyYXkoZGVjb21wcmVzc2VkU2l6ZSk7CgkJCQkJZGVjb21wcmVzc0Jsb2NrKHRyaW1tZWRBcnJheSwgZGVjb21wcmVzc2VkKTsKCQkJCQl0aGlzLmJ1ZmZlci5jb3B5RnJvbShkZWNvbXByZXNzZWQsIFhOQl9DT01QUkVTU0VEX1BST0xPR1VFX1NJWkUsIDAsIGRlY29tcHJlc3NlZFNpemUpOwoJCQkJCXRoaXMuYnVmZmVyLmJ5dGVQb3NpdGlvbiA9IFhOQl9DT01QUkVTU0VEX1BST0xPR1VFX1NJWkU7CgkJCQl9CgkJCX0KCgkJCWxldCBjb3VudCA9IHRoaXMuYnVmZmVyLnJlYWQ3Qml0TnVtYmVyKCk7CgkJCWNvbnN0IHN0cmluZ1JlYWRlciA9IG5ldyBTdHJpbmdSZWFkZXJDb3JlKCk7CgkJCWNvbnN0IHJlYWRlcnMgPSBbXTsKCgkJCWZvciAobGV0IGkgPSAwOyBpIDwgY291bnQ7IGkrKykgewoJCQkJY29uc3QgdHlwZSA9IHN0cmluZ1JlYWRlci5yZWFkKHRoaXMuYnVmZmVyKTsKCQkJCWNvbnN0IHZlcnNpb24gPSB0aGlzLmJ1ZmZlci5yZWFkSW50MzIoKTsKCQkJCWNvbnN0IHJlYWRlciA9IFR5cGVSZWFkZXIuZ2V0UmVhZGVyRnJvbVJhdyh0eXBlKTsKCQkJCXRoaXMucmVhZGVycy5wdXNoKHJlYWRlcik7CgkJCQlyZWFkZXJzLnB1c2goewoJCQkJCXR5cGUsCgkJCQkJdmVyc2lvbgoJCQkJfSk7CgkJCX0KCgkJCWNvbnN0IHNoYXJlZCA9IHRoaXMuYnVmZmVyLnJlYWQ3Qml0TnVtYmVyKCk7CgkJCWlmIChzaGFyZWQgIT0gMCkgdGhyb3cgbmV3IFhuYkVycm9yKCJVbmV4cGVjdGVkICgiLmNvbmNhdChzaGFyZWQsICIpIHNoYXJlZCByZXNvdXJjZXMuIikpOwoJCQljb25zdCBjb250ZW50ID0gbmV3IFJlYWRlclJlc29sdmVyKHRoaXMucmVhZGVycyk7CgkJCWNvbnN0IHJlc3VsdCA9IGNvbnRlbnQucmVhZCh0aGlzLmJ1ZmZlcik7CgkJCWNvbnNvbGUubG9nKCdTdWNjZXNzZnVseSByZWFkIFhOQiBmaWxlIScpOwoJCQlyZXR1cm4gbmV3IFhuYkRhdGEoewoJCQkJdGFyZ2V0OiB0aGlzLnRhcmdldCwKCQkJCWZvcm1hdFZlcnNpb246IHRoaXMuZm9ybWF0VmVyc2lvbiwKCQkJCWhpZGVmOiB0aGlzLmhpZGVmLAoJCQkJY29tcHJlc3NlZDogdGhpcy5jb21wcmVzc2VkCgkJCX0sIHJlYWRlcnMsIHJlc3VsdCk7CgkJfQoKCQljb252ZXJ0KGpzb24pIHsKCQkJY29uc3QgYnVmZmVyID0gbmV3IEJ1ZmZlcldyaXRlcigpOwoJCQljb25zdCBzdHJpbmdSZWFkZXIgPSBuZXcgU3RyaW5nUmVhZGVyQ29yZSgpOwoJCQlsZXQgewoJCQkJdGFyZ2V0LAoJCQkJZm9ybWF0VmVyc2lvbiwKCQkJCWhpZGVmLAoJCQkJY29tcHJlc3NlZAoJCQl9ID0ganNvbi5oZWFkZXI7CgkJCXRoaXMudGFyZ2V0ID0gdGFyZ2V0OwoJCQl0aGlzLmZvcm1hdFZlcnNpb24gPSBmb3JtYXRWZXJzaW9uOwoJCQl0aGlzLmhpZGVmID0gaGlkZWY7CgkJCWNvbnN0IGx6NENvbXByZXNzaW9uID0gdGhpcy50YXJnZXQgPT0gJ2EnIHx8IHRoaXMudGFyZ2V0ID09ICdpJyB8fCAoY29tcHJlc3NlZCAmIENPTVBSRVNTRURfTFo0X01BU0spICE9IDA7CgkJCXRoaXMuY29tcHJlc3NlZCA9IGx6NENvbXByZXNzaW9uID8gdHJ1ZSA6IGZhbHNlOwoJCQlidWZmZXIud3JpdGVTdHJpbmcoIlhOQiIpOwoJCQlidWZmZXIud3JpdGVTdHJpbmcodGhpcy50YXJnZXQpOwoJCQlidWZmZXIud3JpdGVCeXRlKHRoaXMuZm9ybWF0VmVyc2lvbik7CgkJCWJ1ZmZlci53cml0ZUJ5dGUodGhpcy5oaWRlZiB8ICh0aGlzLmNvbXByZXNzZWQgJiYgbHo0Q29tcHJlc3Npb24gPyBDT01QUkVTU0VEX0xaNF9NQVNLIDogMCkpOwoJCQlidWZmZXIud3JpdGVVSW50MzIoMCk7CgkJCWlmIChsejRDb21wcmVzc2lvbikgYnVmZmVyLndyaXRlVUludDMyKDApOwoJCQlidWZmZXIud3JpdGU3Qml0TnVtYmVyKGpzb24ucmVhZGVycy5sZW5ndGgpOwoKCQkJZm9yIChsZXQgcmVhZGVyIG9mIGpzb24ucmVhZGVycykgewoJCQkJdGhpcy5yZWFkZXJzLnB1c2goVHlwZVJlYWRlci5nZXRSZWFkZXJGcm9tUmF3KHJlYWRlci50eXBlKSk7CgkJCQlzdHJpbmdSZWFkZXIud3JpdGUoYnVmZmVyLCByZWFkZXIudHlwZSk7CgkJCQlidWZmZXIud3JpdGVVSW50MzIocmVhZGVyLnZlcnNpb24pOwoJCQl9CgoJCQlidWZmZXIud3JpdGU3Qml0TnVtYmVyKDApOwoJCQljb25zdCBjb250ZW50ID0gbmV3IFJlYWRlclJlc29sdmVyKHRoaXMucmVhZGVycyk7CgkJCWNvbnRlbnQud3JpdGUoYnVmZmVyLCBqc29uLmNvbnRlbnQpOwoJCQlidWZmZXIudHJpbSgpOwoKCQkJaWYgKGx6NENvbXByZXNzaW9uKSB7CgkJCQljb25zdCB0cmltbWVkID0gYnVmZmVyLmJ1ZmZlci5zbGljZShYTkJfQ09NUFJFU1NFRF9QUk9MT0dVRV9TSVpFKTsKCQkJCWNvbnN0IHRyaW1tZWRBcnJheSA9IG5ldyBVaW50OEFycmF5KHRyaW1tZWQpOwoJCQkJbGV0IGNvbXByZXNzZWRTaXplID0gY29tcHJlc3NCb3VuZCh0cmltbWVkQXJyYXkubGVuZ3RoKTsKCQkJCWxldCBjb21wcmVzc2VkID0gbmV3IFVpbnQ4QXJyYXkoY29tcHJlc3NlZFNpemUpOwoJCQkJY29tcHJlc3NlZFNpemUgPSBjb21wcmVzc1NpbmdsZUJsb2NrKHRyaW1tZWRBcnJheSwgY29tcHJlc3NlZCk7CgkJCQljb21wcmVzc2VkID0gY29tcHJlc3NlZC5zbGljZSgwLCBjb21wcmVzc2VkU2l6ZSk7CgkJCQlidWZmZXIuYnl0ZVBvc2l0aW9uID0gNjsKCQkJCWJ1ZmZlci53cml0ZVVJbnQzMihYTkJfQ09NUFJFU1NFRF9QUk9MT0dVRV9TSVpFICsgY29tcHJlc3NlZFNpemUpOwoJCQkJYnVmZmVyLndyaXRlVUludDMyKHRyaW1tZWRBcnJheS5sZW5ndGgpOwoJCQkJYnVmZmVyLmNvbmNhdChjb21wcmVzc2VkKTsKCQkJCWxldCByZXR1cm5CdWZmZXIgPSBidWZmZXIuYnVmZmVyLnNsaWNlKDAsIFhOQl9DT01QUkVTU0VEX1BST0xPR1VFX1NJWkUgKyBjb21wcmVzc2VkU2l6ZSk7CgkJCQlyZXR1cm4gcmV0dXJuQnVmZmVyOwoJCQl9CgoJCQlsZXQgZmlsZVNpemUgPSBidWZmZXIuYnl0ZVBvc2l0aW9uOwoJCQlidWZmZXIuYnl0ZVBvc2l0aW9uID0gNjsKCQkJYnVmZmVyLndyaXRlVUludDMyKGZpbGVTaXplLCA2KTsKCQkJcmV0dXJuIGJ1ZmZlci5idWZmZXI7CgkJfQoKCQlfdmFsaWRhdGVIZWFkZXIoKSB7CgkJCWlmICh0aGlzLmJ1ZmZlciA9PSBudWxsKSB0aHJvdyBuZXcgWG5iRXJyb3IoJ0J1ZmZlciBpcyBudWxsJyk7CgkJCWNvbnN0IG1hZ2ljID0gdGhpcy5idWZmZXIucmVhZFN0cmluZygzKTsKCQkJaWYgKG1hZ2ljICE9ICdYTkInKSB0aHJvdyBuZXcgWG5iRXJyb3IoIkludmFsaWQgZmlsZSBtYWdpYyBmb3VuZCwgZXhwZWN0aW5nIFwiWE5CXCIsIGZvdW5kIFwiIi5jb25jYXQobWFnaWMsICJcIiIpKTsKCQkJdGhpcy50YXJnZXQgPSB0aGlzLmJ1ZmZlci5yZWFkU3RyaW5nKDEpLnRvTG93ZXJDYXNlKCk7CgkJCXRoaXMuZm9ybWF0VmVyc2lvbiA9IHRoaXMuYnVmZmVyLnJlYWRCeXRlKCk7CgkJCWNvbnN0IGZsYWdzID0gdGhpcy5idWZmZXIucmVhZEJ5dGUoMSk7CgkJCXRoaXMuaGlkZWYgPSAoZmxhZ3MgJiBISURFRl9NQVNLKSAhPSAwOwoJCQl0aGlzLmNvbXByZXNzZWQgPSBmbGFncyAmIENPTVBSRVNTRURfTFpYX01BU0sgfHwgKGZsYWdzICYgQ09NUFJFU1NFRF9MWjRfTUFTSykgIT0gMDsKCQkJdGhpcy5jb21wcmVzc2lvblR5cGUgPSAoZmxhZ3MgJiBDT01QUkVTU0VEX0xaWF9NQVNLKSAhPSAwID8gQ09NUFJFU1NFRF9MWlhfTUFTSyA6IGZsYWdzICYgQ09NUFJFU1NFRF9MWjRfTUFTSyA/IENPTVBSRVNTRURfTFo0X01BU0sgOiAwOwoJCX0KCgl9CgoJdmFyIHQgPSB7CgkJMzk2OiBmdW5jdGlvbiBfKCkgewoJCQkhZnVuY3Rpb24gKHQpIHsKCQkJCWlmICh0LlRleHRFbmNvZGVyICYmIHQuVGV4dERlY29kZXIpIHJldHVybiAhMTsKCgkJCQlmdW5jdGlvbiBlKCkgewoJCQkJCWxldCB0ID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiAidXRmLTgiOwoJCQkJCWlmICgidXRmLTgiICE9PSB0KSB0aHJvdyBuZXcgUmFuZ2VFcnJvcigiRmFpbGVkIHRvIGNvbnN0cnVjdCAnVGV4dEVuY29kZXInOiBUaGUgZW5jb2RpbmcgbGFiZWwgcHJvdmlkZWQgKCciLmNvbmNhdCh0LCAiJykgaXMgaW52YWxpZC4iKSk7CgkJCQl9CgoJCQkJZnVuY3Rpb24gaSgpIHsKCQkJCQlsZXQgdCA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogInV0Zi04IjsKCQkJCQlsZXQgZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogewoJCQkJCQlmYXRhbDogITEKCQkJCQl9OwoJCQkJCWlmICgidXRmLTgiICE9PSB0KSB0aHJvdyBuZXcgUmFuZ2VFcnJvcigiRmFpbGVkIHRvIGNvbnN0cnVjdCAnVGV4dERlY29kZXInOiBUaGUgZW5jb2RpbmcgbGFiZWwgcHJvdmlkZWQgKCciLmNvbmNhdCh0LCAiJykgaXMgaW52YWxpZC4iKSk7CgkJCQkJaWYgKGUuZmF0YWwpIHRocm93IG5ldyBFcnJvcigiRmFpbGVkIHRvIGNvbnN0cnVjdCAnVGV4dERlY29kZXInOiB0aGUgJ2ZhdGFsJyBvcHRpb24gaXMgdW5zdXBwb3J0ZWQuIik7CgkJCQl9CgoJCQkJT2JqZWN0LmRlZmluZVByb3BlcnR5KGUucHJvdG90eXBlLCAiZW5jb2RpbmciLCB7CgkJCQkJdmFsdWU6ICJ1dGYtOCIKCQkJCX0pLCBlLnByb3RvdHlwZS5lbmNvZGUgPSBmdW5jdGlvbiAodCkgewoJCQkJCWxldCBlID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiB7CgkJCQkJCXN0cmVhbTogITEKCQkJCQl9OwoJCQkJCWlmIChlLnN0cmVhbSkgdGhyb3cgbmV3IEVycm9yKCJGYWlsZWQgdG8gZW5jb2RlOiB0aGUgJ3N0cmVhbScgb3B0aW9uIGlzIHVuc3VwcG9ydGVkLiIpOwoJCQkJCWxldCBpID0gMDsKCQkJCQljb25zdCBuID0gdC5sZW5ndGg7CgkJCQkJbGV0IHIgPSAwLAoJCQkJCQkJcyA9IE1hdGgubWF4KDMyLCBuICsgKG4gPj4gMSkgKyA3KSwKCQkJCQkJCWEgPSBuZXcgVWludDhBcnJheShzID4+IDMgPDwgMyk7CgoJCQkJCWZvciAoOyBpIDwgbjspIHsKCQkJCQkJbGV0IGUgPSB0LmNoYXJDb2RlQXQoaSsrKTsKCgkJCQkJCWlmIChlID49IDU1Mjk2ICYmIGUgPD0gNTYzMTkpIHsKCQkJCQkJCWlmIChpIDwgbikgewoJCQkJCQkJCWNvbnN0IG4gPSB0LmNoYXJDb2RlQXQoaSk7CgkJCQkJCQkJNTYzMjAgPT0gKDY0NTEyICYgbikgJiYgKCsraSwgZSA9ICgoMTAyMyAmIGUpIDw8IDEwKSArICgxMDIzICYgbikgKyA2NTUzNik7CgkJCQkJCQl9CgoJCQkJCQkJaWYgKGUgPj0gNTUyOTYgJiYgZSA8PSA1NjMxOSkgY29udGludWU7CgkJCQkJCX0KCgkJCQkJCWlmIChyICsgNCA+IGEubGVuZ3RoKSB7CgkJCQkJCQlzICs9IDgsIHMgKj0gMSArIGkgLyB0Lmxlbmd0aCAqIDIsIHMgPSBzID4+IDMgPDwgMzsKCQkJCQkJCWNvbnN0IGUgPSBuZXcgVWludDhBcnJheShzKTsKCQkJCQkJCWUuc2V0KGEpLCBhID0gZTsKCQkJCQkJfQoKCQkJCQkJaWYgKDAgIT0gKDQyOTQ5NjcxNjggJiBlKSkgewoJCQkJCQkJaWYgKDAgPT0gKDQyOTQ5NjUyNDggJiBlKSkgYVtyKytdID0gZSA+PiA2ICYgMzEgfCAxOTI7ZWxzZSBpZiAoMCA9PSAoNDI5NDkwMTc2MCAmIGUpKSBhW3IrK10gPSBlID4+IDEyICYgMTUgfCAyMjQsIGFbcisrXSA9IGUgPj4gNiAmIDYzIHwgMTI4O2Vsc2UgewoJCQkJCQkJCWlmICgwICE9ICg0MjkyODcwMTQ0ICYgZSkpIGNvbnRpbnVlOwoJCQkJCQkJCWFbcisrXSA9IGUgPj4gMTggJiA3IHwgMjQwLCBhW3IrK10gPSBlID4+IDEyICYgNjMgfCAxMjgsIGFbcisrXSA9IGUgPj4gNiAmIDYzIHwgMTI4OwoJCQkJCQkJfQoJCQkJCQkJYVtyKytdID0gNjMgJiBlIHwgMTI4OwoJCQkJCQl9IGVsc2UgYVtyKytdID0gZTsKCQkJCQl9CgoJCQkJCXJldHVybiBhLnNsaWNlKDAsIHIpOwoJCQkJfSwgT2JqZWN0LmRlZmluZVByb3BlcnR5KGkucHJvdG90eXBlLCAiZW5jb2RpbmciLCB7CgkJCQkJdmFsdWU6ICJ1dGYtOCIKCQkJCX0pLCBPYmplY3QuZGVmaW5lUHJvcGVydHkoaS5wcm90b3R5cGUsICJmYXRhbCIsIHsKCQkJCQl2YWx1ZTogITEKCQkJCX0pLCBPYmplY3QuZGVmaW5lUHJvcGVydHkoaS5wcm90b3R5cGUsICJpZ25vcmVCT00iLCB7CgkJCQkJdmFsdWU6ICExCgkJCQl9KSwgaS5wcm90b3R5cGUuZGVjb2RlID0gZnVuY3Rpb24gKHQpIHsKCQkJCQlsZXQgZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogewoJCQkJCQlzdHJlYW06ICExCgkJCQkJfTsKCQkJCQlpZiAoZS5zdHJlYW0pIHRocm93IG5ldyBFcnJvcigiRmFpbGVkIHRvIGRlY29kZTogdGhlICdzdHJlYW0nIG9wdGlvbiBpcyB1bnN1cHBvcnRlZC4iKTsKCQkJCQljb25zdCBpID0gbmV3IFVpbnQ4QXJyYXkodCk7CgkJCQkJbGV0IG4gPSAwOwoJCQkJCWNvbnN0IHIgPSBpLmxlbmd0aCwKCQkJCQkJCQlzID0gW107CgoJCQkJCWZvciAoOyBuIDwgcjspIHsKCQkJCQkJY29uc3QgdCA9IGlbbisrXTsKCQkJCQkJaWYgKDAgPT09IHQpIGJyZWFrOwoJCQkJCQlpZiAoMCA9PSAoMTI4ICYgdCkpIHMucHVzaCh0KTtlbHNlIGlmICgxOTIgPT0gKDIyNCAmIHQpKSB7CgkJCQkJCQljb25zdCBlID0gNjMgJiBpW24rK107CgkJCQkJCQlzLnB1c2goKDMxICYgdCkgPDwgNiB8IGUpOwoJCQkJCQl9IGVsc2UgaWYgKDIyNCA9PSAoMjQwICYgdCkpIHsKCQkJCQkJCWNvbnN0IGUgPSA2MyAmIGlbbisrXSwKCQkJCQkJCQkJCXIgPSA2MyAmIGlbbisrXTsKCQkJCQkJCXMucHVzaCgoMzEgJiB0KSA8PCAxMiB8IGUgPDwgNiB8IHIpOwoJCQkJCQl9IGVsc2UgaWYgKDI0MCA9PSAoMjQ4ICYgdCkpIHsKCQkJCQkJCWxldCBlID0gKDcgJiB0KSA8PCAxOCB8ICg2MyAmIGlbbisrXSkgPDwgMTIgfCAoNjMgJiBpW24rK10pIDw8IDYgfCA2MyAmIGlbbisrXTsKCQkJCQkJCWUgPiA2NTUzNSAmJiAoZSAtPSA2NTUzNiwgcy5wdXNoKGUgPj4+IDEwICYgMTAyMyB8IDU1Mjk2KSwgZSA9IDU2MzIwIHwgMTAyMyAmIGUpLCBzLnB1c2goZSk7CgkJCQkJCX0KCQkJCQl9CgoJCQkJCXJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsIHMpOwoJCQkJfSwgdC5UZXh0RW5jb2RlciA9IGUsIHQuVGV4dERlY29kZXIgPSBpOwoJCQl9KCJ1bmRlZmluZWQiICE9IHR5cGVvZiB3aW5kb3cgPyB3aW5kb3cgOiAidW5kZWZpbmVkIiAhPSB0eXBlb2Ygc2VsZiA/IHNlbGYgOiB0aGlzKTsKCQl9Cgl9LAoJCQllID0ge307CgoJZnVuY3Rpb24gaShuKSB7CgkJdmFyIHIgPSBlW25dOwoJCWlmICh2b2lkIDAgIT09IHIpIHJldHVybiByLmV4cG9ydHM7CgkJdmFyIHMgPSBlW25dID0gewoJCQlleHBvcnRzOiB7fQoJCX07CgkJcmV0dXJuIHRbbl0uY2FsbChzLmV4cG9ydHMsIHMsIHMuZXhwb3J0cywgaSksIHMuZXhwb3J0czsKCX0KCglpLmQgPSAodCwgZSkgPT4gewoJCWZvciAodmFyIG4gaW4gZSkgaS5vKGUsIG4pICYmICFpLm8odCwgbikgJiYgT2JqZWN0LmRlZmluZVByb3BlcnR5KHQsIG4sIHsKCQkJZW51bWVyYWJsZTogITAsCgkJCWdldDogZVtuXQoJCX0pOwoJfSwgaS5vID0gKHQsIGUpID0+IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbCh0LCBlKTsKCXZhciBuID0ge307CgoJKCgpID0+IHsKCQlpLmQobiwgewoJCQlQOiAoKSA9PiBNaSwKCQkJbTogKCkgPT4gRmkKCQl9KSwgaSgzOTYpOwoJCWNvbnN0IHQgPSBuZXcgVGV4dERlY29kZXIoInV0Zi04IiksCgkJCQkJZSA9IG5ldyBUZXh0RW5jb2RlcigpOwoKCQljbGFzcyByIHsKCQkJY29uc3RydWN0b3IoKSB7CgkJCQlsZXQgdCA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogODE5MjsKCQkJCWxldCBlID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiB7fTsKCQkJCWxldCBpID0gITE7CgkJCQkibnVtYmVyIiA9PSB0eXBlb2YgdCA/IHQgPSBuZXcgQXJyYXlCdWZmZXIodCkgOiAoaSA9ICEwLCB0aGlzLmxhc3RXcml0dGVuQnl0ZSA9IHQuYnl0ZUxlbmd0aCk7CgkJCQljb25zdCBuID0gZS5vZmZzZXQgPyBlLm9mZnNldCA+Pj4gMCA6IDAsCgkJCQkJCQlzID0gdC5ieXRlTGVuZ3RoIC0gbjsKCQkJCWxldCBhID0gbjsKCQkJCShBcnJheUJ1ZmZlci5pc1ZpZXcodCkgfHwgdCBpbnN0YW5jZW9mIHIpICYmICh0LmJ5dGVMZW5ndGggIT09IHQuYnVmZmVyLmJ5dGVMZW5ndGggJiYgKGEgPSB0LmJ5dGVPZmZzZXQgKyBuKSwgdCA9IHQuYnVmZmVyKSwgdGhpcy5sYXN0V3JpdHRlbkJ5dGUgPSBpID8gcyA6IDAsIHRoaXMuYnVmZmVyID0gdCwgdGhpcy5sZW5ndGggPSBzLCB0aGlzLmJ5dGVMZW5ndGggPSBzLCB0aGlzLmJ5dGVPZmZzZXQgPSBhLCB0aGlzLm9mZnNldCA9IDAsIHRoaXMubGl0dGxlRW5kaWFuID0gITAsIHRoaXMuX2RhdGEgPSBuZXcgRGF0YVZpZXcodGhpcy5idWZmZXIsIGEsIHMpLCB0aGlzLl9tYXJrID0gMCwgdGhpcy5fbWFya3MgPSBbXTsKCQkJfQoKCQkJYXZhaWxhYmxlKCkgewoJCQkJbGV0IHQgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IDE7CgkJCQlyZXR1cm4gdGhpcy5vZmZzZXQgKyB0IDw9IHRoaXMubGVuZ3RoOwoJCQl9CgoJCQlpc0xpdHRsZUVuZGlhbigpIHsKCQkJCXJldHVybiB0aGlzLmxpdHRsZUVuZGlhbjsKCQkJfQoKCQkJc2V0TGl0dGxlRW5kaWFuKCkgewoJCQkJcmV0dXJuIHRoaXMubGl0dGxlRW5kaWFuID0gITAsIHRoaXM7CgkJCX0KCgkJCWlzQmlnRW5kaWFuKCkgewoJCQkJcmV0dXJuICF0aGlzLmxpdHRsZUVuZGlhbjsKCQkJfQoKCQkJc2V0QmlnRW5kaWFuKCkgewoJCQkJcmV0dXJuIHRoaXMubGl0dGxlRW5kaWFuID0gITEsIHRoaXM7CgkJCX0KCgkJCXNraXAoKSB7CgkJCQlsZXQgdCA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogMTsKCQkJCXJldHVybiB0aGlzLm9mZnNldCArPSB0LCB0aGlzOwoJCQl9CgoJCQlzZWVrKHQpIHsKCQkJCXJldHVybiB0aGlzLm9mZnNldCA9IHQsIHRoaXM7CgkJCX0KCgkJCW1hcmsoKSB7CgkJCQlyZXR1cm4gdGhpcy5fbWFyayA9IHRoaXMub2Zmc2V0LCB0aGlzOwoJCQl9CgoJCQlyZXNldCgpIHsKCQkJCXJldHVybiB0aGlzLm9mZnNldCA9IHRoaXMuX21hcmssIHRoaXM7CgkJCX0KCgkJCXB1c2hNYXJrKCkgewoJCQkJcmV0dXJuIHRoaXMuX21hcmtzLnB1c2godGhpcy5vZmZzZXQpLCB0aGlzOwoJCQl9CgoJCQlwb3BNYXJrKCkgewoJCQkJY29uc3QgdCA9IHRoaXMuX21hcmtzLnBvcCgpOwoKCQkJCWlmICh2b2lkIDAgPT09IHQpIHRocm93IG5ldyBFcnJvcigiTWFyayBzdGFjayBlbXB0eSIpOwoJCQkJcmV0dXJuIHRoaXMuc2Vlayh0KSwgdGhpczsKCQkJfQoKCQkJcmV3aW5kKCkgewoJCQkJcmV0dXJuIHRoaXMub2Zmc2V0ID0gMCwgdGhpczsKCQkJfQoKCQkJZW5zdXJlQXZhaWxhYmxlKCkgewoJCQkJbGV0IHQgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IDE7CgoJCQkJaWYgKCF0aGlzLmF2YWlsYWJsZSh0KSkgewoJCQkJCWNvbnN0IGUgPSAyICogKHRoaXMub2Zmc2V0ICsgdCksCgkJCQkJCQkJaSA9IG5ldyBVaW50OEFycmF5KGUpOwoJCQkJCWkuc2V0KG5ldyBVaW50OEFycmF5KHRoaXMuYnVmZmVyKSksIHRoaXMuYnVmZmVyID0gaS5idWZmZXIsIHRoaXMubGVuZ3RoID0gdGhpcy5ieXRlTGVuZ3RoID0gZSwgdGhpcy5fZGF0YSA9IG5ldyBEYXRhVmlldyh0aGlzLmJ1ZmZlcik7CgkJCQl9CgoJCQkJcmV0dXJuIHRoaXM7CgkJCX0KCgkJCXJlYWRCb29sZWFuKCkgewoJCQkJcmV0dXJuIDAgIT09IHRoaXMucmVhZFVpbnQ4KCk7CgkJCX0KCgkJCXJlYWRJbnQ4KCkgewoJCQkJcmV0dXJuIHRoaXMuX2RhdGEuZ2V0SW50OCh0aGlzLm9mZnNldCsrKTsKCQkJfQoKCQkJcmVhZFVpbnQ4KCkgewoJCQkJcmV0dXJuIHRoaXMuX2RhdGEuZ2V0VWludDgodGhpcy5vZmZzZXQrKyk7CgkJCX0KCgkJCXJlYWRCeXRlKCkgewoJCQkJcmV0dXJuIHRoaXMucmVhZFVpbnQ4KCk7CgkJCX0KCgkJCXJlYWRCeXRlcygpIHsKCQkJCWxldCB0ID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiAxOwoJCQkJY29uc3QgZSA9IG5ldyBVaW50OEFycmF5KHQpOwoKCQkJCWZvciAobGV0IGkgPSAwOyBpIDwgdDsgaSsrKSBlW2ldID0gdGhpcy5yZWFkQnl0ZSgpOwoKCQkJCXJldHVybiBlOwoJCQl9CgoJCQlyZWFkSW50MTYoKSB7CgkJCQljb25zdCB0ID0gdGhpcy5fZGF0YS5nZXRJbnQxNih0aGlzLm9mZnNldCwgdGhpcy5saXR0bGVFbmRpYW4pOwoKCQkJCXJldHVybiB0aGlzLm9mZnNldCArPSAyLCB0OwoJCQl9CgoJCQlyZWFkVWludDE2KCkgewoJCQkJY29uc3QgdCA9IHRoaXMuX2RhdGEuZ2V0VWludDE2KHRoaXMub2Zmc2V0LCB0aGlzLmxpdHRsZUVuZGlhbik7CgoJCQkJcmV0dXJuIHRoaXMub2Zmc2V0ICs9IDIsIHQ7CgkJCX0KCgkJCXJlYWRJbnQzMigpIHsKCQkJCWNvbnN0IHQgPSB0aGlzLl9kYXRhLmdldEludDMyKHRoaXMub2Zmc2V0LCB0aGlzLmxpdHRsZUVuZGlhbik7CgoJCQkJcmV0dXJuIHRoaXMub2Zmc2V0ICs9IDQsIHQ7CgkJCX0KCgkJCXJlYWRVaW50MzIoKSB7CgkJCQljb25zdCB0ID0gdGhpcy5fZGF0YS5nZXRVaW50MzIodGhpcy5vZmZzZXQsIHRoaXMubGl0dGxlRW5kaWFuKTsKCgkJCQlyZXR1cm4gdGhpcy5vZmZzZXQgKz0gNCwgdDsKCQkJfQoKCQkJcmVhZEZsb2F0MzIoKSB7CgkJCQljb25zdCB0ID0gdGhpcy5fZGF0YS5nZXRGbG9hdDMyKHRoaXMub2Zmc2V0LCB0aGlzLmxpdHRsZUVuZGlhbik7CgoJCQkJcmV0dXJuIHRoaXMub2Zmc2V0ICs9IDQsIHQ7CgkJCX0KCgkJCXJlYWRGbG9hdDY0KCkgewoJCQkJY29uc3QgdCA9IHRoaXMuX2RhdGEuZ2V0RmxvYXQ2NCh0aGlzLm9mZnNldCwgdGhpcy5saXR0bGVFbmRpYW4pOwoKCQkJCXJldHVybiB0aGlzLm9mZnNldCArPSA4LCB0OwoJCQl9CgoJCQlyZWFkQmlnSW50NjQoKSB7CgkJCQljb25zdCB0ID0gdGhpcy5fZGF0YS5nZXRCaWdJbnQ2NCh0aGlzLm9mZnNldCwgdGhpcy5saXR0bGVFbmRpYW4pOwoKCQkJCXJldHVybiB0aGlzLm9mZnNldCArPSA4LCB0OwoJCQl9CgoJCQlyZWFkQmlnVWludDY0KCkgewoJCQkJY29uc3QgdCA9IHRoaXMuX2RhdGEuZ2V0QmlnVWludDY0KHRoaXMub2Zmc2V0LCB0aGlzLmxpdHRsZUVuZGlhbik7CgoJCQkJcmV0dXJuIHRoaXMub2Zmc2V0ICs9IDgsIHQ7CgkJCX0KCgkJCXJlYWRDaGFyKCkgewoJCQkJcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUodGhpcy5yZWFkSW50OCgpKTsKCQkJfQoKCQkJcmVhZENoYXJzKCkgewoJCQkJbGV0IHQgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IDE7CgkJCQlsZXQgZSA9ICIiOwoKCQkJCWZvciAobGV0IGkgPSAwOyBpIDwgdDsgaSsrKSBlICs9IHRoaXMucmVhZENoYXIoKTsKCgkJCQlyZXR1cm4gZTsKCQkJfQoKCQkJcmVhZFV0ZjgoKSB7CgkJCQlsZXQgZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogMTsKCQkJCXJldHVybiBpID0gdGhpcy5yZWFkQnl0ZXMoZSksIHQuZGVjb2RlKGkpOwoJCQkJdmFyIGk7CgkJCX0KCgkJCXdyaXRlQm9vbGVhbih0KSB7CgkJCQlyZXR1cm4gdGhpcy53cml0ZVVpbnQ4KHQgPyAyNTUgOiAwKSwgdGhpczsKCQkJfQoKCQkJd3JpdGVJbnQ4KHQpIHsKCQkJCXJldHVybiB0aGlzLmVuc3VyZUF2YWlsYWJsZSgxKSwgdGhpcy5fZGF0YS5zZXRJbnQ4KHRoaXMub2Zmc2V0KyssIHQpLCB0aGlzLl91cGRhdGVMYXN0V3JpdHRlbkJ5dGUoKSwgdGhpczsKCQkJfQoKCQkJd3JpdGVVaW50OCh0KSB7CgkJCQlyZXR1cm4gdGhpcy5lbnN1cmVBdmFpbGFibGUoMSksIHRoaXMuX2RhdGEuc2V0VWludDgodGhpcy5vZmZzZXQrKywgdCksIHRoaXMuX3VwZGF0ZUxhc3RXcml0dGVuQnl0ZSgpLCB0aGlzOwoJCQl9CgoJCQl3cml0ZUJ5dGUodCkgewoJCQkJcmV0dXJuIHRoaXMud3JpdGVVaW50OCh0KTsKCQkJfQoKCQkJd3JpdGVCeXRlcyh0KSB7CgkJCQl0aGlzLmVuc3VyZUF2YWlsYWJsZSh0Lmxlbmd0aCk7CgoJCQkJZm9yIChsZXQgZSA9IDA7IGUgPCB0Lmxlbmd0aDsgZSsrKSB0aGlzLl9kYXRhLnNldFVpbnQ4KHRoaXMub2Zmc2V0KyssIHRbZV0pOwoKCQkJCXJldHVybiB0aGlzLl91cGRhdGVMYXN0V3JpdHRlbkJ5dGUoKSwgdGhpczsKCQkJfQoKCQkJd3JpdGVJbnQxNih0KSB7CgkJCQlyZXR1cm4gdGhpcy5lbnN1cmVBdmFpbGFibGUoMiksIHRoaXMuX2RhdGEuc2V0SW50MTYodGhpcy5vZmZzZXQsIHQsIHRoaXMubGl0dGxlRW5kaWFuKSwgdGhpcy5vZmZzZXQgKz0gMiwgdGhpcy5fdXBkYXRlTGFzdFdyaXR0ZW5CeXRlKCksIHRoaXM7CgkJCX0KCgkJCXdyaXRlVWludDE2KHQpIHsKCQkJCXJldHVybiB0aGlzLmVuc3VyZUF2YWlsYWJsZSgyKSwgdGhpcy5fZGF0YS5zZXRVaW50MTYodGhpcy5vZmZzZXQsIHQsIHRoaXMubGl0dGxlRW5kaWFuKSwgdGhpcy5vZmZzZXQgKz0gMiwgdGhpcy5fdXBkYXRlTGFzdFdyaXR0ZW5CeXRlKCksIHRoaXM7CgkJCX0KCgkJCXdyaXRlSW50MzIodCkgewoJCQkJcmV0dXJuIHRoaXMuZW5zdXJlQXZhaWxhYmxlKDQpLCB0aGlzLl9kYXRhLnNldEludDMyKHRoaXMub2Zmc2V0LCB0LCB0aGlzLmxpdHRsZUVuZGlhbiksIHRoaXMub2Zmc2V0ICs9IDQsIHRoaXMuX3VwZGF0ZUxhc3RXcml0dGVuQnl0ZSgpLCB0aGlzOwoJCQl9CgoJCQl3cml0ZVVpbnQzMih0KSB7CgkJCQlyZXR1cm4gdGhpcy5lbnN1cmVBdmFpbGFibGUoNCksIHRoaXMuX2RhdGEuc2V0VWludDMyKHRoaXMub2Zmc2V0LCB0LCB0aGlzLmxpdHRsZUVuZGlhbiksIHRoaXMub2Zmc2V0ICs9IDQsIHRoaXMuX3VwZGF0ZUxhc3RXcml0dGVuQnl0ZSgpLCB0aGlzOwoJCQl9CgoJCQl3cml0ZUZsb2F0MzIodCkgewoJCQkJcmV0dXJuIHRoaXMuZW5zdXJlQXZhaWxhYmxlKDQpLCB0aGlzLl9kYXRhLnNldEZsb2F0MzIodGhpcy5vZmZzZXQsIHQsIHRoaXMubGl0dGxlRW5kaWFuKSwgdGhpcy5vZmZzZXQgKz0gNCwgdGhpcy5fdXBkYXRlTGFzdFdyaXR0ZW5CeXRlKCksIHRoaXM7CgkJCX0KCgkJCXdyaXRlRmxvYXQ2NCh0KSB7CgkJCQlyZXR1cm4gdGhpcy5lbnN1cmVBdmFpbGFibGUoOCksIHRoaXMuX2RhdGEuc2V0RmxvYXQ2NCh0aGlzLm9mZnNldCwgdCwgdGhpcy5saXR0bGVFbmRpYW4pLCB0aGlzLm9mZnNldCArPSA4LCB0aGlzLl91cGRhdGVMYXN0V3JpdHRlbkJ5dGUoKSwgdGhpczsKCQkJfQoKCQkJd3JpdGVCaWdJbnQ2NCh0KSB7CgkJCQlyZXR1cm4gdGhpcy5lbnN1cmVBdmFpbGFibGUoOCksIHRoaXMuX2RhdGEuc2V0QmlnSW50NjQodGhpcy5vZmZzZXQsIHQsIHRoaXMubGl0dGxlRW5kaWFuKSwgdGhpcy5vZmZzZXQgKz0gOCwgdGhpcy5fdXBkYXRlTGFzdFdyaXR0ZW5CeXRlKCksIHRoaXM7CgkJCX0KCgkJCXdyaXRlQmlnVWludDY0KHQpIHsKCQkJCXJldHVybiB0aGlzLmVuc3VyZUF2YWlsYWJsZSg4KSwgdGhpcy5fZGF0YS5zZXRCaWdVaW50NjQodGhpcy5vZmZzZXQsIHQsIHRoaXMubGl0dGxlRW5kaWFuKSwgdGhpcy5vZmZzZXQgKz0gOCwgdGhpcy5fdXBkYXRlTGFzdFdyaXR0ZW5CeXRlKCksIHRoaXM7CgkJCX0KCgkJCXdyaXRlQ2hhcih0KSB7CgkJCQlyZXR1cm4gdGhpcy53cml0ZVVpbnQ4KHQuY2hhckNvZGVBdCgwKSk7CgkJCX0KCgkJCXdyaXRlQ2hhcnModCkgewoJCQkJZm9yIChsZXQgZSA9IDA7IGUgPCB0Lmxlbmd0aDsgZSsrKSB0aGlzLndyaXRlVWludDgodC5jaGFyQ29kZUF0KGUpKTsKCgkJCQlyZXR1cm4gdGhpczsKCQkJfQoKCQkJd3JpdGVVdGY4KHQpIHsKCQkJCXJldHVybiB0aGlzLndyaXRlQnl0ZXMoZnVuY3Rpb24gKHQpIHsKCQkJCQlyZXR1cm4gZS5lbmNvZGUodCk7CgkJCQl9KHQpKTsKCQkJfQoKCQkJdG9BcnJheSgpIHsKCQkJCXJldHVybiBuZXcgVWludDhBcnJheSh0aGlzLmJ1ZmZlciwgdGhpcy5ieXRlT2Zmc2V0LCB0aGlzLmxhc3RXcml0dGVuQnl0ZSk7CgkJCX0KCgkJCV91cGRhdGVMYXN0V3JpdHRlbkJ5dGUoKSB7CgkJCQl0aGlzLm9mZnNldCA+IHRoaXMubGFzdFdyaXR0ZW5CeXRlICYmICh0aGlzLmxhc3RXcml0dGVuQnl0ZSA9IHRoaXMub2Zmc2V0KTsKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIHModCkgewoJCQlsZXQgZSA9IHQubGVuZ3RoOwoKCQkJZm9yICg7IC0tZSA+PSAwOykgdFtlXSA9IDA7CgkJfQoKCQljb25zdCBhID0gbmV3IFVpbnQ4QXJyYXkoWzAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDEsIDEsIDEsIDEsIDIsIDIsIDIsIDIsIDMsIDMsIDMsIDMsIDQsIDQsIDQsIDQsIDUsIDUsIDUsIDUsIDBdKSwKCQkJCQlvID0gbmV3IFVpbnQ4QXJyYXkoWzAsIDAsIDAsIDAsIDEsIDEsIDIsIDIsIDMsIDMsIDQsIDQsIDUsIDUsIDYsIDYsIDcsIDcsIDgsIDgsIDksIDksIDEwLCAxMCwgMTEsIDExLCAxMiwgMTIsIDEzLCAxM10pLAoJCQkJCWggPSBuZXcgVWludDhBcnJheShbMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMiwgMywgN10pLAoJCQkJCWwgPSBuZXcgVWludDhBcnJheShbMTYsIDE3LCAxOCwgMCwgOCwgNywgOSwgNiwgMTAsIDUsIDExLCA0LCAxMiwgMywgMTMsIDIsIDE0LCAxLCAxNV0pLAoJCQkJCWQgPSBuZXcgQXJyYXkoNTc2KTsKCQlzKGQpOwoKCQljb25zdCBfID0gbmV3IEFycmF5KDYwKTsKCgkJcyhfKTsKCQljb25zdCBmID0gbmV3IEFycmF5KDUxMik7CgkJcyhmKTsKCQljb25zdCBjID0gbmV3IEFycmF5KDI1Nik7CgkJcyhjKTsKCQljb25zdCB1ID0gbmV3IEFycmF5KDI5KTsKCQlzKHUpOwoJCWNvbnN0IHcgPSBuZXcgQXJyYXkoMzApOwoKCQlmdW5jdGlvbiBwKHQsIGUsIGksIG4sIHIpIHsKCQkJdGhpcy5zdGF0aWNfdHJlZSA9IHQsIHRoaXMuZXh0cmFfYml0cyA9IGUsIHRoaXMuZXh0cmFfYmFzZSA9IGksIHRoaXMuZWxlbXMgPSBuLCB0aGlzLm1heF9sZW5ndGggPSByLCB0aGlzLmhhc19zdHJlZSA9IHQgJiYgdC5sZW5ndGg7CgkJfQoKCQlsZXQgZywgYiwgbTsKCgkJZnVuY3Rpb24gayh0LCBlKSB7CgkJCXRoaXMuZHluX3RyZWUgPSB0LCB0aGlzLm1heF9jb2RlID0gMCwgdGhpcy5zdGF0X2Rlc2MgPSBlOwoJCX0KCgkJcyh3KTsKCgkJY29uc3QgeSA9IHQgPT4gdCA8IDI1NiA/IGZbdF0gOiBmWzI1NiArICh0ID4+PiA3KV0sCgkJCQkJdiA9ICh0LCBlKSA9PiB7CgkJCXQucGVuZGluZ19idWZbdC5wZW5kaW5nKytdID0gMjU1ICYgZSwgdC5wZW5kaW5nX2J1Zlt0LnBlbmRpbmcrK10gPSBlID4+PiA4ICYgMjU1OwoJCX0sCgkJCQkJRSA9ICh0LCBlLCBpKSA9PiB7CgkJCXQuYmlfdmFsaWQgPiAxNiAtIGkgPyAodC5iaV9idWYgfD0gZSA8PCB0LmJpX3ZhbGlkICYgNjU1MzUsIHYodCwgdC5iaV9idWYpLCB0LmJpX2J1ZiA9IGUgPj4gMTYgLSB0LmJpX3ZhbGlkLCB0LmJpX3ZhbGlkICs9IGkgLSAxNikgOiAodC5iaV9idWYgfD0gZSA8PCB0LmJpX3ZhbGlkICYgNjU1MzUsIHQuYmlfdmFsaWQgKz0gaSk7CgkJfSwKCQkJCQlBID0gKHQsIGUsIGkpID0+IHsKCQkJRSh0LCBpWzIgKiBlXSwgaVsyICogZSArIDFdKTsKCQl9LAoJCQkJCXggPSAodCwgZSkgPT4gewoJCQlsZXQgaSA9IDA7CgoJCQlkbyB7CgkJCQlpIHw9IDEgJiB0LCB0ID4+Pj0gMSwgaSA8PD0gMTsKCQkJfSB3aGlsZSAoLS1lID4gMCk7CgoJCQlyZXR1cm4gaSA+Pj4gMTsKCQl9LAoJCQkJCVUgPSAodCwgZSwgaSkgPT4gewoJCQljb25zdCBuID0gbmV3IEFycmF5KDE2KTsKCQkJbGV0IHIsCgkJCQkJcywKCQkJCQlhID0gMDsKCgkJCWZvciAociA9IDE7IHIgPD0gMTU7IHIrKykgbltyXSA9IGEgPSBhICsgaVtyIC0gMV0gPDwgMTsKCgkJCWZvciAocyA9IDA7IHMgPD0gZTsgcysrKSB7CgkJCQlsZXQgZSA9IHRbMiAqIHMgKyAxXTsKCQkJCTAgIT09IGUgJiYgKHRbMiAqIHNdID0geChuW2VdKyssIGUpKTsKCQkJfQoJCX0sCgkJCQkJeiA9IHQgPT4gewoJCQlsZXQgZTsKCgkJCWZvciAoZSA9IDA7IGUgPCAyODY7IGUrKykgdC5keW5fbHRyZWVbMiAqIGVdID0gMDsKCgkJCWZvciAoZSA9IDA7IGUgPCAzMDsgZSsrKSB0LmR5bl9kdHJlZVsyICogZV0gPSAwOwoKCQkJZm9yIChlID0gMDsgZSA8IDE5OyBlKyspIHQuYmxfdHJlZVsyICogZV0gPSAwOwoKCQkJdC5keW5fbHRyZWVbNTEyXSA9IDEsIHQub3B0X2xlbiA9IHQuc3RhdGljX2xlbiA9IDAsIHQubGFzdF9saXQgPSB0Lm1hdGNoZXMgPSAwOwoJCX0sCgkJCQkJUiA9IHQgPT4gewoJCQl0LmJpX3ZhbGlkID4gOCA/IHYodCwgdC5iaV9idWYpIDogdC5iaV92YWxpZCA+IDAgJiYgKHQucGVuZGluZ19idWZbdC5wZW5kaW5nKytdID0gdC5iaV9idWYpLCB0LmJpX2J1ZiA9IDAsIHQuYmlfdmFsaWQgPSAwOwoJCX0sCgkJCQkJTiA9ICh0LCBlLCBpLCBuKSA9PiB7CgkJCWNvbnN0IHIgPSAyICogZSwKCQkJCQkJcyA9IDIgKiBpOwoJCQlyZXR1cm4gdFtyXSA8IHRbc10gfHwgdFtyXSA9PT0gdFtzXSAmJiBuW2VdIDw9IG5baV07CgkJfSwKCQkJCQlUID0gKHQsIGUsIGkpID0+IHsKCQkJY29uc3QgbiA9IHQuaGVhcFtpXTsKCQkJbGV0IHIgPSBpIDw8IDE7CgoJCQlmb3IgKDsgciA8PSB0LmhlYXBfbGVuICYmIChyIDwgdC5oZWFwX2xlbiAmJiBOKGUsIHQuaGVhcFtyICsgMV0sIHQuaGVhcFtyXSwgdC5kZXB0aCkgJiYgcisrLCAhTihlLCBuLCB0LmhlYXBbcl0sIHQuZGVwdGgpKTspIHQuaGVhcFtpXSA9IHQuaGVhcFtyXSwgaSA9IHIsIHIgPDw9IDE7CgoJCQl0LmhlYXBbaV0gPSBuOwoJCX0sCgkJCQkJTyA9ICh0LCBlLCBpKSA9PiB7CgkJCWxldCBuLAoJCQkJCXIsCgkJCQkJcywKCQkJCQloLAoJCQkJCWwgPSAwOwoJCQlpZiAoMCAhPT0gdC5sYXN0X2xpdCkgZG8gewoJCQkJbiA9IHQucGVuZGluZ19idWZbdC5kX2J1ZiArIDIgKiBsXSA8PCA4IHwgdC5wZW5kaW5nX2J1Zlt0LmRfYnVmICsgMiAqIGwgKyAxXSwgciA9IHQucGVuZGluZ19idWZbdC5sX2J1ZiArIGxdLCBsKyssIDAgPT09IG4gPyBBKHQsIHIsIGUpIDogKHMgPSBjW3JdLCBBKHQsIHMgKyAyNTYgKyAxLCBlKSwgaCA9IGFbc10sIDAgIT09IGggJiYgKHIgLT0gdVtzXSwgRSh0LCByLCBoKSksIG4tLSwgcyA9IHkobiksIEEodCwgcywgaSksIGggPSBvW3NdLCAwICE9PSBoICYmIChuIC09IHdbc10sIEUodCwgbiwgaCkpKTsKCQkJfSB3aGlsZSAobCA8IHQubGFzdF9saXQpOwoJCQlBKHQsIDI1NiwgZSk7CgkJfSwKCQkJCQlMID0gKHQsIGUpID0+IHsKCQkJY29uc3QgaSA9IGUuZHluX3RyZWUsCgkJCQkJCW4gPSBlLnN0YXRfZGVzYy5zdGF0aWNfdHJlZSwKCQkJCQkJciA9IGUuc3RhdF9kZXNjLmhhc19zdHJlZSwKCQkJCQkJcyA9IGUuc3RhdF9kZXNjLmVsZW1zOwoJCQlsZXQgYSwKCQkJCQlvLAoJCQkJCWgsCgkJCQkJbCA9IC0xOwoKCQkJZm9yICh0LmhlYXBfbGVuID0gMCwgdC5oZWFwX21heCA9IDU3MywgYSA9IDA7IGEgPCBzOyBhKyspIDAgIT09IGlbMiAqIGFdID8gKHQuaGVhcFsrK3QuaGVhcF9sZW5dID0gbCA9IGEsIHQuZGVwdGhbYV0gPSAwKSA6IGlbMiAqIGEgKyAxXSA9IDA7CgoJCQlmb3IgKDsgdC5oZWFwX2xlbiA8IDI7KSBoID0gdC5oZWFwWysrdC5oZWFwX2xlbl0gPSBsIDwgMiA/ICsrbCA6IDAsIGlbMiAqIGhdID0gMSwgdC5kZXB0aFtoXSA9IDAsIHQub3B0X2xlbi0tLCByICYmICh0LnN0YXRpY19sZW4gLT0gblsyICogaCArIDFdKTsKCgkJCWZvciAoZS5tYXhfY29kZSA9IGwsIGEgPSB0LmhlYXBfbGVuID4+IDE7IGEgPj0gMTsgYS0tKSBUKHQsIGksIGEpOwoKCQkJaCA9IHM7CgoJCQlkbyB7CgkJCQlhID0gdC5oZWFwWzFdLCB0LmhlYXBbMV0gPSB0LmhlYXBbdC5oZWFwX2xlbi0tXSwgVCh0LCBpLCAxKSwgbyA9IHQuaGVhcFsxXSwgdC5oZWFwWy0tdC5oZWFwX21heF0gPSBhLCB0LmhlYXBbLS10LmhlYXBfbWF4XSA9IG8sIGlbMiAqIGhdID0gaVsyICogYV0gKyBpWzIgKiBvXSwgdC5kZXB0aFtoXSA9ICh0LmRlcHRoW2FdID49IHQuZGVwdGhbb10gPyB0LmRlcHRoW2FdIDogdC5kZXB0aFtvXSkgKyAxLCBpWzIgKiBhICsgMV0gPSBpWzIgKiBvICsgMV0gPSBoLCB0LmhlYXBbMV0gPSBoKyssIFQodCwgaSwgMSk7CgkJCX0gd2hpbGUgKHQuaGVhcF9sZW4gPj0gMik7CgoJCQl0LmhlYXBbLS10LmhlYXBfbWF4XSA9IHQuaGVhcFsxXSwgKCh0LCBlKSA9PiB7CgkJCQljb25zdCBpID0gZS5keW5fdHJlZSwKCQkJCQkJCW4gPSBlLm1heF9jb2RlLAoJCQkJCQkJciA9IGUuc3RhdF9kZXNjLnN0YXRpY190cmVlLAoJCQkJCQkJcyA9IGUuc3RhdF9kZXNjLmhhc19zdHJlZSwKCQkJCQkJCWEgPSBlLnN0YXRfZGVzYy5leHRyYV9iaXRzLAoJCQkJCQkJbyA9IGUuc3RhdF9kZXNjLmV4dHJhX2Jhc2UsCgkJCQkJCQloID0gZS5zdGF0X2Rlc2MubWF4X2xlbmd0aDsKCgkJCQlsZXQgbCwKCQkJCQkJZCwKCQkJCQkJXywKCQkJCQkJZiwKCQkJCQkJYywKCQkJCQkJdSwKCQkJCQkJdyA9IDA7CgoJCQkJZm9yIChmID0gMDsgZiA8PSAxNTsgZisrKSB0LmJsX2NvdW50W2ZdID0gMDsKCgkJCQlmb3IgKGlbMiAqIHQuaGVhcFt0LmhlYXBfbWF4XSArIDFdID0gMCwgbCA9IHQuaGVhcF9tYXggKyAxOyBsIDwgNTczOyBsKyspIGQgPSB0LmhlYXBbbF0sIGYgPSBpWzIgKiBpWzIgKiBkICsgMV0gKyAxXSArIDEsIGYgPiBoICYmIChmID0gaCwgdysrKSwgaVsyICogZCArIDFdID0gZiwgZCA+IG4gfHwgKHQuYmxfY291bnRbZl0rKywgYyA9IDAsIGQgPj0gbyAmJiAoYyA9IGFbZCAtIG9dKSwgdSA9IGlbMiAqIGRdLCB0Lm9wdF9sZW4gKz0gdSAqIChmICsgYyksIHMgJiYgKHQuc3RhdGljX2xlbiArPSB1ICogKHJbMiAqIGQgKyAxXSArIGMpKSk7CgoJCQkJaWYgKDAgIT09IHcpIHsKCQkJCQlkbyB7CgkJCQkJCWZvciAoZiA9IGggLSAxOyAwID09PSB0LmJsX2NvdW50W2ZdOykgZi0tOwoKCQkJCQkJdC5ibF9jb3VudFtmXS0tLCB0LmJsX2NvdW50W2YgKyAxXSArPSAyLCB0LmJsX2NvdW50W2hdLS0sIHcgLT0gMjsKCQkJCQl9IHdoaWxlICh3ID4gMCk7CgoJCQkJCWZvciAoZiA9IGg7IDAgIT09IGY7IGYtLSkgZm9yIChkID0gdC5ibF9jb3VudFtmXTsgMCAhPT0gZDspIF8gPSB0LmhlYXBbLS1sXSwgXyA+IG4gfHwgKGlbMiAqIF8gKyAxXSAhPT0gZiAmJiAodC5vcHRfbGVuICs9IChmIC0gaVsyICogXyArIDFdKSAqIGlbMiAqIF9dLCBpWzIgKiBfICsgMV0gPSBmKSwgZC0tKTsKCQkJCX0KCQkJfSkodCwgZSksIFUoaSwgbCwgdC5ibF9jb3VudCk7CgkJfSwKCQkJCQlCID0gKHQsIGUsIGkpID0+IHsKCQkJbGV0IG4sCgkJCQkJciwKCQkJCQlzID0gLTEsCgkJCQkJYSA9IGVbMV0sCgkJCQkJbyA9IDAsCgkJCQkJaCA9IDcsCgkJCQkJbCA9IDQ7CgoJCQlmb3IgKDAgPT09IGEgJiYgKGggPSAxMzgsIGwgPSAzKSwgZVsyICogKGkgKyAxKSArIDFdID0gNjU1MzUsIG4gPSAwOyBuIDw9IGk7IG4rKykgciA9IGEsIGEgPSBlWzIgKiAobiArIDEpICsgMV0sICsrbyA8IGggJiYgciA9PT0gYSB8fCAobyA8IGwgPyB0LmJsX3RyZWVbMiAqIHJdICs9IG8gOiAwICE9PSByID8gKHIgIT09IHMgJiYgdC5ibF90cmVlWzIgKiByXSsrLCB0LmJsX3RyZWVbMzJdKyspIDogbyA8PSAxMCA/IHQuYmxfdHJlZVszNF0rKyA6IHQuYmxfdHJlZVszNl0rKywgbyA9IDAsIHMgPSByLCAwID09PSBhID8gKGggPSAxMzgsIGwgPSAzKSA6IHIgPT09IGEgPyAoaCA9IDYsIGwgPSAzKSA6IChoID0gNywgbCA9IDQpKTsKCQl9LAoJCQkJCUMgPSAodCwgZSwgaSkgPT4gewoJCQlsZXQgbiwKCQkJCQlyLAoJCQkJCXMgPSAtMSwKCQkJCQlhID0gZVsxXSwKCQkJCQlvID0gMCwKCQkJCQloID0gNywKCQkJCQlsID0gNDsKCgkJCWZvciAoMCA9PT0gYSAmJiAoaCA9IDEzOCwgbCA9IDMpLCBuID0gMDsgbiA8PSBpOyBuKyspIGlmIChyID0gYSwgYSA9IGVbMiAqIChuICsgMSkgKyAxXSwgISgrK28gPCBoICYmIHIgPT09IGEpKSB7CgkJCQlpZiAobyA8IGwpIGRvIHsKCQkJCQlBKHQsIHIsIHQuYmxfdHJlZSk7CgkJCQl9IHdoaWxlICgwICE9IC0tbyk7ZWxzZSAwICE9PSByID8gKHIgIT09IHMgJiYgKEEodCwgciwgdC5ibF90cmVlKSwgby0tKSwgQSh0LCAxNiwgdC5ibF90cmVlKSwgRSh0LCBvIC0gMywgMikpIDogbyA8PSAxMCA/IChBKHQsIDE3LCB0LmJsX3RyZWUpLCBFKHQsIG8gLSAzLCAzKSkgOiAoQSh0LCAxOCwgdC5ibF90cmVlKSwgRSh0LCBvIC0gMTEsIDcpKTsKCQkJCW8gPSAwLCBzID0gciwgMCA9PT0gYSA/IChoID0gMTM4LCBsID0gMykgOiByID09PSBhID8gKGggPSA2LCBsID0gMykgOiAoaCA9IDcsIGwgPSA0KTsKCQkJfQoJCX07CgoJCWxldCBEID0gITE7CgoJCWNvbnN0IEkgPSAodCwgZSwgaSwgbikgPT4gewoJCQlFKHQsIDAgKyAobiA/IDEgOiAwKSwgMyksICgodCwgZSwgaSwgbikgPT4gewoJCQkJUih0KSwgdih0LCBpKSwgdih0LCB+aSksIHQucGVuZGluZ19idWYuc2V0KHQud2luZG93LnN1YmFycmF5KGUsIGUgKyBpKSwgdC5wZW5kaW5nKSwgdC5wZW5kaW5nICs9IGk7CgkJCX0pKHQsIGUsIGkpOwoJCX07CgoJCXZhciBTID0gewoJCQlfdHJfaW5pdDogdCA9PiB7CgkJCQlEIHx8ICgoKCkgPT4gewoJCQkJCWxldCB0LCBlLCBpLCBuLCByOwoJCQkJCWNvbnN0IHMgPSBuZXcgQXJyYXkoMTYpOwoKCQkJCQlmb3IgKGkgPSAwLCBuID0gMDsgbiA8IDI4OyBuKyspIGZvciAodVtuXSA9IGksIHQgPSAwOyB0IDwgMSA8PCBhW25dOyB0KyspIGNbaSsrXSA9IG47CgoJCQkJCWZvciAoY1tpIC0gMV0gPSBuLCByID0gMCwgbiA9IDA7IG4gPCAxNjsgbisrKSBmb3IgKHdbbl0gPSByLCB0ID0gMDsgdCA8IDEgPDwgb1tuXTsgdCsrKSBmW3IrK10gPSBuOwoKCQkJCQlmb3IgKHIgPj49IDc7IG4gPCAzMDsgbisrKSBmb3IgKHdbbl0gPSByIDw8IDcsIHQgPSAwOyB0IDwgMSA8PCBvW25dIC0gNzsgdCsrKSBmWzI1NiArIHIrK10gPSBuOwoKCQkJCQlmb3IgKGUgPSAwOyBlIDw9IDE1OyBlKyspIHNbZV0gPSAwOwoKCQkJCQlmb3IgKHQgPSAwOyB0IDw9IDE0MzspIGRbMiAqIHQgKyAxXSA9IDgsIHQrKywgc1s4XSsrOwoKCQkJCQlmb3IgKDsgdCA8PSAyNTU7KSBkWzIgKiB0ICsgMV0gPSA5LCB0KyssIHNbOV0rKzsKCgkJCQkJZm9yICg7IHQgPD0gMjc5OykgZFsyICogdCArIDFdID0gNywgdCsrLCBzWzddKys7CgoJCQkJCWZvciAoOyB0IDw9IDI4NzspIGRbMiAqIHQgKyAxXSA9IDgsIHQrKywgc1s4XSsrOwoKCQkJCQlmb3IgKFUoZCwgMjg3LCBzKSwgdCA9IDA7IHQgPCAzMDsgdCsrKSBfWzIgKiB0ICsgMV0gPSA1LCBfWzIgKiB0XSA9IHgodCwgNSk7CgoJCQkJCWcgPSBuZXcgcChkLCBhLCAyNTcsIDI4NiwgMTUpLCBiID0gbmV3IHAoXywgbywgMCwgMzAsIDE1KSwgbSA9IG5ldyBwKG5ldyBBcnJheSgwKSwgaCwgMCwgMTksIDcpOwoJCQkJfSkoKSwgRCA9ICEwKSwgdC5sX2Rlc2MgPSBuZXcgayh0LmR5bl9sdHJlZSwgZyksIHQuZF9kZXNjID0gbmV3IGsodC5keW5fZHRyZWUsIGIpLCB0LmJsX2Rlc2MgPSBuZXcgayh0LmJsX3RyZWUsIG0pLCB0LmJpX2J1ZiA9IDAsIHQuYmlfdmFsaWQgPSAwLCB6KHQpOwoJCQl9LAoJCQlfdHJfc3RvcmVkX2Jsb2NrOiBJLAoJCQlfdHJfZmx1c2hfYmxvY2s6ICh0LCBlLCBpLCBuKSA9PiB7CgkJCQlsZXQgciwKCQkJCQkJcywKCQkJCQkJYSA9IDA7CgkJCQl0LmxldmVsID4gMCA/ICgyID09PSB0LnN0cm0uZGF0YV90eXBlICYmICh0LnN0cm0uZGF0YV90eXBlID0gKHQgPT4gewoJCQkJCWxldCBlLAoJCQkJCQkJaSA9IDQwOTM2MjQ0NDc7CgoJCQkJCWZvciAoZSA9IDA7IGUgPD0gMzE7IGUrKywgaSA+Pj49IDEpIGlmICgxICYgaSAmJiAwICE9PSB0LmR5bl9sdHJlZVsyICogZV0pIHJldHVybiAwOwoKCQkJCQlpZiAoMCAhPT0gdC5keW5fbHRyZWVbMThdIHx8IDAgIT09IHQuZHluX2x0cmVlWzIwXSB8fCAwICE9PSB0LmR5bl9sdHJlZVsyNl0pIHJldHVybiAxOwoKCQkJCQlmb3IgKGUgPSAzMjsgZSA8IDI1NjsgZSsrKSBpZiAoMCAhPT0gdC5keW5fbHRyZWVbMiAqIGVdKSByZXR1cm4gMTsKCgkJCQkJcmV0dXJuIDA7CgkJCQl9KSh0KSksIEwodCwgdC5sX2Rlc2MpLCBMKHQsIHQuZF9kZXNjKSwgYSA9ICh0ID0+IHsKCQkJCQlsZXQgZTsKCgkJCQkJZm9yIChCKHQsIHQuZHluX2x0cmVlLCB0LmxfZGVzYy5tYXhfY29kZSksIEIodCwgdC5keW5fZHRyZWUsIHQuZF9kZXNjLm1heF9jb2RlKSwgTCh0LCB0LmJsX2Rlc2MpLCBlID0gMTg7IGUgPj0gMyAmJiAwID09PSB0LmJsX3RyZWVbMiAqIGxbZV0gKyAxXTsgZS0tKTsKCgkJCQkJcmV0dXJuIHQub3B0X2xlbiArPSAzICogKGUgKyAxKSArIDUgKyA1ICsgNCwgZTsKCQkJCX0pKHQpLCByID0gdC5vcHRfbGVuICsgMyArIDcgPj4+IDMsIHMgPSB0LnN0YXRpY19sZW4gKyAzICsgNyA+Pj4gMywgcyA8PSByICYmIChyID0gcykpIDogciA9IHMgPSBpICsgNSwgaSArIDQgPD0gciAmJiAtMSAhPT0gZSA/IEkodCwgZSwgaSwgbikgOiA0ID09PSB0LnN0cmF0ZWd5IHx8IHMgPT09IHIgPyAoRSh0LCAyICsgKG4gPyAxIDogMCksIDMpLCBPKHQsIGQsIF8pKSA6IChFKHQsIDQgKyAobiA/IDEgOiAwKSwgMyksICgodCwgZSwgaSwgbikgPT4gewoJCQkJCWxldCByOwoKCQkJCQlmb3IgKEUodCwgZSAtIDI1NywgNSksIEUodCwgaSAtIDEsIDUpLCBFKHQsIG4gLSA0LCA0KSwgciA9IDA7IHIgPCBuOyByKyspIEUodCwgdC5ibF90cmVlWzIgKiBsW3JdICsgMV0sIDMpOwoKCQkJCQlDKHQsIHQuZHluX2x0cmVlLCBlIC0gMSksIEModCwgdC5keW5fZHRyZWUsIGkgLSAxKTsKCQkJCX0pKHQsIHQubF9kZXNjLm1heF9jb2RlICsgMSwgdC5kX2Rlc2MubWF4X2NvZGUgKyAxLCBhICsgMSksIE8odCwgdC5keW5fbHRyZWUsIHQuZHluX2R0cmVlKSksIHoodCksIG4gJiYgUih0KTsKCQkJfSwKCQkJX3RyX3RhbGx5OiAodCwgZSwgaSkgPT4gKHQucGVuZGluZ19idWZbdC5kX2J1ZiArIDIgKiB0Lmxhc3RfbGl0XSA9IGUgPj4+IDggJiAyNTUsIHQucGVuZGluZ19idWZbdC5kX2J1ZiArIDIgKiB0Lmxhc3RfbGl0ICsgMV0gPSAyNTUgJiBlLCB0LnBlbmRpbmdfYnVmW3QubF9idWYgKyB0Lmxhc3RfbGl0XSA9IDI1NSAmIGksIHQubGFzdF9saXQrKywgMCA9PT0gZSA/IHQuZHluX2x0cmVlWzIgKiBpXSsrIDogKHQubWF0Y2hlcysrLCBlLS0sIHQuZHluX2x0cmVlWzIgKiAoY1tpXSArIDI1NiArIDEpXSsrLCB0LmR5bl9kdHJlZVsyICogeShlKV0rKyksIHQubGFzdF9saXQgPT09IHQubGl0X2J1ZnNpemUgLSAxKSwKCQkJX3RyX2FsaWduOiB0ID0+IHsKCQkJCUUodCwgMiwgMyksIEEodCwgMjU2LCBkKSwgKHQgPT4gewoJCQkJCTE2ID09PSB0LmJpX3ZhbGlkID8gKHYodCwgdC5iaV9idWYpLCB0LmJpX2J1ZiA9IDAsIHQuYmlfdmFsaWQgPSAwKSA6IHQuYmlfdmFsaWQgPj0gOCAmJiAodC5wZW5kaW5nX2J1Zlt0LnBlbmRpbmcrK10gPSAyNTUgJiB0LmJpX2J1ZiwgdC5iaV9idWYgPj49IDgsIHQuYmlfdmFsaWQgLT0gOCk7CgkJCQl9KSh0KTsKCQkJfQoJCX0sCgkJCQlaID0gKHQsIGUsIGksIG4pID0+IHsKCQkJbGV0IHIgPSA2NTUzNSAmIHQgfCAwLAoJCQkJCXMgPSB0ID4+PiAxNiAmIDY1NTM1IHwgMCwKCQkJCQlhID0gMDsKCgkJCWZvciAoOyAwICE9PSBpOykgewoJCQkJYSA9IGkgPiAyZTMgPyAyZTMgOiBpLCBpIC09IGE7CgoJCQkJZG8gewoJCQkJCXIgPSByICsgZVtuKytdIHwgMCwgcyA9IHMgKyByIHwgMDsKCQkJCX0gd2hpbGUgKC0tYSk7CgoJCQkJciAlPSA2NTUyMSwgcyAlPSA2NTUyMTsKCQkJfQoKCQkJcmV0dXJuIHIgfCBzIDw8IDE2IHwgMDsKCQl9OwoKCQljb25zdCBGID0gbmV3IFVpbnQzMkFycmF5KCgoKSA9PiB7CgkJCWxldCB0LAoJCQkJCWUgPSBbXTsKCgkJCWZvciAodmFyIGkgPSAwOyBpIDwgMjU2OyBpKyspIHsKCQkJCXQgPSBpOwoKCQkJCWZvciAodmFyIG4gPSAwOyBuIDwgODsgbisrKSB0ID0gMSAmIHQgPyAzOTg4MjkyMzg0IF4gdCA+Pj4gMSA6IHQgPj4+IDE7CgoJCQkJZVtpXSA9IHQ7CgkJCX0KCgkJCXJldHVybiBlOwoJCX0pKCkpOwoKCQl2YXIgTSA9ICh0LCBlLCBpLCBuKSA9PiB7CgkJCWNvbnN0IHIgPSBGLAoJCQkJCQlzID0gbiArIGk7CgkJCXQgXj0gLTE7CgoJCQlmb3IgKGxldCBpID0gbjsgaSA8IHM7IGkrKykgdCA9IHQgPj4+IDggXiByWzI1NSAmICh0IF4gZVtpXSldOwoKCQkJcmV0dXJuIC0xIF4gdDsKCQl9LAoJCQkJUCA9IHsKCQkJMjogIm5lZWQgZGljdGlvbmFyeSIsCgkJCTE6ICJzdHJlYW0gZW5kIiwKCQkJMDogIiIsCgkJCSItMSI6ICJmaWxlIGVycm9yIiwKCQkJIi0yIjogInN0cmVhbSBlcnJvciIsCgkJCSItMyI6ICJkYXRhIGVycm9yIiwKCQkJIi00IjogImluc3VmZmljaWVudCBtZW1vcnkiLAoJCQkiLTUiOiAiYnVmZmVyIGVycm9yIiwKCQkJIi02IjogImluY29tcGF0aWJsZSB2ZXJzaW9uIgoJCX0sCgkJCQlIID0gewoJCQlaX05PX0ZMVVNIOiAwLAoJCQlaX1BBUlRJQUxfRkxVU0g6IDEsCgkJCVpfU1lOQ19GTFVTSDogMiwKCQkJWl9GVUxMX0ZMVVNIOiAzLAoJCQlaX0ZJTklTSDogNCwKCQkJWl9CTE9DSzogNSwKCQkJWl9UUkVFUzogNiwKCQkJWl9PSzogMCwKCQkJWl9TVFJFQU1fRU5EOiAxLAoJCQlaX05FRURfRElDVDogMiwKCQkJWl9FUlJOTzogLTEsCgkJCVpfU1RSRUFNX0VSUk9SOiAtMiwKCQkJWl9EQVRBX0VSUk9SOiAtMywKCQkJWl9NRU1fRVJST1I6IC00LAoJCQlaX0JVRl9FUlJPUjogLTUsCgkJCVpfTk9fQ09NUFJFU1NJT046IDAsCgkJCVpfQkVTVF9TUEVFRDogMSwKCQkJWl9CRVNUX0NPTVBSRVNTSU9OOiA5LAoJCQlaX0RFRkFVTFRfQ09NUFJFU1NJT046IC0xLAoJCQlaX0ZJTFRFUkVEOiAxLAoJCQlaX0hVRkZNQU5fT05MWTogMiwKCQkJWl9STEU6IDMsCgkJCVpfRklYRUQ6IDQsCgkJCVpfREVGQVVMVF9TVFJBVEVHWTogMCwKCQkJWl9CSU5BUlk6IDAsCgkJCVpfVEVYVDogMSwKCQkJWl9VTktOT1dOOiAyLAoJCQlaX0RFRkxBVEVEOiA4CgkJfTsKCgkJY29uc3QgewoJCQlfdHJfaW5pdDogVywKCQkJX3RyX3N0b3JlZF9ibG9jazogSywKCQkJX3RyX2ZsdXNoX2Jsb2NrOiAkLAoJCQlfdHJfdGFsbHk6IFksCgkJCV90cl9hbGlnbjogagoJCX0gPSBTLAoJCQkJCXsKCQkJWl9OT19GTFVTSDogRywKCQkJWl9QQVJUSUFMX0ZMVVNIOiBYLAoJCQlaX0ZVTExfRkxVU0g6IFYsCgkJCVpfRklOSVNIOiBxLAoJCQlaX0JMT0NLOiBKLAoJCQlaX09LOiBRLAoJCQlaX1NUUkVBTV9FTkQ6IHR0LAoJCQlaX1NUUkVBTV9FUlJPUjogZXQsCgkJCVpfREFUQV9FUlJPUjogaXQsCgkJCVpfQlVGX0VSUk9SOiBudCwKCQkJWl9ERUZBVUxUX0NPTVBSRVNTSU9OOiBydCwKCQkJWl9GSUxURVJFRDogc3QsCgkJCVpfSFVGRk1BTl9PTkxZOiBhdCwKCQkJWl9STEU6IG90LAoJCQlaX0ZJWEVEOiBodCwKCQkJWl9ERUZBVUxUX1NUUkFURUdZOiBsdCwKCQkJWl9VTktOT1dOOiBkdCwKCQkJWl9ERUZMQVRFRDogX3QKCQl9ID0gSCwKCQkJCQlmdCA9IDI1OCwKCQkJCQljdCA9IDI2MiwKCQkJCQl1dCA9IDEwMywKCQkJCQl3dCA9IDExMywKCQkJCQlwdCA9IDY2NiwKCQkJCQlndCA9ICh0LCBlKSA9PiAodC5tc2cgPSBQW2VdLCBlKSwKCQkJCQlidCA9IHQgPT4gKHQgPDwgMSkgLSAodCA+IDQgPyA5IDogMCksCgkJCQkJbXQgPSB0ID0+IHsKCQkJbGV0IGUgPSB0Lmxlbmd0aDsKCgkJCWZvciAoOyAtLWUgPj0gMDspIHRbZV0gPSAwOwoJCX07CgoJCWxldCBrdCA9ICh0LCBlLCBpKSA9PiAoZSA8PCB0Lmhhc2hfc2hpZnQgXiBpKSAmIHQuaGFzaF9tYXNrOwoKCQljb25zdCB5dCA9IHQgPT4gewoJCQljb25zdCBlID0gdC5zdGF0ZTsKCQkJbGV0IGkgPSBlLnBlbmRpbmc7CgkJCWkgPiB0LmF2YWlsX291dCAmJiAoaSA9IHQuYXZhaWxfb3V0KSwgMCAhPT0gaSAmJiAodC5vdXRwdXQuc2V0KGUucGVuZGluZ19idWYuc3ViYXJyYXkoZS5wZW5kaW5nX291dCwgZS5wZW5kaW5nX291dCArIGkpLCB0Lm5leHRfb3V0KSwgdC5uZXh0X291dCArPSBpLCBlLnBlbmRpbmdfb3V0ICs9IGksIHQudG90YWxfb3V0ICs9IGksIHQuYXZhaWxfb3V0IC09IGksIGUucGVuZGluZyAtPSBpLCAwID09PSBlLnBlbmRpbmcgJiYgKGUucGVuZGluZ19vdXQgPSAwKSk7CgkJfSwKCQkJCQl2dCA9ICh0LCBlKSA9PiB7CgkJCSQodCwgdC5ibG9ja19zdGFydCA+PSAwID8gdC5ibG9ja19zdGFydCA6IC0xLCB0LnN0cnN0YXJ0IC0gdC5ibG9ja19zdGFydCwgZSksIHQuYmxvY2tfc3RhcnQgPSB0LnN0cnN0YXJ0LCB5dCh0LnN0cm0pOwoJCX0sCgkJCQkJRXQgPSAodCwgZSkgPT4gewoJCQl0LnBlbmRpbmdfYnVmW3QucGVuZGluZysrXSA9IGU7CgkJfSwKCQkJCQlBdCA9ICh0LCBlKSA9PiB7CgkJCXQucGVuZGluZ19idWZbdC5wZW5kaW5nKytdID0gZSA+Pj4gOCAmIDI1NSwgdC5wZW5kaW5nX2J1Zlt0LnBlbmRpbmcrK10gPSAyNTUgJiBlOwoJCX0sCgkJCQkJeHQgPSAodCwgZSwgaSwgbikgPT4gewoJCQlsZXQgciA9IHQuYXZhaWxfaW47CgkJCXJldHVybiByID4gbiAmJiAociA9IG4pLCAwID09PSByID8gMCA6ICh0LmF2YWlsX2luIC09IHIsIGUuc2V0KHQuaW5wdXQuc3ViYXJyYXkodC5uZXh0X2luLCB0Lm5leHRfaW4gKyByKSwgaSksIDEgPT09IHQuc3RhdGUud3JhcCA/IHQuYWRsZXIgPSBaKHQuYWRsZXIsIGUsIHIsIGkpIDogMiA9PT0gdC5zdGF0ZS53cmFwICYmICh0LmFkbGVyID0gTSh0LmFkbGVyLCBlLCByLCBpKSksIHQubmV4dF9pbiArPSByLCB0LnRvdGFsX2luICs9IHIsIHIpOwoJCX0sCgkJCQkJVXQgPSAodCwgZSkgPT4gewoJCQlsZXQgaSwKCQkJCQluLAoJCQkJCXIgPSB0Lm1heF9jaGFpbl9sZW5ndGgsCgkJCQkJcyA9IHQuc3Ryc3RhcnQsCgkJCQkJYSA9IHQucHJldl9sZW5ndGgsCgkJCQkJbyA9IHQubmljZV9tYXRjaDsKCQkJY29uc3QgaCA9IHQuc3Ryc3RhcnQgPiB0Lndfc2l6ZSAtIGN0ID8gdC5zdHJzdGFydCAtICh0Lndfc2l6ZSAtIGN0KSA6IDAsCgkJCQkJCWwgPSB0LndpbmRvdywKCQkJCQkJZCA9IHQud19tYXNrLAoJCQkJCQlfID0gdC5wcmV2LAoJCQkJCQlmID0gdC5zdHJzdGFydCArIGZ0OwoJCQlsZXQgYyA9IGxbcyArIGEgLSAxXSwKCQkJCQl1ID0gbFtzICsgYV07CgkJCXQucHJldl9sZW5ndGggPj0gdC5nb29kX21hdGNoICYmIChyID4+PSAyKSwgbyA+IHQubG9va2FoZWFkICYmIChvID0gdC5sb29rYWhlYWQpOwoKCQkJZG8gewoJCQkJaWYgKGkgPSBlLCBsW2kgKyBhXSA9PT0gdSAmJiBsW2kgKyBhIC0gMV0gPT09IGMgJiYgbFtpXSA9PT0gbFtzXSAmJiBsWysraV0gPT09IGxbcyArIDFdKSB7CgkJCQkJcyArPSAyLCBpKys7CgoJCQkJCWRvIHt9IHdoaWxlIChsWysrc10gPT09IGxbKytpXSAmJiBsWysrc10gPT09IGxbKytpXSAmJiBsWysrc10gPT09IGxbKytpXSAmJiBsWysrc10gPT09IGxbKytpXSAmJiBsWysrc10gPT09IGxbKytpXSAmJiBsWysrc10gPT09IGxbKytpXSAmJiBsWysrc10gPT09IGxbKytpXSAmJiBsWysrc10gPT09IGxbKytpXSAmJiBzIDwgZik7CgoJCQkJCWlmIChuID0gZnQgLSAoZiAtIHMpLCBzID0gZiAtIGZ0LCBuID4gYSkgewoJCQkJCQlpZiAodC5tYXRjaF9zdGFydCA9IGUsIGEgPSBuLCBuID49IG8pIGJyZWFrOwoJCQkJCQljID0gbFtzICsgYSAtIDFdLCB1ID0gbFtzICsgYV07CgkJCQkJfQoJCQkJfQoJCQl9IHdoaWxlICgoZSA9IF9bZSAmIGRdKSA+IGggJiYgMCAhPSAtLXIpOwoKCQkJcmV0dXJuIGEgPD0gdC5sb29rYWhlYWQgPyBhIDogdC5sb29rYWhlYWQ7CgkJfSwKCQkJCQl6dCA9IHQgPT4gewoJCQljb25zdCBlID0gdC53X3NpemU7CgkJCWxldCBpLCBuLCByLCBzLCBhOwoKCQkJZG8gewoJCQkJaWYgKHMgPSB0LndpbmRvd19zaXplIC0gdC5sb29rYWhlYWQgLSB0LnN0cnN0YXJ0LCB0LnN0cnN0YXJ0ID49IGUgKyAoZSAtIGN0KSkgewoJCQkJCXQud2luZG93LnNldCh0LndpbmRvdy5zdWJhcnJheShlLCBlICsgZSksIDApLCB0Lm1hdGNoX3N0YXJ0IC09IGUsIHQuc3Ryc3RhcnQgLT0gZSwgdC5ibG9ja19zdGFydCAtPSBlLCBuID0gdC5oYXNoX3NpemUsIGkgPSBuOwoKCQkJCQlkbyB7CgkJCQkJCXIgPSB0LmhlYWRbLS1pXSwgdC5oZWFkW2ldID0gciA+PSBlID8gciAtIGUgOiAwOwoJCQkJCX0gd2hpbGUgKC0tbik7CgoJCQkJCW4gPSBlLCBpID0gbjsKCgkJCQkJZG8gewoJCQkJCQlyID0gdC5wcmV2Wy0taV0sIHQucHJldltpXSA9IHIgPj0gZSA/IHIgLSBlIDogMDsKCQkJCQl9IHdoaWxlICgtLW4pOwoKCQkJCQlzICs9IGU7CgkJCQl9CgoJCQkJaWYgKDAgPT09IHQuc3RybS5hdmFpbF9pbikgYnJlYWs7CgkJCQlpZiAobiA9IHh0KHQuc3RybSwgdC53aW5kb3csIHQuc3Ryc3RhcnQgKyB0Lmxvb2thaGVhZCwgcyksIHQubG9va2FoZWFkICs9IG4sIHQubG9va2FoZWFkICsgdC5pbnNlcnQgPj0gMykgZm9yIChhID0gdC5zdHJzdGFydCAtIHQuaW5zZXJ0LCB0Lmluc19oID0gdC53aW5kb3dbYV0sIHQuaW5zX2ggPSBrdCh0LCB0Lmluc19oLCB0LndpbmRvd1thICsgMV0pOyB0Lmluc2VydCAmJiAodC5pbnNfaCA9IGt0KHQsIHQuaW5zX2gsIHQud2luZG93W2EgKyAzIC0gMV0pLCB0LnByZXZbYSAmIHQud19tYXNrXSA9IHQuaGVhZFt0Lmluc19oXSwgdC5oZWFkW3QuaW5zX2hdID0gYSwgYSsrLCB0Lmluc2VydC0tLCAhKHQubG9va2FoZWFkICsgdC5pbnNlcnQgPCAzKSk7KTsKCQkJfSB3aGlsZSAodC5sb29rYWhlYWQgPCBjdCAmJiAwICE9PSB0LnN0cm0uYXZhaWxfaW4pOwoJCX0sCgkJCQkJUnQgPSAodCwgZSkgPT4gewoJCQlsZXQgaSwgbjsKCgkJCWZvciAoOzspIHsKCQkJCWlmICh0Lmxvb2thaGVhZCA8IGN0KSB7CgkJCQkJaWYgKHp0KHQpLCB0Lmxvb2thaGVhZCA8IGN0ICYmIGUgPT09IEcpIHJldHVybiAxOwoJCQkJCWlmICgwID09PSB0Lmxvb2thaGVhZCkgYnJlYWs7CgkJCQl9CgoJCQkJaWYgKGkgPSAwLCB0Lmxvb2thaGVhZCA+PSAzICYmICh0Lmluc19oID0ga3QodCwgdC5pbnNfaCwgdC53aW5kb3dbdC5zdHJzdGFydCArIDMgLSAxXSksIGkgPSB0LnByZXZbdC5zdHJzdGFydCAmIHQud19tYXNrXSA9IHQuaGVhZFt0Lmluc19oXSwgdC5oZWFkW3QuaW5zX2hdID0gdC5zdHJzdGFydCksIDAgIT09IGkgJiYgdC5zdHJzdGFydCAtIGkgPD0gdC53X3NpemUgLSBjdCAmJiAodC5tYXRjaF9sZW5ndGggPSBVdCh0LCBpKSksIHQubWF0Y2hfbGVuZ3RoID49IDMpIHsKCQkJCQlpZiAobiA9IFkodCwgdC5zdHJzdGFydCAtIHQubWF0Y2hfc3RhcnQsIHQubWF0Y2hfbGVuZ3RoIC0gMyksIHQubG9va2FoZWFkIC09IHQubWF0Y2hfbGVuZ3RoLCB0Lm1hdGNoX2xlbmd0aCA8PSB0Lm1heF9sYXp5X21hdGNoICYmIHQubG9va2FoZWFkID49IDMpIHsKCQkJCQkJdC5tYXRjaF9sZW5ndGgtLTsKCgkJCQkJCWRvIHsKCQkJCQkJCXQuc3Ryc3RhcnQrKywgdC5pbnNfaCA9IGt0KHQsIHQuaW5zX2gsIHQud2luZG93W3Quc3Ryc3RhcnQgKyAzIC0gMV0pLCBpID0gdC5wcmV2W3Quc3Ryc3RhcnQgJiB0LndfbWFza10gPSB0LmhlYWRbdC5pbnNfaF0sIHQuaGVhZFt0Lmluc19oXSA9IHQuc3Ryc3RhcnQ7CgkJCQkJCX0gd2hpbGUgKDAgIT0gLS10Lm1hdGNoX2xlbmd0aCk7CgoJCQkJCQl0LnN0cnN0YXJ0Kys7CgkJCQkJfSBlbHNlIHQuc3Ryc3RhcnQgKz0gdC5tYXRjaF9sZW5ndGgsIHQubWF0Y2hfbGVuZ3RoID0gMCwgdC5pbnNfaCA9IHQud2luZG93W3Quc3Ryc3RhcnRdLCB0Lmluc19oID0ga3QodCwgdC5pbnNfaCwgdC53aW5kb3dbdC5zdHJzdGFydCArIDFdKTsKCQkJCX0gZWxzZSBuID0gWSh0LCAwLCB0LndpbmRvd1t0LnN0cnN0YXJ0XSksIHQubG9va2FoZWFkLS0sIHQuc3Ryc3RhcnQrKzsKCQkJCWlmIChuICYmICh2dCh0LCAhMSksIDAgPT09IHQuc3RybS5hdmFpbF9vdXQpKSByZXR1cm4gMTsKCQkJfQoKCQkJcmV0dXJuIHQuaW5zZXJ0ID0gdC5zdHJzdGFydCA8IDIgPyB0LnN0cnN0YXJ0IDogMiwgZSA9PT0gcSA/ICh2dCh0LCAhMCksIDAgPT09IHQuc3RybS5hdmFpbF9vdXQgPyAzIDogNCkgOiB0Lmxhc3RfbGl0ICYmICh2dCh0LCAhMSksIDAgPT09IHQuc3RybS5hdmFpbF9vdXQpID8gMSA6IDI7CgkJfSwKCQkJCQlOdCA9ICh0LCBlKSA9PiB7CgkJCWxldCBpLCBuLCByOwoKCQkJZm9yICg7OykgewoJCQkJaWYgKHQubG9va2FoZWFkIDwgY3QpIHsKCQkJCQlpZiAoenQodCksIHQubG9va2FoZWFkIDwgY3QgJiYgZSA9PT0gRykgcmV0dXJuIDE7CgkJCQkJaWYgKDAgPT09IHQubG9va2FoZWFkKSBicmVhazsKCQkJCX0KCgkJCQlpZiAoaSA9IDAsIHQubG9va2FoZWFkID49IDMgJiYgKHQuaW5zX2ggPSBrdCh0LCB0Lmluc19oLCB0LndpbmRvd1t0LnN0cnN0YXJ0ICsgMyAtIDFdKSwgaSA9IHQucHJldlt0LnN0cnN0YXJ0ICYgdC53X21hc2tdID0gdC5oZWFkW3QuaW5zX2hdLCB0LmhlYWRbdC5pbnNfaF0gPSB0LnN0cnN0YXJ0KSwgdC5wcmV2X2xlbmd0aCA9IHQubWF0Y2hfbGVuZ3RoLCB0LnByZXZfbWF0Y2ggPSB0Lm1hdGNoX3N0YXJ0LCB0Lm1hdGNoX2xlbmd0aCA9IDIsIDAgIT09IGkgJiYgdC5wcmV2X2xlbmd0aCA8IHQubWF4X2xhenlfbWF0Y2ggJiYgdC5zdHJzdGFydCAtIGkgPD0gdC53X3NpemUgLSBjdCAmJiAodC5tYXRjaF9sZW5ndGggPSBVdCh0LCBpKSwgdC5tYXRjaF9sZW5ndGggPD0gNSAmJiAodC5zdHJhdGVneSA9PT0gc3QgfHwgMyA9PT0gdC5tYXRjaF9sZW5ndGggJiYgdC5zdHJzdGFydCAtIHQubWF0Y2hfc3RhcnQgPiA0MDk2KSAmJiAodC5tYXRjaF9sZW5ndGggPSAyKSksIHQucHJldl9sZW5ndGggPj0gMyAmJiB0Lm1hdGNoX2xlbmd0aCA8PSB0LnByZXZfbGVuZ3RoKSB7CgkJCQkJciA9IHQuc3Ryc3RhcnQgKyB0Lmxvb2thaGVhZCAtIDMsIG4gPSBZKHQsIHQuc3Ryc3RhcnQgLSAxIC0gdC5wcmV2X21hdGNoLCB0LnByZXZfbGVuZ3RoIC0gMyksIHQubG9va2FoZWFkIC09IHQucHJldl9sZW5ndGggLSAxLCB0LnByZXZfbGVuZ3RoIC09IDI7CgoJCQkJCWRvIHsKCQkJCQkJKyt0LnN0cnN0YXJ0IDw9IHIgJiYgKHQuaW5zX2ggPSBrdCh0LCB0Lmluc19oLCB0LndpbmRvd1t0LnN0cnN0YXJ0ICsgMyAtIDFdKSwgaSA9IHQucHJldlt0LnN0cnN0YXJ0ICYgdC53X21hc2tdID0gdC5oZWFkW3QuaW5zX2hdLCB0LmhlYWRbdC5pbnNfaF0gPSB0LnN0cnN0YXJ0KTsKCQkJCQl9IHdoaWxlICgwICE9IC0tdC5wcmV2X2xlbmd0aCk7CgoJCQkJCWlmICh0Lm1hdGNoX2F2YWlsYWJsZSA9IDAsIHQubWF0Y2hfbGVuZ3RoID0gMiwgdC5zdHJzdGFydCsrLCBuICYmICh2dCh0LCAhMSksIDAgPT09IHQuc3RybS5hdmFpbF9vdXQpKSByZXR1cm4gMTsKCQkJCX0gZWxzZSBpZiAodC5tYXRjaF9hdmFpbGFibGUpIHsKCQkJCQlpZiAobiA9IFkodCwgMCwgdC53aW5kb3dbdC5zdHJzdGFydCAtIDFdKSwgbiAmJiB2dCh0LCAhMSksIHQuc3Ryc3RhcnQrKywgdC5sb29rYWhlYWQtLSwgMCA9PT0gdC5zdHJtLmF2YWlsX291dCkgcmV0dXJuIDE7CgkJCQl9IGVsc2UgdC5tYXRjaF9hdmFpbGFibGUgPSAxLCB0LnN0cnN0YXJ0KyssIHQubG9va2FoZWFkLS07CgkJCX0KCgkJCXJldHVybiB0Lm1hdGNoX2F2YWlsYWJsZSAmJiAobiA9IFkodCwgMCwgdC53aW5kb3dbdC5zdHJzdGFydCAtIDFdKSwgdC5tYXRjaF9hdmFpbGFibGUgPSAwKSwgdC5pbnNlcnQgPSB0LnN0cnN0YXJ0IDwgMiA/IHQuc3Ryc3RhcnQgOiAyLCBlID09PSBxID8gKHZ0KHQsICEwKSwgMCA9PT0gdC5zdHJtLmF2YWlsX291dCA/IDMgOiA0KSA6IHQubGFzdF9saXQgJiYgKHZ0KHQsICExKSwgMCA9PT0gdC5zdHJtLmF2YWlsX291dCkgPyAxIDogMjsKCQl9OwoKCQlmdW5jdGlvbiBUdCh0LCBlLCBpLCBuLCByKSB7CgkJCXRoaXMuZ29vZF9sZW5ndGggPSB0LCB0aGlzLm1heF9sYXp5ID0gZSwgdGhpcy5uaWNlX2xlbmd0aCA9IGksIHRoaXMubWF4X2NoYWluID0gbiwgdGhpcy5mdW5jID0gcjsKCQl9CgoJCWNvbnN0IE90ID0gW25ldyBUdCgwLCAwLCAwLCAwLCAodCwgZSkgPT4gewoJCQlsZXQgaSA9IDY1NTM1OwoKCQkJZm9yIChpID4gdC5wZW5kaW5nX2J1Zl9zaXplIC0gNSAmJiAoaSA9IHQucGVuZGluZ19idWZfc2l6ZSAtIDUpOzspIHsKCQkJCWlmICh0Lmxvb2thaGVhZCA8PSAxKSB7CgkJCQkJaWYgKHp0KHQpLCAwID09PSB0Lmxvb2thaGVhZCAmJiBlID09PSBHKSByZXR1cm4gMTsKCQkJCQlpZiAoMCA9PT0gdC5sb29rYWhlYWQpIGJyZWFrOwoJCQkJfQoKCQkJCXQuc3Ryc3RhcnQgKz0gdC5sb29rYWhlYWQsIHQubG9va2FoZWFkID0gMDsKCQkJCWNvbnN0IG4gPSB0LmJsb2NrX3N0YXJ0ICsgaTsKCQkJCWlmICgoMCA9PT0gdC5zdHJzdGFydCB8fCB0LnN0cnN0YXJ0ID49IG4pICYmICh0Lmxvb2thaGVhZCA9IHQuc3Ryc3RhcnQgLSBuLCB0LnN0cnN0YXJ0ID0gbiwgdnQodCwgITEpLCAwID09PSB0LnN0cm0uYXZhaWxfb3V0KSkgcmV0dXJuIDE7CgkJCQlpZiAodC5zdHJzdGFydCAtIHQuYmxvY2tfc3RhcnQgPj0gdC53X3NpemUgLSBjdCAmJiAodnQodCwgITEpLCAwID09PSB0LnN0cm0uYXZhaWxfb3V0KSkgcmV0dXJuIDE7CgkJCX0KCgkJCXJldHVybiB0Lmluc2VydCA9IDAsIGUgPT09IHEgPyAodnQodCwgITApLCAwID09PSB0LnN0cm0uYXZhaWxfb3V0ID8gMyA6IDQpIDogKHQuc3Ryc3RhcnQgPiB0LmJsb2NrX3N0YXJ0ICYmICh2dCh0LCAhMSksIHQuc3RybS5hdmFpbF9vdXQpLCAxKTsKCQl9KSwgbmV3IFR0KDQsIDQsIDgsIDQsIFJ0KSwgbmV3IFR0KDQsIDUsIDE2LCA4LCBSdCksIG5ldyBUdCg0LCA2LCAzMiwgMzIsIFJ0KSwgbmV3IFR0KDQsIDQsIDE2LCAxNiwgTnQpLCBuZXcgVHQoOCwgMTYsIDMyLCAzMiwgTnQpLCBuZXcgVHQoOCwgMTYsIDEyOCwgMTI4LCBOdCksIG5ldyBUdCg4LCAzMiwgMTI4LCAyNTYsIE50KSwgbmV3IFR0KDMyLCAxMjgsIDI1OCwgMTAyNCwgTnQpLCBuZXcgVHQoMzIsIDI1OCwgMjU4LCA0MDk2LCBOdCldOwoKCQlmdW5jdGlvbiBMdCgpIHsKCQkJdGhpcy5zdHJtID0gbnVsbCwgdGhpcy5zdGF0dXMgPSAwLCB0aGlzLnBlbmRpbmdfYnVmID0gbnVsbCwgdGhpcy5wZW5kaW5nX2J1Zl9zaXplID0gMCwgdGhpcy5wZW5kaW5nX291dCA9IDAsIHRoaXMucGVuZGluZyA9IDAsIHRoaXMud3JhcCA9IDAsIHRoaXMuZ3poZWFkID0gbnVsbCwgdGhpcy5nemluZGV4ID0gMCwgdGhpcy5tZXRob2QgPSBfdCwgdGhpcy5sYXN0X2ZsdXNoID0gLTEsIHRoaXMud19zaXplID0gMCwgdGhpcy53X2JpdHMgPSAwLCB0aGlzLndfbWFzayA9IDAsIHRoaXMud2luZG93ID0gbnVsbCwgdGhpcy53aW5kb3dfc2l6ZSA9IDAsIHRoaXMucHJldiA9IG51bGwsIHRoaXMuaGVhZCA9IG51bGwsIHRoaXMuaW5zX2ggPSAwLCB0aGlzLmhhc2hfc2l6ZSA9IDAsIHRoaXMuaGFzaF9iaXRzID0gMCwgdGhpcy5oYXNoX21hc2sgPSAwLCB0aGlzLmhhc2hfc2hpZnQgPSAwLCB0aGlzLmJsb2NrX3N0YXJ0ID0gMCwgdGhpcy5tYXRjaF9sZW5ndGggPSAwLCB0aGlzLnByZXZfbWF0Y2ggPSAwLCB0aGlzLm1hdGNoX2F2YWlsYWJsZSA9IDAsIHRoaXMuc3Ryc3RhcnQgPSAwLCB0aGlzLm1hdGNoX3N0YXJ0ID0gMCwgdGhpcy5sb29rYWhlYWQgPSAwLCB0aGlzLnByZXZfbGVuZ3RoID0gMCwgdGhpcy5tYXhfY2hhaW5fbGVuZ3RoID0gMCwgdGhpcy5tYXhfbGF6eV9tYXRjaCA9IDAsIHRoaXMubGV2ZWwgPSAwLCB0aGlzLnN0cmF0ZWd5ID0gMCwgdGhpcy5nb29kX21hdGNoID0gMCwgdGhpcy5uaWNlX21hdGNoID0gMCwgdGhpcy5keW5fbHRyZWUgPSBuZXcgVWludDE2QXJyYXkoMTE0NiksIHRoaXMuZHluX2R0cmVlID0gbmV3IFVpbnQxNkFycmF5KDEyMiksIHRoaXMuYmxfdHJlZSA9IG5ldyBVaW50MTZBcnJheSg3OCksIG10KHRoaXMuZHluX2x0cmVlKSwgbXQodGhpcy5keW5fZHRyZWUpLCBtdCh0aGlzLmJsX3RyZWUpLCB0aGlzLmxfZGVzYyA9IG51bGwsIHRoaXMuZF9kZXNjID0gbnVsbCwgdGhpcy5ibF9kZXNjID0gbnVsbCwgdGhpcy5ibF9jb3VudCA9IG5ldyBVaW50MTZBcnJheSgxNiksIHRoaXMuaGVhcCA9IG5ldyBVaW50MTZBcnJheSg1NzMpLCBtdCh0aGlzLmhlYXApLCB0aGlzLmhlYXBfbGVuID0gMCwgdGhpcy5oZWFwX21heCA9IDAsIHRoaXMuZGVwdGggPSBuZXcgVWludDE2QXJyYXkoNTczKSwgbXQodGhpcy5kZXB0aCksIHRoaXMubF9idWYgPSAwLCB0aGlzLmxpdF9idWZzaXplID0gMCwgdGhpcy5sYXN0X2xpdCA9IDAsIHRoaXMuZF9idWYgPSAwLCB0aGlzLm9wdF9sZW4gPSAwLCB0aGlzLnN0YXRpY19sZW4gPSAwLCB0aGlzLm1hdGNoZXMgPSAwLCB0aGlzLmluc2VydCA9IDAsIHRoaXMuYmlfYnVmID0gMCwgdGhpcy5iaV92YWxpZCA9IDA7CgkJfQoKCQljb25zdCBCdCA9IHQgPT4gewoJCQlpZiAoIXQgfHwgIXQuc3RhdGUpIHJldHVybiBndCh0LCBldCk7CgkJCXQudG90YWxfaW4gPSB0LnRvdGFsX291dCA9IDAsIHQuZGF0YV90eXBlID0gZHQ7CgkJCWNvbnN0IGUgPSB0LnN0YXRlOwoJCQlyZXR1cm4gZS5wZW5kaW5nID0gMCwgZS5wZW5kaW5nX291dCA9IDAsIGUud3JhcCA8IDAgJiYgKGUud3JhcCA9IC1lLndyYXApLCBlLnN0YXR1cyA9IGUud3JhcCA/IDQyIDogd3QsIHQuYWRsZXIgPSAyID09PSBlLndyYXAgPyAwIDogMSwgZS5sYXN0X2ZsdXNoID0gRywgVyhlKSwgUTsKCQl9LAoJCQkJCUN0ID0gdCA9PiB7CgkJCWNvbnN0IGUgPSBCdCh0KTsKCQkJdmFyIGk7CgkJCXJldHVybiBlID09PSBRICYmICgoaSA9IHQuc3RhdGUpLndpbmRvd19zaXplID0gMiAqIGkud19zaXplLCBtdChpLmhlYWQpLCBpLm1heF9sYXp5X21hdGNoID0gT3RbaS5sZXZlbF0ubWF4X2xhenksIGkuZ29vZF9tYXRjaCA9IE90W2kubGV2ZWxdLmdvb2RfbGVuZ3RoLCBpLm5pY2VfbWF0Y2ggPSBPdFtpLmxldmVsXS5uaWNlX2xlbmd0aCwgaS5tYXhfY2hhaW5fbGVuZ3RoID0gT3RbaS5sZXZlbF0ubWF4X2NoYWluLCBpLnN0cnN0YXJ0ID0gMCwgaS5ibG9ja19zdGFydCA9IDAsIGkubG9va2FoZWFkID0gMCwgaS5pbnNlcnQgPSAwLCBpLm1hdGNoX2xlbmd0aCA9IGkucHJldl9sZW5ndGggPSAyLCBpLm1hdGNoX2F2YWlsYWJsZSA9IDAsIGkuaW5zX2ggPSAwKSwgZTsKCQl9LAoJCQkJCUR0ID0gKHQsIGUsIGksIG4sIHIsIHMpID0+IHsKCQkJaWYgKCF0KSByZXR1cm4gZXQ7CgkJCWxldCBhID0gMTsKCQkJaWYgKGUgPT09IHJ0ICYmIChlID0gNiksIG4gPCAwID8gKGEgPSAwLCBuID0gLW4pIDogbiA+IDE1ICYmIChhID0gMiwgbiAtPSAxNiksIHIgPCAxIHx8IHIgPiA5IHx8IGkgIT09IF90IHx8IG4gPCA4IHx8IG4gPiAxNSB8fCBlIDwgMCB8fCBlID4gOSB8fCBzIDwgMCB8fCBzID4gaHQpIHJldHVybiBndCh0LCBldCk7CgkJCTggPT09IG4gJiYgKG4gPSA5KTsKCQkJY29uc3QgbyA9IG5ldyBMdCgpOwoJCQlyZXR1cm4gdC5zdGF0ZSA9IG8sIG8uc3RybSA9IHQsIG8ud3JhcCA9IGEsIG8uZ3poZWFkID0gbnVsbCwgby53X2JpdHMgPSBuLCBvLndfc2l6ZSA9IDEgPDwgby53X2JpdHMsIG8ud19tYXNrID0gby53X3NpemUgLSAxLCBvLmhhc2hfYml0cyA9IHIgKyA3LCBvLmhhc2hfc2l6ZSA9IDEgPDwgby5oYXNoX2JpdHMsIG8uaGFzaF9tYXNrID0gby5oYXNoX3NpemUgLSAxLCBvLmhhc2hfc2hpZnQgPSB+figoby5oYXNoX2JpdHMgKyAzIC0gMSkgLyAzKSwgby53aW5kb3cgPSBuZXcgVWludDhBcnJheSgyICogby53X3NpemUpLCBvLmhlYWQgPSBuZXcgVWludDE2QXJyYXkoby5oYXNoX3NpemUpLCBvLnByZXYgPSBuZXcgVWludDE2QXJyYXkoby53X3NpemUpLCBvLmxpdF9idWZzaXplID0gMSA8PCByICsgNiwgby5wZW5kaW5nX2J1Zl9zaXplID0gNCAqIG8ubGl0X2J1ZnNpemUsIG8ucGVuZGluZ19idWYgPSBuZXcgVWludDhBcnJheShvLnBlbmRpbmdfYnVmX3NpemUpLCBvLmRfYnVmID0gMSAqIG8ubGl0X2J1ZnNpemUsIG8ubF9idWYgPSAzICogby5saXRfYnVmc2l6ZSwgby5sZXZlbCA9IGUsIG8uc3RyYXRlZ3kgPSBzLCBvLm1ldGhvZCA9IGksIEN0KHQpOwoJCX07CgoJCXZhciBJdCA9IER0LAoJCQkJU3QgPSAodCwgZSkgPT4gdCAmJiB0LnN0YXRlID8gMiAhPT0gdC5zdGF0ZS53cmFwID8gZXQgOiAodC5zdGF0ZS5nemhlYWQgPSBlLCBRKSA6IGV0LAoJCQkJWnQgPSAodCwgZSkgPT4gewoJCQlsZXQgaSwgbjsKCQkJaWYgKCF0IHx8ICF0LnN0YXRlIHx8IGUgPiBKIHx8IGUgPCAwKSByZXR1cm4gdCA/IGd0KHQsIGV0KSA6IGV0OwoJCQljb25zdCByID0gdC5zdGF0ZTsKCQkJaWYgKCF0Lm91dHB1dCB8fCAhdC5pbnB1dCAmJiAwICE9PSB0LmF2YWlsX2luIHx8IHIuc3RhdHVzID09PSBwdCAmJiBlICE9PSBxKSByZXR1cm4gZ3QodCwgMCA9PT0gdC5hdmFpbF9vdXQgPyBudCA6IGV0KTsKCQkJci5zdHJtID0gdDsKCQkJY29uc3QgcyA9IHIubGFzdF9mbHVzaDsKCQkJaWYgKHIubGFzdF9mbHVzaCA9IGUsIDQyID09PSByLnN0YXR1cykgaWYgKDIgPT09IHIud3JhcCkgdC5hZGxlciA9IDAsIEV0KHIsIDMxKSwgRXQociwgMTM5KSwgRXQociwgOCksIHIuZ3poZWFkID8gKEV0KHIsIChyLmd6aGVhZC50ZXh0ID8gMSA6IDApICsgKHIuZ3poZWFkLmhjcmMgPyAyIDogMCkgKyAoci5nemhlYWQuZXh0cmEgPyA0IDogMCkgKyAoci5nemhlYWQubmFtZSA/IDggOiAwKSArIChyLmd6aGVhZC5jb21tZW50ID8gMTYgOiAwKSksIEV0KHIsIDI1NSAmIHIuZ3poZWFkLnRpbWUpLCBFdChyLCByLmd6aGVhZC50aW1lID4+IDggJiAyNTUpLCBFdChyLCByLmd6aGVhZC50aW1lID4+IDE2ICYgMjU1KSwgRXQociwgci5nemhlYWQudGltZSA+PiAyNCAmIDI1NSksIEV0KHIsIDkgPT09IHIubGV2ZWwgPyAyIDogci5zdHJhdGVneSA+PSBhdCB8fCByLmxldmVsIDwgMiA/IDQgOiAwKSwgRXQociwgMjU1ICYgci5nemhlYWQub3MpLCByLmd6aGVhZC5leHRyYSAmJiByLmd6aGVhZC5leHRyYS5sZW5ndGggJiYgKEV0KHIsIDI1NSAmIHIuZ3poZWFkLmV4dHJhLmxlbmd0aCksIEV0KHIsIHIuZ3poZWFkLmV4dHJhLmxlbmd0aCA+PiA4ICYgMjU1KSksIHIuZ3poZWFkLmhjcmMgJiYgKHQuYWRsZXIgPSBNKHQuYWRsZXIsIHIucGVuZGluZ19idWYsIHIucGVuZGluZywgMCkpLCByLmd6aW5kZXggPSAwLCByLnN0YXR1cyA9IDY5KSA6IChFdChyLCAwKSwgRXQociwgMCksIEV0KHIsIDApLCBFdChyLCAwKSwgRXQociwgMCksIEV0KHIsIDkgPT09IHIubGV2ZWwgPyAyIDogci5zdHJhdGVneSA+PSBhdCB8fCByLmxldmVsIDwgMiA/IDQgOiAwKSwgRXQociwgMyksIHIuc3RhdHVzID0gd3QpO2Vsc2UgewoJCQkJbGV0IGUgPSBfdCArIChyLndfYml0cyAtIDggPDwgNCkgPDwgOCwKCQkJCQkJaSA9IC0xOwoJCQkJaSA9IHIuc3RyYXRlZ3kgPj0gYXQgfHwgci5sZXZlbCA8IDIgPyAwIDogci5sZXZlbCA8IDYgPyAxIDogNiA9PT0gci5sZXZlbCA/IDIgOiAzLCBlIHw9IGkgPDwgNiwgMCAhPT0gci5zdHJzdGFydCAmJiAoZSB8PSAzMiksIGUgKz0gMzEgLSBlICUgMzEsIHIuc3RhdHVzID0gd3QsIEF0KHIsIGUpLCAwICE9PSByLnN0cnN0YXJ0ICYmIChBdChyLCB0LmFkbGVyID4+PiAxNiksIEF0KHIsIDY1NTM1ICYgdC5hZGxlcikpLCB0LmFkbGVyID0gMTsKCQkJfQoJCQlpZiAoNjkgPT09IHIuc3RhdHVzKSBpZiAoci5nemhlYWQuZXh0cmEpIHsKCQkJCWZvciAoaSA9IHIucGVuZGluZzsgci5nemluZGV4IDwgKDY1NTM1ICYgci5nemhlYWQuZXh0cmEubGVuZ3RoKSAmJiAoci5wZW5kaW5nICE9PSByLnBlbmRpbmdfYnVmX3NpemUgfHwgKHIuZ3poZWFkLmhjcmMgJiYgci5wZW5kaW5nID4gaSAmJiAodC5hZGxlciA9IE0odC5hZGxlciwgci5wZW5kaW5nX2J1Ziwgci5wZW5kaW5nIC0gaSwgaSkpLCB5dCh0KSwgaSA9IHIucGVuZGluZywgci5wZW5kaW5nICE9PSByLnBlbmRpbmdfYnVmX3NpemUpKTspIEV0KHIsIDI1NSAmIHIuZ3poZWFkLmV4dHJhW3IuZ3ppbmRleF0pLCByLmd6aW5kZXgrKzsKCgkJCQlyLmd6aGVhZC5oY3JjICYmIHIucGVuZGluZyA+IGkgJiYgKHQuYWRsZXIgPSBNKHQuYWRsZXIsIHIucGVuZGluZ19idWYsIHIucGVuZGluZyAtIGksIGkpKSwgci5nemluZGV4ID09PSByLmd6aGVhZC5leHRyYS5sZW5ndGggJiYgKHIuZ3ppbmRleCA9IDAsIHIuc3RhdHVzID0gNzMpOwoJCQl9IGVsc2Ugci5zdGF0dXMgPSA3MzsKCQkJaWYgKDczID09PSByLnN0YXR1cykgaWYgKHIuZ3poZWFkLm5hbWUpIHsKCQkJCWkgPSByLnBlbmRpbmc7CgoJCQkJZG8gewoJCQkJCWlmIChyLnBlbmRpbmcgPT09IHIucGVuZGluZ19idWZfc2l6ZSAmJiAoci5nemhlYWQuaGNyYyAmJiByLnBlbmRpbmcgPiBpICYmICh0LmFkbGVyID0gTSh0LmFkbGVyLCByLnBlbmRpbmdfYnVmLCByLnBlbmRpbmcgLSBpLCBpKSksIHl0KHQpLCBpID0gci5wZW5kaW5nLCByLnBlbmRpbmcgPT09IHIucGVuZGluZ19idWZfc2l6ZSkpIHsKCQkJCQkJbiA9IDE7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCgkJCQkJbiA9IHIuZ3ppbmRleCA8IHIuZ3poZWFkLm5hbWUubGVuZ3RoID8gMjU1ICYgci5nemhlYWQubmFtZS5jaGFyQ29kZUF0KHIuZ3ppbmRleCsrKSA6IDAsIEV0KHIsIG4pOwoJCQkJfSB3aGlsZSAoMCAhPT0gbik7CgoJCQkJci5nemhlYWQuaGNyYyAmJiByLnBlbmRpbmcgPiBpICYmICh0LmFkbGVyID0gTSh0LmFkbGVyLCByLnBlbmRpbmdfYnVmLCByLnBlbmRpbmcgLSBpLCBpKSksIDAgPT09IG4gJiYgKHIuZ3ppbmRleCA9IDAsIHIuc3RhdHVzID0gOTEpOwoJCQl9IGVsc2Ugci5zdGF0dXMgPSA5MTsKCQkJaWYgKDkxID09PSByLnN0YXR1cykgaWYgKHIuZ3poZWFkLmNvbW1lbnQpIHsKCQkJCWkgPSByLnBlbmRpbmc7CgoJCQkJZG8gewoJCQkJCWlmIChyLnBlbmRpbmcgPT09IHIucGVuZGluZ19idWZfc2l6ZSAmJiAoci5nemhlYWQuaGNyYyAmJiByLnBlbmRpbmcgPiBpICYmICh0LmFkbGVyID0gTSh0LmFkbGVyLCByLnBlbmRpbmdfYnVmLCByLnBlbmRpbmcgLSBpLCBpKSksIHl0KHQpLCBpID0gci5wZW5kaW5nLCByLnBlbmRpbmcgPT09IHIucGVuZGluZ19idWZfc2l6ZSkpIHsKCQkJCQkJbiA9IDE7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCgkJCQkJbiA9IHIuZ3ppbmRleCA8IHIuZ3poZWFkLmNvbW1lbnQubGVuZ3RoID8gMjU1ICYgci5nemhlYWQuY29tbWVudC5jaGFyQ29kZUF0KHIuZ3ppbmRleCsrKSA6IDAsIEV0KHIsIG4pOwoJCQkJfSB3aGlsZSAoMCAhPT0gbik7CgoJCQkJci5nemhlYWQuaGNyYyAmJiByLnBlbmRpbmcgPiBpICYmICh0LmFkbGVyID0gTSh0LmFkbGVyLCByLnBlbmRpbmdfYnVmLCByLnBlbmRpbmcgLSBpLCBpKSksIDAgPT09IG4gJiYgKHIuc3RhdHVzID0gdXQpOwoJCQl9IGVsc2Ugci5zdGF0dXMgPSB1dDsKCgkJCWlmIChyLnN0YXR1cyA9PT0gdXQgJiYgKHIuZ3poZWFkLmhjcmMgPyAoci5wZW5kaW5nICsgMiA+IHIucGVuZGluZ19idWZfc2l6ZSAmJiB5dCh0KSwgci5wZW5kaW5nICsgMiA8PSByLnBlbmRpbmdfYnVmX3NpemUgJiYgKEV0KHIsIDI1NSAmIHQuYWRsZXIpLCBFdChyLCB0LmFkbGVyID4+IDggJiAyNTUpLCB0LmFkbGVyID0gMCwgci5zdGF0dXMgPSB3dCkpIDogci5zdGF0dXMgPSB3dCksIDAgIT09IHIucGVuZGluZykgewoJCQkJaWYgKHl0KHQpLCAwID09PSB0LmF2YWlsX291dCkgcmV0dXJuIHIubGFzdF9mbHVzaCA9IC0xLCBROwoJCQl9IGVsc2UgaWYgKDAgPT09IHQuYXZhaWxfaW4gJiYgYnQoZSkgPD0gYnQocykgJiYgZSAhPT0gcSkgcmV0dXJuIGd0KHQsIG50KTsKCgkJCWlmIChyLnN0YXR1cyA9PT0gcHQgJiYgMCAhPT0gdC5hdmFpbF9pbikgcmV0dXJuIGd0KHQsIG50KTsKCgkJCWlmICgwICE9PSB0LmF2YWlsX2luIHx8IDAgIT09IHIubG9va2FoZWFkIHx8IGUgIT09IEcgJiYgci5zdGF0dXMgIT09IHB0KSB7CgkJCQlsZXQgaSA9IHIuc3RyYXRlZ3kgPT09IGF0ID8gKCh0LCBlKSA9PiB7CgkJCQkJbGV0IGk7CgoJCQkJCWZvciAoOzspIHsKCQkJCQkJaWYgKDAgPT09IHQubG9va2FoZWFkICYmICh6dCh0KSwgMCA9PT0gdC5sb29rYWhlYWQpKSB7CgkJCQkJCQlpZiAoZSA9PT0gRykgcmV0dXJuIDE7CgkJCQkJCQlicmVhazsKCQkJCQkJfQoKCQkJCQkJaWYgKHQubWF0Y2hfbGVuZ3RoID0gMCwgaSA9IFkodCwgMCwgdC53aW5kb3dbdC5zdHJzdGFydF0pLCB0Lmxvb2thaGVhZC0tLCB0LnN0cnN0YXJ0KyssIGkgJiYgKHZ0KHQsICExKSwgMCA9PT0gdC5zdHJtLmF2YWlsX291dCkpIHJldHVybiAxOwoJCQkJCX0KCgkJCQkJcmV0dXJuIHQuaW5zZXJ0ID0gMCwgZSA9PT0gcSA/ICh2dCh0LCAhMCksIDAgPT09IHQuc3RybS5hdmFpbF9vdXQgPyAzIDogNCkgOiB0Lmxhc3RfbGl0ICYmICh2dCh0LCAhMSksIDAgPT09IHQuc3RybS5hdmFpbF9vdXQpID8gMSA6IDI7CgkJCQl9KShyLCBlKSA6IHIuc3RyYXRlZ3kgPT09IG90ID8gKCh0LCBlKSA9PiB7CgkJCQkJbGV0IGksIG4sIHIsIHM7CgkJCQkJY29uc3QgYSA9IHQud2luZG93OwoKCQkJCQlmb3IgKDs7KSB7CgkJCQkJCWlmICh0Lmxvb2thaGVhZCA8PSBmdCkgewoJCQkJCQkJaWYgKHp0KHQpLCB0Lmxvb2thaGVhZCA8PSBmdCAmJiBlID09PSBHKSByZXR1cm4gMTsKCQkJCQkJCWlmICgwID09PSB0Lmxvb2thaGVhZCkgYnJlYWs7CgkJCQkJCX0KCgkJCQkJCWlmICh0Lm1hdGNoX2xlbmd0aCA9IDAsIHQubG9va2FoZWFkID49IDMgJiYgdC5zdHJzdGFydCA+IDAgJiYgKHIgPSB0LnN0cnN0YXJ0IC0gMSwgbiA9IGFbcl0sIG4gPT09IGFbKytyXSAmJiBuID09PSBhWysrcl0gJiYgbiA9PT0gYVsrK3JdKSkgewoJCQkJCQkJcyA9IHQuc3Ryc3RhcnQgKyBmdDsKCgkJCQkJCQlkbyB7fSB3aGlsZSAobiA9PT0gYVsrK3JdICYmIG4gPT09IGFbKytyXSAmJiBuID09PSBhWysrcl0gJiYgbiA9PT0gYVsrK3JdICYmIG4gPT09IGFbKytyXSAmJiBuID09PSBhWysrcl0gJiYgbiA9PT0gYVsrK3JdICYmIG4gPT09IGFbKytyXSAmJiByIDwgcyk7CgoJCQkJCQkJdC5tYXRjaF9sZW5ndGggPSBmdCAtIChzIC0gciksIHQubWF0Y2hfbGVuZ3RoID4gdC5sb29rYWhlYWQgJiYgKHQubWF0Y2hfbGVuZ3RoID0gdC5sb29rYWhlYWQpOwoJCQkJCQl9CgoJCQkJCQlpZiAodC5tYXRjaF9sZW5ndGggPj0gMyA/IChpID0gWSh0LCAxLCB0Lm1hdGNoX2xlbmd0aCAtIDMpLCB0Lmxvb2thaGVhZCAtPSB0Lm1hdGNoX2xlbmd0aCwgdC5zdHJzdGFydCArPSB0Lm1hdGNoX2xlbmd0aCwgdC5tYXRjaF9sZW5ndGggPSAwKSA6IChpID0gWSh0LCAwLCB0LndpbmRvd1t0LnN0cnN0YXJ0XSksIHQubG9va2FoZWFkLS0sIHQuc3Ryc3RhcnQrKyksIGkgJiYgKHZ0KHQsICExKSwgMCA9PT0gdC5zdHJtLmF2YWlsX291dCkpIHJldHVybiAxOwoJCQkJCX0KCgkJCQkJcmV0dXJuIHQuaW5zZXJ0ID0gMCwgZSA9PT0gcSA/ICh2dCh0LCAhMCksIDAgPT09IHQuc3RybS5hdmFpbF9vdXQgPyAzIDogNCkgOiB0Lmxhc3RfbGl0ICYmICh2dCh0LCAhMSksIDAgPT09IHQuc3RybS5hdmFpbF9vdXQpID8gMSA6IDI7CgkJCQl9KShyLCBlKSA6IE90W3IubGV2ZWxdLmZ1bmMociwgZSk7CgkJCQlpZiAoMyAhPT0gaSAmJiA0ICE9PSBpIHx8IChyLnN0YXR1cyA9IHB0KSwgMSA9PT0gaSB8fCAzID09PSBpKSByZXR1cm4gMCA9PT0gdC5hdmFpbF9vdXQgJiYgKHIubGFzdF9mbHVzaCA9IC0xKSwgUTsKCQkJCWlmICgyID09PSBpICYmIChlID09PSBYID8gaihyKSA6IGUgIT09IEogJiYgKEsociwgMCwgMCwgITEpLCBlID09PSBWICYmIChtdChyLmhlYWQpLCAwID09PSByLmxvb2thaGVhZCAmJiAoci5zdHJzdGFydCA9IDAsIHIuYmxvY2tfc3RhcnQgPSAwLCByLmluc2VydCA9IDApKSksIHl0KHQpLCAwID09PSB0LmF2YWlsX291dCkpIHJldHVybiByLmxhc3RfZmx1c2ggPSAtMSwgUTsKCQkJfQoKCQkJcmV0dXJuIGUgIT09IHEgPyBRIDogci53cmFwIDw9IDAgPyB0dCA6ICgyID09PSByLndyYXAgPyAoRXQociwgMjU1ICYgdC5hZGxlciksIEV0KHIsIHQuYWRsZXIgPj4gOCAmIDI1NSksIEV0KHIsIHQuYWRsZXIgPj4gMTYgJiAyNTUpLCBFdChyLCB0LmFkbGVyID4+IDI0ICYgMjU1KSwgRXQociwgMjU1ICYgdC50b3RhbF9pbiksIEV0KHIsIHQudG90YWxfaW4gPj4gOCAmIDI1NSksIEV0KHIsIHQudG90YWxfaW4gPj4gMTYgJiAyNTUpLCBFdChyLCB0LnRvdGFsX2luID4+IDI0ICYgMjU1KSkgOiAoQXQociwgdC5hZGxlciA+Pj4gMTYpLCBBdChyLCA2NTUzNSAmIHQuYWRsZXIpKSwgeXQodCksIHIud3JhcCA+IDAgJiYgKHIud3JhcCA9IC1yLndyYXApLCAwICE9PSByLnBlbmRpbmcgPyBRIDogdHQpOwoJCX0sCgkJCQlGdCA9IHQgPT4gewoJCQlpZiAoIXQgfHwgIXQuc3RhdGUpIHJldHVybiBldDsKCQkJY29uc3QgZSA9IHQuc3RhdGUuc3RhdHVzOwoJCQlyZXR1cm4gNDIgIT09IGUgJiYgNjkgIT09IGUgJiYgNzMgIT09IGUgJiYgOTEgIT09IGUgJiYgZSAhPT0gdXQgJiYgZSAhPT0gd3QgJiYgZSAhPT0gcHQgPyBndCh0LCBldCkgOiAodC5zdGF0ZSA9IG51bGwsIGUgPT09IHd0ID8gZ3QodCwgaXQpIDogUSk7CgkJfSwKCQkJCU10ID0gKHQsIGUpID0+IHsKCQkJbGV0IGkgPSBlLmxlbmd0aDsKCQkJaWYgKCF0IHx8ICF0LnN0YXRlKSByZXR1cm4gZXQ7CgkJCWNvbnN0IG4gPSB0LnN0YXRlLAoJCQkJCQlyID0gbi53cmFwOwoJCQlpZiAoMiA9PT0gciB8fCAxID09PSByICYmIDQyICE9PSBuLnN0YXR1cyB8fCBuLmxvb2thaGVhZCkgcmV0dXJuIGV0OwoKCQkJaWYgKDEgPT09IHIgJiYgKHQuYWRsZXIgPSBaKHQuYWRsZXIsIGUsIGksIDApKSwgbi53cmFwID0gMCwgaSA+PSBuLndfc2l6ZSkgewoJCQkJMCA9PT0gciAmJiAobXQobi5oZWFkKSwgbi5zdHJzdGFydCA9IDAsIG4uYmxvY2tfc3RhcnQgPSAwLCBuLmluc2VydCA9IDApOwoJCQkJbGV0IHQgPSBuZXcgVWludDhBcnJheShuLndfc2l6ZSk7CgkJCQl0LnNldChlLnN1YmFycmF5KGkgLSBuLndfc2l6ZSwgaSksIDApLCBlID0gdCwgaSA9IG4ud19zaXplOwoJCQl9CgoJCQljb25zdCBzID0gdC5hdmFpbF9pbiwKCQkJCQkJYSA9IHQubmV4dF9pbiwKCQkJCQkJbyA9IHQuaW5wdXQ7CgoJCQlmb3IgKHQuYXZhaWxfaW4gPSBpLCB0Lm5leHRfaW4gPSAwLCB0LmlucHV0ID0gZSwgenQobik7IG4ubG9va2FoZWFkID49IDM7KSB7CgkJCQlsZXQgdCA9IG4uc3Ryc3RhcnQsCgkJCQkJCWUgPSBuLmxvb2thaGVhZCAtIDI7CgoJCQkJZG8gewoJCQkJCW4uaW5zX2ggPSBrdChuLCBuLmluc19oLCBuLndpbmRvd1t0ICsgMyAtIDFdKSwgbi5wcmV2W3QgJiBuLndfbWFza10gPSBuLmhlYWRbbi5pbnNfaF0sIG4uaGVhZFtuLmluc19oXSA9IHQsIHQrKzsKCQkJCX0gd2hpbGUgKC0tZSk7CgoJCQkJbi5zdHJzdGFydCA9IHQsIG4ubG9va2FoZWFkID0gMiwgenQobik7CgkJCX0KCgkJCXJldHVybiBuLnN0cnN0YXJ0ICs9IG4ubG9va2FoZWFkLCBuLmJsb2NrX3N0YXJ0ID0gbi5zdHJzdGFydCwgbi5pbnNlcnQgPSBuLmxvb2thaGVhZCwgbi5sb29rYWhlYWQgPSAwLCBuLm1hdGNoX2xlbmd0aCA9IG4ucHJldl9sZW5ndGggPSAyLCBuLm1hdGNoX2F2YWlsYWJsZSA9IDAsIHQubmV4dF9pbiA9IGEsIHQuaW5wdXQgPSBvLCB0LmF2YWlsX2luID0gcywgbi53cmFwID0gciwgUTsKCQl9OwoKCQljb25zdCBQdCA9ICh0LCBlKSA9PiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwodCwgZSk7CgoJCXZhciBIdCA9IGZ1bmN0aW9uIEh0KHQpIHsKCQkJY29uc3QgZSA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSk7CgoJCQlmb3IgKDsgZS5sZW5ndGg7KSB7CgkJCQljb25zdCBpID0gZS5zaGlmdCgpOwoKCQkJCWlmIChpKSB7CgkJCQkJaWYgKCJvYmplY3QiICE9IHR5cGVvZiBpKSB0aHJvdyBuZXcgVHlwZUVycm9yKGkgKyAibXVzdCBiZSBub24tb2JqZWN0Iik7CgoJCQkJCWZvciAoY29uc3QgZSBpbiBpKSBQdChpLCBlKSAmJiAodFtlXSA9IGlbZV0pOwoJCQkJfQoJCQl9CgoJCQlyZXR1cm4gdDsKCQl9LAoJCQkJV3QgPSB0ID0+IHsKCQkJbGV0IGUgPSAwOwoKCQkJZm9yIChsZXQgaSA9IDAsIG4gPSB0Lmxlbmd0aDsgaSA8IG47IGkrKykgZSArPSB0W2ldLmxlbmd0aDsKCgkJCWNvbnN0IGkgPSBuZXcgVWludDhBcnJheShlKTsKCgkJCWZvciAobGV0IGUgPSAwLCBuID0gMCwgciA9IHQubGVuZ3RoOyBlIDwgcjsgZSsrKSB7CgkJCQlsZXQgciA9IHRbZV07CgkJCQlpLnNldChyLCBuKSwgbiArPSByLmxlbmd0aDsKCQkJfQoKCQkJcmV0dXJuIGk7CgkJfTsKCgkJbGV0IEt0ID0gITA7CgoJCXRyeSB7CgkJCVN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkobnVsbCwgbmV3IFVpbnQ4QXJyYXkoMSkpOwoJCX0gY2F0Y2ggKHQpIHsKCQkJS3QgPSAhMTsKCQl9CgoJCWNvbnN0ICR0ID0gbmV3IFVpbnQ4QXJyYXkoMjU2KTsKCgkJZm9yIChsZXQgdCA9IDA7IHQgPCAyNTY7IHQrKykgJHRbdF0gPSB0ID49IDI1MiA/IDYgOiB0ID49IDI0OCA/IDUgOiB0ID49IDI0MCA/IDQgOiB0ID49IDIyNCA/IDMgOiB0ID49IDE5MiA/IDIgOiAxOwoKCQkkdFsyNTRdID0gJHRbMjU0XSA9IDE7CgoJCXZhciBZdCA9IHQgPT4gewoJCQlpZiAoImZ1bmN0aW9uIiA9PSB0eXBlb2YgVGV4dEVuY29kZXIgJiYgVGV4dEVuY29kZXIucHJvdG90eXBlLmVuY29kZSkgcmV0dXJuIG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZSh0KTsKCQkJbGV0IGUsCgkJCQkJaSwKCQkJCQluLAoJCQkJCXIsCgkJCQkJcywKCQkJCQlhID0gdC5sZW5ndGgsCgkJCQkJbyA9IDA7CgoJCQlmb3IgKHIgPSAwOyByIDwgYTsgcisrKSBpID0gdC5jaGFyQ29kZUF0KHIpLCA1NTI5NiA9PSAoNjQ1MTIgJiBpKSAmJiByICsgMSA8IGEgJiYgKG4gPSB0LmNoYXJDb2RlQXQociArIDEpLCA1NjMyMCA9PSAoNjQ1MTIgJiBuKSAmJiAoaSA9IDY1NTM2ICsgKGkgLSA1NTI5NiA8PCAxMCkgKyAobiAtIDU2MzIwKSwgcisrKSksIG8gKz0gaSA8IDEyOCA/IDEgOiBpIDwgMjA0OCA/IDIgOiBpIDwgNjU1MzYgPyAzIDogNDsKCgkJCWZvciAoZSA9IG5ldyBVaW50OEFycmF5KG8pLCBzID0gMCwgciA9IDA7IHMgPCBvOyByKyspIGkgPSB0LmNoYXJDb2RlQXQociksIDU1Mjk2ID09ICg2NDUxMiAmIGkpICYmIHIgKyAxIDwgYSAmJiAobiA9IHQuY2hhckNvZGVBdChyICsgMSksIDU2MzIwID09ICg2NDUxMiAmIG4pICYmIChpID0gNjU1MzYgKyAoaSAtIDU1Mjk2IDw8IDEwKSArIChuIC0gNTYzMjApLCByKyspKSwgaSA8IDEyOCA/IGVbcysrXSA9IGkgOiBpIDwgMjA0OCA/IChlW3MrK10gPSAxOTIgfCBpID4+PiA2LCBlW3MrK10gPSAxMjggfCA2MyAmIGkpIDogaSA8IDY1NTM2ID8gKGVbcysrXSA9IDIyNCB8IGkgPj4+IDEyLCBlW3MrK10gPSAxMjggfCBpID4+PiA2ICYgNjMsIGVbcysrXSA9IDEyOCB8IDYzICYgaSkgOiAoZVtzKytdID0gMjQwIHwgaSA+Pj4gMTgsIGVbcysrXSA9IDEyOCB8IGkgPj4+IDEyICYgNjMsIGVbcysrXSA9IDEyOCB8IGkgPj4+IDYgJiA2MywgZVtzKytdID0gMTI4IHwgNjMgJiBpKTsKCgkJCXJldHVybiBlOwoJCX0sCgkJCQlqdCA9ICh0LCBlKSA9PiB7CgkJCWNvbnN0IGkgPSBlIHx8IHQubGVuZ3RoOwoJCQlpZiAoImZ1bmN0aW9uIiA9PSB0eXBlb2YgVGV4dERlY29kZXIgJiYgVGV4dERlY29kZXIucHJvdG90eXBlLmRlY29kZSkgcmV0dXJuIG5ldyBUZXh0RGVjb2RlcigpLmRlY29kZSh0LnN1YmFycmF5KDAsIGUpKTsKCQkJbGV0IG4sIHI7CgkJCWNvbnN0IHMgPSBuZXcgQXJyYXkoMiAqIGkpOwoKCQkJZm9yIChyID0gMCwgbiA9IDA7IG4gPCBpOykgewoJCQkJbGV0IGUgPSB0W24rK107CgoJCQkJaWYgKGUgPCAxMjgpIHsKCQkJCQlzW3IrK10gPSBlOwoJCQkJCWNvbnRpbnVlOwoJCQkJfQoKCQkJCWxldCBhID0gJHRbZV07CgkJCQlpZiAoYSA+IDQpIHNbcisrXSA9IDY1NTMzLCBuICs9IGEgLSAxO2Vsc2UgewoJCQkJCWZvciAoZSAmPSAyID09PSBhID8gMzEgOiAzID09PSBhID8gMTUgOiA3OyBhID4gMSAmJiBuIDwgaTspIGUgPSBlIDw8IDYgfCA2MyAmIHRbbisrXSwgYS0tOwoKCQkJCQlhID4gMSA/IHNbcisrXSA9IDY1NTMzIDogZSA8IDY1NTM2ID8gc1tyKytdID0gZSA6IChlIC09IDY1NTM2LCBzW3IrK10gPSA1NTI5NiB8IGUgPj4gMTAgJiAxMDIzLCBzW3IrK10gPSA1NjMyMCB8IDEwMjMgJiBlKTsKCQkJCX0KCQkJfQoKCQkJcmV0dXJuICgodCwgZSkgPT4gewoJCQkJaWYgKGUgPCA2NTUzNCAmJiB0LnN1YmFycmF5ICYmIEt0KSByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLCB0Lmxlbmd0aCA9PT0gZSA/IHQgOiB0LnN1YmFycmF5KDAsIGUpKTsKCQkJCWxldCBpID0gIiI7CgoJCQkJZm9yIChsZXQgbiA9IDA7IG4gPCBlOyBuKyspIGkgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSh0W25dKTsKCgkJCQlyZXR1cm4gaTsKCQkJfSkocywgcik7CgkJfSwKCQkJCUd0ID0gKHQsIGUpID0+IHsKCQkJKGUgPSBlIHx8IHQubGVuZ3RoKSA+IHQubGVuZ3RoICYmIChlID0gdC5sZW5ndGgpOwoJCQlsZXQgaSA9IGUgLSAxOwoKCQkJZm9yICg7IGkgPj0gMCAmJiAxMjggPT0gKDE5MiAmIHRbaV0pOykgaS0tOwoKCQkJcmV0dXJuIGkgPCAwIHx8IDAgPT09IGkgPyBlIDogaSArICR0W3RbaV1dID4gZSA/IGkgOiBlOwoJCX0sCgkJCQlYdCA9IGZ1bmN0aW9uIFh0KCkgewoJCQl0aGlzLmlucHV0ID0gbnVsbCwgdGhpcy5uZXh0X2luID0gMCwgdGhpcy5hdmFpbF9pbiA9IDAsIHRoaXMudG90YWxfaW4gPSAwLCB0aGlzLm91dHB1dCA9IG51bGwsIHRoaXMubmV4dF9vdXQgPSAwLCB0aGlzLmF2YWlsX291dCA9IDAsIHRoaXMudG90YWxfb3V0ID0gMCwgdGhpcy5tc2cgPSAiIiwgdGhpcy5zdGF0ZSA9IG51bGwsIHRoaXMuZGF0YV90eXBlID0gMiwgdGhpcy5hZGxlciA9IDA7CgkJfTsKCgkJY29uc3QgVnQgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLAoJCQkJCXsKCQkJWl9OT19GTFVTSDogcXQsCgkJCVpfU1lOQ19GTFVTSDogSnQsCgkJCVpfRlVMTF9GTFVTSDogUXQsCgkJCVpfRklOSVNIOiB0ZSwKCQkJWl9PSzogZWUsCgkJCVpfU1RSRUFNX0VORDogaWUsCgkJCVpfREVGQVVMVF9DT01QUkVTU0lPTjogbmUsCgkJCVpfREVGQVVMVF9TVFJBVEVHWTogcmUsCgkJCVpfREVGTEFURUQ6IHNlCgkJfSA9IEg7CgoJCWZ1bmN0aW9uIGFlKHQpIHsKCQkJdGhpcy5vcHRpb25zID0gSHQoewoJCQkJbGV2ZWw6IG5lLAoJCQkJbWV0aG9kOiBzZSwKCQkJCWNodW5rU2l6ZTogMTYzODQsCgkJCQl3aW5kb3dCaXRzOiAxNSwKCQkJCW1lbUxldmVsOiA4LAoJCQkJc3RyYXRlZ3k6IHJlCgkJCX0sIHQgfHwge30pOwoJCQlsZXQgZSA9IHRoaXMub3B0aW9uczsKCQkJZS5yYXcgJiYgZS53aW5kb3dCaXRzID4gMCA/IGUud2luZG93Qml0cyA9IC1lLndpbmRvd0JpdHMgOiBlLmd6aXAgJiYgZS53aW5kb3dCaXRzID4gMCAmJiBlLndpbmRvd0JpdHMgPCAxNiAmJiAoZS53aW5kb3dCaXRzICs9IDE2KSwgdGhpcy5lcnIgPSAwLCB0aGlzLm1zZyA9ICIiLCB0aGlzLmVuZGVkID0gITEsIHRoaXMuY2h1bmtzID0gW10sIHRoaXMuc3RybSA9IG5ldyBYdCgpLCB0aGlzLnN0cm0uYXZhaWxfb3V0ID0gMDsKCQkJbGV0IGkgPSBJdCh0aGlzLnN0cm0sIGUubGV2ZWwsIGUubWV0aG9kLCBlLndpbmRvd0JpdHMsIGUubWVtTGV2ZWwsIGUuc3RyYXRlZ3kpOwoJCQlpZiAoaSAhPT0gZWUpIHRocm93IG5ldyBFcnJvcihQW2ldKTsKCgkJCWlmIChlLmhlYWRlciAmJiBTdCh0aGlzLnN0cm0sIGUuaGVhZGVyKSwgZS5kaWN0aW9uYXJ5KSB7CgkJCQlsZXQgdDsKCQkJCWlmICh0ID0gInN0cmluZyIgPT0gdHlwZW9mIGUuZGljdGlvbmFyeSA/IFl0KGUuZGljdGlvbmFyeSkgOiAiW29iamVjdCBBcnJheUJ1ZmZlcl0iID09PSBWdC5jYWxsKGUuZGljdGlvbmFyeSkgPyBuZXcgVWludDhBcnJheShlLmRpY3Rpb25hcnkpIDogZS5kaWN0aW9uYXJ5LCBpID0gTXQodGhpcy5zdHJtLCB0KSwgaSAhPT0gZWUpIHRocm93IG5ldyBFcnJvcihQW2ldKTsKCQkJCXRoaXMuX2RpY3Rfc2V0ID0gITA7CgkJCX0KCQl9CgoJCWZ1bmN0aW9uIG9lKHQsIGUpIHsKCQkJY29uc3QgaSA9IG5ldyBhZShlKTsKCQkJaWYgKGkucHVzaCh0LCAhMCksIGkuZXJyKSB0aHJvdyBpLm1zZyB8fCBQW2kuZXJyXTsKCQkJcmV0dXJuIGkucmVzdWx0OwoJCX0KCgkJYWUucHJvdG90eXBlLnB1c2ggPSBmdW5jdGlvbiAodCwgZSkgewoJCQljb25zdCBpID0gdGhpcy5zdHJtLAoJCQkJCQluID0gdGhpcy5vcHRpb25zLmNodW5rU2l6ZTsKCQkJbGV0IHIsIHM7CgkJCWlmICh0aGlzLmVuZGVkKSByZXR1cm4gITE7CgoJCQlmb3IgKHMgPSBlID09PSB+fmUgPyBlIDogITAgPT09IGUgPyB0ZSA6IHF0LCAic3RyaW5nIiA9PSB0eXBlb2YgdCA/IGkuaW5wdXQgPSBZdCh0KSA6ICJbb2JqZWN0IEFycmF5QnVmZmVyXSIgPT09IFZ0LmNhbGwodCkgPyBpLmlucHV0ID0gbmV3IFVpbnQ4QXJyYXkodCkgOiBpLmlucHV0ID0gdCwgaS5uZXh0X2luID0gMCwgaS5hdmFpbF9pbiA9IGkuaW5wdXQubGVuZ3RoOzspIGlmICgwID09PSBpLmF2YWlsX291dCAmJiAoaS5vdXRwdXQgPSBuZXcgVWludDhBcnJheShuKSwgaS5uZXh0X291dCA9IDAsIGkuYXZhaWxfb3V0ID0gbiksIChzID09PSBKdCB8fCBzID09PSBRdCkgJiYgaS5hdmFpbF9vdXQgPD0gNikgdGhpcy5vbkRhdGEoaS5vdXRwdXQuc3ViYXJyYXkoMCwgaS5uZXh0X291dCkpLCBpLmF2YWlsX291dCA9IDA7ZWxzZSB7CgkJCQlpZiAociA9IFp0KGksIHMpLCByID09PSBpZSkgcmV0dXJuIGkubmV4dF9vdXQgPiAwICYmIHRoaXMub25EYXRhKGkub3V0cHV0LnN1YmFycmF5KDAsIGkubmV4dF9vdXQpKSwgciA9IEZ0KHRoaXMuc3RybSksIHRoaXMub25FbmQociksIHRoaXMuZW5kZWQgPSAhMCwgciA9PT0gZWU7CgoJCQkJaWYgKDAgIT09IGkuYXZhaWxfb3V0KSB7CgkJCQkJaWYgKHMgPiAwICYmIGkubmV4dF9vdXQgPiAwKSB0aGlzLm9uRGF0YShpLm91dHB1dC5zdWJhcnJheSgwLCBpLm5leHRfb3V0KSksIGkuYXZhaWxfb3V0ID0gMDtlbHNlIGlmICgwID09PSBpLmF2YWlsX2luKSBicmVhazsKCQkJCX0gZWxzZSB0aGlzLm9uRGF0YShpLm91dHB1dCk7CgkJCX0KCgkJCXJldHVybiAhMDsKCQl9LCBhZS5wcm90b3R5cGUub25EYXRhID0gZnVuY3Rpb24gKHQpIHsKCQkJdGhpcy5jaHVua3MucHVzaCh0KTsKCQl9LCBhZS5wcm90b3R5cGUub25FbmQgPSBmdW5jdGlvbiAodCkgewoJCQl0ID09PSBlZSAmJiAodGhpcy5yZXN1bHQgPSBXdCh0aGlzLmNodW5rcykpLCB0aGlzLmNodW5rcyA9IFtdLCB0aGlzLmVyciA9IHQsIHRoaXMubXNnID0gdGhpcy5zdHJtLm1zZzsKCQl9OwoKCQl2YXIgaGUgPSB7CgkJCURlZmxhdGU6IGFlLAoJCQlkZWZsYXRlOiBvZSwKCQkJZGVmbGF0ZVJhdzogZnVuY3Rpb24gZGVmbGF0ZVJhdyh0LCBlKSB7CgkJCQlyZXR1cm4gKGUgPSBlIHx8IHt9KS5yYXcgPSAhMCwgb2UodCwgZSk7CgkJCX0sCgkJCWd6aXA6IGZ1bmN0aW9uIGd6aXAodCwgZSkgewoJCQkJcmV0dXJuIChlID0gZSB8fCB7fSkuZ3ppcCA9ICEwLCBvZSh0LCBlKTsKCQkJfSwKCQkJY29uc3RhbnRzOiBICgkJfSwKCQkJCWxlID0gZnVuY3Rpb24gbGUodCwgZSkgewoJCQlsZXQgaSwgbiwgciwgcywgYSwgbywgaCwgbCwgZCwgXywgZiwgYywgdSwgdywgcCwgZywgYiwgbSwgaywgeSwgdiwgRSwgQSwgeDsKCgkJCWNvbnN0IFUgPSB0LnN0YXRlOwoJCQlpID0gdC5uZXh0X2luLCBBID0gdC5pbnB1dCwgbiA9IGkgKyAodC5hdmFpbF9pbiAtIDUpLCByID0gdC5uZXh0X291dCwgeCA9IHQub3V0cHV0LCBzID0gciAtIChlIC0gdC5hdmFpbF9vdXQpLCBhID0gciArICh0LmF2YWlsX291dCAtIDI1NyksIG8gPSBVLmRtYXgsIGggPSBVLndzaXplLCBsID0gVS53aGF2ZSwgZCA9IFUud25leHQsIF8gPSBVLndpbmRvdywgZiA9IFUuaG9sZCwgYyA9IFUuYml0cywgdSA9IFUubGVuY29kZSwgdyA9IFUuZGlzdGNvZGUsIHAgPSAoMSA8PCBVLmxlbmJpdHMpIC0gMSwgZyA9ICgxIDw8IFUuZGlzdGJpdHMpIC0gMTsKCgkJCXQ6IGRvIHsKCQkJCWMgPCAxNSAmJiAoZiArPSBBW2krK10gPDwgYywgYyArPSA4LCBmICs9IEFbaSsrXSA8PCBjLCBjICs9IDgpLCBiID0gdVtmICYgcF07CgoJCQkJZTogZm9yICg7OykgewoJCQkJCWlmIChtID0gYiA+Pj4gMjQsIGYgPj4+PSBtLCBjIC09IG0sIG0gPSBiID4+PiAxNiAmIDI1NSwgMCA9PT0gbSkgeFtyKytdID0gNjU1MzUgJiBiO2Vsc2UgewoJCQkJCQlpZiAoISgxNiAmIG0pKSB7CgkJCQkJCQlpZiAoMCA9PSAoNjQgJiBtKSkgewoJCQkJCQkJCWIgPSB1Wyg2NTUzNSAmIGIpICsgKGYgJiAoMSA8PCBtKSAtIDEpXTsKCQkJCQkJCQljb250aW51ZSBlOwoJCQkJCQkJfQoKCQkJCQkJCWlmICgzMiAmIG0pIHsKCQkJCQkJCQlVLm1vZGUgPSAxMjsKCQkJCQkJCQlicmVhayB0OwoJCQkJCQkJfQoKCQkJCQkJCXQubXNnID0gImludmFsaWQgbGl0ZXJhbC9sZW5ndGggY29kZSIsIFUubW9kZSA9IDMwOwoJCQkJCQkJYnJlYWsgdDsKCQkJCQkJfQoKCQkJCQkJayA9IDY1NTM1ICYgYiwgbSAmPSAxNSwgbSAmJiAoYyA8IG0gJiYgKGYgKz0gQVtpKytdIDw8IGMsIGMgKz0gOCksIGsgKz0gZiAmICgxIDw8IG0pIC0gMSwgZiA+Pj49IG0sIGMgLT0gbSksIGMgPCAxNSAmJiAoZiArPSBBW2krK10gPDwgYywgYyArPSA4LCBmICs9IEFbaSsrXSA8PCBjLCBjICs9IDgpLCBiID0gd1tmICYgZ107CgoJCQkJCQlpOiBmb3IgKDs7KSB7CgkJCQkJCQlpZiAobSA9IGIgPj4+IDI0LCBmID4+Pj0gbSwgYyAtPSBtLCBtID0gYiA+Pj4gMTYgJiAyNTUsICEoMTYgJiBtKSkgewoJCQkJCQkJCWlmICgwID09ICg2NCAmIG0pKSB7CgkJCQkJCQkJCWIgPSB3Wyg2NTUzNSAmIGIpICsgKGYgJiAoMSA8PCBtKSAtIDEpXTsKCQkJCQkJCQkJY29udGludWUgaTsKCQkJCQkJCQl9CgoJCQkJCQkJCXQubXNnID0gImludmFsaWQgZGlzdGFuY2UgY29kZSIsIFUubW9kZSA9IDMwOwoJCQkJCQkJCWJyZWFrIHQ7CgkJCQkJCQl9CgoJCQkJCQkJaWYgKHkgPSA2NTUzNSAmIGIsIG0gJj0gMTUsIGMgPCBtICYmIChmICs9IEFbaSsrXSA8PCBjLCBjICs9IDgsIGMgPCBtICYmIChmICs9IEFbaSsrXSA8PCBjLCBjICs9IDgpKSwgeSArPSBmICYgKDEgPDwgbSkgLSAxLCB5ID4gbykgewoJCQkJCQkJCXQubXNnID0gImludmFsaWQgZGlzdGFuY2UgdG9vIGZhciBiYWNrIiwgVS5tb2RlID0gMzA7CgkJCQkJCQkJYnJlYWsgdDsKCQkJCQkJCX0KCgkJCQkJCQlpZiAoZiA+Pj49IG0sIGMgLT0gbSwgbSA9IHIgLSBzLCB5ID4gbSkgewoJCQkJCQkJCWlmIChtID0geSAtIG0sIG0gPiBsICYmIFUuc2FuZSkgewoJCQkJCQkJCQl0Lm1zZyA9ICJpbnZhbGlkIGRpc3RhbmNlIHRvbyBmYXIgYmFjayIsIFUubW9kZSA9IDMwOwoJCQkJCQkJCQlicmVhayB0OwoJCQkJCQkJCX0KCgkJCQkJCQkJaWYgKHYgPSAwLCBFID0gXywgMCA9PT0gZCkgewoJCQkJCQkJCQlpZiAodiArPSBoIC0gbSwgbSA8IGspIHsKCQkJCQkJCQkJCWsgLT0gbTsKCgkJCQkJCQkJCQlkbyB7CgkJCQkJCQkJCQkJeFtyKytdID0gX1t2KytdOwoJCQkJCQkJCQkJfSB3aGlsZSAoLS1tKTsKCgkJCQkJCQkJCQl2ID0gciAtIHksIEUgPSB4OwoJCQkJCQkJCQl9CgkJCQkJCQkJfSBlbHNlIGlmIChkIDwgbSkgewoJCQkJCQkJCQlpZiAodiArPSBoICsgZCAtIG0sIG0gLT0gZCwgbSA8IGspIHsKCQkJCQkJCQkJCWsgLT0gbTsKCgkJCQkJCQkJCQlkbyB7CgkJCQkJCQkJCQkJeFtyKytdID0gX1t2KytdOwoJCQkJCQkJCQkJfSB3aGlsZSAoLS1tKTsKCgkJCQkJCQkJCQlpZiAodiA9IDAsIGQgPCBrKSB7CgkJCQkJCQkJCQkJbSA9IGQsIGsgLT0gbTsKCgkJCQkJCQkJCQkJZG8gewoJCQkJCQkJCQkJCQl4W3IrK10gPSBfW3YrK107CgkJCQkJCQkJCQkJfSB3aGlsZSAoLS1tKTsKCgkJCQkJCQkJCQkJdiA9IHIgLSB5LCBFID0geDsKCQkJCQkJCQkJCX0KCQkJCQkJCQkJfQoJCQkJCQkJCX0gZWxzZSBpZiAodiArPSBkIC0gbSwgbSA8IGspIHsKCQkJCQkJCQkJayAtPSBtOwoKCQkJCQkJCQkJZG8gewoJCQkJCQkJCQkJeFtyKytdID0gX1t2KytdOwoJCQkJCQkJCQl9IHdoaWxlICgtLW0pOwoKCQkJCQkJCQkJdiA9IHIgLSB5LCBFID0geDsKCQkJCQkJCQl9CgoJCQkJCQkJCWZvciAoOyBrID4gMjspIHhbcisrXSA9IEVbdisrXSwgeFtyKytdID0gRVt2KytdLCB4W3IrK10gPSBFW3YrK10sIGsgLT0gMzsKCgkJCQkJCQkJayAmJiAoeFtyKytdID0gRVt2KytdLCBrID4gMSAmJiAoeFtyKytdID0gRVt2KytdKSk7CgkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCXYgPSByIC0geTsKCgkJCQkJCQkJZG8gewoJCQkJCQkJCQl4W3IrK10gPSB4W3YrK10sIHhbcisrXSA9IHhbdisrXSwgeFtyKytdID0geFt2KytdLCBrIC09IDM7CgkJCQkJCQkJfSB3aGlsZSAoayA+IDIpOwoKCQkJCQkJCQlrICYmICh4W3IrK10gPSB4W3YrK10sIGsgPiAxICYmICh4W3IrK10gPSB4W3YrK10pKTsKCQkJCQkJCX0KCgkJCQkJCQlicmVhazsKCQkJCQkJfQoJCQkJCX0KCQkJCQlicmVhazsKCQkJCX0KCQkJfSB3aGlsZSAoaSA8IG4gJiYgciA8IGEpOwoKCQkJayA9IGMgPj4gMywgaSAtPSBrLCBjIC09IGsgPDwgMywgZiAmPSAoMSA8PCBjKSAtIDEsIHQubmV4dF9pbiA9IGksIHQubmV4dF9vdXQgPSByLCB0LmF2YWlsX2luID0gaSA8IG4gPyBuIC0gaSArIDUgOiA1IC0gKGkgLSBuKSwgdC5hdmFpbF9vdXQgPSByIDwgYSA/IGEgLSByICsgMjU3IDogMjU3IC0gKHIgLSBhKSwgVS5ob2xkID0gZiwgVS5iaXRzID0gYzsKCQl9OwoKCQljb25zdCBkZSA9IG5ldyBVaW50MTZBcnJheShbMywgNCwgNSwgNiwgNywgOCwgOSwgMTAsIDExLCAxMywgMTUsIDE3LCAxOSwgMjMsIDI3LCAzMSwgMzUsIDQzLCA1MSwgNTksIDY3LCA4MywgOTksIDExNSwgMTMxLCAxNjMsIDE5NSwgMjI3LCAyNTgsIDAsIDBdKSwKCQkJCQlfZSA9IG5ldyBVaW50OEFycmF5KFsxNiwgMTYsIDE2LCAxNiwgMTYsIDE2LCAxNiwgMTYsIDE3LCAxNywgMTcsIDE3LCAxOCwgMTgsIDE4LCAxOCwgMTksIDE5LCAxOSwgMTksIDIwLCAyMCwgMjAsIDIwLCAyMSwgMjEsIDIxLCAyMSwgMTYsIDcyLCA3OF0pLAoJCQkJCWZlID0gbmV3IFVpbnQxNkFycmF5KFsxLCAyLCAzLCA0LCA1LCA3LCA5LCAxMywgMTcsIDI1LCAzMywgNDksIDY1LCA5NywgMTI5LCAxOTMsIDI1NywgMzg1LCA1MTMsIDc2OSwgMTAyNSwgMTUzNywgMjA0OSwgMzA3MywgNDA5NywgNjE0NSwgODE5MywgMTIyODksIDE2Mzg1LCAyNDU3NywgMCwgMF0pLAoJCQkJCWNlID0gbmV3IFVpbnQ4QXJyYXkoWzE2LCAxNiwgMTYsIDE2LCAxNywgMTcsIDE4LCAxOCwgMTksIDE5LCAyMCwgMjAsIDIxLCAyMSwgMjIsIDIyLCAyMywgMjMsIDI0LCAyNCwgMjUsIDI1LCAyNiwgMjYsIDI3LCAyNywgMjgsIDI4LCAyOSwgMjksIDY0LCA2NF0pOwoKCQl2YXIgdWUgPSAodCwgZSwgaSwgbiwgciwgcywgYSwgbykgPT4gewoJCQljb25zdCBoID0gby5iaXRzOwoKCQkJbGV0IGwsCgkJCQkJZCwKCQkJCQlfLAoJCQkJCWYsCgkJCQkJYywKCQkJCQl1LAoJCQkJCXcgPSAwLAoJCQkJCXAgPSAwLAoJCQkJCWcgPSAwLAoJCQkJCWIgPSAwLAoJCQkJCW0gPSAwLAoJCQkJCWsgPSAwLAoJCQkJCXkgPSAwLAoJCQkJCXYgPSAwLAoJCQkJCUUgPSAwLAoJCQkJCUEgPSAwLAoJCQkJCXggPSBudWxsLAoJCQkJCVUgPSAwOwoKCQkJY29uc3QgeiA9IG5ldyBVaW50MTZBcnJheSgxNiksCgkJCQkJCVIgPSBuZXcgVWludDE2QXJyYXkoMTYpOwoJCQlsZXQgTiwKCQkJCQlULAoJCQkJCU8sCgkJCQkJTCA9IG51bGwsCgkJCQkJQiA9IDA7CgoJCQlmb3IgKHcgPSAwOyB3IDw9IDE1OyB3KyspIHpbd10gPSAwOwoKCQkJZm9yIChwID0gMDsgcCA8IG47IHArKykgeltlW2kgKyBwXV0rKzsKCgkJCWZvciAobSA9IGgsIGIgPSAxNTsgYiA+PSAxICYmIDAgPT09IHpbYl07IGItLSk7CgoJCQlpZiAobSA+IGIgJiYgKG0gPSBiKSwgMCA9PT0gYikgcmV0dXJuIHJbcysrXSA9IDIwOTcxNTIwLCByW3MrK10gPSAyMDk3MTUyMCwgby5iaXRzID0gMSwgMDsKCgkJCWZvciAoZyA9IDE7IGcgPCBiICYmIDAgPT09IHpbZ107IGcrKyk7CgoJCQlmb3IgKG0gPCBnICYmIChtID0gZyksIHYgPSAxLCB3ID0gMTsgdyA8PSAxNTsgdysrKSBpZiAodiA8PD0gMSwgdiAtPSB6W3ddLCB2IDwgMCkgcmV0dXJuIC0xOwoKCQkJaWYgKHYgPiAwICYmICgwID09PSB0IHx8IDEgIT09IGIpKSByZXR1cm4gLTE7CgoJCQlmb3IgKFJbMV0gPSAwLCB3ID0gMTsgdyA8IDE1OyB3KyspIFJbdyArIDFdID0gUlt3XSArIHpbd107CgoJCQlmb3IgKHAgPSAwOyBwIDwgbjsgcCsrKSAwICE9PSBlW2kgKyBwXSAmJiAoYVtSW2VbaSArIHBdXSsrXSA9IHApOwoKCQkJaWYgKDAgPT09IHQgPyAoeCA9IEwgPSBhLCB1ID0gMTkpIDogMSA9PT0gdCA/ICh4ID0gZGUsIFUgLT0gMjU3LCBMID0gX2UsIEIgLT0gMjU3LCB1ID0gMjU2KSA6ICh4ID0gZmUsIEwgPSBjZSwgdSA9IC0xKSwgQSA9IDAsIHAgPSAwLCB3ID0gZywgYyA9IHMsIGsgPSBtLCB5ID0gMCwgXyA9IC0xLCBFID0gMSA8PCBtLCBmID0gRSAtIDEsIDEgPT09IHQgJiYgRSA+IDg1MiB8fCAyID09PSB0ICYmIEUgPiA1OTIpIHJldHVybiAxOwoKCQkJZm9yICg7OykgewoJCQkJTiA9IHcgLSB5LCBhW3BdIDwgdSA/IChUID0gMCwgTyA9IGFbcF0pIDogYVtwXSA+IHUgPyAoVCA9IExbQiArIGFbcF1dLCBPID0geFtVICsgYVtwXV0pIDogKFQgPSA5NiwgTyA9IDApLCBsID0gMSA8PCB3IC0geSwgZCA9IDEgPDwgaywgZyA9IGQ7CgoJCQkJZG8gewoJCQkJCWQgLT0gbCwgcltjICsgKEEgPj4geSkgKyBkXSA9IE4gPDwgMjQgfCBUIDw8IDE2IHwgTyB8IDA7CgkJCQl9IHdoaWxlICgwICE9PSBkKTsKCgkJCQlmb3IgKGwgPSAxIDw8IHcgLSAxOyBBICYgbDspIGwgPj49IDE7CgoJCQkJaWYgKDAgIT09IGwgPyAoQSAmPSBsIC0gMSwgQSArPSBsKSA6IEEgPSAwLCBwKyssIDAgPT0gLS16W3ddKSB7CgkJCQkJaWYgKHcgPT09IGIpIGJyZWFrOwoJCQkJCXcgPSBlW2kgKyBhW3BdXTsKCQkJCX0KCgkJCQlpZiAodyA+IG0gJiYgKEEgJiBmKSAhPT0gXykgewoJCQkJCWZvciAoMCA9PT0geSAmJiAoeSA9IG0pLCBjICs9IGcsIGsgPSB3IC0geSwgdiA9IDEgPDwgazsgayArIHkgPCBiICYmICh2IC09IHpbayArIHldLCAhKHYgPD0gMCkpOykgaysrLCB2IDw8PSAxOwoKCQkJCQlpZiAoRSArPSAxIDw8IGssIDEgPT09IHQgJiYgRSA+IDg1MiB8fCAyID09PSB0ICYmIEUgPiA1OTIpIHJldHVybiAxOwoJCQkJCV8gPSBBICYgZiwgcltfXSA9IG0gPDwgMjQgfCBrIDw8IDE2IHwgYyAtIHMgfCAwOwoJCQkJfQoJCQl9CgoJCQlyZXR1cm4gMCAhPT0gQSAmJiAocltjICsgQV0gPSB3IC0geSA8PCAyNCB8IDY0IDw8IDE2IHwgMCksIG8uYml0cyA9IG0sIDA7CgkJfTsKCgkJY29uc3QgewoJCQlaX0ZJTklTSDogd2UsCgkJCVpfQkxPQ0s6IHBlLAoJCQlaX1RSRUVTOiBnZSwKCQkJWl9PSzogYmUsCgkJCVpfU1RSRUFNX0VORDogbWUsCgkJCVpfTkVFRF9ESUNUOiBrZSwKCQkJWl9TVFJFQU1fRVJST1I6IHllLAoJCQlaX0RBVEFfRVJST1I6IHZlLAoJCQlaX01FTV9FUlJPUjogRWUsCgkJCVpfQlVGX0VSUk9SOiBBZSwKCQkJWl9ERUZMQVRFRDogeGUKCQl9ID0gSCwKCQkJCQlVZSA9IDEyLAoJCQkJCXplID0gMzAsCgkJCQkJUmUgPSB0ID0+ICh0ID4+PiAyNCAmIDI1NSkgKyAodCA+Pj4gOCAmIDY1MjgwKSArICgoNjUyODAgJiB0KSA8PCA4KSArICgoMjU1ICYgdCkgPDwgMjQpOwoKCQlmdW5jdGlvbiBOZSgpIHsKCQkJdGhpcy5tb2RlID0gMCwgdGhpcy5sYXN0ID0gITEsIHRoaXMud3JhcCA9IDAsIHRoaXMuaGF2ZWRpY3QgPSAhMSwgdGhpcy5mbGFncyA9IDAsIHRoaXMuZG1heCA9IDAsIHRoaXMuY2hlY2sgPSAwLCB0aGlzLnRvdGFsID0gMCwgdGhpcy5oZWFkID0gbnVsbCwgdGhpcy53Yml0cyA9IDAsIHRoaXMud3NpemUgPSAwLCB0aGlzLndoYXZlID0gMCwgdGhpcy53bmV4dCA9IDAsIHRoaXMud2luZG93ID0gbnVsbCwgdGhpcy5ob2xkID0gMCwgdGhpcy5iaXRzID0gMCwgdGhpcy5sZW5ndGggPSAwLCB0aGlzLm9mZnNldCA9IDAsIHRoaXMuZXh0cmEgPSAwLCB0aGlzLmxlbmNvZGUgPSBudWxsLCB0aGlzLmRpc3Rjb2RlID0gbnVsbCwgdGhpcy5sZW5iaXRzID0gMCwgdGhpcy5kaXN0Yml0cyA9IDAsIHRoaXMubmNvZGUgPSAwLCB0aGlzLm5sZW4gPSAwLCB0aGlzLm5kaXN0ID0gMCwgdGhpcy5oYXZlID0gMCwgdGhpcy5uZXh0ID0gbnVsbCwgdGhpcy5sZW5zID0gbmV3IFVpbnQxNkFycmF5KDMyMCksIHRoaXMud29yayA9IG5ldyBVaW50MTZBcnJheSgyODgpLCB0aGlzLmxlbmR5biA9IG51bGwsIHRoaXMuZGlzdGR5biA9IG51bGwsIHRoaXMuc2FuZSA9IDAsIHRoaXMuYmFjayA9IDAsIHRoaXMud2FzID0gMDsKCQl9CgoJCWNvbnN0IFRlID0gdCA9PiB7CgkJCWlmICghdCB8fCAhdC5zdGF0ZSkgcmV0dXJuIHllOwoJCQljb25zdCBlID0gdC5zdGF0ZTsKCQkJcmV0dXJuIHQudG90YWxfaW4gPSB0LnRvdGFsX291dCA9IGUudG90YWwgPSAwLCB0Lm1zZyA9ICIiLCBlLndyYXAgJiYgKHQuYWRsZXIgPSAxICYgZS53cmFwKSwgZS5tb2RlID0gMSwgZS5sYXN0ID0gMCwgZS5oYXZlZGljdCA9IDAsIGUuZG1heCA9IDMyNzY4LCBlLmhlYWQgPSBudWxsLCBlLmhvbGQgPSAwLCBlLmJpdHMgPSAwLCBlLmxlbmNvZGUgPSBlLmxlbmR5biA9IG5ldyBJbnQzMkFycmF5KDg1MiksIGUuZGlzdGNvZGUgPSBlLmRpc3RkeW4gPSBuZXcgSW50MzJBcnJheSg1OTIpLCBlLnNhbmUgPSAxLCBlLmJhY2sgPSAtMSwgYmU7CgkJfSwKCQkJCQlPZSA9IHQgPT4gewoJCQlpZiAoIXQgfHwgIXQuc3RhdGUpIHJldHVybiB5ZTsKCQkJY29uc3QgZSA9IHQuc3RhdGU7CgkJCXJldHVybiBlLndzaXplID0gMCwgZS53aGF2ZSA9IDAsIGUud25leHQgPSAwLCBUZSh0KTsKCQl9LAoJCQkJCUxlID0gKHQsIGUpID0+IHsKCQkJbGV0IGk7CgkJCWlmICghdCB8fCAhdC5zdGF0ZSkgcmV0dXJuIHllOwoJCQljb25zdCBuID0gdC5zdGF0ZTsKCQkJcmV0dXJuIGUgPCAwID8gKGkgPSAwLCBlID0gLWUpIDogKGkgPSAxICsgKGUgPj4gNCksIGUgPCA0OCAmJiAoZSAmPSAxNSkpLCBlICYmIChlIDwgOCB8fCBlID4gMTUpID8geWUgOiAobnVsbCAhPT0gbi53aW5kb3cgJiYgbi53Yml0cyAhPT0gZSAmJiAobi53aW5kb3cgPSBudWxsKSwgbi53cmFwID0gaSwgbi53Yml0cyA9IGUsIE9lKHQpKTsKCQl9LAoJCQkJCUJlID0gKHQsIGUpID0+IHsKCQkJaWYgKCF0KSByZXR1cm4geWU7CgkJCWNvbnN0IGkgPSBuZXcgTmUoKTsKCQkJdC5zdGF0ZSA9IGksIGkud2luZG93ID0gbnVsbDsKCQkJY29uc3QgbiA9IExlKHQsIGUpOwoJCQlyZXR1cm4gbiAhPT0gYmUgJiYgKHQuc3RhdGUgPSBudWxsKSwgbjsKCQl9OwoKCQlsZXQgQ2UsCgkJCQlEZSwKCQkJCUllID0gITA7CgoJCWNvbnN0IFNlID0gdCA9PiB7CgkJCWlmIChJZSkgewoJCQkJQ2UgPSBuZXcgSW50MzJBcnJheSg1MTIpLCBEZSA9IG5ldyBJbnQzMkFycmF5KDMyKTsKCQkJCWxldCBlID0gMDsKCgkJCQlmb3IgKDsgZSA8IDE0NDspIHQubGVuc1tlKytdID0gODsKCgkJCQlmb3IgKDsgZSA8IDI1NjspIHQubGVuc1tlKytdID0gOTsKCgkJCQlmb3IgKDsgZSA8IDI4MDspIHQubGVuc1tlKytdID0gNzsKCgkJCQlmb3IgKDsgZSA8IDI4ODspIHQubGVuc1tlKytdID0gODsKCgkJCQlmb3IgKHVlKDEsIHQubGVucywgMCwgMjg4LCBDZSwgMCwgdC53b3JrLCB7CgkJCQkJYml0czogOQoJCQkJfSksIGUgPSAwOyBlIDwgMzI7KSB0LmxlbnNbZSsrXSA9IDU7CgoJCQkJdWUoMiwgdC5sZW5zLCAwLCAzMiwgRGUsIDAsIHQud29yaywgewoJCQkJCWJpdHM6IDUKCQkJCX0pLCBJZSA9ICExOwoJCQl9CgoJCQl0LmxlbmNvZGUgPSBDZSwgdC5sZW5iaXRzID0gOSwgdC5kaXN0Y29kZSA9IERlLCB0LmRpc3RiaXRzID0gNTsKCQl9LAoJCQkJCVplID0gKHQsIGUsIGksIG4pID0+IHsKCQkJbGV0IHI7CgkJCWNvbnN0IHMgPSB0LnN0YXRlOwoJCQlyZXR1cm4gbnVsbCA9PT0gcy53aW5kb3cgJiYgKHMud3NpemUgPSAxIDw8IHMud2JpdHMsIHMud25leHQgPSAwLCBzLndoYXZlID0gMCwgcy53aW5kb3cgPSBuZXcgVWludDhBcnJheShzLndzaXplKSksIG4gPj0gcy53c2l6ZSA/IChzLndpbmRvdy5zZXQoZS5zdWJhcnJheShpIC0gcy53c2l6ZSwgaSksIDApLCBzLnduZXh0ID0gMCwgcy53aGF2ZSA9IHMud3NpemUpIDogKHIgPSBzLndzaXplIC0gcy53bmV4dCwgciA+IG4gJiYgKHIgPSBuKSwgcy53aW5kb3cuc2V0KGUuc3ViYXJyYXkoaSAtIG4sIGkgLSBuICsgciksIHMud25leHQpLCAobiAtPSByKSA/IChzLndpbmRvdy5zZXQoZS5zdWJhcnJheShpIC0gbiwgaSksIDApLCBzLnduZXh0ID0gbiwgcy53aGF2ZSA9IHMud3NpemUpIDogKHMud25leHQgKz0gciwgcy53bmV4dCA9PT0gcy53c2l6ZSAmJiAocy53bmV4dCA9IDApLCBzLndoYXZlIDwgcy53c2l6ZSAmJiAocy53aGF2ZSArPSByKSkpLCAwOwoJCX07CgoJCXZhciBGZSA9IE9lLAoJCQkJTWUgPSBCZSwKCQkJCVBlID0gKHQsIGUpID0+IHsKCQkJbGV0IGksCgkJCQkJbiwKCQkJCQlyLAoJCQkJCXMsCgkJCQkJYSwKCQkJCQlvLAoJCQkJCWgsCgkJCQkJbCwKCQkJCQlkLAoJCQkJCV8sCgkJCQkJZiwKCQkJCQljLAoJCQkJCXUsCgkJCQkJdywKCQkJCQlwLAoJCQkJCWcsCgkJCQkJYiwKCQkJCQltLAoJCQkJCWssCgkJCQkJeSwKCQkJCQl2LAoJCQkJCUUsCgkJCQkJQSA9IDA7CgoJCQljb25zdCB4ID0gbmV3IFVpbnQ4QXJyYXkoNCk7CgkJCWxldCBVLCB6OwoJCQljb25zdCBSID0gbmV3IFVpbnQ4QXJyYXkoWzE2LCAxNywgMTgsIDAsIDgsIDcsIDksIDYsIDEwLCA1LCAxMSwgNCwgMTIsIDMsIDEzLCAyLCAxNCwgMSwgMTVdKTsKCQkJaWYgKCF0IHx8ICF0LnN0YXRlIHx8ICF0Lm91dHB1dCB8fCAhdC5pbnB1dCAmJiAwICE9PSB0LmF2YWlsX2luKSByZXR1cm4geWU7CgkJCWkgPSB0LnN0YXRlLCBpLm1vZGUgPT09IFVlICYmIChpLm1vZGUgPSAxMyksIGEgPSB0Lm5leHRfb3V0LCByID0gdC5vdXRwdXQsIGggPSB0LmF2YWlsX291dCwgcyA9IHQubmV4dF9pbiwgbiA9IHQuaW5wdXQsIG8gPSB0LmF2YWlsX2luLCBsID0gaS5ob2xkLCBkID0gaS5iaXRzLCBfID0gbywgZiA9IGgsIEUgPSBiZTsKCgkJCXQ6IGZvciAoOzspIHN3aXRjaCAoaS5tb2RlKSB7CgkJCQljYXNlIDE6CgkJCQkJaWYgKDAgPT09IGkud3JhcCkgewoJCQkJCQlpLm1vZGUgPSAxMzsKCQkJCQkJYnJlYWs7CgkJCQkJfQoKCQkJCQlmb3IgKDsgZCA8IDE2OykgewoJCQkJCQlpZiAoMCA9PT0gbykgYnJlYWsgdDsKCQkJCQkJby0tLCBsICs9IG5bcysrXSA8PCBkLCBkICs9IDg7CgkJCQkJfQoKCQkJCQlpZiAoMiAmIGkud3JhcCAmJiAzNTYxNSA9PT0gbCkgewoJCQkJCQlpLmNoZWNrID0gMCwgeFswXSA9IDI1NSAmIGwsIHhbMV0gPSBsID4+PiA4ICYgMjU1LCBpLmNoZWNrID0gTShpLmNoZWNrLCB4LCAyLCAwKSwgbCA9IDAsIGQgPSAwLCBpLm1vZGUgPSAyOwoJCQkJCQlicmVhazsKCQkJCQl9CgoJCQkJCWlmIChpLmZsYWdzID0gMCwgaS5oZWFkICYmIChpLmhlYWQuZG9uZSA9ICExKSwgISgxICYgaS53cmFwKSB8fCAoKCgyNTUgJiBsKSA8PCA4KSArIChsID4+IDgpKSAlIDMxKSB7CgkJCQkJCXQubXNnID0gImluY29ycmVjdCBoZWFkZXIgY2hlY2siLCBpLm1vZGUgPSB6ZTsKCQkJCQkJYnJlYWs7CgkJCQkJfQoKCQkJCQlpZiAoKDE1ICYgbCkgIT09IHhlKSB7CgkJCQkJCXQubXNnID0gInVua25vd24gY29tcHJlc3Npb24gbWV0aG9kIiwgaS5tb2RlID0gemU7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCgkJCQkJaWYgKGwgPj4+PSA0LCBkIC09IDQsIHYgPSA4ICsgKDE1ICYgbCksIDAgPT09IGkud2JpdHMpIGkud2JpdHMgPSB2O2Vsc2UgaWYgKHYgPiBpLndiaXRzKSB7CgkJCQkJCXQubXNnID0gImludmFsaWQgd2luZG93IHNpemUiLCBpLm1vZGUgPSB6ZTsKCQkJCQkJYnJlYWs7CgkJCQkJfQoJCQkJCWkuZG1heCA9IDEgPDwgaS53Yml0cywgdC5hZGxlciA9IGkuY2hlY2sgPSAxLCBpLm1vZGUgPSA1MTIgJiBsID8gMTAgOiBVZSwgbCA9IDAsIGQgPSAwOwoJCQkJCWJyZWFrOwoKCQkJCWNhc2UgMjoKCQkJCQlmb3IgKDsgZCA8IDE2OykgewoJCQkJCQlpZiAoMCA9PT0gbykgYnJlYWsgdDsKCQkJCQkJby0tLCBsICs9IG5bcysrXSA8PCBkLCBkICs9IDg7CgkJCQkJfQoKCQkJCQlpZiAoaS5mbGFncyA9IGwsICgyNTUgJiBpLmZsYWdzKSAhPT0geGUpIHsKCQkJCQkJdC5tc2cgPSAidW5rbm93biBjb21wcmVzc2lvbiBtZXRob2QiLCBpLm1vZGUgPSB6ZTsKCQkJCQkJYnJlYWs7CgkJCQkJfQoKCQkJCQlpZiAoNTczNDQgJiBpLmZsYWdzKSB7CgkJCQkJCXQubXNnID0gInVua25vd24gaGVhZGVyIGZsYWdzIHNldCIsIGkubW9kZSA9IHplOwoJCQkJCQlicmVhazsKCQkJCQl9CgoJCQkJCWkuaGVhZCAmJiAoaS5oZWFkLnRleHQgPSBsID4+IDggJiAxKSwgNTEyICYgaS5mbGFncyAmJiAoeFswXSA9IDI1NSAmIGwsIHhbMV0gPSBsID4+PiA4ICYgMjU1LCBpLmNoZWNrID0gTShpLmNoZWNrLCB4LCAyLCAwKSksIGwgPSAwLCBkID0gMCwgaS5tb2RlID0gMzsKCgkJCQljYXNlIDM6CgkJCQkJZm9yICg7IGQgPCAzMjspIHsKCQkJCQkJaWYgKDAgPT09IG8pIGJyZWFrIHQ7CgkJCQkJCW8tLSwgbCArPSBuW3MrK10gPDwgZCwgZCArPSA4OwoJCQkJCX0KCgkJCQkJaS5oZWFkICYmIChpLmhlYWQudGltZSA9IGwpLCA1MTIgJiBpLmZsYWdzICYmICh4WzBdID0gMjU1ICYgbCwgeFsxXSA9IGwgPj4+IDggJiAyNTUsIHhbMl0gPSBsID4+PiAxNiAmIDI1NSwgeFszXSA9IGwgPj4+IDI0ICYgMjU1LCBpLmNoZWNrID0gTShpLmNoZWNrLCB4LCA0LCAwKSksIGwgPSAwLCBkID0gMCwgaS5tb2RlID0gNDsKCgkJCQljYXNlIDQ6CgkJCQkJZm9yICg7IGQgPCAxNjspIHsKCQkJCQkJaWYgKDAgPT09IG8pIGJyZWFrIHQ7CgkJCQkJCW8tLSwgbCArPSBuW3MrK10gPDwgZCwgZCArPSA4OwoJCQkJCX0KCgkJCQkJaS5oZWFkICYmIChpLmhlYWQueGZsYWdzID0gMjU1ICYgbCwgaS5oZWFkLm9zID0gbCA+PiA4KSwgNTEyICYgaS5mbGFncyAmJiAoeFswXSA9IDI1NSAmIGwsIHhbMV0gPSBsID4+PiA4ICYgMjU1LCBpLmNoZWNrID0gTShpLmNoZWNrLCB4LCAyLCAwKSksIGwgPSAwLCBkID0gMCwgaS5tb2RlID0gNTsKCgkJCQljYXNlIDU6CgkJCQkJaWYgKDEwMjQgJiBpLmZsYWdzKSB7CgkJCQkJCWZvciAoOyBkIDwgMTY7KSB7CgkJCQkJCQlpZiAoMCA9PT0gbykgYnJlYWsgdDsKCQkJCQkJCW8tLSwgbCArPSBuW3MrK10gPDwgZCwgZCArPSA4OwoJCQkJCQl9CgoJCQkJCQlpLmxlbmd0aCA9IGwsIGkuaGVhZCAmJiAoaS5oZWFkLmV4dHJhX2xlbiA9IGwpLCA1MTIgJiBpLmZsYWdzICYmICh4WzBdID0gMjU1ICYgbCwgeFsxXSA9IGwgPj4+IDggJiAyNTUsIGkuY2hlY2sgPSBNKGkuY2hlY2ssIHgsIDIsIDApKSwgbCA9IDAsIGQgPSAwOwoJCQkJCX0gZWxzZSBpLmhlYWQgJiYgKGkuaGVhZC5leHRyYSA9IG51bGwpOwoKCQkJCQlpLm1vZGUgPSA2OwoKCQkJCWNhc2UgNjoKCQkJCQlpZiAoMTAyNCAmIGkuZmxhZ3MgJiYgKGMgPSBpLmxlbmd0aCwgYyA+IG8gJiYgKGMgPSBvKSwgYyAmJiAoaS5oZWFkICYmICh2ID0gaS5oZWFkLmV4dHJhX2xlbiAtIGkubGVuZ3RoLCBpLmhlYWQuZXh0cmEgfHwgKGkuaGVhZC5leHRyYSA9IG5ldyBVaW50OEFycmF5KGkuaGVhZC5leHRyYV9sZW4pKSwgaS5oZWFkLmV4dHJhLnNldChuLnN1YmFycmF5KHMsIHMgKyBjKSwgdikpLCA1MTIgJiBpLmZsYWdzICYmIChpLmNoZWNrID0gTShpLmNoZWNrLCBuLCBjLCBzKSksIG8gLT0gYywgcyArPSBjLCBpLmxlbmd0aCAtPSBjKSwgaS5sZW5ndGgpKSBicmVhayB0OwoJCQkJCWkubGVuZ3RoID0gMCwgaS5tb2RlID0gNzsKCgkJCQljYXNlIDc6CgkJCQkJaWYgKDIwNDggJiBpLmZsYWdzKSB7CgkJCQkJCWlmICgwID09PSBvKSBicmVhayB0OwoJCQkJCQljID0gMDsKCgkJCQkJCWRvIHsKCQkJCQkJCXYgPSBuW3MgKyBjKytdLCBpLmhlYWQgJiYgdiAmJiBpLmxlbmd0aCA8IDY1NTM2ICYmIChpLmhlYWQubmFtZSArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKHYpKTsKCQkJCQkJfSB3aGlsZSAodiAmJiBjIDwgbyk7CgoJCQkJCQlpZiAoNTEyICYgaS5mbGFncyAmJiAoaS5jaGVjayA9IE0oaS5jaGVjaywgbiwgYywgcykpLCBvIC09IGMsIHMgKz0gYywgdikgYnJlYWsgdDsKCQkJCQl9IGVsc2UgaS5oZWFkICYmIChpLmhlYWQubmFtZSA9IG51bGwpOwoKCQkJCQlpLmxlbmd0aCA9IDAsIGkubW9kZSA9IDg7CgoJCQkJY2FzZSA4OgoJCQkJCWlmICg0MDk2ICYgaS5mbGFncykgewoJCQkJCQlpZiAoMCA9PT0gbykgYnJlYWsgdDsKCQkJCQkJYyA9IDA7CgoJCQkJCQlkbyB7CgkJCQkJCQl2ID0gbltzICsgYysrXSwgaS5oZWFkICYmIHYgJiYgaS5sZW5ndGggPCA2NTUzNiAmJiAoaS5oZWFkLmNvbW1lbnQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSh2KSk7CgkJCQkJCX0gd2hpbGUgKHYgJiYgYyA8IG8pOwoKCQkJCQkJaWYgKDUxMiAmIGkuZmxhZ3MgJiYgKGkuY2hlY2sgPSBNKGkuY2hlY2ssIG4sIGMsIHMpKSwgbyAtPSBjLCBzICs9IGMsIHYpIGJyZWFrIHQ7CgkJCQkJfSBlbHNlIGkuaGVhZCAmJiAoaS5oZWFkLmNvbW1lbnQgPSBudWxsKTsKCgkJCQkJaS5tb2RlID0gOTsKCgkJCQljYXNlIDk6CgkJCQkJaWYgKDUxMiAmIGkuZmxhZ3MpIHsKCQkJCQkJZm9yICg7IGQgPCAxNjspIHsKCQkJCQkJCWlmICgwID09PSBvKSBicmVhayB0OwoJCQkJCQkJby0tLCBsICs9IG5bcysrXSA8PCBkLCBkICs9IDg7CgkJCQkJCX0KCgkJCQkJCWlmIChsICE9PSAoNjU1MzUgJiBpLmNoZWNrKSkgewoJCQkJCQkJdC5tc2cgPSAiaGVhZGVyIGNyYyBtaXNtYXRjaCIsIGkubW9kZSA9IHplOwoJCQkJCQkJYnJlYWs7CgkJCQkJCX0KCgkJCQkJCWwgPSAwLCBkID0gMDsKCQkJCQl9CgoJCQkJCWkuaGVhZCAmJiAoaS5oZWFkLmhjcmMgPSBpLmZsYWdzID4+IDkgJiAxLCBpLmhlYWQuZG9uZSA9ICEwKSwgdC5hZGxlciA9IGkuY2hlY2sgPSAwLCBpLm1vZGUgPSBVZTsKCQkJCQlicmVhazsKCgkJCQljYXNlIDEwOgoJCQkJCWZvciAoOyBkIDwgMzI7KSB7CgkJCQkJCWlmICgwID09PSBvKSBicmVhayB0OwoJCQkJCQlvLS0sIGwgKz0gbltzKytdIDw8IGQsIGQgKz0gODsKCQkJCQl9CgoJCQkJCXQuYWRsZXIgPSBpLmNoZWNrID0gUmUobCksIGwgPSAwLCBkID0gMCwgaS5tb2RlID0gMTE7CgoJCQkJY2FzZSAxMToKCQkJCQlpZiAoMCA9PT0gaS5oYXZlZGljdCkgcmV0dXJuIHQubmV4dF9vdXQgPSBhLCB0LmF2YWlsX291dCA9IGgsIHQubmV4dF9pbiA9IHMsIHQuYXZhaWxfaW4gPSBvLCBpLmhvbGQgPSBsLCBpLmJpdHMgPSBkLCBrZTsKCQkJCQl0LmFkbGVyID0gaS5jaGVjayA9IDEsIGkubW9kZSA9IFVlOwoKCQkJCWNhc2UgVWU6CgkJCQkJaWYgKGUgPT09IHBlIHx8IGUgPT09IGdlKSBicmVhayB0OwoKCQkJCWNhc2UgMTM6CgkJCQkJaWYgKGkubGFzdCkgewoJCQkJCQlsID4+Pj0gNyAmIGQsIGQgLT0gNyAmIGQsIGkubW9kZSA9IDI3OwoJCQkJCQlicmVhazsKCQkJCQl9CgoJCQkJCWZvciAoOyBkIDwgMzspIHsKCQkJCQkJaWYgKDAgPT09IG8pIGJyZWFrIHQ7CgkJCQkJCW8tLSwgbCArPSBuW3MrK10gPDwgZCwgZCArPSA4OwoJCQkJCX0KCgkJCQkJc3dpdGNoIChpLmxhc3QgPSAxICYgbCwgbCA+Pj49IDEsIGQgLT0gMSwgMyAmIGwpIHsKCQkJCQkJY2FzZSAwOgoJCQkJCQkJaS5tb2RlID0gMTQ7CgkJCQkJCQlicmVhazsKCgkJCQkJCWNhc2UgMToKCQkJCQkJCWlmIChTZShpKSwgaS5tb2RlID0gMjAsIGUgPT09IGdlKSB7CgkJCQkJCQkJbCA+Pj49IDIsIGQgLT0gMjsKCQkJCQkJCQlicmVhayB0OwoJCQkJCQkJfQoKCQkJCQkJCWJyZWFrOwoKCQkJCQkJY2FzZSAyOgoJCQkJCQkJaS5tb2RlID0gMTc7CgkJCQkJCQlicmVhazsKCgkJCQkJCWNhc2UgMzoKCQkJCQkJCXQubXNnID0gImludmFsaWQgYmxvY2sgdHlwZSIsIGkubW9kZSA9IHplOwoJCQkJCX0KCgkJCQkJbCA+Pj49IDIsIGQgLT0gMjsKCQkJCQlicmVhazsKCgkJCQljYXNlIDE0OgoJCQkJCWZvciAobCA+Pj49IDcgJiBkLCBkIC09IDcgJiBkOyBkIDwgMzI7KSB7CgkJCQkJCWlmICgwID09PSBvKSBicmVhayB0OwoJCQkJCQlvLS0sIGwgKz0gbltzKytdIDw8IGQsIGQgKz0gODsKCQkJCQl9CgoJCQkJCWlmICgoNjU1MzUgJiBsKSAhPSAobCA+Pj4gMTYgXiA2NTUzNSkpIHsKCQkJCQkJdC5tc2cgPSAiaW52YWxpZCBzdG9yZWQgYmxvY2sgbGVuZ3RocyIsIGkubW9kZSA9IHplOwoJCQkJCQlicmVhazsKCQkJCQl9CgoJCQkJCWlmIChpLmxlbmd0aCA9IDY1NTM1ICYgbCwgbCA9IDAsIGQgPSAwLCBpLm1vZGUgPSAxNSwgZSA9PT0gZ2UpIGJyZWFrIHQ7CgoJCQkJY2FzZSAxNToKCQkJCQlpLm1vZGUgPSAxNjsKCgkJCQljYXNlIDE2OgoJCQkJCWlmIChjID0gaS5sZW5ndGgsIGMpIHsKCQkJCQkJaWYgKGMgPiBvICYmIChjID0gbyksIGMgPiBoICYmIChjID0gaCksIDAgPT09IGMpIGJyZWFrIHQ7CgkJCQkJCXIuc2V0KG4uc3ViYXJyYXkocywgcyArIGMpLCBhKSwgbyAtPSBjLCBzICs9IGMsIGggLT0gYywgYSArPSBjLCBpLmxlbmd0aCAtPSBjOwoJCQkJCQlicmVhazsKCQkJCQl9CgoJCQkJCWkubW9kZSA9IFVlOwoJCQkJCWJyZWFrOwoKCQkJCWNhc2UgMTc6CgkJCQkJZm9yICg7IGQgPCAxNDspIHsKCQkJCQkJaWYgKDAgPT09IG8pIGJyZWFrIHQ7CgkJCQkJCW8tLSwgbCArPSBuW3MrK10gPDwgZCwgZCArPSA4OwoJCQkJCX0KCgkJCQkJaWYgKGkubmxlbiA9IDI1NyArICgzMSAmIGwpLCBsID4+Pj0gNSwgZCAtPSA1LCBpLm5kaXN0ID0gMSArICgzMSAmIGwpLCBsID4+Pj0gNSwgZCAtPSA1LCBpLm5jb2RlID0gNCArICgxNSAmIGwpLCBsID4+Pj0gNCwgZCAtPSA0LCBpLm5sZW4gPiAyODYgfHwgaS5uZGlzdCA+IDMwKSB7CgkJCQkJCXQubXNnID0gInRvbyBtYW55IGxlbmd0aCBvciBkaXN0YW5jZSBzeW1ib2xzIiwgaS5tb2RlID0gemU7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCgkJCQkJaS5oYXZlID0gMCwgaS5tb2RlID0gMTg7CgoJCQkJY2FzZSAxODoKCQkJCQlmb3IgKDsgaS5oYXZlIDwgaS5uY29kZTspIHsKCQkJCQkJZm9yICg7IGQgPCAzOykgewoJCQkJCQkJaWYgKDAgPT09IG8pIGJyZWFrIHQ7CgkJCQkJCQlvLS0sIGwgKz0gbltzKytdIDw8IGQsIGQgKz0gODsKCQkJCQkJfQoKCQkJCQkJaS5sZW5zW1JbaS5oYXZlKytdXSA9IDcgJiBsLCBsID4+Pj0gMywgZCAtPSAzOwoJCQkJCX0KCgkJCQkJZm9yICg7IGkuaGF2ZSA8IDE5OykgaS5sZW5zW1JbaS5oYXZlKytdXSA9IDA7CgoJCQkJCWlmIChpLmxlbmNvZGUgPSBpLmxlbmR5biwgaS5sZW5iaXRzID0gNywgVSA9IHsKCQkJCQkJYml0czogaS5sZW5iaXRzCgkJCQkJfSwgRSA9IHVlKDAsIGkubGVucywgMCwgMTksIGkubGVuY29kZSwgMCwgaS53b3JrLCBVKSwgaS5sZW5iaXRzID0gVS5iaXRzLCBFKSB7CgkJCQkJCXQubXNnID0gImludmFsaWQgY29kZSBsZW5ndGhzIHNldCIsIGkubW9kZSA9IHplOwoJCQkJCQlicmVhazsKCQkJCQl9CgoJCQkJCWkuaGF2ZSA9IDAsIGkubW9kZSA9IDE5OwoKCQkJCWNhc2UgMTk6CgkJCQkJZm9yICg7IGkuaGF2ZSA8IGkubmxlbiArIGkubmRpc3Q7KSB7CgkJCQkJCWZvciAoOyBBID0gaS5sZW5jb2RlW2wgJiAoMSA8PCBpLmxlbmJpdHMpIC0gMV0sIHAgPSBBID4+PiAyNCwgZyA9IEEgPj4+IDE2ICYgMjU1LCBiID0gNjU1MzUgJiBBLCAhKHAgPD0gZCk7KSB7CgkJCQkJCQlpZiAoMCA9PT0gbykgYnJlYWsgdDsKCQkJCQkJCW8tLSwgbCArPSBuW3MrK10gPDwgZCwgZCArPSA4OwoJCQkJCQl9CgoJCQkJCQlpZiAoYiA8IDE2KSBsID4+Pj0gcCwgZCAtPSBwLCBpLmxlbnNbaS5oYXZlKytdID0gYjtlbHNlIHsKCQkJCQkJCWlmICgxNiA9PT0gYikgewoJCQkJCQkJCWZvciAoeiA9IHAgKyAyOyBkIDwgejspIHsKCQkJCQkJCQkJaWYgKDAgPT09IG8pIGJyZWFrIHQ7CgkJCQkJCQkJCW8tLSwgbCArPSBuW3MrK10gPDwgZCwgZCArPSA4OwoJCQkJCQkJCX0KCgkJCQkJCQkJaWYgKGwgPj4+PSBwLCBkIC09IHAsIDAgPT09IGkuaGF2ZSkgewoJCQkJCQkJCQl0Lm1zZyA9ICJpbnZhbGlkIGJpdCBsZW5ndGggcmVwZWF0IiwgaS5tb2RlID0gemU7CgkJCQkJCQkJCWJyZWFrOwoJCQkJCQkJCX0KCgkJCQkJCQkJdiA9IGkubGVuc1tpLmhhdmUgLSAxXSwgYyA9IDMgKyAoMyAmIGwpLCBsID4+Pj0gMiwgZCAtPSAyOwoJCQkJCQkJfSBlbHNlIGlmICgxNyA9PT0gYikgewoJCQkJCQkJCWZvciAoeiA9IHAgKyAzOyBkIDwgejspIHsKCQkJCQkJCQkJaWYgKDAgPT09IG8pIGJyZWFrIHQ7CgkJCQkJCQkJCW8tLSwgbCArPSBuW3MrK10gPDwgZCwgZCArPSA4OwoJCQkJCQkJCX0KCgkJCQkJCQkJbCA+Pj49IHAsIGQgLT0gcCwgdiA9IDAsIGMgPSAzICsgKDcgJiBsKSwgbCA+Pj49IDMsIGQgLT0gMzsKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJZm9yICh6ID0gcCArIDc7IGQgPCB6OykgewoJCQkJCQkJCQlpZiAoMCA9PT0gbykgYnJlYWsgdDsKCQkJCQkJCQkJby0tLCBsICs9IG5bcysrXSA8PCBkLCBkICs9IDg7CgkJCQkJCQkJfQoKCQkJCQkJCQlsID4+Pj0gcCwgZCAtPSBwLCB2ID0gMCwgYyA9IDExICsgKDEyNyAmIGwpLCBsID4+Pj0gNywgZCAtPSA3OwoJCQkJCQkJfQoKCQkJCQkJCWlmIChpLmhhdmUgKyBjID4gaS5ubGVuICsgaS5uZGlzdCkgewoJCQkJCQkJCXQubXNnID0gImludmFsaWQgYml0IGxlbmd0aCByZXBlYXQiLCBpLm1vZGUgPSB6ZTsKCQkJCQkJCQlicmVhazsKCQkJCQkJCX0KCgkJCQkJCQlmb3IgKDsgYy0tOykgaS5sZW5zW2kuaGF2ZSsrXSA9IHY7CgkJCQkJCX0KCQkJCQl9CgoJCQkJCWlmIChpLm1vZGUgPT09IHplKSBicmVhazsKCgkJCQkJaWYgKDAgPT09IGkubGVuc1syNTZdKSB7CgkJCQkJCXQubXNnID0gImludmFsaWQgY29kZSAtLSBtaXNzaW5nIGVuZC1vZi1ibG9jayIsIGkubW9kZSA9IHplOwoJCQkJCQlicmVhazsKCQkJCQl9CgoJCQkJCWlmIChpLmxlbmJpdHMgPSA5LCBVID0gewoJCQkJCQliaXRzOiBpLmxlbmJpdHMKCQkJCQl9LCBFID0gdWUoMSwgaS5sZW5zLCAwLCBpLm5sZW4sIGkubGVuY29kZSwgMCwgaS53b3JrLCBVKSwgaS5sZW5iaXRzID0gVS5iaXRzLCBFKSB7CgkJCQkJCXQubXNnID0gImludmFsaWQgbGl0ZXJhbC9sZW5ndGhzIHNldCIsIGkubW9kZSA9IHplOwoJCQkJCQlicmVhazsKCQkJCQl9CgoJCQkJCWlmIChpLmRpc3RiaXRzID0gNiwgaS5kaXN0Y29kZSA9IGkuZGlzdGR5biwgVSA9IHsKCQkJCQkJYml0czogaS5kaXN0Yml0cwoJCQkJCX0sIEUgPSB1ZSgyLCBpLmxlbnMsIGkubmxlbiwgaS5uZGlzdCwgaS5kaXN0Y29kZSwgMCwgaS53b3JrLCBVKSwgaS5kaXN0Yml0cyA9IFUuYml0cywgRSkgewoJCQkJCQl0Lm1zZyA9ICJpbnZhbGlkIGRpc3RhbmNlcyBzZXQiLCBpLm1vZGUgPSB6ZTsKCQkJCQkJYnJlYWs7CgkJCQkJfQoKCQkJCQlpZiAoaS5tb2RlID0gMjAsIGUgPT09IGdlKSBicmVhayB0OwoKCQkJCWNhc2UgMjA6CgkJCQkJaS5tb2RlID0gMjE7CgoJCQkJY2FzZSAyMToKCQkJCQlpZiAobyA+PSA2ICYmIGggPj0gMjU4KSB7CgkJCQkJCXQubmV4dF9vdXQgPSBhLCB0LmF2YWlsX291dCA9IGgsIHQubmV4dF9pbiA9IHMsIHQuYXZhaWxfaW4gPSBvLCBpLmhvbGQgPSBsLCBpLmJpdHMgPSBkLCBsZSh0LCBmKSwgYSA9IHQubmV4dF9vdXQsIHIgPSB0Lm91dHB1dCwgaCA9IHQuYXZhaWxfb3V0LCBzID0gdC5uZXh0X2luLCBuID0gdC5pbnB1dCwgbyA9IHQuYXZhaWxfaW4sIGwgPSBpLmhvbGQsIGQgPSBpLmJpdHMsIGkubW9kZSA9PT0gVWUgJiYgKGkuYmFjayA9IC0xKTsKCQkJCQkJYnJlYWs7CgkJCQkJfQoKCQkJCQlmb3IgKGkuYmFjayA9IDA7IEEgPSBpLmxlbmNvZGVbbCAmICgxIDw8IGkubGVuYml0cykgLSAxXSwgcCA9IEEgPj4+IDI0LCBnID0gQSA+Pj4gMTYgJiAyNTUsIGIgPSA2NTUzNSAmIEEsICEocCA8PSBkKTspIHsKCQkJCQkJaWYgKDAgPT09IG8pIGJyZWFrIHQ7CgkJCQkJCW8tLSwgbCArPSBuW3MrK10gPDwgZCwgZCArPSA4OwoJCQkJCX0KCgkJCQkJaWYgKGcgJiYgMCA9PSAoMjQwICYgZykpIHsKCQkJCQkJZm9yIChtID0gcCwgayA9IGcsIHkgPSBiOyBBID0gaS5sZW5jb2RlW3kgKyAoKGwgJiAoMSA8PCBtICsgaykgLSAxKSA+PiBtKV0sIHAgPSBBID4+PiAyNCwgZyA9IEEgPj4+IDE2ICYgMjU1LCBiID0gNjU1MzUgJiBBLCAhKG0gKyBwIDw9IGQpOykgewoJCQkJCQkJaWYgKDAgPT09IG8pIGJyZWFrIHQ7CgkJCQkJCQlvLS0sIGwgKz0gbltzKytdIDw8IGQsIGQgKz0gODsKCQkJCQkJfQoKCQkJCQkJbCA+Pj49IG0sIGQgLT0gbSwgaS5iYWNrICs9IG07CgkJCQkJfQoKCQkJCQlpZiAobCA+Pj49IHAsIGQgLT0gcCwgaS5iYWNrICs9IHAsIGkubGVuZ3RoID0gYiwgMCA9PT0gZykgewoJCQkJCQlpLm1vZGUgPSAyNjsKCQkJCQkJYnJlYWs7CgkJCQkJfQoKCQkJCQlpZiAoMzIgJiBnKSB7CgkJCQkJCWkuYmFjayA9IC0xLCBpLm1vZGUgPSBVZTsKCQkJCQkJYnJlYWs7CgkJCQkJfQoKCQkJCQlpZiAoNjQgJiBnKSB7CgkJCQkJCXQubXNnID0gImludmFsaWQgbGl0ZXJhbC9sZW5ndGggY29kZSIsIGkubW9kZSA9IHplOwoJCQkJCQlicmVhazsKCQkJCQl9CgoJCQkJCWkuZXh0cmEgPSAxNSAmIGcsIGkubW9kZSA9IDIyOwoKCQkJCWNhc2UgMjI6CgkJCQkJaWYgKGkuZXh0cmEpIHsKCQkJCQkJZm9yICh6ID0gaS5leHRyYTsgZCA8IHo7KSB7CgkJCQkJCQlpZiAoMCA9PT0gbykgYnJlYWsgdDsKCQkJCQkJCW8tLSwgbCArPSBuW3MrK10gPDwgZCwgZCArPSA4OwoJCQkJCQl9CgoJCQkJCQlpLmxlbmd0aCArPSBsICYgKDEgPDwgaS5leHRyYSkgLSAxLCBsID4+Pj0gaS5leHRyYSwgZCAtPSBpLmV4dHJhLCBpLmJhY2sgKz0gaS5leHRyYTsKCQkJCQl9CgoJCQkJCWkud2FzID0gaS5sZW5ndGgsIGkubW9kZSA9IDIzOwoKCQkJCWNhc2UgMjM6CgkJCQkJZm9yICg7IEEgPSBpLmRpc3Rjb2RlW2wgJiAoMSA8PCBpLmRpc3RiaXRzKSAtIDFdLCBwID0gQSA+Pj4gMjQsIGcgPSBBID4+PiAxNiAmIDI1NSwgYiA9IDY1NTM1ICYgQSwgIShwIDw9IGQpOykgewoJCQkJCQlpZiAoMCA9PT0gbykgYnJlYWsgdDsKCQkJCQkJby0tLCBsICs9IG5bcysrXSA8PCBkLCBkICs9IDg7CgkJCQkJfQoKCQkJCQlpZiAoMCA9PSAoMjQwICYgZykpIHsKCQkJCQkJZm9yIChtID0gcCwgayA9IGcsIHkgPSBiOyBBID0gaS5kaXN0Y29kZVt5ICsgKChsICYgKDEgPDwgbSArIGspIC0gMSkgPj4gbSldLCBwID0gQSA+Pj4gMjQsIGcgPSBBID4+PiAxNiAmIDI1NSwgYiA9IDY1NTM1ICYgQSwgIShtICsgcCA8PSBkKTspIHsKCQkJCQkJCWlmICgwID09PSBvKSBicmVhayB0OwoJCQkJCQkJby0tLCBsICs9IG5bcysrXSA8PCBkLCBkICs9IDg7CgkJCQkJCX0KCgkJCQkJCWwgPj4+PSBtLCBkIC09IG0sIGkuYmFjayArPSBtOwoJCQkJCX0KCgkJCQkJaWYgKGwgPj4+PSBwLCBkIC09IHAsIGkuYmFjayArPSBwLCA2NCAmIGcpIHsKCQkJCQkJdC5tc2cgPSAiaW52YWxpZCBkaXN0YW5jZSBjb2RlIiwgaS5tb2RlID0gemU7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCgkJCQkJaS5vZmZzZXQgPSBiLCBpLmV4dHJhID0gMTUgJiBnLCBpLm1vZGUgPSAyNDsKCgkJCQljYXNlIDI0OgoJCQkJCWlmIChpLmV4dHJhKSB7CgkJCQkJCWZvciAoeiA9IGkuZXh0cmE7IGQgPCB6OykgewoJCQkJCQkJaWYgKDAgPT09IG8pIGJyZWFrIHQ7CgkJCQkJCQlvLS0sIGwgKz0gbltzKytdIDw8IGQsIGQgKz0gODsKCQkJCQkJfQoKCQkJCQkJaS5vZmZzZXQgKz0gbCAmICgxIDw8IGkuZXh0cmEpIC0gMSwgbCA+Pj49IGkuZXh0cmEsIGQgLT0gaS5leHRyYSwgaS5iYWNrICs9IGkuZXh0cmE7CgkJCQkJfQoKCQkJCQlpZiAoaS5vZmZzZXQgPiBpLmRtYXgpIHsKCQkJCQkJdC5tc2cgPSAiaW52YWxpZCBkaXN0YW5jZSB0b28gZmFyIGJhY2siLCBpLm1vZGUgPSB6ZTsKCQkJCQkJYnJlYWs7CgkJCQkJfQoKCQkJCQlpLm1vZGUgPSAyNTsKCgkJCQljYXNlIDI1OgoJCQkJCWlmICgwID09PSBoKSBicmVhayB0OwoKCQkJCQlpZiAoYyA9IGYgLSBoLCBpLm9mZnNldCA+IGMpIHsKCQkJCQkJaWYgKGMgPSBpLm9mZnNldCAtIGMsIGMgPiBpLndoYXZlICYmIGkuc2FuZSkgewoJCQkJCQkJdC5tc2cgPSAiaW52YWxpZCBkaXN0YW5jZSB0b28gZmFyIGJhY2siLCBpLm1vZGUgPSB6ZTsKCQkJCQkJCWJyZWFrOwoJCQkJCQl9CgoJCQkJCQljID4gaS53bmV4dCA/IChjIC09IGkud25leHQsIHUgPSBpLndzaXplIC0gYykgOiB1ID0gaS53bmV4dCAtIGMsIGMgPiBpLmxlbmd0aCAmJiAoYyA9IGkubGVuZ3RoKSwgdyA9IGkud2luZG93OwoJCQkJCX0gZWxzZSB3ID0gciwgdSA9IGEgLSBpLm9mZnNldCwgYyA9IGkubGVuZ3RoOwoKCQkJCQljID4gaCAmJiAoYyA9IGgpLCBoIC09IGMsIGkubGVuZ3RoIC09IGM7CgoJCQkJCWRvIHsKCQkJCQkJclthKytdID0gd1t1KytdOwoJCQkJCX0gd2hpbGUgKC0tYyk7CgoJCQkJCTAgPT09IGkubGVuZ3RoICYmIChpLm1vZGUgPSAyMSk7CgkJCQkJYnJlYWs7CgoJCQkJY2FzZSAyNjoKCQkJCQlpZiAoMCA9PT0gaCkgYnJlYWsgdDsKCQkJCQlyW2ErK10gPSBpLmxlbmd0aCwgaC0tLCBpLm1vZGUgPSAyMTsKCQkJCQlicmVhazsKCgkJCQljYXNlIDI3OgoJCQkJCWlmIChpLndyYXApIHsKCQkJCQkJZm9yICg7IGQgPCAzMjspIHsKCQkJCQkJCWlmICgwID09PSBvKSBicmVhayB0OwoJCQkJCQkJby0tLCBsIHw9IG5bcysrXSA8PCBkLCBkICs9IDg7CgkJCQkJCX0KCgkJCQkJCWlmIChmIC09IGgsIHQudG90YWxfb3V0ICs9IGYsIGkudG90YWwgKz0gZiwgZiAmJiAodC5hZGxlciA9IGkuY2hlY2sgPSBpLmZsYWdzID8gTShpLmNoZWNrLCByLCBmLCBhIC0gZikgOiBaKGkuY2hlY2ssIHIsIGYsIGEgLSBmKSksIGYgPSBoLCAoaS5mbGFncyA/IGwgOiBSZShsKSkgIT09IGkuY2hlY2spIHsKCQkJCQkJCXQubXNnID0gImluY29ycmVjdCBkYXRhIGNoZWNrIiwgaS5tb2RlID0gemU7CgkJCQkJCQlicmVhazsKCQkJCQkJfQoKCQkJCQkJbCA9IDAsIGQgPSAwOwoJCQkJCX0KCgkJCQkJaS5tb2RlID0gMjg7CgoJCQkJY2FzZSAyODoKCQkJCQlpZiAoaS53cmFwICYmIGkuZmxhZ3MpIHsKCQkJCQkJZm9yICg7IGQgPCAzMjspIHsKCQkJCQkJCWlmICgwID09PSBvKSBicmVhayB0OwoJCQkJCQkJby0tLCBsICs9IG5bcysrXSA8PCBkLCBkICs9IDg7CgkJCQkJCX0KCgkJCQkJCWlmIChsICE9PSAoNDI5NDk2NzI5NSAmIGkudG90YWwpKSB7CgkJCQkJCQl0Lm1zZyA9ICJpbmNvcnJlY3QgbGVuZ3RoIGNoZWNrIiwgaS5tb2RlID0gemU7CgkJCQkJCQlicmVhazsKCQkJCQkJfQoKCQkJCQkJbCA9IDAsIGQgPSAwOwoJCQkJCX0KCgkJCQkJaS5tb2RlID0gMjk7CgoJCQkJY2FzZSAyOToKCQkJCQlFID0gbWU7CgkJCQkJYnJlYWsgdDsKCgkJCQljYXNlIHplOgoJCQkJCUUgPSB2ZTsKCQkJCQlicmVhayB0OwoKCQkJCWNhc2UgMzE6CgkJCQkJcmV0dXJuIEVlOwoKCQkJCWRlZmF1bHQ6CgkJCQkJcmV0dXJuIHllOwoJCQl9CgoJCQlyZXR1cm4gdC5uZXh0X291dCA9IGEsIHQuYXZhaWxfb3V0ID0gaCwgdC5uZXh0X2luID0gcywgdC5hdmFpbF9pbiA9IG8sIGkuaG9sZCA9IGwsIGkuYml0cyA9IGQsIChpLndzaXplIHx8IGYgIT09IHQuYXZhaWxfb3V0ICYmIGkubW9kZSA8IHplICYmIChpLm1vZGUgPCAyNyB8fCBlICE9PSB3ZSkpICYmIFplKHQsIHQub3V0cHV0LCB0Lm5leHRfb3V0LCBmIC0gdC5hdmFpbF9vdXQpLCBfIC09IHQuYXZhaWxfaW4sIGYgLT0gdC5hdmFpbF9vdXQsIHQudG90YWxfaW4gKz0gXywgdC50b3RhbF9vdXQgKz0gZiwgaS50b3RhbCArPSBmLCBpLndyYXAgJiYgZiAmJiAodC5hZGxlciA9IGkuY2hlY2sgPSBpLmZsYWdzID8gTShpLmNoZWNrLCByLCBmLCB0Lm5leHRfb3V0IC0gZikgOiBaKGkuY2hlY2ssIHIsIGYsIHQubmV4dF9vdXQgLSBmKSksIHQuZGF0YV90eXBlID0gaS5iaXRzICsgKGkubGFzdCA/IDY0IDogMCkgKyAoaS5tb2RlID09PSBVZSA/IDEyOCA6IDApICsgKDIwID09PSBpLm1vZGUgfHwgMTUgPT09IGkubW9kZSA/IDI1NiA6IDApLCAoMCA9PT0gXyAmJiAwID09PSBmIHx8IGUgPT09IHdlKSAmJiBFID09PSBiZSAmJiAoRSA9IEFlKSwgRTsKCQl9LAoJCQkJSGUgPSB0ID0+IHsKCQkJaWYgKCF0IHx8ICF0LnN0YXRlKSByZXR1cm4geWU7CgkJCWxldCBlID0gdC5zdGF0ZTsKCQkJcmV0dXJuIGUud2luZG93ICYmIChlLndpbmRvdyA9IG51bGwpLCB0LnN0YXRlID0gbnVsbCwgYmU7CgkJfSwKCQkJCVdlID0gKHQsIGUpID0+IHsKCQkJaWYgKCF0IHx8ICF0LnN0YXRlKSByZXR1cm4geWU7CgkJCWNvbnN0IGkgPSB0LnN0YXRlOwoJCQlyZXR1cm4gMCA9PSAoMiAmIGkud3JhcCkgPyB5ZSA6IChpLmhlYWQgPSBlLCBlLmRvbmUgPSAhMSwgYmUpOwoJCX0sCgkJCQlLZSA9ICh0LCBlKSA9PiB7CgkJCWNvbnN0IGkgPSBlLmxlbmd0aDsKCQkJbGV0IG4sIHIsIHM7CgkJCXJldHVybiB0ICYmIHQuc3RhdGUgPyAobiA9IHQuc3RhdGUsIDAgIT09IG4ud3JhcCAmJiAxMSAhPT0gbi5tb2RlID8geWUgOiAxMSA9PT0gbi5tb2RlICYmIChyID0gMSwgciA9IFoociwgZSwgaSwgMCksIHIgIT09IG4uY2hlY2spID8gdmUgOiAocyA9IFplKHQsIGUsIGksIGkpLCBzID8gKG4ubW9kZSA9IDMxLCBFZSkgOiAobi5oYXZlZGljdCA9IDEsIGJlKSkpIDogeWU7CgkJfSwKCQkJCSRlID0gZnVuY3Rpb24gJGUoKSB7CgkJCXRoaXMudGV4dCA9IDAsIHRoaXMudGltZSA9IDAsIHRoaXMueGZsYWdzID0gMCwgdGhpcy5vcyA9IDAsIHRoaXMuZXh0cmEgPSBudWxsLCB0aGlzLmV4dHJhX2xlbiA9IDAsIHRoaXMubmFtZSA9ICIiLCB0aGlzLmNvbW1lbnQgPSAiIiwgdGhpcy5oY3JjID0gMCwgdGhpcy5kb25lID0gITE7CgkJfTsKCgkJY29uc3QgWWUgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLAoJCQkJCXsKCQkJWl9OT19GTFVTSDogamUsCgkJCVpfRklOSVNIOiBHZSwKCQkJWl9PSzogWGUsCgkJCVpfU1RSRUFNX0VORDogVmUsCgkJCVpfTkVFRF9ESUNUOiBxZSwKCQkJWl9TVFJFQU1fRVJST1I6IEplLAoJCQlaX0RBVEFfRVJST1I6IFFlLAoJCQlaX01FTV9FUlJPUjogdGkKCQl9ID0gSDsKCgkJZnVuY3Rpb24gZWkodCkgewoJCQl0aGlzLm9wdGlvbnMgPSBIdCh7CgkJCQljaHVua1NpemU6IDY1NTM2LAoJCQkJd2luZG93Qml0czogMTUsCgkJCQl0bzogIiIKCQkJfSwgdCB8fCB7fSk7CgkJCWNvbnN0IGUgPSB0aGlzLm9wdGlvbnM7CgkJCWUucmF3ICYmIGUud2luZG93Qml0cyA+PSAwICYmIGUud2luZG93Qml0cyA8IDE2ICYmIChlLndpbmRvd0JpdHMgPSAtZS53aW5kb3dCaXRzLCAwID09PSBlLndpbmRvd0JpdHMgJiYgKGUud2luZG93Qml0cyA9IC0xNSkpLCAhKGUud2luZG93Qml0cyA+PSAwICYmIGUud2luZG93Qml0cyA8IDE2KSB8fCB0ICYmIHQud2luZG93Qml0cyB8fCAoZS53aW5kb3dCaXRzICs9IDMyKSwgZS53aW5kb3dCaXRzID4gMTUgJiYgZS53aW5kb3dCaXRzIDwgNDggJiYgMCA9PSAoMTUgJiBlLndpbmRvd0JpdHMpICYmIChlLndpbmRvd0JpdHMgfD0gMTUpLCB0aGlzLmVyciA9IDAsIHRoaXMubXNnID0gIiIsIHRoaXMuZW5kZWQgPSAhMSwgdGhpcy5jaHVua3MgPSBbXSwgdGhpcy5zdHJtID0gbmV3IFh0KCksIHRoaXMuc3RybS5hdmFpbF9vdXQgPSAwOwoJCQlsZXQgaSA9IE1lKHRoaXMuc3RybSwgZS53aW5kb3dCaXRzKTsKCQkJaWYgKGkgIT09IFhlKSB0aHJvdyBuZXcgRXJyb3IoUFtpXSk7CgkJCWlmICh0aGlzLmhlYWRlciA9IG5ldyAkZSgpLCBXZSh0aGlzLnN0cm0sIHRoaXMuaGVhZGVyKSwgZS5kaWN0aW9uYXJ5ICYmICgic3RyaW5nIiA9PSB0eXBlb2YgZS5kaWN0aW9uYXJ5ID8gZS5kaWN0aW9uYXJ5ID0gWXQoZS5kaWN0aW9uYXJ5KSA6ICJbb2JqZWN0IEFycmF5QnVmZmVyXSIgPT09IFllLmNhbGwoZS5kaWN0aW9uYXJ5KSAmJiAoZS5kaWN0aW9uYXJ5ID0gbmV3IFVpbnQ4QXJyYXkoZS5kaWN0aW9uYXJ5KSksIGUucmF3ICYmIChpID0gS2UodGhpcy5zdHJtLCBlLmRpY3Rpb25hcnkpLCBpICE9PSBYZSkpKSB0aHJvdyBuZXcgRXJyb3IoUFtpXSk7CgkJfQoKCQlmdW5jdGlvbiBpaSh0LCBlKSB7CgkJCWNvbnN0IGkgPSBuZXcgZWkoZSk7CgkJCWlmIChpLnB1c2godCksIGkuZXJyKSB0aHJvdyBpLm1zZyB8fCBQW2kuZXJyXTsKCQkJcmV0dXJuIGkucmVzdWx0OwoJCX0KCgkJZWkucHJvdG90eXBlLnB1c2ggPSBmdW5jdGlvbiAodCwgZSkgewoJCQljb25zdCBpID0gdGhpcy5zdHJtLAoJCQkJCQluID0gdGhpcy5vcHRpb25zLmNodW5rU2l6ZSwKCQkJCQkJciA9IHRoaXMub3B0aW9ucy5kaWN0aW9uYXJ5OwoJCQlsZXQgcywgYSwgbzsKCQkJaWYgKHRoaXMuZW5kZWQpIHJldHVybiAhMTsKCgkJCWZvciAoYSA9IGUgPT09IH5+ZSA/IGUgOiAhMCA9PT0gZSA/IEdlIDogamUsICJbb2JqZWN0IEFycmF5QnVmZmVyXSIgPT09IFllLmNhbGwodCkgPyBpLmlucHV0ID0gbmV3IFVpbnQ4QXJyYXkodCkgOiBpLmlucHV0ID0gdCwgaS5uZXh0X2luID0gMCwgaS5hdmFpbF9pbiA9IGkuaW5wdXQubGVuZ3RoOzspIHsKCQkJCWZvciAoMCA9PT0gaS5hdmFpbF9vdXQgJiYgKGkub3V0cHV0ID0gbmV3IFVpbnQ4QXJyYXkobiksIGkubmV4dF9vdXQgPSAwLCBpLmF2YWlsX291dCA9IG4pLCBzID0gUGUoaSwgYSksIHMgPT09IHFlICYmIHIgJiYgKHMgPSBLZShpLCByKSwgcyA9PT0gWGUgPyBzID0gUGUoaSwgYSkgOiBzID09PSBRZSAmJiAocyA9IHFlKSk7IGkuYXZhaWxfaW4gPiAwICYmIHMgPT09IFZlICYmIGkuc3RhdGUud3JhcCA+IDAgJiYgMCAhPT0gdFtpLm5leHRfaW5dOykgRmUoaSksIHMgPSBQZShpLCBhKTsKCgkJCQlzd2l0Y2ggKHMpIHsKCQkJCQljYXNlIEplOgoJCQkJCWNhc2UgUWU6CgkJCQkJY2FzZSBxZToKCQkJCQljYXNlIHRpOgoJCQkJCQlyZXR1cm4gdGhpcy5vbkVuZChzKSwgdGhpcy5lbmRlZCA9ICEwLCAhMTsKCQkJCX0KCgkJCQlpZiAobyA9IGkuYXZhaWxfb3V0LCBpLm5leHRfb3V0ICYmICgwID09PSBpLmF2YWlsX291dCB8fCBzID09PSBWZSkpIGlmICgic3RyaW5nIiA9PT0gdGhpcy5vcHRpb25zLnRvKSB7CgkJCQkJbGV0IHQgPSBHdChpLm91dHB1dCwgaS5uZXh0X291dCksCgkJCQkJCQllID0gaS5uZXh0X291dCAtIHQsCgkJCQkJCQlyID0ganQoaS5vdXRwdXQsIHQpOwoJCQkJCWkubmV4dF9vdXQgPSBlLCBpLmF2YWlsX291dCA9IG4gLSBlLCBlICYmIGkub3V0cHV0LnNldChpLm91dHB1dC5zdWJhcnJheSh0LCB0ICsgZSksIDApLCB0aGlzLm9uRGF0YShyKTsKCQkJCX0gZWxzZSB0aGlzLm9uRGF0YShpLm91dHB1dC5sZW5ndGggPT09IGkubmV4dF9vdXQgPyBpLm91dHB1dCA6IGkub3V0cHV0LnN1YmFycmF5KDAsIGkubmV4dF9vdXQpKTsKCgkJCQlpZiAocyAhPT0gWGUgfHwgMCAhPT0gbykgewoJCQkJCWlmIChzID09PSBWZSkgcmV0dXJuIHMgPSBIZSh0aGlzLnN0cm0pLCB0aGlzLm9uRW5kKHMpLCB0aGlzLmVuZGVkID0gITAsICEwOwoJCQkJCWlmICgwID09PSBpLmF2YWlsX2luKSBicmVhazsKCQkJCX0KCQkJfQoKCQkJcmV0dXJuICEwOwoJCX0sIGVpLnByb3RvdHlwZS5vbkRhdGEgPSBmdW5jdGlvbiAodCkgewoJCQl0aGlzLmNodW5rcy5wdXNoKHQpOwoJCX0sIGVpLnByb3RvdHlwZS5vbkVuZCA9IGZ1bmN0aW9uICh0KSB7CgkJCXQgPT09IFhlICYmICgic3RyaW5nIiA9PT0gdGhpcy5vcHRpb25zLnRvID8gdGhpcy5yZXN1bHQgPSB0aGlzLmNodW5rcy5qb2luKCIiKSA6IHRoaXMucmVzdWx0ID0gV3QodGhpcy5jaHVua3MpKSwgdGhpcy5jaHVua3MgPSBbXSwgdGhpcy5lcnIgPSB0LCB0aGlzLm1zZyA9IHRoaXMuc3RybS5tc2c7CgkJfTsKCQl2YXIgbmkgPSB7CgkJCUluZmxhdGU6IGVpLAoJCQlpbmZsYXRlOiBpaSwKCQkJaW5mbGF0ZVJhdzogZnVuY3Rpb24gaW5mbGF0ZVJhdyh0LCBlKSB7CgkJCQlyZXR1cm4gKGUgPSBlIHx8IHt9KS5yYXcgPSAhMCwgaWkodCwgZSk7CgkJCX0sCgkJCXVuZ3ppcDogaWksCgkJCWNvbnN0YW50czogSAoJCX07CgkJY29uc3QgewoJCQlEZWZsYXRlOiByaSwKCQkJZGVmbGF0ZTogc2ksCgkJCWRlZmxhdGVSYXc6IGFpLAoJCQlnemlwOiBvaQoJCX0gPSBoZSwKCQkJCQl7CgkJCUluZmxhdGU6IGhpLAoJCQlpbmZsYXRlOiBsaSwKCQkJaW5mbGF0ZVJhdzogZGksCgkJCXVuZ3ppcDogX2kKCQl9ID0gbmk7CgkJdmFyIGZpID0gc2ksCgkJCQljaSA9IGhpLAoJCQkJdWkgPSBsaTsKCQljb25zdCB3aSA9IFsxMzcsIDgwLCA3OCwgNzEsIDEzLCAxMCwgMjYsIDEwXSwKCQkJCQlwaSA9IFtdOwoKCQlmb3IgKGxldCB0ID0gMDsgdCA8IDI1NjsgdCsrKSB7CgkJCWxldCBlID0gdDsKCgkJCWZvciAobGV0IHQgPSAwOyB0IDwgODsgdCsrKSAxICYgZSA/IGUgPSAzOTg4MjkyMzg0IF4gZSA+Pj4gMSA6IGUgPj4+PSAxOwoKCQkJcGlbdF0gPSBlOwoJCX0KCgkJY29uc3QgZ2kgPSA0Mjk0OTY3Mjk1OwoKCQlmdW5jdGlvbiBiaSh0LCBlKSB7CgkJCXJldHVybiAoZnVuY3Rpb24gKHQsIGUsIGkpIHsKCQkJCWxldCBuID0gNDI5NDk2NzI5NTsKCgkJCQlmb3IgKGxldCB0ID0gMDsgdCA8IGk7IHQrKykgbiA9IHBpWzI1NSAmIChuIF4gZVt0XSldIF4gbiA+Pj4gODsKCgkJCQlyZXR1cm4gbjsKCQkJfSgwLCB0LCBlKSBeIGdpKSA+Pj4gMDsKCQl9CgoJCXZhciBtaSwga2ksIHlpLCB2aTsKCQkhZnVuY3Rpb24gKHQpIHsKCQkJdFt0LlVOS05PV04gPSAtMV0gPSAiVU5LTk9XTiIsIHRbdC5HUkVZU0NBTEUgPSAwXSA9ICJHUkVZU0NBTEUiLCB0W3QuVFJVRUNPTE9VUiA9IDJdID0gIlRSVUVDT0xPVVIiLCB0W3QuSU5ERVhFRF9DT0xPVVIgPSAzXSA9ICJJTkRFWEVEX0NPTE9VUiIsIHRbdC5HUkVZU0NBTEVfQUxQSEEgPSA0XSA9ICJHUkVZU0NBTEVfQUxQSEEiLCB0W3QuVFJVRUNPTE9VUl9BTFBIQSA9IDZdID0gIlRSVUVDT0xPVVJfQUxQSEEiOwoJCX0obWkgfHwgKG1pID0ge30pKSwgZnVuY3Rpb24gKHQpIHsKCQkJdFt0LlVOS05PV04gPSAtMV0gPSAiVU5LTk9XTiIsIHRbdC5ERUZMQVRFID0gMF0gPSAiREVGTEFURSI7CgkJfShraSB8fCAoa2kgPSB7fSkpLCBmdW5jdGlvbiAodCkgewoJCQl0W3QuVU5LTk9XTiA9IC0xXSA9ICJVTktOT1dOIiwgdFt0LkFEQVBUSVZFID0gMF0gPSAiQURBUFRJVkUiOwoJCX0oeWkgfHwgKHlpID0ge30pKSwgZnVuY3Rpb24gKHQpIHsKCQkJdFt0LlVOS05PV04gPSAtMV0gPSAiVU5LTk9XTiIsIHRbdC5OT19JTlRFUkxBQ0UgPSAwXSA9ICJOT19JTlRFUkxBQ0UiLCB0W3QuQURBTTcgPSAxXSA9ICJBREFNNyI7CgkJfSh2aSB8fCAodmkgPSB7fSkpOwoJCWNvbnN0IEVpID0gbmV3IFVpbnQ4QXJyYXkoMCksCgkJCQkJQWkgPSBuZXcgVWludDE2QXJyYXkoWzI1NV0pLAoJCQkJCXhpID0gMjU1ID09PSBuZXcgVWludDhBcnJheShBaS5idWZmZXIpWzBdOwoKCQljbGFzcyBVaSBleHRlbmRzIHIgewoJCQljb25zdHJ1Y3Rvcih0KSB7CgkJCQlsZXQgZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDoge307CgkJCQlzdXBlcih0KTsKCQkJCWNvbnN0IHsKCQkJCQljaGVja0NyYzogaSA9ICExCgkJCQl9ID0gZTsKCQkJCXRoaXMuX2NoZWNrQ3JjID0gaSwgdGhpcy5faW5mbGF0b3IgPSBuZXcgY2koKSwgdGhpcy5fcG5nID0gewoJCQkJCXdpZHRoOiAtMSwKCQkJCQloZWlnaHQ6IC0xLAoJCQkJCWNoYW5uZWxzOiAtMSwKCQkJCQlkYXRhOiBuZXcgVWludDhBcnJheSgwKSwKCQkJCQlkZXB0aDogMSwKCQkJCQl0ZXh0OiB7fQoJCQkJfSwgdGhpcy5fZW5kID0gITEsIHRoaXMuX2hhc1BhbGV0dGUgPSAhMSwgdGhpcy5fcGFsZXR0ZSA9IFtdLCB0aGlzLl9jb21wcmVzc2lvbk1ldGhvZCA9IGtpLlVOS05PV04sIHRoaXMuX2ZpbHRlck1ldGhvZCA9IHlpLlVOS05PV04sIHRoaXMuX2ludGVybGFjZU1ldGhvZCA9IHZpLlVOS05PV04sIHRoaXMuX2NvbG9yVHlwZSA9IC0xLCB0aGlzLnNldEJpZ0VuZGlhbigpOwoJCQl9CgoJCQlkZWNvZGUoKSB7CgkJCQlmb3IgKHRoaXMuZGVjb2RlU2lnbmF0dXJlKCk7ICF0aGlzLl9lbmQ7KSB0aGlzLmRlY29kZUNodW5rKCk7CgoJCQkJcmV0dXJuIHRoaXMuZGVjb2RlSW1hZ2UoKSwgdGhpcy5fcG5nOwoJCQl9CgoJCQlkZWNvZGVTaWduYXR1cmUoKSB7CgkJCQlmb3IgKGxldCB0ID0gMDsgdCA8IHdpLmxlbmd0aDsgdCsrKSBpZiAodGhpcy5yZWFkVWludDgoKSAhPT0gd2lbdF0pIHRocm93IG5ldyBFcnJvcigid3JvbmcgUE5HIHNpZ25hdHVyZS4gQnl0ZSBhdCAiLmNvbmNhdCh0LCAiIHNob3VsZCBiZSAiKS5jb25jYXQod2lbdF0sICIuIikpOwoJCQl9CgoJCQlkZWNvZGVDaHVuaygpIHsKCQkJCWNvbnN0IHQgPSB0aGlzLnJlYWRVaW50MzIoKSwKCQkJCQkJCWUgPSB0aGlzLnJlYWRDaGFycyg0KSwKCQkJCQkJCWkgPSB0aGlzLm9mZnNldDsKCgkJCQlzd2l0Y2ggKGUpIHsKCQkJCQljYXNlICJJSERSIjoKCQkJCQkJdGhpcy5kZWNvZGVJSERSKCk7CgkJCQkJCWJyZWFrOwoKCQkJCQljYXNlICJQTFRFIjoKCQkJCQkJdGhpcy5kZWNvZGVQTFRFKHQpOwoJCQkJCQlicmVhazsKCgkJCQkJY2FzZSAiSURBVCI6CgkJCQkJCXRoaXMuZGVjb2RlSURBVCh0KTsKCQkJCQkJYnJlYWs7CgoJCQkJCWNhc2UgIklFTkQiOgoJCQkJCQl0aGlzLl9lbmQgPSAhMDsKCQkJCQkJYnJlYWs7CgoJCQkJCWNhc2UgInRSTlMiOgoJCQkJCQl0aGlzLmRlY29kZXRSTlModCk7CgkJCQkJCWJyZWFrOwoKCQkJCQljYXNlICJpQ0NQIjoKCQkJCQkJdGhpcy5kZWNvZGVpQ0NQKHQpOwoJCQkJCQlicmVhazsKCgkJCQkJY2FzZSAidEVYdCI6CgkJCQkJCXRoaXMuZGVjb2RldEVYdCh0KTsKCQkJCQkJYnJlYWs7CgoJCQkJCWNhc2UgInBIWXMiOgoJCQkJCQl0aGlzLmRlY29kZXBIWXMoKTsKCQkJCQkJYnJlYWs7CgoJCQkJCWRlZmF1bHQ6CgkJCQkJCXRoaXMuc2tpcCh0KTsKCQkJCX0KCgkJCQlpZiAodGhpcy5vZmZzZXQgLSBpICE9PSB0KSB0aHJvdyBuZXcgRXJyb3IoIkxlbmd0aCBtaXNtYXRjaCB3aGlsZSBkZWNvZGluZyBjaHVuayAiLmNvbmNhdChlKSk7CgoJCQkJaWYgKHRoaXMuX2NoZWNrQ3JjKSB7CgkJCQkJY29uc3QgaSA9IHRoaXMucmVhZFVpbnQzMigpLAoJCQkJCQkJCW4gPSB0ICsgNCwKCQkJCQkJCQlyID0gYmkobmV3IFVpbnQ4QXJyYXkodGhpcy5idWZmZXIsIHRoaXMuYnl0ZU9mZnNldCArIHRoaXMub2Zmc2V0IC0gbiAtIDQsIG4pLCBuKTsKCQkJCQlpZiAociAhPT0gaSkgdGhyb3cgbmV3IEVycm9yKCJDUkMgbWlzbWF0Y2ggZm9yIGNodW5rICIuY29uY2F0KGUsICIuIEV4cGVjdGVkICIpLmNvbmNhdChpLCAiLCBmb3VuZCAiKS5jb25jYXQocikpOwoJCQkJfSBlbHNlIHRoaXMuc2tpcCg0KTsKCQkJfQoKCQkJZGVjb2RlSUhEUigpIHsKCQkJCWNvbnN0IHQgPSB0aGlzLl9wbmc7CgkJCQl0LndpZHRoID0gdGhpcy5yZWFkVWludDMyKCksIHQuaGVpZ2h0ID0gdGhpcy5yZWFkVWludDMyKCksIHQuZGVwdGggPSBmdW5jdGlvbiAodCkgewoJCQkJCWlmICgxICE9PSB0ICYmIDIgIT09IHQgJiYgNCAhPT0gdCAmJiA4ICE9PSB0ICYmIDE2ICE9PSB0KSB0aHJvdyBuZXcgRXJyb3IoImludmFsaWQgYml0IGRlcHRoOiAiLmNvbmNhdCh0KSk7CgkJCQkJcmV0dXJuIHQ7CgkJCQl9KHRoaXMucmVhZFVpbnQ4KCkpOwoJCQkJY29uc3QgZSA9IHRoaXMucmVhZFVpbnQ4KCk7CgkJCQlsZXQgaTsKCgkJCQlzd2l0Y2ggKHRoaXMuX2NvbG9yVHlwZSA9IGUsIGUpIHsKCQkJCQljYXNlIG1pLkdSRVlTQ0FMRToKCQkJCQkJaSA9IDE7CgkJCQkJCWJyZWFrOwoKCQkJCQljYXNlIG1pLlRSVUVDT0xPVVI6CgkJCQkJCWkgPSAzOwoJCQkJCQlicmVhazsKCgkJCQkJY2FzZSBtaS5JTkRFWEVEX0NPTE9VUjoKCQkJCQkJaSA9IDE7CgkJCQkJCWJyZWFrOwoKCQkJCQljYXNlIG1pLkdSRVlTQ0FMRV9BTFBIQToKCQkJCQkJaSA9IDI7CgkJCQkJCWJyZWFrOwoKCQkJCQljYXNlIG1pLlRSVUVDT0xPVVJfQUxQSEE6CgkJCQkJCWkgPSA0OwoJCQkJCQlicmVhazsKCgkJCQkJZGVmYXVsdDoKCQkJCQkJdGhyb3cgbmV3IEVycm9yKCJVbmtub3duIGNvbG9yIHR5cGU6ICIuY29uY2F0KGUpKTsKCQkJCX0KCgkJCQlpZiAodGhpcy5fcG5nLmNoYW5uZWxzID0gaSwgdGhpcy5fY29tcHJlc3Npb25NZXRob2QgPSB0aGlzLnJlYWRVaW50OCgpLCB0aGlzLl9jb21wcmVzc2lvbk1ldGhvZCAhPT0ga2kuREVGTEFURSkgdGhyb3cgbmV3IEVycm9yKCJVbnN1cHBvcnRlZCBjb21wcmVzc2lvbiBtZXRob2Q6ICIuY29uY2F0KHRoaXMuX2NvbXByZXNzaW9uTWV0aG9kKSk7CgkJCQl0aGlzLl9maWx0ZXJNZXRob2QgPSB0aGlzLnJlYWRVaW50OCgpLCB0aGlzLl9pbnRlcmxhY2VNZXRob2QgPSB0aGlzLnJlYWRVaW50OCgpOwoJCQl9CgoJCQlkZWNvZGVQTFRFKHQpIHsKCQkJCWlmICh0ICUgMyAhPSAwKSB0aHJvdyBuZXcgUmFuZ2VFcnJvcigiUExURSBmaWVsZCBsZW5ndGggbXVzdCBiZSBhIG11bHRpcGxlIG9mIDMuIEdvdCAiLmNvbmNhdCh0KSk7CgkJCQljb25zdCBlID0gdCAvIDM7CgkJCQl0aGlzLl9oYXNQYWxldHRlID0gITA7CgkJCQljb25zdCBpID0gW107CgkJCQl0aGlzLl9wYWxldHRlID0gaTsKCgkJCQlmb3IgKGxldCB0ID0gMDsgdCA8IGU7IHQrKykgaS5wdXNoKFt0aGlzLnJlYWRVaW50OCgpLCB0aGlzLnJlYWRVaW50OCgpLCB0aGlzLnJlYWRVaW50OCgpXSk7CgkJCX0KCgkJCWRlY29kZUlEQVQodCkgewoJCQkJdGhpcy5faW5mbGF0b3IucHVzaChuZXcgVWludDhBcnJheSh0aGlzLmJ1ZmZlciwgdGhpcy5vZmZzZXQgKyB0aGlzLmJ5dGVPZmZzZXQsIHQpKSwgdGhpcy5za2lwKHQpOwoJCQl9CgoJCQlkZWNvZGV0Uk5TKHQpIHsKCQkJCWlmICgzID09PSB0aGlzLl9jb2xvclR5cGUpIHsKCQkJCQlpZiAodCA+IHRoaXMuX3BhbGV0dGUubGVuZ3RoKSB0aHJvdyBuZXcgRXJyb3IoInRSTlMgY2h1bmsgY29udGFpbnMgbW9yZSBhbHBoYSB2YWx1ZXMgdGhhbiB0aGVyZSBhcmUgcGFsZXR0ZSBjb2xvcnMgKCIuY29uY2F0KHQsICIgdnMgIikuY29uY2F0KHRoaXMuX3BhbGV0dGUubGVuZ3RoLCAiKSIpKTsKCQkJCQlsZXQgZSA9IDA7CgoJCQkJCWZvciAoOyBlIDwgdDsgZSsrKSB7CgkJCQkJCWNvbnN0IHQgPSB0aGlzLnJlYWRCeXRlKCk7CgoJCQkJCQl0aGlzLl9wYWxldHRlW2VdLnB1c2godCk7CgkJCQkJfQoKCQkJCQlmb3IgKDsgZSA8IHRoaXMuX3BhbGV0dGUubGVuZ3RoOyBlKyspIHRoaXMuX3BhbGV0dGVbZV0ucHVzaCgyNTUpOwoJCQkJfQoJCQl9CgoJCQlkZWNvZGVpQ0NQKHQpIHsKCQkJCWxldCBlLAoJCQkJCQlpID0gIiI7CgoJCQkJZm9yICg7ICJcMCIgIT09IChlID0gdGhpcy5yZWFkQ2hhcigpKTspIGkgKz0gZTsKCgkJCQljb25zdCBuID0gdGhpcy5yZWFkVWludDgoKTsKCQkJCWlmIChuICE9PSBraS5ERUZMQVRFKSB0aHJvdyBuZXcgRXJyb3IoIlVuc3VwcG9ydGVkIGlDQ1AgY29tcHJlc3Npb24gbWV0aG9kOiAiLmNvbmNhdChuKSk7CgkJCQljb25zdCByID0gdGhpcy5yZWFkQnl0ZXModCAtIGkubGVuZ3RoIC0gMik7CgkJCQl0aGlzLl9wbmcuaWNjRW1iZWRkZWRQcm9maWxlID0gewoJCQkJCW5hbWU6IGksCgkJCQkJcHJvZmlsZTogdWkocikKCQkJCX07CgkJCX0KCgkJCWRlY29kZXRFWHQodCkgewoJCQkJbGV0IGUsCgkJCQkJCWkgPSAiIjsKCgkJCQlmb3IgKDsgIlwwIiAhPT0gKGUgPSB0aGlzLnJlYWRDaGFyKCkpOykgaSArPSBlOwoKCQkJCXRoaXMuX3BuZy50ZXh0W2ldID0gdGhpcy5yZWFkQ2hhcnModCAtIGkubGVuZ3RoIC0gMSk7CgkJCX0KCgkJCWRlY29kZXBIWXMoKSB7CgkJCQljb25zdCB0ID0gdGhpcy5yZWFkVWludDMyKCksCgkJCQkJCQllID0gdGhpcy5yZWFkVWludDMyKCksCgkJCQkJCQlpID0gdGhpcy5yZWFkQnl0ZSgpOwoJCQkJdGhpcy5fcG5nLnJlc29sdXRpb24gPSB7CgkJCQkJeDogdCwKCQkJCQl5OiBlLAoJCQkJCXVuaXQ6IGkKCQkJCX07CgkJCX0KCgkJCWRlY29kZUltYWdlKCkgewoJCQkJaWYgKHRoaXMuX2luZmxhdG9yLmVycikgdGhyb3cgbmV3IEVycm9yKCJFcnJvciB3aGlsZSBkZWNvbXByZXNzaW5nIHRoZSBkYXRhOiAiLmNvbmNhdCh0aGlzLl9pbmZsYXRvci5lcnIpKTsKCQkJCWNvbnN0IHQgPSB0aGlzLl9pbmZsYXRvci5yZXN1bHQ7CgkJCQlpZiAodGhpcy5fZmlsdGVyTWV0aG9kICE9PSB5aS5BREFQVElWRSkgdGhyb3cgbmV3IEVycm9yKCJGaWx0ZXIgbWV0aG9kICIuY29uY2F0KHRoaXMuX2ZpbHRlck1ldGhvZCwgIiBub3Qgc3VwcG9ydGVkIikpOwoJCQkJaWYgKHRoaXMuX2ludGVybGFjZU1ldGhvZCAhPT0gdmkuTk9fSU5URVJMQUNFKSB0aHJvdyBuZXcgRXJyb3IoIkludGVybGFjZSBtZXRob2QgIi5jb25jYXQodGhpcy5faW50ZXJsYWNlTWV0aG9kLCAiIG5vdCBzdXBwb3J0ZWQiKSk7CgkJCQl0aGlzLmRlY29kZUludGVybGFjZU51bGwodCk7CgkJCX0KCgkJCWRlY29kZUludGVybGFjZU51bGwodCkgewoJCQkJY29uc3QgZSA9IHRoaXMuX3BuZy5oZWlnaHQsCgkJCQkJCQlpID0gdGhpcy5fcG5nLmNoYW5uZWxzICogdGhpcy5fcG5nLmRlcHRoIC8gOCwKCQkJCQkJCW4gPSB0aGlzLl9wbmcud2lkdGggKiBpLAoJCQkJCQkJciA9IG5ldyBVaW50OEFycmF5KHRoaXMuX3BuZy5oZWlnaHQgKiBuKTsKCQkJCWxldCBzLAoJCQkJCQlhLAoJCQkJCQlvID0gRWksCgkJCQkJCWggPSAwOwoKCQkJCWZvciAobGV0IGwgPSAwOyBsIDwgZTsgbCsrKSB7CgkJCQkJc3dpdGNoIChzID0gdC5zdWJhcnJheShoICsgMSwgaCArIDEgKyBuKSwgYSA9IHIuc3ViYXJyYXkobCAqIG4sIChsICsgMSkgKiBuKSwgdFtoXSkgewoJCQkJCQljYXNlIDA6CgkJCQkJCQl6aShzLCBhLCBuKTsKCQkJCQkJCWJyZWFrOwoKCQkJCQkJY2FzZSAxOgoJCQkJCQkJUmkocywgYSwgbiwgaSk7CgkJCQkJCQlicmVhazsKCgkJCQkJCWNhc2UgMjoKCQkJCQkJCU5pKHMsIGEsIG8sIG4pOwoJCQkJCQkJYnJlYWs7CgoJCQkJCQljYXNlIDM6CgkJCQkJCQlUaShzLCBhLCBvLCBuLCBpKTsKCQkJCQkJCWJyZWFrOwoKCQkJCQkJY2FzZSA0OgoJCQkJCQkJT2kocywgYSwgbywgbiwgaSk7CgkJCQkJCQlicmVhazsKCgkJCQkJCWRlZmF1bHQ6CgkJCQkJCQl0aHJvdyBuZXcgRXJyb3IoIlVuc3VwcG9ydGVkIGZpbHRlcjogIi5jb25jYXQodFtoXSkpOwoJCQkJCX0KCgkJCQkJbyA9IGEsIGggKz0gbiArIDE7CgkJCQl9CgoJCQkJaWYgKHRoaXMuX2hhc1BhbGV0dGUgJiYgKHRoaXMuX3BuZy5wYWxldHRlID0gdGhpcy5fcGFsZXR0ZSksIDE2ID09PSB0aGlzLl9wbmcuZGVwdGgpIHsKCQkJCQljb25zdCB0ID0gbmV3IFVpbnQxNkFycmF5KHIuYnVmZmVyKTsKCQkJCQlpZiAoeGkpIGZvciAobGV0IGUgPSAwOyBlIDwgdC5sZW5ndGg7IGUrKykgdFtlXSA9ICgyNTUgJiAobCA9IHRbZV0pKSA8PCA4IHwgbCA+PiA4ICYgMjU1OwoJCQkJCXRoaXMuX3BuZy5kYXRhID0gdDsKCQkJCX0gZWxzZSB0aGlzLl9wbmcuZGF0YSA9IHI7CgoJCQkJdmFyIGw7CgkJCX0KCgkJfQoKCQlmdW5jdGlvbiB6aSh0LCBlLCBpKSB7CgkJCWZvciAobGV0IG4gPSAwOyBuIDwgaTsgbisrKSBlW25dID0gdFtuXTsKCQl9CgoJCWZ1bmN0aW9uIFJpKHQsIGUsIGksIG4pIHsKCQkJbGV0IHIgPSAwOwoKCQkJZm9yICg7IHIgPCBuOyByKyspIGVbcl0gPSB0W3JdOwoKCQkJZm9yICg7IHIgPCBpOyByKyspIGVbcl0gPSB0W3JdICsgZVtyIC0gbl0gJiAyNTU7CgkJfQoKCQlmdW5jdGlvbiBOaSh0LCBlLCBpLCBuKSB7CgkJCWxldCByID0gMDsKCQkJaWYgKDAgPT09IGkubGVuZ3RoKSBmb3IgKDsgciA8IG47IHIrKykgZVtyXSA9IHRbcl07ZWxzZSBmb3IgKDsgciA8IG47IHIrKykgZVtyXSA9IHRbcl0gKyBpW3JdICYgMjU1OwoJCX0KCgkJZnVuY3Rpb24gVGkodCwgZSwgaSwgbiwgcikgewoJCQlsZXQgcyA9IDA7CgoJCQlpZiAoMCA9PT0gaS5sZW5ndGgpIHsKCQkJCWZvciAoOyBzIDwgcjsgcysrKSBlW3NdID0gdFtzXTsKCgkJCQlmb3IgKDsgcyA8IG47IHMrKykgZVtzXSA9IHRbc10gKyAoZVtzIC0gcl0gPj4gMSkgJiAyNTU7CgkJCX0gZWxzZSB7CgkJCQlmb3IgKDsgcyA8IHI7IHMrKykgZVtzXSA9IHRbc10gKyAoaVtzXSA+PiAxKSAmIDI1NTsKCgkJCQlmb3IgKDsgcyA8IG47IHMrKykgZVtzXSA9IHRbc10gKyAoZVtzIC0gcl0gKyBpW3NdID4+IDEpICYgMjU1OwoJCQl9CgkJfQoKCQlmdW5jdGlvbiBPaSh0LCBlLCBpLCBuLCByKSB7CgkJCWxldCBzID0gMDsKCgkJCWlmICgwID09PSBpLmxlbmd0aCkgewoJCQkJZm9yICg7IHMgPCByOyBzKyspIGVbc10gPSB0W3NdOwoKCQkJCWZvciAoOyBzIDwgbjsgcysrKSBlW3NdID0gdFtzXSArIGVbcyAtIHJdICYgMjU1OwoJCQl9IGVsc2UgewoJCQkJZm9yICg7IHMgPCByOyBzKyspIGVbc10gPSB0W3NdICsgaVtzXSAmIDI1NTsKCgkJCQlmb3IgKDsgcyA8IG47IHMrKykgZVtzXSA9IHRbc10gKyBMaShlW3MgLSByXSwgaVtzXSwgaVtzIC0gcl0pICYgMjU1OwoJCQl9CgkJfQoKCQlmdW5jdGlvbiBMaSh0LCBlLCBpKSB7CgkJCWNvbnN0IG4gPSB0ICsgZSAtIGksCgkJCQkJCXIgPSBNYXRoLmFicyhuIC0gdCksCgkJCQkJCXMgPSBNYXRoLmFicyhuIC0gZSksCgkJCQkJCWEgPSBNYXRoLmFicyhuIC0gaSk7CgkJCXJldHVybiByIDw9IHMgJiYgciA8PSBhID8gdCA6IHMgPD0gYSA/IGUgOiBpOwoJCX0KCgkJY29uc3QgQmkgPSB7CgkJCWxldmVsOiAzCgkJfTsKCgkJY2xhc3MgQ2kgZXh0ZW5kcyByIHsKCQkJY29uc3RydWN0b3IodCkgewoJCQkJbGV0IGUgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHt9OwoJCQkJc3VwZXIoKSwgdGhpcy5fY29sb3JUeXBlID0gbWkuVU5LTk9XTiwgdGhpcy5femxpYk9wdGlvbnMgPSBfb2JqZWN0U3ByZWFkMihfb2JqZWN0U3ByZWFkMih7fSwgQmkpLCBlLnpsaWIpLCB0aGlzLl9wbmcgPSB0aGlzLl9jaGVja0RhdGEodCksIHRoaXMuc2V0QmlnRW5kaWFuKCk7CgkJCX0KCgkJCWVuY29kZSgpIHsKCQkJCXJldHVybiB0aGlzLmVuY29kZVNpZ25hdHVyZSgpLCB0aGlzLmVuY29kZUlIRFIoKSwgdGhpcy5lbmNvZGVEYXRhKCksIHRoaXMuZW5jb2RlSUVORCgpLCB0aGlzLnRvQXJyYXkoKTsKCQkJfQoKCQkJZW5jb2RlU2lnbmF0dXJlKCkgewoJCQkJdGhpcy53cml0ZUJ5dGVzKHdpKTsKCQkJfQoKCQkJZW5jb2RlSUhEUigpIHsKCQkJCXRoaXMud3JpdGVVaW50MzIoMTMpLCB0aGlzLndyaXRlQ2hhcnMoIklIRFIiKSwgdGhpcy53cml0ZVVpbnQzMih0aGlzLl9wbmcud2lkdGgpLCB0aGlzLndyaXRlVWludDMyKHRoaXMuX3BuZy5oZWlnaHQpLCB0aGlzLndyaXRlQnl0ZSh0aGlzLl9wbmcuZGVwdGgpLCB0aGlzLndyaXRlQnl0ZSh0aGlzLl9jb2xvclR5cGUpLCB0aGlzLndyaXRlQnl0ZShraS5ERUZMQVRFKSwgdGhpcy53cml0ZUJ5dGUoeWkuQURBUFRJVkUpLCB0aGlzLndyaXRlQnl0ZSh2aS5OT19JTlRFUkxBQ0UpLCB0aGlzLndyaXRlQ3JjKDE3KTsKCQkJfQoKCQkJZW5jb2RlSUVORCgpIHsKCQkJCXRoaXMud3JpdGVVaW50MzIoMCksIHRoaXMud3JpdGVDaGFycygiSUVORCIpLCB0aGlzLndyaXRlQ3JjKDQpOwoJCQl9CgoJCQllbmNvZGVJREFUKHQpIHsKCQkJCXRoaXMud3JpdGVVaW50MzIodC5sZW5ndGgpLCB0aGlzLndyaXRlQ2hhcnMoIklEQVQiKSwgdGhpcy53cml0ZUJ5dGVzKHQpLCB0aGlzLndyaXRlQ3JjKHQubGVuZ3RoICsgNCk7CgkJCX0KCgkJCWVuY29kZURhdGEoKSB7CgkJCQljb25zdCB7CgkJCQkJd2lkdGg6IHQsCgkJCQkJaGVpZ2h0OiBlLAoJCQkJCWNoYW5uZWxzOiBpLAoJCQkJCWRlcHRoOiBuLAoJCQkJCWRhdGE6IHMKCQkJCX0gPSB0aGlzLl9wbmcsCgkJCQkJCQlhID0gaSAqIHQsCgkJCQkJCQlvID0gbmV3IHIoKS5zZXRCaWdFbmRpYW4oKTsKCQkJCWxldCBoID0gMDsKCgkJCQlmb3IgKGxldCB0ID0gMDsgdCA8IGU7IHQrKykgaWYgKG8ud3JpdGVCeXRlKDApLCA4ID09PSBuKSBoID0gSWkocywgbywgYSwgaCk7ZWxzZSB7CgkJCQkJaWYgKDE2ICE9PSBuKSB0aHJvdyBuZXcgRXJyb3IoInVucmVhY2hhYmxlIik7CgkJCQkJaCA9IFNpKHMsIG8sIGEsIGgpOwoJCQkJfQoKCQkJCWNvbnN0IGwgPSBvLnRvQXJyYXkoKSwKCQkJCQkJCWQgPSBmaShsLCB0aGlzLl96bGliT3B0aW9ucyk7CgkJCQl0aGlzLmVuY29kZUlEQVQoZCk7CgkJCX0KCgkJCV9jaGVja0RhdGEodCkgewoJCQkJY29uc3QgewoJCQkJCWNvbG9yVHlwZTogZSwKCQkJCQljaGFubmVsczogaSwKCQkJCQlkZXB0aDogbgoJCQkJfSA9IGZ1bmN0aW9uICh0KSB7CgkJCQkJY29uc3QgewoJCQkJCQljaGFubmVsczogZSA9IDQsCgkJCQkJCWRlcHRoOiBpID0gOAoJCQkJCX0gPSB0OwoJCQkJCWlmICg0ICE9PSBlICYmIDMgIT09IGUgJiYgMiAhPT0gZSAmJiAxICE9PSBlKSB0aHJvdyBuZXcgUmFuZ2VFcnJvcigidW5zdXBwb3J0ZWQgbnVtYmVyIG9mIGNoYW5uZWxzOiAiLmNvbmNhdChlKSk7CgkJCQkJaWYgKDggIT09IGkgJiYgMTYgIT09IGkpIHRocm93IG5ldyBSYW5nZUVycm9yKCJ1bnN1cHBvcnRlZCBiaXQgZGVwdGg6ICIuY29uY2F0KGkpKTsKCQkJCQljb25zdCBuID0gewoJCQkJCQljaGFubmVsczogZSwKCQkJCQkJZGVwdGg6IGksCgkJCQkJCWNvbG9yVHlwZTogbWkuVU5LTk9XTgoJCQkJCX07CgoJCQkJCXN3aXRjaCAoZSkgewoJCQkJCQljYXNlIDQ6CgkJCQkJCQluLmNvbG9yVHlwZSA9IG1pLlRSVUVDT0xPVVJfQUxQSEE7CgkJCQkJCQlicmVhazsKCgkJCQkJCWNhc2UgMzoKCQkJCQkJCW4uY29sb3JUeXBlID0gbWkuVFJVRUNPTE9VUjsKCQkJCQkJCWJyZWFrOwoKCQkJCQkJY2FzZSAxOgoJCQkJCQkJbi5jb2xvclR5cGUgPSBtaS5HUkVZU0NBTEU7CgkJCQkJCQlicmVhazsKCgkJCQkJCWNhc2UgMjoKCQkJCQkJCW4uY29sb3JUeXBlID0gbWkuR1JFWVNDQUxFX0FMUEhBOwoJCQkJCQkJYnJlYWs7CgoJCQkJCQlkZWZhdWx0OgoJCQkJCQkJdGhyb3cgbmV3IEVycm9yKCJ1bnN1cHBvcnRlZCBudW1iZXIgb2YgY2hhbm5lbHMiKTsKCQkJCQl9CgoJCQkJCXJldHVybiBuOwoJCQkJfSh0KSwKCQkJCQkJCXIgPSB7CgkJCQkJd2lkdGg6IERpKHQud2lkdGgsICJ3aWR0aCIpLAoJCQkJCWhlaWdodDogRGkodC5oZWlnaHQsICJoZWlnaHQiKSwKCQkJCQljaGFubmVsczogaSwKCQkJCQlkYXRhOiB0LmRhdGEsCgkJCQkJZGVwdGg6IG4sCgkJCQkJdGV4dDoge30KCQkJCX07CgoJCQkJdGhpcy5fY29sb3JUeXBlID0gZTsKCQkJCWNvbnN0IHMgPSByLndpZHRoICogci5oZWlnaHQgKiBpOwoJCQkJaWYgKHIuZGF0YS5sZW5ndGggIT09IHMpIHRocm93IG5ldyBSYW5nZUVycm9yKCJ3cm9uZyBkYXRhIHNpemUuIEZvdW5kICIuY29uY2F0KHIuZGF0YS5sZW5ndGgsICIsIGV4cGVjdGVkICIpLmNvbmNhdChzKSk7CgkJCQlyZXR1cm4gcjsKCQkJfQoKCQkJd3JpdGVDcmModCkgewoJCQkJdGhpcy53cml0ZVVpbnQzMihiaShuZXcgVWludDhBcnJheSh0aGlzLmJ1ZmZlciwgdGhpcy5ieXRlT2Zmc2V0ICsgdGhpcy5vZmZzZXQgLSB0LCB0KSwgdCkpOwoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gRGkodCwgZSkgewoJCQlpZiAoTnVtYmVyLmlzSW50ZWdlcih0KSAmJiB0ID4gMCkgcmV0dXJuIHQ7CgkJCXRocm93IG5ldyBUeXBlRXJyb3IoIiIuY29uY2F0KGUsICIgbXVzdCBiZSBhIHBvc2l0aXZlIGludGVnZXIiKSk7CgkJfQoKCQlmdW5jdGlvbiBJaSh0LCBlLCBpLCBuKSB7CgkJCWZvciAobGV0IHIgPSAwOyByIDwgaTsgcisrKSBlLndyaXRlQnl0ZSh0W24rK10pOwoKCQkJcmV0dXJuIG47CgkJfQoKCQlmdW5jdGlvbiBTaSh0LCBlLCBpLCBuKSB7CgkJCWZvciAobGV0IHIgPSAwOyByIDwgaTsgcisrKSBlLndyaXRlVWludDE2KHRbbisrXSk7CgoJCQlyZXR1cm4gbjsKCQl9CgoJCXZhciBaaTsKCQkhZnVuY3Rpb24gKHQpIHsKCQkJdFt0LlVOS05PV04gPSAwXSA9ICJVTktOT1dOIiwgdFt0Lk1FVFJFID0gMV0gPSAiTUVUUkUiOwoJCX0oWmkgfHwgKFppID0ge30pKTsKCgkJY29uc3QgRmkgPSAodCwgZSwgaSkgPT4gbmV3IENpKHsKCQkJd2lkdGg6IHQsCgkJCWhlaWdodDogZSwKCQkJZGF0YTogaQoJCX0sIHVuZGVmaW5lZCkuZW5jb2RlKCksCgkJCQkJTWkgPSB0ID0+IGZ1bmN0aW9uICh0LCBlKSB7CgkJCXJldHVybiBuZXcgVWkodCwgdm9pZCAwKS5kZWNvZGUoKTsKCQl9KHQpOwoJfSkoKTsKCgluLlA7CgkJCXZhciBzID0gbi5tOwoKCWZ1bmN0aW9uIHNlYXJjaEVsZW1lbnQocGFyZW50LCBlbGVtZW50KSB7CgkJaWYgKCFwYXJlbnQgfHwgdHlwZW9mIHBhcmVudCAhPSAnb2JqZWN0JykgcmV0dXJuOwoKCQlpZiAocGFyZW50Lmhhc093blByb3BlcnR5KGVsZW1lbnQpKSB7CgkJCXJldHVybiB7CgkJCQlwYXJlbnQsCgkJCQl2YWx1ZTogcGFyZW50W2VsZW1lbnRdCgkJCX07CgkJfQoKCQlmb3IgKGxldCBjaGlsZCBvZiBPYmplY3QudmFsdWVzKHBhcmVudCkpIHsKCQkJaWYgKCEhY2hpbGQgfHwgdHlwZW9mIGNoaWxkID09ICdvYmplY3QnKSB7CgkJCQlsZXQgZm91bmQgPSBzZWFyY2hFbGVtZW50KGNoaWxkLCBlbGVtZW50KTsKCQkJCWlmIChmb3VuZCkgcmV0dXJuIGZvdW5kOwoJCQl9CgkJfQoKCQlyZXR1cm4gbnVsbDsKCX0KCglmdW5jdGlvbiBnZXRFeHRlbnNpb24oZGF0YVR5cGUpIHsKCQlzd2l0Y2ggKGRhdGFUeXBlKSB7CgkJCWNhc2UgIkpTT04iOgoJCQkJcmV0dXJuICJqc29uIjsKCgkJCWNhc2UgInlhbWwiOgoJCQkJcmV0dXJuICJ5YW1sIjsKCgkJCWNhc2UgIlRleHR1cmUyRCI6CgkJCQlyZXR1cm4gInBuZyI7CgoJCQljYXNlICJFZmZlY3QiOgoJCQkJcmV0dXJuICJjc28iOwoKCQkJY2FzZSAnVEJpbic6CgkJCQlyZXR1cm4gInRiaW4iOwoKCQkJY2FzZSAnQm1Gb250JzoKCQkJCXJldHVybiAieG1sIjsKCQl9CgoJCXJldHVybiAiYmluIjsKCX0KCglmdW5jdGlvbiBnZXRNaW1lVHlwZShkYXRhVHlwZSkgewoJCXN3aXRjaCAoZGF0YVR5cGUpIHsKCQkJY2FzZSAiSlNPTiI6CgkJCQlyZXR1cm4gImFwcGxpY2F0aW9uL2pzb24iOwoKCQkJY2FzZSAieWFtbCI6CgkJCQlyZXR1cm4gInRleHQvcGxhaW4iOwoKCQkJY2FzZSAiVGV4dHVyZTJEIjoKCQkJCXJldHVybiAiaW1hZ2UvcG5nIjsKCgkJCWNhc2UgIkVmZmVjdCI6CgkJCQlyZXR1cm4gImFwcGxpY2F0aW9uL3gtY3NvIjsKCgkJCWNhc2UgJ0JtRm9udCc6CgkJCQlyZXR1cm4gImFwcGxpY2F0aW9uL3htbCI7CgkJfQoKCQlyZXR1cm4gImFwcGxpY2F0aW9uL29jdGV0LXN0cmVhbSI7Cgl9CgoJZnVuY3Rpb24gbWFrZUJsb2IoZGF0YSwgZGF0YVR5cGUpIHsKCQlpZiAodHlwZW9mIEJsb2IgPT09ICJmdW5jdGlvbiIpIHJldHVybiB7CgkJCWRhdGE6IG5ldyBCbG9iKFtkYXRhXSwgewoJCQkJdHlwZTogZ2V0TWltZVR5cGUoZGF0YVR5cGUpCgkJCX0pLAoJCQlleHRlbnNpb246IGdldEV4dGVuc2lvbihkYXRhVHlwZSkKCQl9OwoJCXJldHVybiB7CgkJCWRhdGE6IGRhdGEsCgkJCWV4dGVuc2lvbjogZ2V0RXh0ZW5zaW9uKGRhdGFUeXBlKQoJCX07Cgl9CgoJZnVuY3Rpb24gZXhwb3J0Q29udGVudChjb250ZW50KSB7CgkJbGV0IGpzb25Db250ZW50ID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiBmYWxzZTsKCQlsZXQgZm91bmQgPSBzZWFyY2hFbGVtZW50KGNvbnRlbnQsICJleHBvcnQiKTsKCgkJaWYgKGZvdW5kKSB7CgkJCWNvbnN0IHsKCQkJCXZhbHVlCgkJCX0gPSBmb3VuZDsKCQkJbGV0IHsKCQkJCXR5cGU6IGRhdGFUeXBlLAoJCQkJZGF0YQoJCQl9ID0gdmFsdWU7CgoJCQlpZiAoZGF0YVR5cGUgPT09ICJUZXh0dXJlMkQiKSB7CgkJCQlkYXRhID0gcyh2YWx1ZS53aWR0aCwgdmFsdWUuaGVpZ2h0LCBuZXcgVWludDhBcnJheShkYXRhKSk7CgkJCX0KCgkJCXJldHVybiBtYWtlQmxvYihkYXRhLCBkYXRhVHlwZSk7CgkJfQoKCQlpZiAoanNvbkNvbnRlbnQpIHsKCQkJbGV0IGNvbnRlbnRKc29uID0gSlNPTi5zdHJpbmdpZnkoY29udGVudCwgbnVsbCwgNCk7CgkJCXJldHVybiBtYWtlQmxvYihjb250ZW50SnNvbiwgIkpTT04iKTsKCQl9CgoJCXJldHVybiBudWxsOwoJfQoJLyoqIEBhcGkKCSAqIHJlYWRzIHRoZSBidWZmZXIgYW5kIHRoZW4gdW5wYWNrcy4KCSAqIGFycmF5QnVmZmVyIC0+IFhuYkRhdGEKCSAqIEBwYXJhbSB7QXJyYXlCdWZmZXJ9IGJ1ZmZlcgoJICogQHJldHVybiB7WG5iRGF0YX0gdGhlIGxvYWRlZCBYTkIganNvbgoJICovCgoKCWZ1bmN0aW9uIGJ1ZmZlclRvWG5iKGJ1ZmZlcikgewoJCWNvbnN0IHhuYiA9IG5ldyBYbmJDb252ZXJ0ZXIoKTsKCQlyZXR1cm4geG5iLmxvYWQoYnVmZmVyKTsKCX0KCS8qKiBAYXBpCgkgKiByZW1vdmUgaGVhZGVyIGZyb20gdGhlIGxvYWRlZCBYTkIgT2JqZWN0CgkgKiBYbmJEYXRhIC0+IENvbnRlbnQKCSAqIEBwYXJhbSB7WG5iRGF0YX0gdGhlIGxvYWRlZCBYTkIgb2JqZWN0IGluY2x1ZGUgaGVhZGVycwoJICogQHJldHVybiB7WG5iQ29udGVudH0gZXhwb3J0ZWQgQ29udGVudCBPYmplY3QKCSAqLwoKCglmdW5jdGlvbiB4bmJEYXRhVG9Db250ZW50KGxvYWRlZFhuYikgewoJCWNvbnN0IHsKCQkJY29udGVudAoJCX0gPSBsb2FkZWRYbmI7CgkJY29uc3QgewoJCQlkYXRhLAoJCQlleHRlbnNpb24KCQl9ID0gZXhwb3J0Q29udGVudChjb250ZW50LCB0cnVlKTsKCQlyZXR1cm4gbmV3IFhuYkNvbnRlbnQoZGF0YSwgZXh0ZW5zaW9uKTsKCX0KCglmdW5jdGlvbiBzZXRSZWFkZXJzKHJlYWRlcnMpIHsKCQlyZXR1cm4gVHlwZVJlYWRlci5zZXRSZWFkZXJzKHJlYWRlcnMpOwoJfQoKCS8qKiAKCSAqIHhuYi5qcyAxLjIuMAoJICogbWFkZSBieSBMeWJlbGwoIGh0dHBzOi8vZ2l0aHViLmNvbS9seWJlbGwtYXJ0LyApCgkgKiBUaGlzIGxpYnJhcnkgaXMgYmFzZWQgb24gdGhlIFhuYkNsaSBtYWRlIGJ5IExlb25ibGFkZS4KCSAqIAoJICogeG5iLmpzIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBMR1BMIDMuMCBMaWNlbnNlLgoJICogCgkqLwoKCWNsYXNzIEJhc2VSZWFkZXIgewoJCXN0YXRpYyBpc1R5cGVPZih0eXBlKSB7CgkJCXJldHVybiBmYWxzZTsKCQl9CgoJCXN0YXRpYyBoYXNTdWJUeXBlKCkgewoJCQlyZXR1cm4gZmFsc2U7CgkJfQoKCQlzdGF0aWMgcGFyc2VUeXBlTGlzdCgpIHsKCQkJcmV0dXJuIFt0aGlzLnR5cGUoKV07CgkJfQoKCQlzdGF0aWMgdHlwZSgpIHsKCQkJcmV0dXJuIHRoaXMubmFtZS5zbGljZSgwLCAtNik7CgkJfQoKCQlpc1ZhbHVlVHlwZSgpIHsKCQkJcmV0dXJuIHRydWU7CgkJfQoKCQlnZXQgdHlwZSgpIHsKCQkJcmV0dXJuIHRoaXMuY29uc3RydWN0b3IudHlwZSgpOwoJCX0KCgkJcmVhZChidWZmZXIsIHJlc29sdmVyKSB7CgkJCXRocm93IG5ldyBFcnJvcignQ2Fubm90IGludm9rZSBtZXRob2RzIG9uIGFic3RyYWN0IGNsYXNzLicpOwoJCX0KCgkJd3JpdGUoYnVmZmVyLCBjb250ZW50LCByZXNvbHZlcikgewoJCQl0aHJvdyBuZXcgRXJyb3IoJ0Nhbm5vdCBpbnZva2UgbWV0aG9kcyBvbiBhYnN0cmFjdCBjbGFzcy4nKTsKCQl9CgoJCXdyaXRlSW5kZXgoYnVmZmVyLCByZXNvbHZlcikgewoJCQlpZiAocmVzb2x2ZXIgIT0gbnVsbCkgYnVmZmVyLndyaXRlN0JpdE51bWJlcihOdW1iZXIucGFyc2VJbnQocmVzb2x2ZXIuZ2V0SW5kZXgodGhpcykpICsgMSk7CgkJfQoKCQl0b1N0cmluZygpIHsKCQkJcmV0dXJuIHRoaXMudHlwZTsKCQl9CgoJCXBhcnNlVHlwZUxpc3QoKSB7CgkJCXJldHVybiB0aGlzLmNvbnN0cnVjdG9yLnBhcnNlVHlwZUxpc3QoKTsKCQl9CgoJfQoKCWNsYXNzIFVJbnQzMlJlYWRlciBleHRlbmRzIEJhc2VSZWFkZXIgewoJCXN0YXRpYyBpc1R5cGVPZih0eXBlKSB7CgkJCXN3aXRjaCAodHlwZSkgewoJCQkJY2FzZSAnTWljcm9zb2Z0LlhuYS5GcmFtZXdvcmsuQ29udGVudC5VSW50MzJSZWFkZXInOgoJCQkJY2FzZSAnU3lzdGVtLlVJbnQzMic6CgkJCQkJcmV0dXJuIHRydWU7CgoJCQkJZGVmYXVsdDoKCQkJCQlyZXR1cm4gZmFsc2U7CgkJCX0KCQl9CgoJCXJlYWQoYnVmZmVyKSB7CgkJCXJldHVybiBidWZmZXIucmVhZFVJbnQzMigpOwoJCX0KCgkJd3JpdGUoYnVmZmVyLCBjb250ZW50LCByZXNvbHZlcikgewoJCQl0aGlzLndyaXRlSW5kZXgoYnVmZmVyLCByZXNvbHZlcik7CgkJCWJ1ZmZlci53cml0ZVVJbnQzMihjb250ZW50KTsKCQl9CgoJfQoKCWNsYXNzIEludDMyUmVhZGVyIGV4dGVuZHMgQmFzZVJlYWRlciB7CgkJc3RhdGljIGlzVHlwZU9mKHR5cGUpIHsKCQkJc3dpdGNoICh0eXBlKSB7CgkJCQljYXNlICdNaWNyb3NvZnQuWG5hLkZyYW1ld29yay5Db250ZW50LkludDMyUmVhZGVyJzoKCQkJCWNhc2UgJ1N5c3RlbS5JbnQzMic6CgkJCQkJcmV0dXJuIHRydWU7CgoJCQkJZGVmYXVsdDoKCQkJCQlyZXR1cm4gZmFsc2U7CgkJCX0KCQl9CgoJCXJlYWQoYnVmZmVyKSB7CgkJCXJldHVybiBidWZmZXIucmVhZEludDMyKCk7CgkJfQoKCQl3cml0ZShidWZmZXIsIGNvbnRlbnQsIHJlc29sdmVyKSB7CgkJCXRoaXMud3JpdGVJbmRleChidWZmZXIsIHJlc29sdmVyKTsKCQkJYnVmZmVyLndyaXRlSW50MzIoY29udGVudCk7CgkJfQoKCX0KCgljbGFzcyBMaWdodHdlaWdodFRleHR1cmUyRFJlYWRlciBleHRlbmRzIEJhc2VSZWFkZXIgewoJCXN0YXRpYyBpc1R5cGVPZih0eXBlKSB7CgkJCXN3aXRjaCAodHlwZSkgewoJCQkJY2FzZSAnTWljcm9zb2Z0LlhuYS5GcmFtZXdvcmsuQ29udGVudC5UZXh0dXJlMkRSZWFkZXInOgoJCQkJCXJldHVybiB0cnVlOwoKCQkJCWRlZmF1bHQ6CgkJCQkJcmV0dXJuIGZhbHNlOwoJCQl9CgkJfQoKCQlzdGF0aWMgdHlwZSgpIHsKCQkJcmV0dXJuICJUZXh0dXJlMkQiOwoJCX0KCgkJcmVhZChidWZmZXIpIHsKCQkJY29uc3QgaW50MzJSZWFkZXIgPSBuZXcgSW50MzJSZWFkZXIoKTsKCQkJY29uc3QgdWludDMyUmVhZGVyID0gbmV3IFVJbnQzMlJlYWRlcigpOwoJCQlsZXQgZm9ybWF0ID0gaW50MzJSZWFkZXIucmVhZChidWZmZXIpOwoJCQlsZXQgd2lkdGggPSB1aW50MzJSZWFkZXIucmVhZChidWZmZXIpOwoJCQlsZXQgaGVpZ2h0ID0gdWludDMyUmVhZGVyLnJlYWQoYnVmZmVyKTsKCQkJbGV0IG1pcENvdW50ID0gdWludDMyUmVhZGVyLnJlYWQoYnVmZmVyKTsKCQkJaWYgKG1pcENvdW50ID4gMSkgY29uc29sZS53YXJuKCJGb3VuZCBtaXBjb3VudCBvZiAiLmNvbmNhdChtaXBDb3VudCwgIiwgb25seSB0aGUgZmlyc3Qgd2lsbCBiZSB1c2VkLiIpKTsKCQkJbGV0IGRhdGFTaXplID0gdWludDMyUmVhZGVyLnJlYWQoYnVmZmVyKTsKCQkJbGV0IGRhdGEgPSBidWZmZXIucmVhZChkYXRhU2l6ZSk7CgkJCWRhdGEgPSBuZXcgVWludDhBcnJheShkYXRhKTsKCQkJaWYgKGZvcm1hdCAhPSAwKSB0aHJvdyBuZXcgRXJyb3IoIkNvbXByZXNzZWQgdGV4dHVyZSBmb3JtYXQgaXMgbm90IHN1cHBvcnRlZCEiKTsKCgkJCWZvciAobGV0IGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkgKz0gNCkgewoJCQkJbGV0IGludmVyc2VBbHBoYSA9IDI1NSAvIGRhdGFbaSArIDNdOwoJCQkJZGF0YVtpXSA9IE1hdGgubWluKE1hdGguY2VpbChkYXRhW2ldICogaW52ZXJzZUFscGhhKSwgMjU1KTsKCQkJCWRhdGFbaSArIDFdID0gTWF0aC5taW4oTWF0aC5jZWlsKGRhdGFbaSArIDFdICogaW52ZXJzZUFscGhhKSwgMjU1KTsKCQkJCWRhdGFbaSArIDJdID0gTWF0aC5taW4oTWF0aC5jZWlsKGRhdGFbaSArIDJdICogaW52ZXJzZUFscGhhKSwgMjU1KTsKCQkJfQoKCQkJcmV0dXJuIHsKCQkJCWZvcm1hdCwKCQkJCWV4cG9ydDogewoJCQkJCXR5cGU6IHRoaXMudHlwZSwKCQkJCQlkYXRhLAoJCQkJCXdpZHRoLAoJCQkJCWhlaWdodAoJCQkJfQoJCQl9OwoJCX0KCgkJd3JpdGUoYnVmZmVyLCBjb250ZW50LCByZXNvbHZlcikgewoJCQlpZiAoY29udGVudC5mb3JtYXQgIT0gMCkgdGhyb3cgbmV3IEVycm9yKCJDb21wcmVzc2VkIHRleHR1cmUgZm9ybWF0IGlzIG5vdCBzdXBwb3J0ZWQhIik7CgkJCWNvbnN0IGludDMyUmVhZGVyID0gbmV3IEludDMyUmVhZGVyKCk7CgkJCWNvbnN0IHVpbnQzMlJlYWRlciA9IG5ldyBVSW50MzJSZWFkZXIoKTsKCQkJdGhpcy53cml0ZUluZGV4KGJ1ZmZlciwgcmVzb2x2ZXIpOwoJCQljb250ZW50LmV4cG9ydC53aWR0aDsKCQkJY29udGVudC5leHBvcnQuaGVpZ2h0OwoJCQlpbnQzMlJlYWRlci53cml0ZShidWZmZXIsIGNvbnRlbnQuZm9ybWF0LCBudWxsKTsKCQkJdWludDMyUmVhZGVyLndyaXRlKGJ1ZmZlciwgY29udGVudC5leHBvcnQud2lkdGgsIG51bGwpOwoJCQl1aW50MzJSZWFkZXIud3JpdGUoYnVmZmVyLCBjb250ZW50LmV4cG9ydC5oZWlnaHQsIG51bGwpOwoJCQl1aW50MzJSZWFkZXIud3JpdGUoYnVmZmVyLCAxLCBudWxsKTsKCQkJbGV0IGRhdGEgPSBjb250ZW50LmV4cG9ydC5kYXRhOwoKCQkJZm9yIChsZXQgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSArPSA0KSB7CgkJCQljb25zdCBhbHBoYSA9IGRhdGFbaSArIDNdIC8gMjU1OwoJCQkJZGF0YVtpXSA9IE1hdGguZmxvb3IoZGF0YVtpXSAqIGFscGhhKTsKCQkJCWRhdGFbaSArIDFdID0gTWF0aC5mbG9vcihkYXRhW2kgKyAxXSAqIGFscGhhKTsKCQkJCWRhdGFbaSArIDJdID0gTWF0aC5mbG9vcihkYXRhW2kgKyAyXSAqIGFscGhhKTsKCQkJfQoKCQkJdWludDMyUmVhZGVyLndyaXRlKGJ1ZmZlciwgZGF0YS5sZW5ndGgsIG51bGwpOwoJCQlidWZmZXIuY29uY2F0KGRhdGEpOwoJCX0KCgkJaXNWYWx1ZVR5cGUoKSB7CgkJCXJldHVybiBmYWxzZTsKCQl9CgoJCWdldCB0eXBlKCkgewoJCQlyZXR1cm4gIlRleHR1cmUyRCI7CgkJfQoKCX0KCglzZXRSZWFkZXJzKHtUZXh0dXJlMkRSZWFkZXI6IExpZ2h0d2VpZ2h0VGV4dHVyZTJEUmVhZGVyfSk7CgoJbGV0IGtJc05vZGVKUyA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh0eXBlb2YgcHJvY2VzcyAhPT0gJ3VuZGVmaW5lZCcgPyBwcm9jZXNzIDogMCkgPT09ICdbb2JqZWN0IHByb2Nlc3NdJzsNCg0KCWZ1bmN0aW9uIGlzTm9kZUpTKCkgew0KCQlyZXR1cm4ga0lzTm9kZUpTOw0KCX0NCg0KCWNvbnN0IFdvcmtlclRocmVhZHMgPQ0KCQl0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyAmJiB0eXBlb2YgbW9kdWxlLnJlcXVpcmUgPT09ICdmdW5jdGlvbicgJiYgbW9kdWxlLnJlcXVpcmUoJ3dvcmtlcl90aHJlYWRzJykgfHwNCgkJdHlwZW9mIF9fbm9uX3dlYnBhY2tfcmVxdWlyZV9fID09PSAnZnVuY3Rpb24nICYmIF9fbm9uX3dlYnBhY2tfcmVxdWlyZV9fKCd3b3JrZXJfdGhyZWFkcycpIHx8DQoJCXR5cGVvZiByZXF1aXJlID09PSAnZnVuY3Rpb24nICYmIHJlcXVpcmUoJ3dvcmtlcl90aHJlYWRzJyk7DQoNCglmdW5jdGlvbiB3b3JrZXJNYWtlcih3b3JrZXJGdW5jKQ0KCXsNCgkJLy8gbm9kZS1qcyBlbnZpcm9ubWVudA0KCQlpZihpc05vZGVKUygpKQ0KCQl7DQoJCQljb25zdCB7cGFyZW50UG9ydH0gPSBXb3JrZXJUaHJlYWRzOw0KCQkJcGFyZW50UG9ydC5vbignbWVzc2FnZScsIChlKT0+d29ya2VyRnVuYyhlLCBwYXJlbnRQb3J0KSk7DQoJCX0NCgkJLy8gYnJvd3NlciBlbnZpcm9ubWVudA0KCQllbHNlDQoJCXsNCgkJCW9ubWVzc2FnZSA9IGZ1bmN0aW9uKGUpew0KCQkJCXdvcmtlckZ1bmMoZS5kYXRhLCB0aGlzKTsNCgkJCX07DQoJCX0NCgl9CgoJZnVuY3Rpb24gXyhlLCBwYXJlbnQpew0KCQljb25zdCB7dHlwZSwgZGF0YX0gPSBlOw0KCQlpZih0eXBlID09PSAiYnVmZmVyVG9YbmIiKSBwYXJlbnQucG9zdE1lc3NhZ2UoYnVmZmVyVG9YbmIoZGF0YSkpOw0KCQllbHNlIHBhcmVudC5wb3N0TWVzc2FnZSh4bmJEYXRhVG9Db250ZW50KGRhdGEpKTsNCgkJcGFyZW50LmNsb3NlKCk7DQoJfQ0KDQoJd29ya2VyTWFrZXIoXyk7Cgp9KSgpOwoK', null, false);
/* eslint-enable */

/** 
 * xnb.js 1.2.1
 * made by Lybell( https://github.com/lybell-art/ )
 * This library is based on the XnbCli made by Leonblade.
 * 
 * xnb.js is licensed under the LGPL 3.0 License.
 * 
*/

class XnbData {
    constructor(header, readers, content) {
        let {
            target,
            formatVersion,
            hidef,
            compressed
        } = header;
        this.header = {
            target,
            formatVersion,
            hidef,
            compressed
        };
        this.readers = readers;
        this.content = content;
    }

    get target() {
        var _this$header;

        switch ((_this$header = this.header) === null || _this$header === void 0 ? void 0 : _this$header.target) {
            case 'w':
                return "Microsoft Windows";

            case 'm':
                return "Windows Phone 7";

            case 'x':
                return "Xbox 360";

            case 'a':
                return "Android";

            case 'i':
                return "iOS";

            default:
                return "Unknown";
        }
    }

    get formatVersion() {
        var _this$header2;

        switch ((_this$header2 = this.header) === null || _this$header2 === void 0 ? void 0 : _this$header2.formatVersion) {
            case 0x3:
                return "XNA Game Studio 3.0";

            case 0x4:
                return "XNA Game Studio 3.1";

            case 0x5:
                return "XNA Game Studio 4.0";

            default:
                return "Unknown";
        }
    }

    get hidef() {
        var _this$header3;

        return !!((_this$header3 = this.header) !== null && _this$header3 !== void 0 && _this$header3.hidef);
    }

    get compressed() {
        var _this$header4;

        return !!((_this$header4 = this.header) !== null && _this$header4 !== void 0 && _this$header4.compressed);
    }

    get contentType() {
        let {
            export: raw
        } = this.content;
        if (raw !== undefined) return raw.type;
        return "JSON";
    }

    get rawContent() {
        let {
            export: raw
        } = this.content;
        if (raw !== undefined) return raw.data;
        return JSON.stringify(this.content, (key, value) => {
            if (key === "export") return value.type;
            return value;
        }, 4);
    }

    stringify() {
        return JSON.stringify({
            header: this.header,
            readers: this.readers,
            content: this.content
        }, null, 4);
    }

    toString() {
        return this.stringify();
    }

}

function extensionToDatatype(extension) {
    switch (extension) {
        case "json":
            return "JSON";

        case "yaml":
            return "yaml";

        case "png":
            return "Texture2D";

        case "cso":
            return "Effect";

        case 'tbin':
            return "TBin";

        case 'xml':
            return "BmFont";
    }

    return "Others";
}

class XnbContent {
    constructor(data, ext) {
        this.type = extensionToDatatype(ext);
        this.content = data;
    }

}


function workerPromise(worker, sendData)
{
	return new Promise( (resolve, reject)=>{
		worker.postMessage(sendData);
		worker.addEventListener("message", (e)=>resolve(e.data));
		worker.addEventListener("error", (e)=>reject(e.message));
	});
}

const bufferToXnb = function(data)
{
	const worker = new WorkerFactory();
	return workerPromise(worker, {type:"bufferToXnb", data}).
        then( ( {header, readers, content} )=>new XnbData(header, readers, content) );
};

const xnbDataToContent = function(data)
{
	const worker = new WorkerFactory();
	return workerPromise(worker, {type:"xnbDataToContent", data})
        .then( ( {type, content} )=>new XnbContent(content, type) );
};

export { bufferToXnb, xnbDataToContent };
