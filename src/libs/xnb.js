function decodeBase64(base64, enableUnicode) {
    var binaryString = atob(base64);
    if (enableUnicode) {
        var binaryView = new Uint8Array(binaryString.length);
        for (var i = 0, n = binaryString.length; i < n; ++i) {
            binaryView[i] = binaryString.charCodeAt(i);
        }
        return String.fromCharCode.apply(null, new Uint16Array(binaryView.buffer));
    }
    return binaryString;
}

function createURL(base64, sourcemapArg, enableUnicodeArg) {
    var sourcemap = sourcemapArg === undefined ? null : sourcemapArg;
    var enableUnicode = enableUnicodeArg === undefined ? false : enableUnicodeArg;
    var source = decodeBase64(base64, enableUnicode);
    var start = source.indexOf('\n', 10) + 1;
    var body = source.substring(start) + (sourcemap ? '\/\/# sourceMappingURL=' + sourcemap : '');
    var blob = new Blob([body], { type: 'application/javascript' });
    return URL.createObjectURL(blob);
}

function createBase64WorkerFactory(base64, sourcemapArg, enableUnicodeArg) {
    var url;
    return function WorkerFactory(options) {
        url = url || createURL(base64, sourcemapArg, enableUnicodeArg);
        return new Worker(url, options);
    };
}

const WorkerFactory = createBase64WorkerFactory('Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewoJJ3VzZSBzdHJpY3QnOwoKCS8qKiAKCSAqIHhuYi5qcyAxLjIuMQoJICogbWFkZSBieSBMeWJlbGwoIGh0dHBzOi8vZ2l0aHViLmNvbS9seWJlbGwtYXJ0LyApCgkgKiBUaGlzIGxpYnJhcnkgaXMgYmFzZWQgb24gdGhlIFhuYkNsaSBtYWRlIGJ5IExlb25ibGFkZS4KCSAqIAoJICogeG5iLmpzIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBMR1BMIDMuMCBMaWNlbnNlLgoJICogCgkqLwoKCWZ1bmN0aW9uIG93bktleXMob2JqZWN0LCBlbnVtZXJhYmxlT25seSkgewoJCXZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqZWN0KTsKCgkJaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsKCQkJdmFyIHN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9iamVjdCk7CgkJCWVudW1lcmFibGVPbmx5ICYmIChzeW1ib2xzID0gc3ltYm9scy5maWx0ZXIoZnVuY3Rpb24gKHN5bSkgewoJCQkJcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7CgkJCX0pKSwga2V5cy5wdXNoLmFwcGx5KGtleXMsIHN5bWJvbHMpOwoJCX0KCgkJcmV0dXJuIGtleXM7Cgl9CgoJZnVuY3Rpb24gX29iamVjdFNwcmVhZDIodGFyZ2V0KSB7CgkJZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsKCQkJdmFyIHNvdXJjZSA9IG51bGwgIT0gYXJndW1lbnRzW2ldID8gYXJndW1lbnRzW2ldIDoge307CgkJCWkgJSAyID8gb3duS2V5cyhPYmplY3Qoc291cmNlKSwgITApLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewoJCQkJX2RlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBzb3VyY2Vba2V5XSk7CgkJCX0pIDogT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMgPyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHNvdXJjZSkpIDogb3duS2V5cyhPYmplY3Qoc291cmNlKSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7CgkJCQlPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioc291cmNlLCBrZXkpKTsKCQkJfSk7CgkJfQoKCQlyZXR1cm4gdGFyZ2V0OwoJfQoKCWZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgdmFsdWUpIHsKCQlpZiAoa2V5IGluIG9iaikgewoJCQlPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsKCQkJCXZhbHVlOiB2YWx1ZSwKCQkJCWVudW1lcmFibGU6IHRydWUsCgkJCQljb25maWd1cmFibGU6IHRydWUsCgkJCQl3cml0YWJsZTogdHJ1ZQoJCQl9KTsKCQl9IGVsc2UgewoJCQlvYmpba2V5XSA9IHZhbHVlOwoJCX0KCgkJcmV0dXJuIG9iajsKCX0KCgljbGFzcyBYbmJFcnJvciBleHRlbmRzIEVycm9yIHsKCQljb25zdHJ1Y3RvcigpIHsKCQkJbGV0IG1lc3NhZ2UgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6ICcnOwoJCQlzdXBlcihtZXNzYWdlKTsKCQkJdGhpcy5uYW1lID0gIlhuYkVycm9yIjsKCQkJdGhpcy5tZXNzYWdlID0gbWVzc2FnZTsKCQkJRXJyb3IuY2FwdHVyZVN0YWNrVHJhY2UodGhpcywgWG5iRXJyb3IpOwoJCX0KCgl9CgoJZnVuY3Rpb24gcmVtb3ZlRXh0ZXJuQnJhY2tldChzdHIpIHsKCQlsZXQgYnJhY2tldFN0YWNrID0gW107CgkJbGV0IHJlc3VsdCA9IFtdOwoKCQlmb3IgKGxldCBpID0gMDsgaSA8IHN0ci5sZW5ndGg7IGkrKykgewoJCQlsZXQgYyA9IHN0cltpXTsKCQkJaWYgKGMgPT09ICJbIikgYnJhY2tldFN0YWNrLnB1c2goaSk7ZWxzZSBpZiAoYyA9PT0gIl0iKSB7CgkJCQlsZXQgc3RhcnRQb2ludCA9IGJyYWNrZXRTdGFjay5wb3AoKTsKCQkJCWlmIChzdGFydFBvaW50ID09PSB1bmRlZmluZWQpIHRocm93IG5ldyBFcnJvcigiSW52YWxpZCBCcmFja2V0IEZvcm0hIik7CgkJCQlpZiAoYnJhY2tldFN0YWNrLmxlbmd0aCA9PT0gMCkgcmVzdWx0LnB1c2goc3RyLnNsaWNlKHN0YXJ0UG9pbnQgKyAxLCBpKSk7CgkJCX0KCQl9CgoJCXJldHVybiByZXN1bHQ7Cgl9CgoJY2xhc3MgVHlwZVJlYWRlciB7CgkJc3RhdGljIHNldFJlYWRlcnMocmVhZGVycykgewoJCQlUeXBlUmVhZGVyLnJlYWRlcnMgPSBfb2JqZWN0U3ByZWFkMih7fSwgcmVhZGVycyk7CgkJfQoKCQlzdGF0aWMgYWRkUmVhZGVycyhyZWFkZXJzKSB7CgkJCVR5cGVSZWFkZXIucmVhZGVycyA9IF9vYmplY3RTcHJlYWQyKF9vYmplY3RTcHJlYWQyKHt9LCBUeXBlUmVhZGVyLnJlYWRlcnMpLCByZWFkZXJzKTsKCQl9CgoJCXN0YXRpYyBtYWtlU2ltcGxpZWQodHlwZSwgcmVhZGVyKSB7CgkJCWxldCBzaW1wbGUgPSB0eXBlLnNwbGl0KC9gfCwvKVswXTsKCgkJCWlmIChyZWFkZXIuaXNUeXBlT2Yoc2ltcGxlKSkgewoJCQkJaWYgKHJlYWRlci5oYXNTdWJUeXBlKCkpIHsKCQkJCQlsZXQgc3VidHlwZXMgPSBUeXBlUmVhZGVyLnBhcnNlU3VidHlwZXModHlwZSkubWFwKFR5cGVSZWFkZXIuc2ltcGxpZnlUeXBlLmJpbmQoVHlwZVJlYWRlcikpOwoJCQkJCXJldHVybiAiIi5jb25jYXQocmVhZGVyLnR5cGUoKSwgIjwiKS5jb25jYXQoc3VidHlwZXMuam9pbigiLCIpLCAiPiIpOwoJCQkJfSBlbHNlIHJldHVybiByZWFkZXIudHlwZSgpOwoJCQl9CgoJCQlyZXR1cm4gbnVsbDsKCQl9CgoJCXN0YXRpYyBzaW1wbGlmeVR5cGUodHlwZSkgewoJCQlsZXQgc2ltcGxlID0gdHlwZS5zcGxpdCgvYHwsLylbMF07CgkJCWxldCBpc0FycmF5ID0gc2ltcGxlLmVuZHNXaXRoKCdbXScpOwoJCQlpZiAoaXNBcnJheSkgcmV0dXJuICJBcnJheTwiLmNvbmNhdChzaW1wbGlmeVR5cGUoc2ltcGxlLnNsaWNlKDAsIC0yKSksICI+Iik7CgoJCQlpZiAoc2ltcGxlID09PSAnTWljcm9zb2Z0LlhuYS5GcmFtZXdvcmsuQ29udGVudC5SZWZsZWN0aXZlUmVhZGVyJykgewoJCQkJCWxldCByZWZsZWN0aXZlVHlwZSA9IFR5cGVSZWFkZXIucGFyc2VTdWJ0eXBlcyh0eXBlKS5tYXAoVHlwZVJlYWRlci5zaW1wbGlmeVR5cGUuYmluZChUeXBlUmVhZGVyKSk7CgkJCQkJcmV0dXJuICIiLmNvbmNhdChyZWZsZWN0aXZlVHlwZSk7CgkJCQl9CgoJCQlmb3IgKGxldCByZWFkZXIgb2YgT2JqZWN0LnZhbHVlcyhUeXBlUmVhZGVyLnJlYWRlcnMpKSB7CgkJCQlsZXQgcmVzdWx0ID0gVHlwZVJlYWRlci5tYWtlU2ltcGxpZWQodHlwZSwgcmVhZGVyKTsKCQkJCWlmIChyZXN1bHQgIT09IG51bGwpIHJldHVybiByZXN1bHQ7CgkJCX0KCgkJCXRocm93IG5ldyBYbmJFcnJvcigiTm9uLWltcGxlbWVudGVkIHR5cGUgZm91bmQsIGNhbm5vdCByZXNvbHZlIHR5cGUgXCIiLmNvbmNhdChzaW1wbGUsICJcIiwgXCIiKS5jb25jYXQodHlwZSwgIlwiLiIpKTsKCQl9CgoJCXN0YXRpYyBwYXJzZVN1YnR5cGVzKHR5cGUpIHsKCQkJbGV0IHN1YnR5cGUgPSB0eXBlLnNsaWNlKHR5cGUuc2VhcmNoKCJgIikgKyAxKTsKCQkJc3VidHlwZVswXTsKCQkJc3VidHlwZSA9IHJlbW92ZUV4dGVybkJyYWNrZXQoc3VidHlwZSlbMF07CgkJCWxldCBtYXRjaGVzID0gcmVtb3ZlRXh0ZXJuQnJhY2tldChzdWJ0eXBlKTsKCQkJcmV0dXJuIG1hdGNoZXM7CgkJfQoKCQlzdGF0aWMgZ2V0VHlwZUluZm8odHlwZSkgewoJCQlsZXQgbWFpblR5cGUgPSB0eXBlLm1hdGNoKC9bXjxdKy8pWzBdOwoJCQlsZXQgc3VidHlwZXMgPSB0eXBlLm1hdGNoKC88KC4rKT4vKTsKCQkJc3VidHlwZXMgPSBzdWJ0eXBlcyA/IHN1YnR5cGVzWzFdLnNwbGl0KCcsJykubWFwKHR5cGUgPT4gdHlwZS50cmltKCkpIDogW107CgkJCXJldHVybiB7CgkJCQl0eXBlOiBtYWluVHlwZSwKCQkJCXN1YnR5cGVzCgkJCX07CgkJfQoKCQlzdGF0aWMgZ2V0UmVhZGVyVHlwZUxpc3QodHlwZVN0cmluZykgewoJCQlsZXQgcmVhZGVyID0gVHlwZVJlYWRlci5nZXRSZWFkZXIodHlwZVN0cmluZyk7CgkJCXJldHVybiByZWFkZXIucGFyc2VUeXBlTGlzdCgpOwoJCX0KCgkJc3RhdGljIGdldFJlYWRlcih0eXBlU3RyaW5nKSB7CgkJCWxldCB7CgkJCQl0eXBlLAoJCQkJc3VidHlwZXMKCQkJfSA9IFR5cGVSZWFkZXIuZ2V0VHlwZUluZm8odHlwZVN0cmluZyk7CgkJCXN1YnR5cGVzID0gc3VidHlwZXMubWFwKFR5cGVSZWFkZXIuZ2V0UmVhZGVyLmJpbmQoVHlwZVJlYWRlcikpOwoJCQlpZiAoVHlwZVJlYWRlci5yZWFkZXJzLmhhc093blByb3BlcnR5KCIiLmNvbmNhdCh0eXBlLCAiUmVhZGVyIikpKSByZXR1cm4gbmV3IFR5cGVSZWFkZXIucmVhZGVyc1siIi5jb25jYXQodHlwZSwgIlJlYWRlciIpXSguLi5zdWJ0eXBlcyk7CgkJCXRocm93IG5ldyBYbmJFcnJvcigiSW52YWxpZCByZWFkZXIgdHlwZSBcIiIuY29uY2F0KHR5cGVTdHJpbmcsICJcIiBwYXNzZWQsIHVuYWJsZSB0byByZXNvbHZlISIpKTsKCQl9CgoJCXN0YXRpYyBnZXRSZWFkZXJGcm9tUmF3KHR5cGVTdHJpbmcpIHsKCQkJY29uc3Qgc2ltcGxpZmllZCA9IFR5cGVSZWFkZXIuc2ltcGxpZnlUeXBlKHR5cGVTdHJpbmcpOwoJCQlyZXR1cm4gVHlwZVJlYWRlci5nZXRSZWFkZXIoc2ltcGxpZmllZCk7CgkJfQoKCX0KCglfZGVmaW5lUHJvcGVydHkoVHlwZVJlYWRlciwgInJlYWRlcnMiLCB7fSk7CgoJY29uc3QgVVRGOF9GSVJTVF9CSVRFUyA9IFsweEMwLCAweEUwLCAweEYwXTsKCWNvbnN0IFVURjhfU0VDT05EX0JJVEVTID0gMHg4MDsKCWNvbnN0IFVURjhfTUFTSyA9IDBiMTExMTExOwoJY29uc3QgVVRGMTZfQklURVMkMSA9IFsweEQ4MDAsIDB4REMwMF07Cgljb25zdCBVVEYxNl9NQVNLJDEgPSAwYjExMTExMTExMTE7CgoJZnVuY3Rpb24gVVRGOEVuY29kZShjb2RlKSB7CgkJaWYgKGNvZGUgPCAweDgwKSByZXR1cm4gW2NvZGVdOwoJCWlmIChjb2RlIDwgMHg4MDApIHJldHVybiBbVVRGOF9GSVJTVF9CSVRFU1swXSB8IGNvZGUgPj4gNiwgVVRGOF9TRUNPTkRfQklURVMgfCBjb2RlICYgVVRGOF9NQVNLXTsKCQlpZiAoY29kZSA8IDB4MTAwMDApIHJldHVybiBbVVRGOF9GSVJTVF9CSVRFU1sxXSB8IGNvZGUgPj4gMTIsIFVURjhfU0VDT05EX0JJVEVTIHwgY29kZSA+PiA2ICYgVVRGOF9NQVNLLCBVVEY4X1NFQ09ORF9CSVRFUyB8IGNvZGUgJiBVVEY4X01BU0tdOwoJCXJldHVybiBbVVRGOF9GSVJTVF9CSVRFU1syXSB8IGNvZGUgPj4gMTgsIFVURjhfU0VDT05EX0JJVEVTIHwgY29kZSA+PiAxMiAmIFVURjhfTUFTSywgVVRGOF9TRUNPTkRfQklURVMgfCBjb2RlID4+IDYgJiBVVEY4X01BU0ssIFVURjhfU0VDT05EX0JJVEVTIHwgY29kZSAmIFVURjhfTUFTS107Cgl9CgoJZnVuY3Rpb24gVVRGMTZFbmNvZGUoY29kZSkgewoJCWlmIChjb2RlIDwgMHhGRkZGKSByZXR1cm4gW2NvZGVdOwoJCWNvZGUgLT0gMHgxMDAwMDsKCQlyZXR1cm4gW1VURjE2X0JJVEVTJDFbMF0gfCBjb2RlID4+IDEwICYgVVRGMTZfTUFTSyQxLCBVVEYxNl9CSVRFUyQxWzFdIHwgY29kZSAmIFVURjE2X01BU0skMV07Cgl9CgoJZnVuY3Rpb24gVVRGOERlY29kZShjb2RlU2V0KSB7CgkJdmFyIF9jb2RlU2V0OwoKCQlpZiAodHlwZW9mIGNvZGVTZXQgPT09ICJudW1iZXIiKSBjb2RlU2V0ID0gW2NvZGVTZXRdOwoJCWlmICghKChfY29kZVNldCA9IGNvZGVTZXQpICE9PSBudWxsICYmIF9jb2RlU2V0ICE9PSB2b2lkIDAgJiYgX2NvZGVTZXQubGVuZ3RoKSkgdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIGNvZGVzZXQhIik7CgkJY29uc3QgY29kZVNldFJhbmdlID0gY29kZVNldC5sZW5ndGg7CgkJaWYgKGNvZGVTZXRSYW5nZSA9PT0gMSkgcmV0dXJuIGNvZGVTZXRbMF07CgkJaWYgKGNvZGVTZXRSYW5nZSA9PT0gMikgcmV0dXJuICgoY29kZVNldFswXSBeIFVURjhfRklSU1RfQklURVNbMF0pIDw8IDYpICsgKGNvZGVTZXRbMV0gXiBVVEY4X1NFQ09ORF9CSVRFUyk7CgoJCWlmIChjb2RlU2V0UmFuZ2UgPT09IDMpIHsKCQkJcmV0dXJuICgoY29kZVNldFswXSBeIFVURjhfRklSU1RfQklURVNbMV0pIDw8IDEyKSArICgoY29kZVNldFsxXSBeIFVURjhfU0VDT05EX0JJVEVTKSA8PCA2KSArIChjb2RlU2V0WzJdIF4gVVRGOF9TRUNPTkRfQklURVMpOwoJCX0KCgkJcmV0dXJuICgoY29kZVNldFswXSBeIFVURjhfRklSU1RfQklURVNbMl0pIDw8IDE4KSArICgoY29kZVNldFsxXSBeIFVURjhfU0VDT05EX0JJVEVTKSA8PCAxMikgKyAoKGNvZGVTZXRbMl0gXiBVVEY4X1NFQ09ORF9CSVRFUykgPDwgNikgKyAoY29kZVNldFszXSBeIFVURjhfU0VDT05EX0JJVEVTKTsKCX0KCglmdW5jdGlvbiBVVEYxNkRlY29kZSQxKGNvZGVTZXQpIHsKCQl2YXIgX2NvZGVTZXQyOwoKCQlpZiAodHlwZW9mIGNvZGVTZXQgPT09ICJudW1iZXIiKSBjb2RlU2V0ID0gW2NvZGVTZXRdOwoJCWlmICghKChfY29kZVNldDIgPSBjb2RlU2V0KSAhPT0gbnVsbCAmJiBfY29kZVNldDIgIT09IHZvaWQgMCAmJiBfY29kZVNldDIubGVuZ3RoKSkgdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIGNvZGVzZXQhIik7CgkJY29uc3QgY29kZVNldFJhbmdlID0gY29kZVNldC5sZW5ndGg7CgkJaWYgKGNvZGVTZXRSYW5nZSA9PT0gMSkgcmV0dXJuIGNvZGVTZXRbMF07CgkJcmV0dXJuICgoY29kZVNldFswXSAmIFVURjE2X01BU0skMSkgPDwgMTApICsgKGNvZGVTZXRbMV0gJiBVVEYxNl9NQVNLJDEpICsgMHgxMDAwMDsKCX0KCglmdW5jdGlvbiBzdHJpbmdUb1VuaWNvZGUkMShzdHIpIHsKCQljb25zdCB1dGYxNk1hcCA9IEFycmF5LmZyb20oewoJCQlsZW5ndGg6IHN0ci5sZW5ndGgKCQl9LCAoXywgaSkgPT4gc3RyLmNoYXJDb2RlQXQoaSkpOwoJCWNvbnN0IHJlc3VsdCA9IFtdOwoJCWxldCBpbmRleCA9IDA7CgoJCXdoaWxlIChpbmRleCA8IHN0ci5sZW5ndGgpIHsKCQkJbGV0IGNvZGUgPSB1dGYxNk1hcFtpbmRleF07CgoJCQlpZiAoKFVURjE2X0JJVEVTJDFbMF0gJiBjb2RlKSAhPT0gVVRGMTZfQklURVMkMVswXSkgewoJCQkJcmVzdWx0LnB1c2goY29kZSk7CgkJCQlpbmRleCsrOwoJCQl9IGVsc2UgewoJCQkJcmVzdWx0LnB1c2goVVRGMTZEZWNvZGUkMSh1dGYxNk1hcC5zbGljZShpbmRleCwgaW5kZXggKyAyKSkpOwoJCQkJaW5kZXggKz0gMjsKCQkJfQoJCX0KCgkJcmV0dXJuIHJlc3VsdDsKCX0KCglmdW5jdGlvbiBVVEY4VG9Vbmljb2RlKGNvZGVzKSB7CgkJY29uc3QgZGF0YUFycmF5ID0gY29kZXMgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlciA/IG5ldyBVaW50OEFycmF5KGNvZGVzKSA6IGNvZGVzOwoJCWNvbnN0IHJlc3VsdCA9IFtdOwoJCWxldCBpbmRleCA9IDA7CgoJCXdoaWxlIChpbmRleCA8IGRhdGFBcnJheS5sZW5ndGgpIHsKCQkJbGV0IGhlYWRlckNvZGUgPSBkYXRhQXJyYXlbaW5kZXhdOwoKCQkJaWYgKChoZWFkZXJDb2RlICYgMHg4MCkgPT09IDApIHsKCQkJCXJlc3VsdC5wdXNoKGhlYWRlckNvZGUpOwoJCQkJaW5kZXgrKzsKCQkJfSBlbHNlIGlmIChoZWFkZXJDb2RlIDwgVVRGOF9GSVJTVF9CSVRFU1sxXSkgewoJCQkJcmVzdWx0LnB1c2goVVRGOERlY29kZShkYXRhQXJyYXkuc2xpY2UoaW5kZXgsIGluZGV4ICsgMikpKTsKCQkJCWluZGV4ICs9IDI7CgkJCX0gZWxzZSBpZiAoaGVhZGVyQ29kZSA8IFVURjhfRklSU1RfQklURVNbMl0pIHsKCQkJCXJlc3VsdC5wdXNoKFVURjhEZWNvZGUoZGF0YUFycmF5LnNsaWNlKGluZGV4LCBpbmRleCArIDMpKSk7CgkJCQlpbmRleCArPSAzOwoJCQl9IGVsc2UgewoJCQkJcmVzdWx0LnB1c2goVVRGOERlY29kZShkYXRhQXJyYXkuc2xpY2UoaW5kZXgsIGluZGV4ICsgNCkpKTsKCQkJCWluZGV4ICs9IDQ7CgkJCX0KCQl9CgoJCXJldHVybiByZXN1bHQ7Cgl9CgoJZnVuY3Rpb24gVW5pY29kZVRvVVRGOCh1bmljb2RlQXJyKSB7CgkJY29uc3QgcmVzdWx0ID0gW107CgoJCWZvciAobGV0IGNvZGUgb2YgdW5pY29kZUFycikgewoJCQlyZXN1bHQucHVzaCguLi5VVEY4RW5jb2RlKGNvZGUpKTsKCQl9CgoJCXJldHVybiByZXN1bHQ7Cgl9CgoJZnVuY3Rpb24gVW5pY29kZVRvU3RyaW5nKHVuaWNvZGVBcnIpIHsKCQljb25zdCByZXN1bHQgPSBbXTsKCgkJZm9yIChsZXQgY29kZSBvZiB1bmljb2RlQXJyKSB7CgkJCXJlc3VsdC5wdXNoKC4uLlVURjE2RW5jb2RlKGNvZGUpKTsKCQl9CgoJCWNvbnN0IGJsb2NrU2l6ZSA9IDMyNzY4OwoJCWxldCByZXN1bHRTdHIgPSAiIjsKCgkJZm9yIChsZXQgaSA9IDA7IGkgPCByZXN1bHQubGVuZ3RoIC8gYmxvY2tTaXplOyBpKyspIHsKCQkJcmVzdWx0U3RyICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoLi4ucmVzdWx0LnNsaWNlKGkgKiBibG9ja1NpemUsIChpICsgMSkgKiBibG9ja1NpemUpKTsKCQl9CgoJCXJldHVybiByZXN1bHRTdHI7Cgl9CgoJZnVuY3Rpb24gc3RyaW5nVG9VVEY4KHN0cikgewoJCXJldHVybiBVbmljb2RlVG9VVEY4KHN0cmluZ1RvVW5pY29kZSQxKHN0cikpOwoJfQoKCWZ1bmN0aW9uIFVURjhUb1N0cmluZyh1dGY4QXJyYXkpIHsKCQlyZXR1cm4gVW5pY29kZVRvU3RyaW5nKFVURjhUb1VuaWNvZGUodXRmOEFycmF5KSk7Cgl9CgoJZnVuY3Rpb24gVVRGOExlbmd0aCQxKHN0cikgewoJCWNvbnN0IGNvZGVzID0gc3RyaW5nVG9Vbmljb2RlJDEoc3RyKTsKCQlyZXR1cm4gY29kZXMucmVkdWNlKChzdW0sIHVuaWNvZGUpID0+IHsKCQkJaWYgKHVuaWNvZGUgPCAweDgwKSByZXR1cm4gc3VtICsgMTsKCQkJaWYgKHVuaWNvZGUgPCAweDgwMCkgcmV0dXJuIHN1bSArIDI7CgkJCWlmICh1bmljb2RlIDwgMHgxMDAwMCkgcmV0dXJuIHN1bSArIDM7CgkJCXJldHVybiBzdW0gKyA0OwoJCX0sIDApOwoJfQoKCWNvbnN0IExJVFRMRV9FTkRJQU4gPSB0cnVlOwoKCWNsYXNzIEJ1ZmZlclJlYWRlciB7CgkJY29uc3RydWN0b3IoYnVmZmVyKSB7CgkJCWxldCBlbmRpYW51cyA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogTElUVExFX0VORElBTjsKCQkJdGhpcy5fZW5kaWFudXMgPSBlbmRpYW51czsKCQkJdGhpcy5fYnVmZmVyID0gYnVmZmVyLnNsaWNlKCk7CgkJCXRoaXMuX2RhdGFWaWV3ID0gbmV3IERhdGFWaWV3KHRoaXMuX2J1ZmZlcik7CgkJCXRoaXMuX29mZnNldCA9IDA7CgkJCXRoaXMuX2JpdE9mZnNldCA9IDA7CgkJfQoKCQlzZWVrKGluZGV4KSB7CgkJCWxldCBvcmlnaW4gPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHRoaXMuX29mZnNldDsKCQkJY29uc3Qgb2Zmc2V0ID0gdGhpcy5fb2Zmc2V0OwoJCQl0aGlzLl9vZmZzZXQgPSBNYXRoLm1heChvcmlnaW4gKyBOdW1iZXIucGFyc2VJbnQoaW5kZXgpLCAwKTsKCQkJaWYgKHRoaXMuX29mZnNldCA8IDAgfHwgdGhpcy5fb2Zmc2V0ID4gdGhpcy5idWZmZXIubGVuZ3RoKSB0aHJvdyBuZXcgUmFuZ2VFcnJvcigiQnVmZmVyIHNlZWsgb3V0IG9mIGJvdW5kcyEgIi5jb25jYXQodGhpcy5fb2Zmc2V0LCAiICIpLmNvbmNhdCh0aGlzLmJ1ZmZlci5sZW5ndGgpKTsKCQkJcmV0dXJuIHRoaXMuX29mZnNldCAtIG9mZnNldDsKCQl9CgoJCWdldCBieXRlUG9zaXRpb24oKSB7CgkJCXJldHVybiBOdW1iZXIucGFyc2VJbnQodGhpcy5fb2Zmc2V0KTsKCQl9CgoJCXNldCBieXRlUG9zaXRpb24odmFsdWUpIHsKCQkJdGhpcy5fb2Zmc2V0ID0gdmFsdWU7CgkJfQoKCQlnZXQgYml0UG9zaXRpb24oKSB7CgkJCXJldHVybiBOdW1iZXIucGFyc2VJbnQodGhpcy5fYml0T2Zmc2V0KTsKCQl9CgoJCXNldCBiaXRQb3NpdGlvbihvZmZzZXQpIHsKCQkJaWYgKG9mZnNldCA8IDApIG9mZnNldCA9IDE2IC0gb2Zmc2V0OwoJCQl0aGlzLl9iaXRPZmZzZXQgPSBvZmZzZXQgJSAxNjsKCQkJY29uc3QgYnl0ZVNlZWsgPSAob2Zmc2V0IC0gTWF0aC5hYnMob2Zmc2V0KSAlIDE2KSAvIDE2ICogMjsKCQkJdGhpcy5zZWVrKGJ5dGVTZWVrKTsKCQl9CgoJCWdldCBzaXplKCkgewoJCQlyZXR1cm4gdGhpcy5idWZmZXIuYnl0ZUxlbmd0aDsKCQl9CgoJCWdldCBidWZmZXIoKSB7CgkJCXJldHVybiB0aGlzLl9idWZmZXI7CgkJfQoKCQljb3B5RnJvbShidWZmZXIpIHsKCQkJbGV0IHRhcmdldEluZGV4ID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiAwOwoJCQlsZXQgc291cmNlSW5kZXggPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IDA7CgkJCWxldCBsZW5ndGggPSBhcmd1bWVudHMubGVuZ3RoID4gMyAmJiBhcmd1bWVudHNbM10gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1szXSA6IGJ1ZmZlci5ieXRlTGVuZ3RoOwoJCQljb25zdCBzb3VyY2VWaWV3ID0gbmV3IFVpbnQ4QXJyYXkoYnVmZmVyKTsKCQkJY29uc3QgaXNPdmVyZmxvdyA9IHRoaXMuYnVmZmVyLmJ5dGVMZW5ndGggPCBsZW5ndGggKyB0YXJnZXRJbmRleDsKCQkJbGV0IHRhcmdldEJ1ZmZlciA9IHRoaXMuYnVmZmVyOwoJCQlsZXQgdGFyZ2V0VmlldyA9IHRoaXMuX2RhdGFWaWV3OwoKCQkJaWYgKGlzT3ZlcmZsb3cpIHsKCQkJCXRhcmdldEJ1ZmZlciA9IG5ldyBBcnJheUJ1ZmZlcih0aGlzLmJ1ZmZlci5ieXRlTGVuZ3RoICsgKGxlbmd0aCArIHRhcmdldEluZGV4IC0gdGhpcy5idWZmZXIuYnl0ZUxlbmd0aCkpOwoJCQkJdGFyZ2V0VmlldyA9IG5ldyBEYXRhVmlldyh0YXJnZXRCdWZmZXIpOwoKCQkJCWZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5idWZmZXIuYnl0ZUxlbmd0aDsgaSsrKSB7CgkJCQkJdGFyZ2V0Vmlldy5zZXRVaW50OChpLCB0aGlzLl9kYXRhVmlldy5nZXRVaW50OChpKSk7CgkJCQl9CgkJCX0KCgkJCWZvciAobGV0IGkgPSBzb3VyY2VJbmRleCwgaiA9IHRhcmdldEluZGV4OyBpIDwgbGVuZ3RoOyBpKyssIGorKykgewoJCQkJdGFyZ2V0Vmlldy5zZXRVaW50OChqLCBzb3VyY2VWaWV3W2ldKTsKCQkJfQoKCQkJaWYgKGlzT3ZlcmZsb3cpIHsKCQkJCXRoaXMuX2J1ZmZlciA9IHRhcmdldEJ1ZmZlcjsKCQkJCXRoaXMuX2RhdGFWaWV3ID0gdGFyZ2V0VmlldzsKCQkJfQoJCX0KCgkJcmVhZChjb3VudCkgewoJCQljb25zdCBidWZmZXIgPSB0aGlzLmJ1ZmZlci5zbGljZSh0aGlzLl9vZmZzZXQsIHRoaXMuX29mZnNldCArIGNvdW50KTsKCQkJdGhpcy5zZWVrKGNvdW50KTsKCQkJcmV0dXJuIGJ1ZmZlcjsKCQl9CgoJCXJlYWRCeXRlKCkgewoJCQlyZXR1cm4gdGhpcy5yZWFkVUludCgpOwoJCX0KCgkJcmVhZEludCgpIHsKCQkJY29uc3QgdmFsdWUgPSB0aGlzLl9kYXRhVmlldy5nZXRJbnQ4KHRoaXMuX29mZnNldCk7CgoJCQl0aGlzLnNlZWsoMSk7CgkJCXJldHVybiB2YWx1ZTsKCQl9CgoJCXJlYWRVSW50KCkgewoJCQljb25zdCB2YWx1ZSA9IHRoaXMuX2RhdGFWaWV3LmdldFVpbnQ4KHRoaXMuX29mZnNldCk7CgoJCQl0aGlzLnNlZWsoMSk7CgkJCXJldHVybiB2YWx1ZTsKCQl9CgoJCXJlYWRVSW50MTYoKSB7CgkJCWNvbnN0IHZhbHVlID0gdGhpcy5fZGF0YVZpZXcuZ2V0VWludDE2KHRoaXMuX29mZnNldCwgdGhpcy5fZW5kaWFudXMpOwoKCQkJdGhpcy5zZWVrKDIpOwoJCQlyZXR1cm4gdmFsdWU7CgkJfQoKCQlyZWFkVUludDMyKCkgewoJCQljb25zdCB2YWx1ZSA9IHRoaXMuX2RhdGFWaWV3LmdldFVpbnQzMih0aGlzLl9vZmZzZXQsIHRoaXMuX2VuZGlhbnVzKTsKCgkJCXRoaXMuc2Vlayg0KTsKCQkJcmV0dXJuIHZhbHVlOwoJCX0KCgkJcmVhZEludDE2KCkgewoJCQljb25zdCB2YWx1ZSA9IHRoaXMuX2RhdGFWaWV3LmdldEludDE2KHRoaXMuX29mZnNldCwgdGhpcy5fZW5kaWFudXMpOwoKCQkJdGhpcy5zZWVrKDIpOwoJCQlyZXR1cm4gdmFsdWU7CgkJfQoKCQlyZWFkSW50MzIoKSB7CgkJCWNvbnN0IHZhbHVlID0gdGhpcy5fZGF0YVZpZXcuZ2V0SW50MzIodGhpcy5fb2Zmc2V0LCB0aGlzLl9lbmRpYW51cyk7CgoJCQl0aGlzLnNlZWsoNCk7CgkJCXJldHVybiB2YWx1ZTsKCQl9CgoJCXJlYWRTaW5nbGUoKSB7CgkJCWNvbnN0IHZhbHVlID0gdGhpcy5fZGF0YVZpZXcuZ2V0RmxvYXQzMih0aGlzLl9vZmZzZXQsIHRoaXMuX2VuZGlhbnVzKTsKCgkJCXRoaXMuc2Vlayg0KTsKCQkJcmV0dXJuIHZhbHVlOwoJCX0KCgkJcmVhZERvdWJsZSgpIHsKCQkJY29uc3QgdmFsdWUgPSB0aGlzLl9kYXRhVmlldy5nZXRGbG9hdDMyKHRoaXMuX29mZnNldCwgdGhpcy5fZW5kaWFudXMpOwoKCQkJdGhpcy5zZWVrKDgpOwoJCQlyZXR1cm4gdmFsdWU7CgkJfQoKCQlyZWFkU3RyaW5nKCkgewoJCQlsZXQgY291bnQgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IC0xOwoJCQljb25zdCBjaGFycyA9IFtdOwoJCQl0aGlzLl9vZmZzZXQ7CgoJCQlpZiAoY291bnQgPT09IC0xKSB7CgkJCQl3aGlsZSAodGhpcy5wZWVrQnl0ZSgxKSAhPSAweDApIGNoYXJzLnB1c2godGhpcy5yZWFkQnl0ZSgpKTsKCQkJfSBlbHNlIHsKCQkJCWZvciAobGV0IGkgPSAwOyBpIDwgY291bnQ7IGkrKykgewoJCQkJCWNoYXJzLnB1c2godGhpcy5yZWFkQnl0ZSgpKTsKCQkJCX0KCQkJfQoKCQkJcmV0dXJuIFVURjhUb1N0cmluZyhjaGFycyk7CgkJfQoKCQlwZWVrKGNvdW50KSB7CgkJCWNvbnN0IGJ1ZmZlciA9IHRoaXMucmVhZChjb3VudCk7CgkJCXRoaXMuc2VlaygtY291bnQpOwoJCQlyZXR1cm4gYnVmZmVyOwoJCX0KCgkJcGVla0J5dGUoKSB7CgkJCXJldHVybiB0aGlzLnBlZWtVSW50KCk7CgkJfQoKCQlwZWVrSW50KCkgewoJCQljb25zdCB2YWx1ZSA9IHRoaXMuX2RhdGFWaWV3LmdldEludDgodGhpcy5fb2Zmc2V0KTsKCgkJCXJldHVybiB2YWx1ZTsKCQl9CgoJCXBlZWtVSW50KCkgewoJCQljb25zdCB2YWx1ZSA9IHRoaXMuX2RhdGFWaWV3LmdldFVpbnQ4KHRoaXMuX29mZnNldCk7CgoJCQlyZXR1cm4gdmFsdWU7CgkJfQoKCQlwZWVrVUludDE2KCkgewoJCQljb25zdCB2YWx1ZSA9IHRoaXMuX2RhdGFWaWV3LmdldFVpbnQxNih0aGlzLl9vZmZzZXQsIHRoaXMuX2VuZGlhbnVzKTsKCgkJCXJldHVybiB2YWx1ZTsKCQl9CgoJCXBlZWtVSW50MzIoKSB7CgkJCWNvbnN0IHZhbHVlID0gdGhpcy5fZGF0YVZpZXcuZ2V0VWludDMyKHRoaXMuX29mZnNldCwgdGhpcy5fZW5kaWFudXMpOwoKCQkJcmV0dXJuIHZhbHVlOwoJCX0KCgkJcGVla0ludDE2KCkgewoJCQljb25zdCB2YWx1ZSA9IHRoaXMuX2RhdGFWaWV3LmdldEludDE2KHRoaXMuX29mZnNldCwgdGhpcy5fZW5kaWFudXMpOwoKCQkJcmV0dXJuIHZhbHVlOwoJCX0KCgkJcGVla0ludDMyKCkgewoJCQljb25zdCB2YWx1ZSA9IHRoaXMuX2RhdGFWaWV3LmdldEludDMyKHRoaXMuX29mZnNldCwgdGhpcy5fZW5kaWFudXMpOwoKCQkJcmV0dXJuIHZhbHVlOwoJCX0KCgkJcGVla1NpbmdsZSgpIHsKCQkJY29uc3QgdmFsdWUgPSB0aGlzLl9kYXRhVmlldy5nZXRGbG9hdDMyKHRoaXMuX29mZnNldCwgdGhpcy5fZW5kaWFudXMpOwoKCQkJcmV0dXJuIHZhbHVlOwoJCX0KCgkJcGVla0RvdWJsZSgpIHsKCQkJY29uc3QgdmFsdWUgPSB0aGlzLl9kYXRhVmlldy5nZXRGbG9hdDY0KHRoaXMuX29mZnNldCwgdGhpcy5fZW5kaWFudXMpOwoKCQkJcmV0dXJuIHZhbHVlOwoJCX0KCgkJcGVla1N0cmluZygpIHsKCQkJbGV0IGNvdW50ID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiAwOwoJCQljb25zdCBjaGFycyA9IFtdOwoJCQljb25zdCBzdGFydE9mZnNldCA9IHRoaXMuX29mZnNldDsKCgkJCWlmIChjb3VudCA9PT0gMCkgewoJCQkJd2hpbGUgKHRoaXMucGVla0J5dGUoMSkgIT0gMHgwKSBjaGFycy5wdXNoKHRoaXMucmVhZEJ5dGUoKSk7CgkJCX0gZWxzZSB7CgkJCQlmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyBpKyspIHsKCQkJCQljaGFycy5wdXNoKHRoaXMucmVhZEJ5dGUoKSk7CgkJCQl9CgkJCX0KCgkJCXRoaXMuYnl0ZVBvc2l0aW9uID0gc3RhcnRPZmZzZXQ7CgkJCXJldHVybiBVVEY4VG9TdHJpbmcoY2hhcnMpOwoJCX0KCgkJcmVhZDdCaXROdW1iZXIoKSB7CgkJCWxldCByZXN1bHQgPSAwOwoJCQlsZXQgYml0c1JlYWQgPSAwOwoJCQlsZXQgdmFsdWU7CgoJCQlkbyB7CgkJCQl2YWx1ZSA9IHRoaXMucmVhZEJ5dGUoKTsKCQkJCXJlc3VsdCB8PSAodmFsdWUgJiAweDdGKSA8PCBiaXRzUmVhZDsKCQkJCWJpdHNSZWFkICs9IDc7CgkJCX0gd2hpbGUgKHZhbHVlICYgMHg4MCk7CgoJCQlyZXR1cm4gcmVzdWx0OwoJCX0KCgkJcmVhZExaWEJpdHMoYml0cykgewoJCQlsZXQgYml0c0xlZnQgPSBiaXRzOwoJCQlsZXQgcmVhZCA9IDA7CgoJCQl3aGlsZSAoYml0c0xlZnQgPiAwKSB7CgkJCQljb25zdCBwZWVrID0gdGhpcy5fZGF0YVZpZXcuZ2V0VWludDE2KHRoaXMuX29mZnNldCwgdHJ1ZSk7CgoJCQkJY29uc3QgYml0c0luRnJhbWUgPSBNYXRoLm1pbihNYXRoLm1heChiaXRzTGVmdCwgMCksIDE2IC0gdGhpcy5iaXRQb3NpdGlvbik7CgkJCQljb25zdCBvZmZzZXQgPSAxNiAtIHRoaXMuYml0UG9zaXRpb24gLSBiaXRzSW5GcmFtZTsKCQkJCWNvbnN0IHZhbHVlID0gKHBlZWsgJiAyICoqIGJpdHNJbkZyYW1lIC0gMSA8PCBvZmZzZXQpID4+IG9mZnNldDsKCQkJCWJpdHNMZWZ0IC09IGJpdHNJbkZyYW1lOwoJCQkJdGhpcy5iaXRQb3NpdGlvbiArPSBiaXRzSW5GcmFtZTsKCQkJCXJlYWQgfD0gdmFsdWUgPDwgYml0c0xlZnQ7CgkJCX0KCgkJCXJldHVybiByZWFkOwoJCX0KCgkJcGVla0xaWEJpdHMoYml0cykgewoJCQlsZXQgYml0UG9zaXRpb24gPSB0aGlzLmJpdFBvc2l0aW9uOwoJCQlsZXQgYnl0ZVBvc2l0aW9uID0gdGhpcy5ieXRlUG9zaXRpb247CgkJCWNvbnN0IHJlYWQgPSB0aGlzLnJlYWRMWlhCaXRzKGJpdHMpOwoJCQl0aGlzLmJpdFBvc2l0aW9uID0gYml0UG9zaXRpb247CgkJCXRoaXMuYnl0ZVBvc2l0aW9uID0gYnl0ZVBvc2l0aW9uOwoJCQlyZXR1cm4gcmVhZDsKCQl9CgoJCXJlYWRMWlhJbnQxNigpIHsKCQkJbGV0IHNlZWsgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHRydWU7CgkJCWNvbnN0IGxzQiA9IHRoaXMucmVhZEJ5dGUoKTsKCQkJY29uc3QgbXNCID0gdGhpcy5yZWFkQnl0ZSgpOwoJCQlpZiAoIXNlZWspIHRoaXMuc2VlaygtMik7CgkJCXJldHVybiBsc0IgPDwgOCB8IG1zQjsKCQl9CgoJCWFsaWduKCkgewoJCQlpZiAodGhpcy5iaXRQb3NpdGlvbiA+IDApIHRoaXMuYml0UG9zaXRpb24gKz0gMTYgLSB0aGlzLmJpdFBvc2l0aW9uOwoJCX0KCgl9CgoJY2xhc3MgQnVmZmVyV3JpdGVyIHsKCQljb25zdHJ1Y3RvcigpIHsKCQkJbGV0IHNpemUgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IDIwNDg7CgkJCXRoaXMuX2J1ZmZlciA9IG5ldyBBcnJheUJ1ZmZlcihzaXplKTsKCQkJdGhpcy5fZGF0YVZpZXcgPSBuZXcgRGF0YVZpZXcodGhpcy5fYnVmZmVyKTsKCQkJdGhpcy5ieXRlUG9zaXRpb24gPSAwOwoJCX0KCgkJZ2V0IGJ1ZmZlcigpIHsKCQkJcmV0dXJuIHRoaXMuX2J1ZmZlcjsKCQl9CgoJCXJlY29ubmVjdERhdGFWaWV3KCkgewoJCQl0aGlzLl9kYXRhVmlldyA9IG5ldyBEYXRhVmlldyh0aGlzLl9idWZmZXIpOwoJCX0KCgkJdHJpbSgpIHsKCQkJbGV0IHBlbmRpbmcgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IGZhbHNlOwoJCQl0aGlzLl9idWZmZXIgPSB0aGlzLmJ1ZmZlci5zbGljZSgwLCB0aGlzLmJ5dGVQb3NpdGlvbik7CgkJCWlmICghcGVuZGluZykgdGhpcy5yZWNvbm5lY3REYXRhVmlldygpOwoJCX0KCgkJYWxsb2MoYnl0ZXMpIHsKCQkJaWYgKHRoaXMuX2J1ZmZlci5ieXRlTGVuZ3RoIDw9IHRoaXMuYnl0ZVBvc2l0aW9uICsgYnl0ZXMpIHsKCQkJCWNvbnN0IHRCdWZmZXIgPSBuZXcgQXJyYXlCdWZmZXIodGhpcy5fYnVmZmVyLmJ5dGVMZW5ndGggKyBieXRlcyk7CgkJCQljb25zdCB0RGF0YVZpZXcgPSBuZXcgRGF0YVZpZXcodEJ1ZmZlcik7CgoJCQkJZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmJ1ZmZlci5ieXRlTGVuZ3RoOyBpKyspIHsKCQkJCQl0RGF0YVZpZXcuc2V0VWludDgoaSwgdGhpcy5fZGF0YVZpZXcuZ2V0VWludDgoaSkpOwoJCQkJfQoKCQkJCXRoaXMuX2J1ZmZlciA9IHRCdWZmZXI7CgkJCQl0aGlzLl9kYXRhVmlldyA9IHREYXRhVmlldzsKCQkJfQoKCQkJcmV0dXJuIHRoaXM7CgkJfQoKCQljb25jYXQoYnVmZmVyKSB7CgkJCWNvbnN0IHRhcmdldEJ1ZmZlclZpZXcgPSBuZXcgVWludDhBcnJheShidWZmZXIpOwoJCQljb25zdCBuZXdQb3NpdGlvbiA9IHRoaXMuYnl0ZVBvc2l0aW9uICsgdGFyZ2V0QnVmZmVyVmlldy5sZW5ndGg7CgkJCXRoaXMuYWxsb2ModGFyZ2V0QnVmZmVyVmlldy5sZW5ndGgpOwoKCQkJZm9yIChsZXQgaSA9IHRoaXMuYnl0ZVBvc2l0aW9uOyBpIDwgbmV3UG9zaXRpb247IGkrKykgewoJCQkJdGhpcy5fZGF0YVZpZXcuc2V0VWludDgoaSwgdGFyZ2V0QnVmZmVyVmlld1tpIC0gdGhpcy5ieXRlUG9zaXRpb25dKTsKCQkJfQoKCQkJdGhpcy5ieXRlUG9zaXRpb24gPSBuZXdQb3NpdGlvbjsKCQkJdGhpcy50cmltKCk7CgkJfQoKCQl3cml0ZShieXRlcykgewoJCQljb25zdCB0YXJnZXRCdWZmZXJWaWV3ID0gbmV3IFVpbnQ4QXJyYXkoYnl0ZXMpOwoJCQljb25zdCBuZXdQb3NpdGlvbiA9IHRoaXMuYnl0ZVBvc2l0aW9uICsgdGFyZ2V0QnVmZmVyVmlldy5sZW5ndGg7CgkJCXRoaXMuYWxsb2ModGFyZ2V0QnVmZmVyVmlldy5sZW5ndGgpOwoKCQkJZm9yIChsZXQgaSA9IHRoaXMuYnl0ZVBvc2l0aW9uOyBpIDwgbmV3UG9zaXRpb247IGkrKykgewoJCQkJdGhpcy5fZGF0YVZpZXcuc2V0VWludDgoaSwgdGFyZ2V0QnVmZmVyVmlld1tpIC0gdGhpcy5ieXRlUG9zaXRpb25dKTsKCQkJfQoKCQkJdGhpcy5ieXRlUG9zaXRpb24gPSBuZXdQb3NpdGlvbjsKCQl9CgoJCXdyaXRlU3RyaW5nKHN0cikgewoJCQlsZXQgdXRmOERhdGEgPSBzdHJpbmdUb1VURjgoc3RyKTsKCQkJdGhpcy53cml0ZSh1dGY4RGF0YSk7CgkJfQoKCQl3cml0ZUJ5dGUoYnl0ZSkgewoJCQl0aGlzLmFsbG9jKDEpLl9kYXRhVmlldy5zZXRVaW50OCh0aGlzLmJ5dGVQb3NpdGlvbiwgYnl0ZSk7CgoJCQl0aGlzLmJ5dGVQb3NpdGlvbisrOwoJCX0KCgkJd3JpdGVJbnQobnVtYmVyKSB7CgkJCXRoaXMuYWxsb2MoMSkuX2RhdGFWaWV3LnNldEludDgodGhpcy5ieXRlUG9zaXRpb24sIG51bWJlcik7CgoJCQl0aGlzLmJ5dGVQb3NpdGlvbisrOwoJCX0KCgkJd3JpdGVVSW50KG51bWJlcikgewoJCQl0aGlzLmFsbG9jKDEpLl9kYXRhVmlldy5zZXRVaW50OCh0aGlzLmJ5dGVQb3NpdGlvbiwgbnVtYmVyKTsKCgkJCXRoaXMuYnl0ZVBvc2l0aW9uKys7CgkJfQoKCQl3cml0ZUludDE2KG51bWJlcikgewoJCQl0aGlzLmFsbG9jKDIpLl9kYXRhVmlldy5zZXRJbnQxNih0aGlzLmJ5dGVQb3NpdGlvbiwgbnVtYmVyLCB0cnVlKTsKCgkJCXRoaXMuYnl0ZVBvc2l0aW9uICs9IDI7CgkJfQoKCQl3cml0ZVVJbnQxNihudW1iZXIpIHsKCQkJdGhpcy5hbGxvYygyKS5fZGF0YVZpZXcuc2V0VWludDE2KHRoaXMuYnl0ZVBvc2l0aW9uLCBudW1iZXIsIHRydWUpOwoKCQkJdGhpcy5ieXRlUG9zaXRpb24gKz0gMjsKCQl9CgoJCXdyaXRlSW50MzIobnVtYmVyKSB7CgkJCXRoaXMuYWxsb2MoNCkuX2RhdGFWaWV3LnNldEludDMyKHRoaXMuYnl0ZVBvc2l0aW9uLCBudW1iZXIsIHRydWUpOwoKCQkJdGhpcy5ieXRlUG9zaXRpb24gKz0gNDsKCQl9CgoJCXdyaXRlVUludDMyKG51bWJlcikgewoJCQl0aGlzLmFsbG9jKDQpLl9kYXRhVmlldy5zZXRVaW50MzIodGhpcy5ieXRlUG9zaXRpb24sIG51bWJlciwgdHJ1ZSk7CgoJCQl0aGlzLmJ5dGVQb3NpdGlvbiArPSA0OwoJCX0KCgkJd3JpdGVTaW5nbGUobnVtYmVyKSB7CgkJCXRoaXMuYWxsb2MoNCkuX2RhdGFWaWV3LnNldEZsb2F0MzIodGhpcy5ieXRlUG9zaXRpb24sIG51bWJlciwgdHJ1ZSk7CgoJCQl0aGlzLmJ5dGVQb3NpdGlvbiArPSA0OwoJCX0KCgkJd3JpdGVEb3VibGUobnVtYmVyKSB7CgkJCXRoaXMuYWxsb2MoOCkuX2RhdGFWaWV3LnNldEZsb2F0NjQodGhpcy5ieXRlUG9zaXRpb24sIG51bWJlciwgdHJ1ZSk7CgoJCQl0aGlzLmJ5dGVQb3NpdGlvbiArPSA4OwoJCX0KCgkJd3JpdGU3Qml0TnVtYmVyKG51bWJlcikgewoJCQl0aGlzLmFsbG9jKDIpOwoKCQkJZG8gewoJCQkJbGV0IGJ5dGUgPSBudW1iZXIgJiAweDdGOwoJCQkJbnVtYmVyID0gbnVtYmVyID4+IDc7CgkJCQlpZiAobnVtYmVyKSBieXRlIHw9IDB4ODA7CgoJCQkJdGhpcy5fZGF0YVZpZXcuc2V0VWludDgodGhpcy5ieXRlUG9zaXRpb24sIGJ5dGUpOwoKCQkJCXRoaXMuYnl0ZVBvc2l0aW9uKys7CgkJCX0gd2hpbGUgKG51bWJlcik7CgkJfQoKCX0KCgkvKiogQGxpY2Vuc2UKCSAqCgkgKiBUaGlzIGZpbGUgaXMgaGVhdmlseSBiYXNlZCBvbiBNb25vR2FtZSdzIGltcGxlbWVudGF0aW9uIG9mIHRoZWlyIEx6eERlY29kZXIgYXR0cmlidXRlZCB0byBBbGkgU2Npc3NvbnMKCSAqIHdoaWNoIGlzIGRlcml2ZWQgZnJvbSBsaWJtc3BhY2sgYnkgU3R1YXJ0IENvbGUuCgkgKgoJICogKEMpIDIwMDMtMjAwNCBTdHVhcnQgQ2FpZS4KCSAqIChDKSAyMDExIEFsaSBTY2lzc29ucy4KCSAqIChDKSAyMDE3IEphbWVzIFN0aW5lLgoJICoKCSAqIFRoZSBMWlggbWV0aG9kIHdhcyBjcmVhdGVkIGJ5IEpvaG5hdGhhbiBGb3JiZXMgYW5kIFRvbWkgUG91dGFuZW4sIGFkYXB0ZWQgYnkgTWljcm9zb2Z0IENvcnBvcmF0aW9uLgoJICoKCSAqIAoJICogR05VIExFU1NFUiBHRU5FUkFMIFBVQkxJQyBMSUNFTlNFIHZlcnNpb24gMi4xCgkgKiBMenhEZWNvZGVyIGlzIGZyZWUgc29mdHdhcmU7IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkgaXQgdW5kZXIKCSAqIHRoZSB0ZXJtcyBvZiB0aGUgR05VIExlc3NlciBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIChMR1BMKSB2ZXJzaW9uIDIuMSAKCSAqCgkgKiBNSUNST1NPRlQgUFVCTElDIExJQ0VOU0UKCSAqIFRoaXMgc291cmNlIGNvZGUgYSBkZXJpdmF0aXZlIG9uIEx6eERlY29kZXIgYW5kIGlzIHN1YmplY3QgdG8gdGhlIHRlcm1zIG9mIHRoZSBNaWNyb3NvZnQgUHVibGljIExpY2Vuc2UgKE1zLVBMKS4gCgkgKgkKCSAqIFJlZGlzdHJpYnV0aW9uIGFuZCB1c2UgaW4gc291cmNlIGFuZCBiaW5hcnkgZm9ybXMsIHdpdGggb3Igd2l0aG91dCBtb2RpZmljYXRpb24sIAoJICogaXMgcGVybWl0dGVkIHByb3ZpZGVkIHRoYXQgcmVkaXN0cmlidXRpb25zIG9mIHRoZSBzb3VyY2UgY29kZSByZXRhaW4gdGhlIGFib3ZlIAoJICogY29weXJpZ2h0IG5vdGljZXMgYW5kIHRoaXMgZmlsZSBoZWFkZXIuIAoJICoJCgkgKiBBZGRpdGlvbmFsIGNvcHlyaWdodCBub3RpY2VzIHNob3VsZCBiZSBhcHBlbmRlZCB0byB0aGUgbGlzdCBhYm92ZS4gCgkgKiAKCSAqIEZvciBkZXRhaWxzLCBzZWUgPGh0dHA6Ly93d3cub3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvbXMtcGwuaHRtbD4uCgkgKgoJICoKCSAqIEkgbWFkZSB0aGUgbWlzdGFrZSBvZiBub3QgaW5jbHVkaW5nIHRoaXMgbGljZW5zZSB5ZWFycyBhZ28uIEJpZyB0aGFua3MgdG8gZXZlcnlvbmUgaW52b2x2ZWQgYW5kIGxpY2Vuc2UgaGFzIG5vdyBiZWVuCgkgKiBhY2tub3dsZWRlZCBwcm9wZXJseSBhcyBpdCBzaG91bGQgaGF2ZSBiZWVuIGJhY2sgaW4gMjAxNy4KCSAqCgkgKiBSZXNvdXJjZXM6CgkgKgoJICogY2FiZXh0cmFjdC9saWJtc3BhY2sgLSBodHRwOi8vaHR0cDovL3d3dy5jYWJleHRyYWN0Lm9yZy51ay8KCSAqIE1vbm9HYW1lIEx6eERlY29kZXIuY3MgLSBodHRwczovL2dpdGh1Yi5jb20vTW9ub0dhbWUvTW9ub0dhbWUvYmxvYi9tYXN0ZXIvTW9ub0dhbWUuRnJhbWV3b3JrL0NvbnRlbnQvTHp4RGVjb2Rlci5jcwoJICoKCSAqLwoJY29uc3QgTUlOX01BVENIID0gMjsKCWNvbnN0IE5VTV9DSEFSUyA9IDI1NjsKCWNvbnN0IEJMT0NLVFlQRSA9IHsKCQlJTlZBTElEOiAwLAoJCVZFUkJBVElNOiAxLAoJCUFMSUdORUQ6IDIsCgkJVU5DT01QUkVTU0VEOiAzCgl9OwoJY29uc3QgUFJFVFJFRV9OVU1fRUxFTUVOVFMgPSAyMDsKCWNvbnN0IEFMSUdORURfTlVNX0VMRU1FTlRTID0gODsKCWNvbnN0IE5VTV9QUklNQVJZX0xFTkdUSFMgPSA3OwoJY29uc3QgTlVNX1NFQ09OREFSWV9MRU5HVEhTID0gMjQ5OwoJY29uc3QgUFJFVFJFRV9NQVhTWU1CT0xTID0gUFJFVFJFRV9OVU1fRUxFTUVOVFM7Cgljb25zdCBQUkVUUkVFX1RBQkxFQklUUyA9IDY7Cgljb25zdCBNQUlOVFJFRV9NQVhTWU1CT0xTID0gTlVNX0NIQVJTICsgNTAgKiA4OwoJY29uc3QgTUFJTlRSRUVfVEFCTEVCSVRTID0gMTI7Cgljb25zdCBMRU5HVEhfTUFYU1lNQk9MUyA9IE5VTV9TRUNPTkRBUllfTEVOR1RIUyArIDE7Cgljb25zdCBMRU5HVEhfVEFCTEVCSVRTID0gMTI7Cgljb25zdCBBTElHTkVEX01BWFNZTUJPTFMgPSBBTElHTkVEX05VTV9FTEVNRU5UUzsKCWNvbnN0IEFMSUdORURfVEFCTEVCSVRTID0gNzsKCgljbGFzcyBMenggewoJCWNvbnN0cnVjdG9yKHdpbmRvd19iaXRzKSB7CgkJCXRoaXMud2luZG93X3NpemUgPSAxIDw8IHdpbmRvd19iaXRzOwoJCQlpZiAod2luZG93X2JpdHMgPCAxNSB8fCB3aW5kb3dfYml0cyA+IDIxKSB0aHJvdyBuZXcgWG5iRXJyb3IoJ1dpbmRvdyBzaXplIG91dCBvZiByYW5nZSEnKTsKCgkJCWlmICghTHp4LmV4dHJhX2JpdHMubGVuZ3RoKSB7CgkJCQlmb3IgKGxldCBpID0gMCwgaiA9IDA7IGkgPD0gNTA7IGkgKz0gMikgewoJCQkJCUx6eC5leHRyYV9iaXRzW2ldID0gTHp4LmV4dHJhX2JpdHNbaSArIDFdID0gajsKCQkJCQlpZiAoaSAhPSAwICYmIGogPCAxNykgaisrOwoJCQkJfQoJCQl9CgoJCQlpZiAoIUx6eC5wb3NpdGlvbl9iYXNlLmxlbmd0aCkgewoJCQkJZm9yIChsZXQgaSA9IDAsIGogPSAwOyBpIDw9IDUwOyBpKyspIHsKCQkJCQlMengucG9zaXRpb25fYmFzZVtpXSA9IGo7CgkJCQkJaiArPSAxIDw8IEx6eC5leHRyYV9iaXRzW2ldOwoJCQkJfQoJCQl9CgoJCQljb25zdCBwb3NuX3Nsb3RzID0gd2luZG93X2JpdHMgPT0gMjEgPyA1MCA6IHdpbmRvd19iaXRzID09IDIwID8gNDIgOiB3aW5kb3dfYml0cyA8PCAxOwoJCQl0aGlzLlIwID0gdGhpcy5SMSA9IHRoaXMuUjIgPSAxOwoJCQl0aGlzLm1haW5fZWxlbWVudHMgPSBOVU1fQ0hBUlMgKyAocG9zbl9zbG90cyA8PCAzKTsKCQkJdGhpcy5oZWFkZXJfcmVhZCA9IGZhbHNlOwoJCQl0aGlzLmJsb2NrX3JlbWFpbmluZyA9IDA7CgkJCXRoaXMuYmxvY2tfdHlwZSA9IEJMT0NLVFlQRS5JTlZBTElEOwoJCQl0aGlzLndpbmRvd19wb3NuID0gMDsKCQkJdGhpcy5wcmV0cmVlX3RhYmxlID0gW107CgkJCXRoaXMucHJldHJlZV9sZW4gPSBbXTsKCQkJdGhpcy5hbGlnbmVkX3RhYmxlID0gW107CgkJCXRoaXMuYWxpZ25lZF9sZW4gPSBbXTsKCQkJdGhpcy5sZW5ndGhfdGFibGUgPSBbXTsKCQkJdGhpcy5sZW5ndGhfbGVuID0gW107CgkJCXRoaXMubWFpbnRyZWVfdGFibGUgPSBbXTsKCQkJdGhpcy5tYWludHJlZV9sZW4gPSBbXTsKCgkJCWZvciAobGV0IGkgPSAwOyBpIDwgTUFJTlRSRUVfTUFYU1lNQk9MUzsgaSsrKSB0aGlzLm1haW50cmVlX2xlbltpXSA9IDA7CgoJCQlmb3IgKGxldCBpID0gMDsgaSA8IE5VTV9TRUNPTkRBUllfTEVOR1RIUzsgaSsrKSB0aGlzLmxlbmd0aF9sZW5baV0gPSAwOwoKCQkJdGhpcy53aW4gPSBbXTsKCQl9CgoJCWRlY29tcHJlc3MoYnVmZmVyLCBmcmFtZV9zaXplLCBibG9ja19zaXplKSB7CgkJCWlmICghdGhpcy5oZWFkZXJfcmVhZCkgewoJCQkJY29uc3QgaW50ZWwgPSBidWZmZXIucmVhZExaWEJpdHMoMSk7CgkJCQlpZiAoaW50ZWwgIT0gMCkgdGhyb3cgbmV3IFhuYkVycm9yKCJJbnRlbCBFOCBDYWxsIGZvdW5kLCBpbnZhbGlkIGZvciBYTkIgZmlsZXMuIik7CgkJCQl0aGlzLmhlYWRlcl9yZWFkID0gdHJ1ZTsKCQkJfQoKCQkJbGV0IHRvZ28gPSBmcmFtZV9zaXplOwoKCQkJd2hpbGUgKHRvZ28gPiAwKSB7CgkJCQlpZiAodGhpcy5ibG9ja19yZW1haW5pbmcgPT0gMCkgewoJCQkJCXRoaXMuYmxvY2tfdHlwZSA9IGJ1ZmZlci5yZWFkTFpYQml0cygzKTsKCQkJCQljb25zdCBoaSA9IGJ1ZmZlci5yZWFkTFpYQml0cygxNik7CgkJCQkJY29uc3QgbG8gPSBidWZmZXIucmVhZExaWEJpdHMoOCk7CgkJCQkJdGhpcy5ibG9ja19yZW1haW5pbmcgPSBoaSA8PCA4IHwgbG87CgoJCQkJCXN3aXRjaCAodGhpcy5ibG9ja190eXBlKSB7CgkJCQkJCWNhc2UgQkxPQ0tUWVBFLkFMSUdORUQ6CgkJCQkJCQlmb3IgKGxldCBpID0gMDsgaSA8IDg7IGkrKykgdGhpcy5hbGlnbmVkX2xlbltpXSA9IGJ1ZmZlci5yZWFkTFpYQml0cygzKTsKCgkJCQkJCQl0aGlzLmFsaWduZWRfdGFibGUgPSB0aGlzLmRlY29kZVRhYmxlKEFMSUdORURfTUFYU1lNQk9MUywgQUxJR05FRF9UQUJMRUJJVFMsIHRoaXMuYWxpZ25lZF9sZW4pOwoKCQkJCQkJY2FzZSBCTE9DS1RZUEUuVkVSQkFUSU06CgkJCQkJCQl0aGlzLnJlYWRMZW5ndGhzKGJ1ZmZlciwgdGhpcy5tYWludHJlZV9sZW4sIDAsIDI1Nik7CgkJCQkJCQl0aGlzLnJlYWRMZW5ndGhzKGJ1ZmZlciwgdGhpcy5tYWludHJlZV9sZW4sIDI1NiwgdGhpcy5tYWluX2VsZW1lbnRzKTsKCQkJCQkJCXRoaXMubWFpbnRyZWVfdGFibGUgPSB0aGlzLmRlY29kZVRhYmxlKE1BSU5UUkVFX01BWFNZTUJPTFMsIE1BSU5UUkVFX1RBQkxFQklUUywgdGhpcy5tYWludHJlZV9sZW4pOwoJCQkJCQkJdGhpcy5yZWFkTGVuZ3RocyhidWZmZXIsIHRoaXMubGVuZ3RoX2xlbiwgMCwgTlVNX1NFQ09OREFSWV9MRU5HVEhTKTsKCQkJCQkJCXRoaXMubGVuZ3RoX3RhYmxlID0gdGhpcy5kZWNvZGVUYWJsZShMRU5HVEhfTUFYU1lNQk9MUywgTEVOR1RIX1RBQkxFQklUUywgdGhpcy5sZW5ndGhfbGVuKTsKCQkJCQkJCWJyZWFrOwoKCQkJCQkJY2FzZSBCTE9DS1RZUEUuVU5DT01QUkVTU0VEOgoJCQkJCQkJYnVmZmVyLmFsaWduKCk7CgkJCQkJCQl0aGlzLlIwID0gYnVmZmVyLnJlYWRJbnQzMigpOwoJCQkJCQkJdGhpcy5SMSA9IGJ1ZmZlci5yZWFkSW50MzIoKTsKCQkJCQkJCXRoaXMuUjIgPSBidWZmZXIucmVhZEludDMyKCk7CgkJCQkJCQlicmVhazsKCgkJCQkJCWRlZmF1bHQ6CgkJCQkJCQl0aHJvdyBuZXcgWG5iRXJyb3IoIkludmFsaWQgQmxvY2t0eXBlIEZvdW5kOiAiLmNvbmNhdCh0aGlzLmJsb2NrX3R5cGUpKTsKCQkJCQl9CgkJCQl9CgoJCQkJbGV0IHRoaXNfcnVuID0gdGhpcy5ibG9ja19yZW1haW5pbmc7CgoJCQkJd2hpbGUgKCh0aGlzX3J1biA9IHRoaXMuYmxvY2tfcmVtYWluaW5nKSA+IDAgJiYgdG9nbyA+IDApIHsKCQkJCQlpZiAodGhpc19ydW4gPiB0b2dvKSB0aGlzX3J1biA9IHRvZ287CgkJCQkJdG9nbyAtPSB0aGlzX3J1bjsKCQkJCQl0aGlzLmJsb2NrX3JlbWFpbmluZyAtPSB0aGlzX3J1bjsKCQkJCQl0aGlzLndpbmRvd19wb3NuICY9IHRoaXMud2luZG93X3NpemUgLSAxOwoJCQkJCWlmICh0aGlzLndpbmRvd19wb3NuICsgdGhpc19ydW4gPiB0aGlzLndpbmRvd19zaXplKSB0aHJvdyBuZXcgWG5iRXJyb3IoJ0Nhbm5vdCBydW4gb3V0c2lkZSBvZiB3aW5kb3cgZnJhbWUuJyk7CgoJCQkJCXN3aXRjaCAodGhpcy5ibG9ja190eXBlKSB7CgkJCQkJCWNhc2UgQkxPQ0tUWVBFLkFMSUdORUQ6CgkJCQkJCQl3aGlsZSAodGhpc19ydW4gPiAwKSB7CgkJCQkJCQkJbGV0IG1haW5fZWxlbWVudCA9IHRoaXMucmVhZEh1ZmZTeW1ib2woYnVmZmVyLCB0aGlzLm1haW50cmVlX3RhYmxlLCB0aGlzLm1haW50cmVlX2xlbiwgTUFJTlRSRUVfTUFYU1lNQk9MUywgTUFJTlRSRUVfVEFCTEVCSVRTKTsKCgkJCQkJCQkJaWYgKG1haW5fZWxlbWVudCA8IE5VTV9DSEFSUykgewoJCQkJCQkJCQl0aGlzLndpblt0aGlzLndpbmRvd19wb3NuKytdID0gbWFpbl9lbGVtZW50OwoJCQkJCQkJCQl0aGlzX3J1bi0tOwoJCQkJCQkJCQljb250aW51ZTsKCQkJCQkJCQl9CgoJCQkJCQkJCW1haW5fZWxlbWVudCAtPSBOVU1fQ0hBUlM7CgkJCQkJCQkJbGV0IGxlbmd0aF9mb290ZXI7CgkJCQkJCQkJbGV0IG1hdGNoX2xlbmd0aCA9IG1haW5fZWxlbWVudCAmIE5VTV9QUklNQVJZX0xFTkdUSFM7CgoJCQkJCQkJCWlmIChtYXRjaF9sZW5ndGggPT0gTlVNX1BSSU1BUllfTEVOR1RIUykgewoJCQkJCQkJCQlsZW5ndGhfZm9vdGVyID0gdGhpcy5yZWFkSHVmZlN5bWJvbChidWZmZXIsIHRoaXMubGVuZ3RoX3RhYmxlLCB0aGlzLmxlbmd0aF9sZW4sIExFTkdUSF9NQVhTWU1CT0xTLCBMRU5HVEhfVEFCTEVCSVRTKTsKCQkJCQkJCQkJbWF0Y2hfbGVuZ3RoICs9IGxlbmd0aF9mb290ZXI7CgkJCQkJCQkJfQoKCQkJCQkJCQltYXRjaF9sZW5ndGggKz0gTUlOX01BVENIOwoJCQkJCQkJCWxldCBtYXRjaF9vZmZzZXQgPSBtYWluX2VsZW1lbnQgPj4gMzsKCgkJCQkJCQkJaWYgKG1hdGNoX29mZnNldCA+IDIpIHsKCQkJCQkJCQkJbGV0IGV4dHJhID0gTHp4LmV4dHJhX2JpdHNbbWF0Y2hfb2Zmc2V0XTsKCQkJCQkJCQkJbWF0Y2hfb2Zmc2V0ID0gTHp4LnBvc2l0aW9uX2Jhc2VbbWF0Y2hfb2Zmc2V0XSAtIDI7CgoJCQkJCQkJCQlpZiAoZXh0cmEgPiAzKSB7CgkJCQkJCQkJCQlleHRyYSAtPSAzOwoJCQkJCQkJCQkJbGV0IHZlcmJhdGltX2JpdHMgPSBidWZmZXIucmVhZExaWEJpdHMoZXh0cmEpOwoJCQkJCQkJCQkJbWF0Y2hfb2Zmc2V0ICs9IHZlcmJhdGltX2JpdHMgPDwgMzsKCQkJCQkJCQkJCWxldCBhbGlnbmVkX2JpdHMgPSB0aGlzLnJlYWRIdWZmU3ltYm9sKGJ1ZmZlciwgdGhpcy5hbGlnbmVkX3RhYmxlLCB0aGlzLmFsaWduZWRfbGVuLCBBTElHTkVEX01BWFNZTUJPTFMsIEFMSUdORURfVEFCTEVCSVRTKTsKCQkJCQkJCQkJCW1hdGNoX29mZnNldCArPSBhbGlnbmVkX2JpdHM7CgkJCQkJCQkJCX0gZWxzZSBpZiAoZXh0cmEgPT0gMykgewoJCQkJCQkJCQkJbWF0Y2hfb2Zmc2V0ICs9IHRoaXMucmVhZEh1ZmZTeW1ib2woYnVmZmVyLCB0aGlzLmFsaWduZWRfdGFibGUsIHRoaXMuYWxpZ25lZF9sZW4sIEFMSUdORURfTUFYU1lNQk9MUywgQUxJR05FRF9UQUJMRUJJVFMpOwoJCQkJCQkJCQl9IGVsc2UgaWYgKGV4dHJhID4gMCkgbWF0Y2hfb2Zmc2V0ICs9IGJ1ZmZlci5yZWFkTFpYQml0cyhleHRyYSk7ZWxzZSBtYXRjaF9vZmZzZXQgPSAxOwoKCQkJCQkJCQkJdGhpcy5SMiA9IHRoaXMuUjE7CgkJCQkJCQkJCXRoaXMuUjEgPSB0aGlzLlIwOwoJCQkJCQkJCQl0aGlzLlIwID0gbWF0Y2hfb2Zmc2V0OwoJCQkJCQkJCX0gZWxzZSBpZiAobWF0Y2hfb2Zmc2V0ID09PSAwKSB7CgkJCQkJCQkJCW1hdGNoX29mZnNldCA9IHRoaXMuUjA7CgkJCQkJCQkJfSBlbHNlIGlmIChtYXRjaF9vZmZzZXQgPT0gMSkgewoJCQkJCQkJCQltYXRjaF9vZmZzZXQgPSB0aGlzLlIxOwoJCQkJCQkJCQl0aGlzLlIxID0gdGhpcy5SMDsKCQkJCQkJCQkJdGhpcy5SMCA9IG1hdGNoX29mZnNldDsKCQkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCQltYXRjaF9vZmZzZXQgPSB0aGlzLlIyOwoJCQkJCQkJCQl0aGlzLlIyID0gdGhpcy5SMDsKCQkJCQkJCQkJdGhpcy5SMCA9IG1hdGNoX29mZnNldDsKCQkJCQkJCQl9CgoJCQkJCQkJCWxldCBydW5kZXN0ID0gdGhpcy53aW5kb3dfcG9zbjsKCQkJCQkJCQlsZXQgcnVuc3JjOwoJCQkJCQkJCXRoaXNfcnVuIC09IG1hdGNoX2xlbmd0aDsKCQkJCQkJCQlpZiAodGhpcy53aW5kb3dfcG9zbiA+PSBtYXRjaF9vZmZzZXQpIHJ1bnNyYyA9IHJ1bmRlc3QgLSBtYXRjaF9vZmZzZXQ7ZWxzZSB7CgkJCQkJCQkJCXJ1bnNyYyA9IHJ1bmRlc3QgKyAodGhpcy53aW5kb3dfc2l6ZSAtIG1hdGNoX29mZnNldCk7CgkJCQkJCQkJCWxldCBjb3B5X2xlbmd0aCA9IG1hdGNoX29mZnNldCAtIHRoaXMud2luZG93X3Bvc247CgoJCQkJCQkJCQlpZiAoY29weV9sZW5ndGggPCBtYXRjaF9sZW5ndGgpIHsKCQkJCQkJCQkJCW1hdGNoX2xlbmd0aCAtPSBjb3B5X2xlbmd0aDsKCQkJCQkJCQkJCXRoaXMud2luZG93X3Bvc24gKz0gY29weV9sZW5ndGg7CgoJCQkJCQkJCQkJd2hpbGUgKGNvcHlfbGVuZ3RoLS0gPiAwKSB0aGlzLndpbltydW5kZXN0KytdID0gdGhpcy53aW5bcnVuc3JjKytdOwoKCQkJCQkJCQkJCXJ1bnNyYyA9IDA7CgkJCQkJCQkJCX0KCQkJCQkJCQl9CgkJCQkJCQkJdGhpcy53aW5kb3dfcG9zbiArPSBtYXRjaF9sZW5ndGg7CgoJCQkJCQkJCXdoaWxlIChtYXRjaF9sZW5ndGgtLSA+IDApIHRoaXMud2luW3J1bmRlc3QrK10gPSB0aGlzLndpbltydW5zcmMrK107CgkJCQkJCQl9CgoJCQkJCQkJYnJlYWs7CgoJCQkJCQljYXNlIEJMT0NLVFlQRS5WRVJCQVRJTToKCQkJCQkJCXdoaWxlICh0aGlzX3J1biA+IDApIHsKCQkJCQkJCQlsZXQgbWFpbl9lbGVtZW50ID0gdGhpcy5yZWFkSHVmZlN5bWJvbChidWZmZXIsIHRoaXMubWFpbnRyZWVfdGFibGUsIHRoaXMubWFpbnRyZWVfbGVuLCBNQUlOVFJFRV9NQVhTWU1CT0xTLCBNQUlOVFJFRV9UQUJMRUJJVFMpOwoKCQkJCQkJCQlpZiAobWFpbl9lbGVtZW50IDwgTlVNX0NIQVJTKSB7CgkJCQkJCQkJCXRoaXMud2luW3RoaXMud2luZG93X3Bvc24rK10gPSBtYWluX2VsZW1lbnQ7CgkJCQkJCQkJCXRoaXNfcnVuLS07CgkJCQkJCQkJCWNvbnRpbnVlOwoJCQkJCQkJCX0KCgkJCQkJCQkJbWFpbl9lbGVtZW50IC09IE5VTV9DSEFSUzsKCQkJCQkJCQlsZXQgbGVuZ3RoX2Zvb3RlcjsKCQkJCQkJCQlsZXQgbWF0Y2hfbGVuZ3RoID0gbWFpbl9lbGVtZW50ICYgTlVNX1BSSU1BUllfTEVOR1RIUzsKCgkJCQkJCQkJaWYgKG1hdGNoX2xlbmd0aCA9PSBOVU1fUFJJTUFSWV9MRU5HVEhTKSB7CgkJCQkJCQkJCWxlbmd0aF9mb290ZXIgPSB0aGlzLnJlYWRIdWZmU3ltYm9sKGJ1ZmZlciwgdGhpcy5sZW5ndGhfdGFibGUsIHRoaXMubGVuZ3RoX2xlbiwgTEVOR1RIX01BWFNZTUJPTFMsIExFTkdUSF9UQUJMRUJJVFMpOwoJCQkJCQkJCQltYXRjaF9sZW5ndGggKz0gbGVuZ3RoX2Zvb3RlcjsKCQkJCQkJCQl9CgoJCQkJCQkJCW1hdGNoX2xlbmd0aCArPSBNSU5fTUFUQ0g7CgkJCQkJCQkJbGV0IG1hdGNoX29mZnNldCA9IG1haW5fZWxlbWVudCA+PiAzOwoKCQkJCQkJCQlpZiAobWF0Y2hfb2Zmc2V0ID4gMikgewoJCQkJCQkJCQlpZiAobWF0Y2hfb2Zmc2V0ICE9IDMpIHsKCQkJCQkJCQkJCWxldCBleHRyYSA9IEx6eC5leHRyYV9iaXRzW21hdGNoX29mZnNldF07CgkJCQkJCQkJCQlsZXQgdmVyYmF0aW1fYml0cyA9IGJ1ZmZlci5yZWFkTFpYQml0cyhleHRyYSk7CgkJCQkJCQkJCQltYXRjaF9vZmZzZXQgPSBMengucG9zaXRpb25fYmFzZVttYXRjaF9vZmZzZXRdIC0gMiArIHZlcmJhdGltX2JpdHM7CgkJCQkJCQkJCX0gZWxzZSBtYXRjaF9vZmZzZXQgPSAxOwoKCQkJCQkJCQkJdGhpcy5SMiA9IHRoaXMuUjE7CgkJCQkJCQkJCXRoaXMuUjEgPSB0aGlzLlIwOwoJCQkJCQkJCQl0aGlzLlIwID0gbWF0Y2hfb2Zmc2V0OwoJCQkJCQkJCX0gZWxzZSBpZiAobWF0Y2hfb2Zmc2V0ID09PSAwKSB7CgkJCQkJCQkJCW1hdGNoX29mZnNldCA9IHRoaXMuUjA7CgkJCQkJCQkJfSBlbHNlIGlmIChtYXRjaF9vZmZzZXQgPT0gMSkgewoJCQkJCQkJCQltYXRjaF9vZmZzZXQgPSB0aGlzLlIxOwoJCQkJCQkJCQl0aGlzLlIxID0gdGhpcy5SMDsKCQkJCQkJCQkJdGhpcy5SMCA9IG1hdGNoX29mZnNldDsKCQkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCQltYXRjaF9vZmZzZXQgPSB0aGlzLlIyOwoJCQkJCQkJCQl0aGlzLlIyID0gdGhpcy5SMDsKCQkJCQkJCQkJdGhpcy5SMCA9IG1hdGNoX29mZnNldDsKCQkJCQkJCQl9CgoJCQkJCQkJCWxldCBydW5kZXN0ID0gdGhpcy53aW5kb3dfcG9zbjsKCQkJCQkJCQlsZXQgcnVuc3JjOwoJCQkJCQkJCXRoaXNfcnVuIC09IG1hdGNoX2xlbmd0aDsKCQkJCQkJCQlpZiAodGhpcy53aW5kb3dfcG9zbiA+PSBtYXRjaF9vZmZzZXQpIHJ1bnNyYyA9IHJ1bmRlc3QgLSBtYXRjaF9vZmZzZXQ7ZWxzZSB7CgkJCQkJCQkJCXJ1bnNyYyA9IHJ1bmRlc3QgKyAodGhpcy53aW5kb3dfc2l6ZSAtIG1hdGNoX29mZnNldCk7CgkJCQkJCQkJCWxldCBjb3B5X2xlbmd0aCA9IG1hdGNoX29mZnNldCAtIHRoaXMud2luZG93X3Bvc247CgoJCQkJCQkJCQlpZiAoY29weV9sZW5ndGggPCBtYXRjaF9sZW5ndGgpIHsKCQkJCQkJCQkJCW1hdGNoX2xlbmd0aCAtPSBjb3B5X2xlbmd0aDsKCQkJCQkJCQkJCXRoaXMud2luZG93X3Bvc24gKz0gY29weV9sZW5ndGg7CgoJCQkJCQkJCQkJd2hpbGUgKGNvcHlfbGVuZ3RoLS0gPiAwKSB0aGlzLndpbltydW5kZXN0KytdID0gdGhpcy53aW5bcnVuc3JjKytdOwoKCQkJCQkJCQkJCXJ1bnNyYyA9IDA7CgkJCQkJCQkJCX0KCQkJCQkJCQl9CgkJCQkJCQkJdGhpcy53aW5kb3dfcG9zbiArPSBtYXRjaF9sZW5ndGg7CgoJCQkJCQkJCXdoaWxlIChtYXRjaF9sZW5ndGgtLSA+IDApIHRoaXMud2luW3J1bmRlc3QrK10gPSB0aGlzLndpbltydW5zcmMrK107CgkJCQkJCQl9CgoJCQkJCQkJYnJlYWs7CgoJCQkJCQljYXNlIEJMT0NLVFlQRS5VTkNPTVBSRVNTRUQ6CgkJCQkJCQlpZiAoYnVmZmVyLmJ5dGVQb3NpdGlvbiArIHRoaXNfcnVuID4gYmxvY2tfc2l6ZSkgdGhyb3cgbmV3IFhuYkVycm9yKCdPdmVycnVuIScgKyBibG9ja19zaXplICsgJyAnICsgYnVmZmVyLmJ5dGVQb3NpdGlvbiArICcgJyArIHRoaXNfcnVuKTsKCgkJCQkJCQlmb3IgKGxldCBpID0gMDsgaSA8IHRoaXNfcnVuOyBpKyspIHRoaXMud2luW3dpbmRvd19wb3NuICsgaV0gPSBidWZmZXIuYnVmZmVyW2J1ZmZlci5ieXRlUG9zaXRpb24gKyBpXTsKCgkJCQkJCQlidWZmZXIuYnl0ZVBvc2l0aW9uICs9IHRoaXNfcnVuOwoJCQkJCQkJdGhpcy53aW5kb3dfcG9zbiArPSB0aGlzX3J1bjsKCQkJCQkJCWJyZWFrOwoKCQkJCQkJZGVmYXVsdDoKCQkJCQkJCXRocm93IG5ldyBYbmJFcnJvcignSW52YWxpZCBibG9ja3R5cGUgc3BlY2lmaWVkIScpOwoJCQkJCX0KCQkJCX0KCQkJfQoKCQkJaWYgKHRvZ28gIT0gMCkgdGhyb3cgbmV3IFhuYkVycm9yKCdFT0YgcmVhY2hlZCB3aXRoIGRhdGEgbGVmdCB0byBnby4nKTsKCQkJYnVmZmVyLmFsaWduKCk7CgkJCWNvbnN0IHN0YXJ0X3dpbmRvd19wb3MgPSAodGhpcy53aW5kb3dfcG9zbiA9PSAwID8gdGhpcy53aW5kb3dfc2l6ZSA6IHRoaXMud2luZG93X3Bvc24pIC0gZnJhbWVfc2l6ZTsKCQkJcmV0dXJuIHRoaXMud2luLnNsaWNlKHN0YXJ0X3dpbmRvd19wb3MsIHN0YXJ0X3dpbmRvd19wb3MgKyBmcmFtZV9zaXplKTsKCQl9CgoJCXJlYWRMZW5ndGhzKGJ1ZmZlciwgdGFibGUsIGZpcnN0LCBsYXN0KSB7CgkJCWZvciAobGV0IGkgPSAwOyBpIDwgMjA7IGkrKykgdGhpcy5wcmV0cmVlX2xlbltpXSA9IGJ1ZmZlci5yZWFkTFpYQml0cyg0KTsKCgkJCXRoaXMucHJldHJlZV90YWJsZSA9IHRoaXMuZGVjb2RlVGFibGUoUFJFVFJFRV9NQVhTWU1CT0xTLCBQUkVUUkVFX1RBQkxFQklUUywgdGhpcy5wcmV0cmVlX2xlbik7CgoJCQlmb3IgKGxldCBpID0gZmlyc3Q7IGkgPCBsYXN0OykgewoJCQkJbGV0IHN5bWJvbCA9IHRoaXMucmVhZEh1ZmZTeW1ib2woYnVmZmVyLCB0aGlzLnByZXRyZWVfdGFibGUsIHRoaXMucHJldHJlZV9sZW4sIFBSRVRSRUVfTUFYU1lNQk9MUywgUFJFVFJFRV9UQUJMRUJJVFMpOwoKCQkJCWlmIChzeW1ib2wgPT0gMTcpIHsKCQkJCQlsZXQgemVyb3MgPSBidWZmZXIucmVhZExaWEJpdHMoNCkgKyA0OwoKCQkJCQl3aGlsZSAoemVyb3MtLSAhPSAwKSB0YWJsZVtpKytdID0gMDsKCQkJCX0gZWxzZSBpZiAoc3ltYm9sID09IDE4KSB7CgkJCQkJbGV0IHplcm9zID0gYnVmZmVyLnJlYWRMWlhCaXRzKDUpICsgMjA7CgoJCQkJCXdoaWxlICh6ZXJvcy0tICE9IDApIHRhYmxlW2krK10gPSAwOwoJCQkJfSBlbHNlIGlmIChzeW1ib2wgPT0gMTkpIHsKCQkJCQlsZXQgc2FtZSA9IGJ1ZmZlci5yZWFkTFpYQml0cygxKSArIDQ7CgkJCQkJc3ltYm9sID0gdGhpcy5yZWFkSHVmZlN5bWJvbChidWZmZXIsIHRoaXMucHJldHJlZV90YWJsZSwgdGhpcy5wcmV0cmVlX2xlbiwgUFJFVFJFRV9NQVhTWU1CT0xTLCBQUkVUUkVFX1RBQkxFQklUUyk7CgkJCQkJc3ltYm9sID0gdGFibGVbaV0gLSBzeW1ib2w7CgkJCQkJaWYgKHN5bWJvbCA8IDApIHN5bWJvbCArPSAxNzsKCgkJCQkJd2hpbGUgKHNhbWUtLSAhPSAwKSB0YWJsZVtpKytdID0gc3ltYm9sOwoJCQkJfSBlbHNlIHsKCQkJCQlzeW1ib2wgPSB0YWJsZVtpXSAtIHN5bWJvbDsKCQkJCQlpZiAoc3ltYm9sIDwgMCkgc3ltYm9sICs9IDE3OwoJCQkJCXRhYmxlW2krK10gPSBzeW1ib2w7CgkJCQl9CgkJCX0KCgkJCXJldHVybiB0YWJsZTsKCQl9CgoJCWRlY29kZVRhYmxlKHN5bWJvbHMsIGJpdHMsIGxlbmd0aCkgewoJCQlsZXQgdGFibGUgPSBbXTsKCQkJbGV0IHBvcyA9IDA7CgkJCWxldCB0YWJsZV9tYXNrID0gMSA8PCBiaXRzOwoJCQlsZXQgYml0X21hc2sgPSB0YWJsZV9tYXNrID4+IDE7CgoJCQlmb3IgKGxldCBiaXRfbnVtID0gMTsgYml0X251bSA8PSBiaXRzOyBiaXRfbnVtKyspIHsKCQkJCWZvciAobGV0IHN5bWJvbCA9IDA7IHN5bWJvbCA8IHN5bWJvbHM7IHN5bWJvbCsrKSB7CgkJCQkJaWYgKGxlbmd0aFtzeW1ib2xdID09IGJpdF9udW0pIHsKCQkJCQkJbGV0IGxlYWYgPSBwb3M7CgoJCQkJCQlpZiAoKHBvcyArPSBiaXRfbWFzaykgPiB0YWJsZV9tYXNrKSB7CgkJCQkJCQl0aHJvdyBuZXcgWG5iRXJyb3IoJ092ZXJydW4gdGFibGUhJyk7CgkJCQkJCX0KCgkJCQkJCWxldCBmaWxsID0gYml0X21hc2s7CgoJCQkJCQl3aGlsZSAoZmlsbC0tID4gMCkgdGFibGVbbGVhZisrXSA9IHN5bWJvbDsKCQkJCQl9CgkJCQl9CgoJCQkJYml0X21hc2sgPj49IDE7CgkJCX0KCgkJCWlmIChwb3MgPT0gdGFibGVfbWFzaykgcmV0dXJuIHRhYmxlOwoKCQkJZm9yIChsZXQgc3ltYm9sID0gcG9zOyBzeW1ib2wgPCB0YWJsZV9tYXNrOyBzeW1ib2wrKykgdGFibGVbc3ltYm9sXSA9IDB4RkZGRjsKCgkJCWxldCBuZXh0X3N5bWJvbCA9IHRhYmxlX21hc2sgPj4gMSA8IHN5bWJvbHMgPyBzeW1ib2xzIDogdGFibGVfbWFzayA+PiAxOwoJCQlwb3MgPDw9IDE2OwoJCQl0YWJsZV9tYXNrIDw8PSAxNjsKCQkJYml0X21hc2sgPSAxIDw8IDE1OwoKCQkJZm9yIChsZXQgYml0X251bSA9IGJpdHMgKyAxOyBiaXRfbnVtIDw9IDE2OyBiaXRfbnVtKyspIHsKCQkJCWZvciAobGV0IHN5bWJvbCA9IDA7IHN5bWJvbCA8IHN5bWJvbHM7IHN5bWJvbCsrKSB7CgkJCQkJaWYgKGxlbmd0aFtzeW1ib2xdICE9IGJpdF9udW0pIGNvbnRpbnVlOwoJCQkJCWxldCBsZWFmID0gcG9zID4+IDE2OwoKCQkJCQlmb3IgKGxldCBmaWxsID0gMDsgZmlsbCA8IGJpdF9udW0gLSBiaXRzOyBmaWxsKyspIHsKCQkJCQkJaWYgKHRhYmxlW2xlYWZdID09IDB4RkZGRikgewoJCQkJCQkJdGFibGVbbmV4dF9zeW1ib2wgPDwgMV0gPSAweEZGRkY7CgkJCQkJCQl0YWJsZVsobmV4dF9zeW1ib2wgPDwgMSkgKyAxXSA9IDB4RkZGRjsKCQkJCQkJCXRhYmxlW2xlYWZdID0gbmV4dF9zeW1ib2wrKzsKCQkJCQkJfQoKCQkJCQkJbGVhZiA9IHRhYmxlW2xlYWZdIDw8IDE7CgkJCQkJCWlmIChwb3MgPj4gMTUgLSBmaWxsICYgMSkgbGVhZisrOwoJCQkJCX0KCgkJCQkJdGFibGVbbGVhZl0gPSBzeW1ib2w7CgkJCQkJaWYgKChwb3MgKz0gYml0X21hc2spID4gdGFibGVfbWFzaykgdGhyb3cgbmV3IFhuYkVycm9yKCdPdmVycnVuIHRhYmxlIGR1cmluZyBkZWNvZGluZy4nKTsKCQkJCX0KCgkJCQliaXRfbWFzayA+Pj0gMTsKCQkJfQoKCQkJaWYgKHBvcyA9PSB0YWJsZV9tYXNrKSByZXR1cm4gdGFibGU7CgkJCXRocm93IG5ldyBYbmJFcnJvcignRGVjb2RlIHRhYmxlIGRpZCBub3QgcmVhY2ggdGFibGUgbWFzay4nKTsKCQl9CgoJCXJlYWRIdWZmU3ltYm9sKGJ1ZmZlciwgdGFibGUsIGxlbmd0aCwgc3ltYm9scywgYml0cykgewoJCQlsZXQgYml0ID0gYnVmZmVyLnBlZWtMWlhCaXRzKDMyKSA+Pj4gMDsKCQkJbGV0IGkgPSB0YWJsZVtidWZmZXIucGVla0xaWEJpdHMoYml0cyldOwoKCQkJaWYgKGkgPj0gc3ltYm9scykgewoJCQkJbGV0IGogPSAxIDw8IDMyIC0gYml0czsKCgkJCQlkbyB7CgkJCQkJaiA+Pj0gMTsKCQkJCQlpIDw8PSAxOwoJCQkJCWkgfD0gKGJpdCAmIGopICE9IDAgPyAxIDogMDsKCQkJCQlpZiAoaiA9PSAwKSByZXR1cm4gMDsKCQkJCX0gd2hpbGUgKChpID0gdGFibGVbaV0pID49IHN5bWJvbHMpOwoJCQl9CgoJCQlidWZmZXIuYml0UG9zaXRpb24gKz0gbGVuZ3RoW2ldOwoJCQlyZXR1cm4gaTsKCQl9CgoJCXNldCBSUlIoWCkgewoJCQlpZiAodGhpcy5SMCAhPSBYICYmIHRoaXMuUjEgIT0gWCAmJiB0aGlzLlIyICE9IFgpIHsKCQkJCXRoaXMuUjIgPSB0aGlzLlIxOwoJCQkJdGhpcy5SMSA9IHRoaXMuUjA7CgkJCQl0aGlzLlIwID0gWDsKCQkJfSBlbHNlIGlmICh0aGlzLlIxID09IFgpIHsKCQkJCWxldCBSMSA9IHRoaXMuUjE7CgkJCQl0aGlzLlIxID0gdGhpcy5SMDsKCQkJCXRoaXMuUjAgPSBSMTsKCQkJfSBlbHNlIGlmICh0aGlzLlIyID09IFgpIHsKCQkJCWxldCBSMiA9IHRoaXMuUjI7CgkJCQl0aGlzLlIyID0gdGhpcy5SMDsKCQkJCXRoaXMuUjAgPSBSMjsKCQkJfQoJCX0KCgl9CgoJTHp4LnBvc2l0aW9uX2Jhc2UgPSBbXTsKCUx6eC5leHRyYV9iaXRzID0gW107CgoJY2xhc3MgUHJlc3NlciB7CgkJc3RhdGljIGRlY29tcHJlc3MoYnVmZmVyLCBjb21wcmVzc2VkVG9kbywgZGVjb21wcmVzc2VkVG9kbykgewoJCQlsZXQgcG9zID0gMDsKCQkJbGV0IGJsb2NrX3NpemU7CgkJCWxldCBmcmFtZV9zaXplOwoJCQljb25zdCBsenggPSBuZXcgTHp4KDE2KTsKCQkJbGV0IGRlY29tcHJlc3NlZCA9IG5ldyBCdWZmZXJXcml0ZXIoZGVjb21wcmVzc2VkVG9kbyk7CgoJCQl3aGlsZSAocG9zIDwgY29tcHJlc3NlZFRvZG8pIHsKCQkJCWNvbnN0IGZsYWcgPSBidWZmZXIucmVhZEJ5dGUoKTsKCgkJCQlpZiAoZmxhZyA9PSAweEZGKSB7CgkJCQkJZnJhbWVfc2l6ZSA9IGJ1ZmZlci5yZWFkTFpYSW50MTYoKTsKCQkJCQlibG9ja19zaXplID0gYnVmZmVyLnJlYWRMWlhJbnQxNigpOwoJCQkJCXBvcyArPSA1OwoJCQkJfSBlbHNlIHsKCQkJCQlidWZmZXIuc2VlaygtMSk7CgkJCQkJYmxvY2tfc2l6ZSA9IGJ1ZmZlci5yZWFkTFpYSW50MTYodGhpcy5idWZmZXIpOwoJCQkJCWZyYW1lX3NpemUgPSAweDgwMDA7CgkJCQkJcG9zICs9IDI7CgkJCQl9CgoJCQkJaWYgKGJsb2NrX3NpemUgPT0gMCB8fCBmcmFtZV9zaXplID09IDApIGJyZWFrOwoJCQkJaWYgKGJsb2NrX3NpemUgPiAweDEwMDAwIHx8IGZyYW1lX3NpemUgPiAweDEwMDAwKSB0aHJvdyBuZXcgWG5iRXJyb3IoJ0ludmFsaWQgc2l6ZSByZWFkIGluIGNvbXByZXNzaW9uIGNvbnRlbnQuJyk7CgkJCQlkZWNvbXByZXNzZWQud3JpdGUobHp4LmRlY29tcHJlc3MoYnVmZmVyLCBmcmFtZV9zaXplLCBibG9ja19zaXplKSk7CgkJCQlwb3MgKz0gYmxvY2tfc2l6ZTsKCQkJfQoKCQkJY29uc29sZS5sb2coJ0ZpbGUgaGFzIGJlZW4gc3VjY2Vzc2Z1bGx5IGRlY29tcHJlc3NlZCEnKTsKCQkJZGVjb21wcmVzc2VkLnRyaW0oKTsKCQkJcmV0dXJuIGRlY29tcHJlc3NlZC5idWZmZXI7CgkJfQoKCX0KCgljbGFzcyBMWjRVdGlscyB7CgkJc3RhdGljIGhhc2hVMzIoYSkgewoJCQlhID0gYSB8IDA7CgkJCWEgPSBhICsgMjEyNzkxMjIxNCArIChhIDw8IDEyKSB8IDA7CgkJCWEgPSBhIF4gLTk0OTg5NDU5NiBeIGEgPj4+IDE5OwoJCQlhID0gYSArIDM3NDc2MTM5MyArIChhIDw8IDUpIHwgMDsKCQkJYSA9IGEgKyAtNzQ0MzMyMTgwIF4gYSA8PCA5OwoJCQlhID0gYSArIC00Mjk3MzQ5OSArIChhIDw8IDMpIHwgMDsKCQkJcmV0dXJuIGEgXiAtMTI1MjM3MjcyNyBeIGEgPj4+IDE2IHwgMDsKCQl9CgoJCXN0YXRpYyByZWFkVTY0KGIsIG4pIHsKCQkJdmFyIHggPSAwOwoJCQl4IHw9IGJbbisrXSA8PCAwOwoJCQl4IHw9IGJbbisrXSA8PCA4OwoJCQl4IHw9IGJbbisrXSA8PCAxNjsKCQkJeCB8PSBiW24rK10gPDwgMjQ7CgkJCXggfD0gYltuKytdIDw8IDMyOwoJCQl4IHw9IGJbbisrXSA8PCA0MDsKCQkJeCB8PSBiW24rK10gPDwgNDg7CgkJCXggfD0gYltuKytdIDw8IDU2OwoJCQlyZXR1cm4geDsKCQl9CgoJCXN0YXRpYyByZWFkVTMyKGIsIG4pIHsKCQkJdmFyIHggPSAwOwoJCQl4IHw9IGJbbisrXSA8PCAwOwoJCQl4IHw9IGJbbisrXSA8PCA4OwoJCQl4IHw9IGJbbisrXSA8PCAxNjsKCQkJeCB8PSBiW24rK10gPDwgMjQ7CgkJCXJldHVybiB4OwoJCX0KCgkJc3RhdGljIHdyaXRlVTMyKGIsIG4sIHgpIHsKCQkJYltuKytdID0geCA+PiAwICYgMHhmZjsKCQkJYltuKytdID0geCA+PiA4ICYgMHhmZjsKCQkJYltuKytdID0geCA+PiAxNiAmIDB4ZmY7CgkJCWJbbisrXSA9IHggPj4gMjQgJiAweGZmOwoJCX0KCgkJc3RhdGljIGltdWwoYSwgYikgewoJCQl2YXIgYWggPSBhID4+PiAxNjsKCQkJdmFyIGFsID0gYSAmIDY1NTM1OwoJCQl2YXIgYmggPSBiID4+PiAxNjsKCQkJdmFyIGJsID0gYiAmIDY1NTM1OwoJCQlyZXR1cm4gYWwgKiBibCArIChhaCAqIGJsICsgYWwgKiBiaCA8PCAxNikgfCAwOwoJCX0KCgl9CgoJLyoqIEBsaWNlbnNlCgkgKiBPcmlnaW5hbCBDb2RlIGJ5OiBodHRwczovL2dpdGh1Yi5jb20vQmVuemluZ2EvbHo0anMvCgkgKi8KCWNvbnN0IG1pbk1hdGNoID0gNDsKCWNvbnN0IG1pbkxlbmd0aCA9IDEzOwoJY29uc3Qgc2VhcmNoTGltaXQgPSA1OwoJY29uc3Qgc2tpcFRyaWdnZXIgPSA2OwoJY29uc3QgaGFzaFNpemUgPSAxIDw8IDE2OwoJY29uc3QgbWxCaXRzID0gNDsKCWNvbnN0IG1sTWFzayA9ICgxIDw8IG1sQml0cykgLSAxOwoJY29uc3QgcnVuQml0cyA9IDQ7Cgljb25zdCBydW5NYXNrID0gKDEgPDwgcnVuQml0cykgLSAxOwoJbWFrZUJ1ZmZlcig1IDw8IDIwKTsKCWNvbnN0IGhhc2hUYWJsZSA9IG1ha2VIYXNoVGFibGUoKTsKCglmdW5jdGlvbiBtYWtlSGFzaFRhYmxlKCkgewoJCXRyeSB7CgkJCXJldHVybiBuZXcgVWludDMyQXJyYXkoaGFzaFNpemUpOwoJCX0gY2F0Y2ggKGVycm9yKSB7CgkJCWNvbnN0IGhhc2hUYWJsZSA9IG5ldyBBcnJheShoYXNoU2l6ZSk7CgoJCQlmb3IgKHZhciBpID0gMDsgaSA8IGhhc2hTaXplOyBpKyspIHsKCQkJCWhhc2hUYWJsZVtpXSA9IDA7CgkJCX0KCgkJCXJldHVybiBoYXNoVGFibGU7CgkJfQoJfQoKCWZ1bmN0aW9uIGNsZWFySGFzaFRhYmxlKHRhYmxlKSB7CgkJZm9yICh2YXIgaSA9IDA7IGkgPCBoYXNoU2l6ZTsgaSsrKSB7CgkJCWhhc2hUYWJsZVtpXSA9IDA7CgkJfQoJfQoKCWZ1bmN0aW9uIG1ha2VCdWZmZXIoc2l6ZSkgewoJCXRyeSB7CgkJCXJldHVybiBuZXcgVWludDhBcnJheShzaXplKTsKCQl9IGNhdGNoIChlcnJvcikgewoJCQl2YXIgYnVmID0gbmV3IEFycmF5KHNpemUpOwoKCQkJZm9yICh2YXIgaSA9IDA7IGkgPCBzaXplOyBpKyspIHsKCQkJCWJ1ZltpXSA9IDA7CgkJCX0KCgkJCXJldHVybiBidWY7CgkJfQoJfQoKCWZ1bmN0aW9uIGNvbXByZXNzQm91bmQobikgewoJCXJldHVybiBuICsgbiAvIDI1NSArIDE2IHwgMDsKCX0KCglmdW5jdGlvbiBkZWNvbXByZXNzQmxvY2soc3JjLCBkc3QpIHsKCQlsZXQgc0luZGV4ID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiAwOwoJCWxldCBzTGVuZ3RoID0gYXJndW1lbnRzLmxlbmd0aCA+IDMgJiYgYXJndW1lbnRzWzNdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbM10gOiBzcmMubGVuZ3RoIC0gMiAqIHNJbmRleDsKCQlsZXQgZEluZGV4ID0gYXJndW1lbnRzLmxlbmd0aCA+IDQgJiYgYXJndW1lbnRzWzRdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbNF0gOiAwOwoJCXZhciBtTGVuZ3RoLCBtT2Zmc2V0LCBzRW5kLCBuLCBpOwoJCXZhciBoYXNDb3B5V2l0aGluID0gZHN0LmNvcHlXaXRoaW4gIT09IHVuZGVmaW5lZCAmJiBkc3QuZmlsbCAhPT0gdW5kZWZpbmVkOwoJCXNFbmQgPSBzSW5kZXggKyBzTGVuZ3RoOwoKCQl3aGlsZSAoc0luZGV4IDwgc0VuZCkgewoJCQl2YXIgdG9rZW4gPSBzcmNbc0luZGV4KytdOwoJCQl2YXIgbGl0ZXJhbENvdW50ID0gdG9rZW4gPj4gNDsKCgkJCWlmIChsaXRlcmFsQ291bnQgPiAwKSB7CgkJCQlpZiAobGl0ZXJhbENvdW50ID09PSAweGYpIHsKCQkJCQl3aGlsZSAodHJ1ZSkgewoJCQkJCQlsaXRlcmFsQ291bnQgKz0gc3JjW3NJbmRleF07CgoJCQkJCQlpZiAoc3JjW3NJbmRleCsrXSAhPT0gMHhmZikgewoJCQkJCQkJYnJlYWs7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgoJCQkJZm9yIChuID0gc0luZGV4ICsgbGl0ZXJhbENvdW50OyBzSW5kZXggPCBuOykgewoJCQkJCWRzdFtkSW5kZXgrK10gPSBzcmNbc0luZGV4KytdOwoJCQkJfQoJCQl9CgoJCQlpZiAoc0luZGV4ID49IHNFbmQpIHsKCQkJCWJyZWFrOwoJCQl9CgoJCQltTGVuZ3RoID0gdG9rZW4gJiAweGY7CgkJCW1PZmZzZXQgPSBzcmNbc0luZGV4KytdIHwgc3JjW3NJbmRleCsrXSA8PCA4OwoKCQkJaWYgKG1MZW5ndGggPT09IDB4ZikgewoJCQkJd2hpbGUgKHRydWUpIHsKCQkJCQltTGVuZ3RoICs9IHNyY1tzSW5kZXhdOwoKCQkJCQlpZiAoc3JjW3NJbmRleCsrXSAhPT0gMHhmZikgewoJCQkJCQlicmVhazsKCQkJCQl9CgkJCQl9CgkJCX0KCgkJCW1MZW5ndGggKz0gbWluTWF0Y2g7CgoJCQlpZiAoaGFzQ29weVdpdGhpbiAmJiBtT2Zmc2V0ID09PSAxKSB7CgkJCQlkc3QuZmlsbChkc3RbZEluZGV4IC0gMV0gfCAwLCBkSW5kZXgsIGRJbmRleCArIG1MZW5ndGgpOwoJCQkJZEluZGV4ICs9IG1MZW5ndGg7CgkJCX0gZWxzZSBpZiAoaGFzQ29weVdpdGhpbiAmJiBtT2Zmc2V0ID4gbUxlbmd0aCAmJiBtTGVuZ3RoID4gMzEpIHsKCQkJCWRzdC5jb3B5V2l0aGluKGRJbmRleCwgZEluZGV4IC0gbU9mZnNldCwgZEluZGV4IC0gbU9mZnNldCArIG1MZW5ndGgpOwoJCQkJZEluZGV4ICs9IG1MZW5ndGg7CgkJCX0gZWxzZSB7CgkJCQlmb3IgKGkgPSBkSW5kZXggLSBtT2Zmc2V0LCBuID0gaSArIG1MZW5ndGg7IGkgPCBuOykgewoJCQkJCWRzdFtkSW5kZXgrK10gPSBkc3RbaSsrXSB8IDA7CgkJCQl9CgkJCX0KCQl9CgoJCXJldHVybiBkSW5kZXg7Cgl9CgoJZnVuY3Rpb24gY29tcHJlc3NCbG9jayhzcmMsIGRzdCwgc0luZGV4LCBzTGVuZ3RoLCBoYXNoVGFibGUpIHsKCQl2YXIgbUluZGV4LCBtQW5jaG9yLCBtTGVuZ3RoLCBtT2Zmc2V0LCBtU3RlcDsKCQl2YXIgbGl0ZXJhbENvdW50LCBkSW5kZXgsIHNFbmQsIG47CgkJZEluZGV4ID0gMDsKCQlzRW5kID0gc0xlbmd0aCArIHNJbmRleDsKCQltQW5jaG9yID0gc0luZGV4OwoKCQlpZiAoc0xlbmd0aCA+PSBtaW5MZW5ndGgpIHsKCQkJdmFyIHNlYXJjaE1hdGNoQ291bnQgPSAoMSA8PCBza2lwVHJpZ2dlcikgKyAzOwoKCQkJd2hpbGUgKHNJbmRleCArIG1pbk1hdGNoIDwgc0VuZCAtIHNlYXJjaExpbWl0KSB7CgkJCQl2YXIgc2VxID0gTFo0VXRpbHMucmVhZFUzMihzcmMsIHNJbmRleCk7CgkJCQl2YXIgaGFzaCA9IExaNFV0aWxzLmhhc2hVMzIoc2VxKSA+Pj4gMDsKCQkJCWhhc2ggPSAoaGFzaCA+PiAxNiBeIGhhc2gpID4+PiAwICYgMHhmZmZmOwoJCQkJbUluZGV4ID0gaGFzaFRhYmxlW2hhc2hdIC0gMTsKCQkJCWhhc2hUYWJsZVtoYXNoXSA9IHNJbmRleCArIDE7CgoJCQkJaWYgKG1JbmRleCA8IDAgfHwgc0luZGV4IC0gbUluZGV4ID4+PiAxNiA+IDAgfHwgTFo0VXRpbHMucmVhZFUzMihzcmMsIG1JbmRleCkgIT09IHNlcSkgewoJCQkJCW1TdGVwID0gc2VhcmNoTWF0Y2hDb3VudCsrID4+IHNraXBUcmlnZ2VyOwoJCQkJCXNJbmRleCArPSBtU3RlcDsKCQkJCQljb250aW51ZTsKCQkJCX0KCgkJCQlzZWFyY2hNYXRjaENvdW50ID0gKDEgPDwgc2tpcFRyaWdnZXIpICsgMzsKCQkJCWxpdGVyYWxDb3VudCA9IHNJbmRleCAtIG1BbmNob3I7CgkJCQltT2Zmc2V0ID0gc0luZGV4IC0gbUluZGV4OwoJCQkJc0luZGV4ICs9IG1pbk1hdGNoOwoJCQkJbUluZGV4ICs9IG1pbk1hdGNoOwoJCQkJbUxlbmd0aCA9IHNJbmRleDsKCgkJCQl3aGlsZSAoc0luZGV4IDwgc0VuZCAtIHNlYXJjaExpbWl0ICYmIHNyY1tzSW5kZXhdID09PSBzcmNbbUluZGV4XSkgewoJCQkJCXNJbmRleCsrOwoJCQkJCW1JbmRleCsrOwoJCQkJfQoKCQkJCW1MZW5ndGggPSBzSW5kZXggLSBtTGVuZ3RoOwoJCQkJdmFyIHRva2VuID0gbUxlbmd0aCA8IG1sTWFzayA/IG1MZW5ndGggOiBtbE1hc2s7CgoJCQkJaWYgKGxpdGVyYWxDb3VudCA+PSBydW5NYXNrKSB7CgkJCQkJZHN0W2RJbmRleCsrXSA9IChydW5NYXNrIDw8IG1sQml0cykgKyB0b2tlbjsKCgkJCQkJZm9yIChuID0gbGl0ZXJhbENvdW50IC0gcnVuTWFzazsgbiA+PSAweGZmOyBuIC09IDB4ZmYpIHsKCQkJCQkJZHN0W2RJbmRleCsrXSA9IDB4ZmY7CgkJCQkJfQoKCQkJCQlkc3RbZEluZGV4KytdID0gbjsKCQkJCX0gZWxzZSB7CgkJCQkJZHN0W2RJbmRleCsrXSA9IChsaXRlcmFsQ291bnQgPDwgbWxCaXRzKSArIHRva2VuOwoJCQkJfQoKCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgbGl0ZXJhbENvdW50OyBpKyspIHsKCQkJCQlkc3RbZEluZGV4KytdID0gc3JjW21BbmNob3IgKyBpXTsKCQkJCX0KCgkJCQlkc3RbZEluZGV4KytdID0gbU9mZnNldDsKCQkJCWRzdFtkSW5kZXgrK10gPSBtT2Zmc2V0ID4+IDg7CgoJCQkJaWYgKG1MZW5ndGggPj0gbWxNYXNrKSB7CgkJCQkJZm9yIChuID0gbUxlbmd0aCAtIG1sTWFzazsgbiA+PSAweGZmOyBuIC09IDB4ZmYpIHsKCQkJCQkJZHN0W2RJbmRleCsrXSA9IDB4ZmY7CgkJCQkJfQoKCQkJCQlkc3RbZEluZGV4KytdID0gbjsKCQkJCX0KCgkJCQltQW5jaG9yID0gc0luZGV4OwoJCQl9CgkJfQoKCQlpZiAobUFuY2hvciA9PT0gMCkgewoJCQlyZXR1cm4gMDsKCQl9CgoJCWxpdGVyYWxDb3VudCA9IHNFbmQgLSBtQW5jaG9yOwoKCQlpZiAobGl0ZXJhbENvdW50ID49IHJ1bk1hc2spIHsKCQkJZHN0W2RJbmRleCsrXSA9IHJ1bk1hc2sgPDwgbWxCaXRzOwoKCQkJZm9yIChuID0gbGl0ZXJhbENvdW50IC0gcnVuTWFzazsgbiA+PSAweGZmOyBuIC09IDB4ZmYpIHsKCQkJCWRzdFtkSW5kZXgrK10gPSAweGZmOwoJCQl9CgoJCQlkc3RbZEluZGV4KytdID0gbjsKCQl9IGVsc2UgewoJCQlkc3RbZEluZGV4KytdID0gbGl0ZXJhbENvdW50IDw8IG1sQml0czsKCQl9CgoJCXNJbmRleCA9IG1BbmNob3I7CgoJCXdoaWxlIChzSW5kZXggPCBzRW5kKSB7CgkJCWRzdFtkSW5kZXgrK10gPSBzcmNbc0luZGV4KytdOwoJCX0KCgkJcmV0dXJuIGRJbmRleDsKCX0KCglmdW5jdGlvbiBjb21wcmVzc1NpbmdsZUJsb2NrKHNyYywgZHN0KSB7CgkJY2xlYXJIYXNoVGFibGUoKTsKCQlyZXR1cm4gY29tcHJlc3NCbG9jayhzcmMsIGRzdCwgMCwgc3JjLmxlbmd0aCwgaGFzaFRhYmxlKTsKCX0KCgljbGFzcyBTdHJpbmdSZWFkZXJDb3JlIHsKCQlyZWFkKGJ1ZmZlcikgewoJCQlsZXQgbGVuZ3RoID0gYnVmZmVyLnJlYWQ3Qml0TnVtYmVyKCk7CgkJCXJldHVybiBidWZmZXIucmVhZFN0cmluZyhsZW5ndGgpOwoJCX0KCgkJd3JpdGUoYnVmZmVyLCBzdHJpbmcpIHsKCQkJY29uc3Qgc2l6ZSA9IFVURjhMZW5ndGgkMShzdHJpbmcpOwoJCQlidWZmZXIud3JpdGU3Qml0TnVtYmVyKHNpemUpOwoJCQlidWZmZXIud3JpdGVTdHJpbmcoc3RyaW5nKTsKCQl9CgoJfQoKCWNsYXNzIFJlYWRlclJlc29sdmVyIHsKCQljb25zdHJ1Y3RvcihyZWFkZXJzKSB7CgkJCXRoaXMucmVhZGVycyA9IHJlYWRlcnM7CgkJfQoKCQlyZWFkKGJ1ZmZlcikgewoJCQlsZXQgaW5kZXggPSBidWZmZXIucmVhZDdCaXROdW1iZXIoKSAtIDE7CgkJCWlmICh0aGlzLnJlYWRlcnNbaW5kZXhdID09IG51bGwpIHRocm93IG5ldyBYbmJFcnJvcigiSW52YWxpZCByZWFkZXIgaW5kZXggIi5jb25jYXQoaW5kZXgpKTsKCQkJcmV0dXJuIHRoaXMucmVhZGVyc1tpbmRleF0ucmVhZChidWZmZXIsIHRoaXMpOwoJCX0KCgkJd3JpdGUoYnVmZmVyLCBjb250ZW50KSB7CgkJCXRoaXMucmVhZGVyc1swXS53cml0ZShidWZmZXIsIGNvbnRlbnQsIHRoaXMpOwoJCX0KCgkJZ2V0SW5kZXgocmVhZGVyKSB7CgkJCWZvciAobGV0IGkgPSAwLCBsZW4gPSB0aGlzLnJlYWRlcnMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKCQkJCWlmIChyZWFkZXIudG9TdHJpbmcoKSA9PT0gdGhpcy5yZWFkZXJzW2ldLnRvU3RyaW5nKCkpIHJldHVybiBpOwoJCQl9CgkJfQoKCX0KCgljbGFzcyBYbmJEYXRhIHsKCQljb25zdHJ1Y3RvcihoZWFkZXIsIHJlYWRlcnMsIGNvbnRlbnQpIHsKCQkJbGV0IHsKCQkJCXRhcmdldCwKCQkJCWZvcm1hdFZlcnNpb24sCgkJCQloaWRlZiwKCQkJCWNvbXByZXNzZWQKCQkJfSA9IGhlYWRlcjsKCQkJdGhpcy5oZWFkZXIgPSB7CgkJCQl0YXJnZXQsCgkJCQlmb3JtYXRWZXJzaW9uLAoJCQkJaGlkZWYsCgkJCQljb21wcmVzc2VkCgkJCX07CgkJCXRoaXMucmVhZGVycyA9IHJlYWRlcnM7CgkJCXRoaXMuY29udGVudCA9IGNvbnRlbnQ7CgkJfQoKCQlnZXQgdGFyZ2V0KCkgewoJCQl2YXIgX3RoaXMkaGVhZGVyOwoKCQkJc3dpdGNoICgoX3RoaXMkaGVhZGVyID0gdGhpcy5oZWFkZXIpID09PSBudWxsIHx8IF90aGlzJGhlYWRlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3RoaXMkaGVhZGVyLnRhcmdldCkgewoJCQkJY2FzZSAndyc6CgkJCQkJcmV0dXJuICJNaWNyb3NvZnQgV2luZG93cyI7CgoJCQkJY2FzZSAnbSc6CgkJCQkJcmV0dXJuICJXaW5kb3dzIFBob25lIDciOwoKCQkJCWNhc2UgJ3gnOgoJCQkJCXJldHVybiAiWGJveCAzNjAiOwoKCQkJCWNhc2UgJ2EnOgoJCQkJCXJldHVybiAiQW5kcm9pZCI7CgoJCQkJY2FzZSAnaSc6CgkJCQkJcmV0dXJuICJpT1MiOwoKCQkJCWRlZmF1bHQ6CgkJCQkJcmV0dXJuICJVbmtub3duIjsKCQkJfQoJCX0KCgkJZ2V0IGZvcm1hdFZlcnNpb24oKSB7CgkJCXZhciBfdGhpcyRoZWFkZXIyOwoKCQkJc3dpdGNoICgoX3RoaXMkaGVhZGVyMiA9IHRoaXMuaGVhZGVyKSA9PT0gbnVsbCB8fCBfdGhpcyRoZWFkZXIyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfdGhpcyRoZWFkZXIyLmZvcm1hdFZlcnNpb24pIHsKCQkJCWNhc2UgMHgzOgoJCQkJCXJldHVybiAiWE5BIEdhbWUgU3R1ZGlvIDMuMCI7CgoJCQkJY2FzZSAweDQ6CgkJCQkJcmV0dXJuICJYTkEgR2FtZSBTdHVkaW8gMy4xIjsKCgkJCQljYXNlIDB4NToKCQkJCQlyZXR1cm4gIlhOQSBHYW1lIFN0dWRpbyA0LjAiOwoKCQkJCWRlZmF1bHQ6CgkJCQkJcmV0dXJuICJVbmtub3duIjsKCQkJfQoJCX0KCgkJZ2V0IGhpZGVmKCkgewoJCQl2YXIgX3RoaXMkaGVhZGVyMzsKCgkJCXJldHVybiAhISgoX3RoaXMkaGVhZGVyMyA9IHRoaXMuaGVhZGVyKSAhPT0gbnVsbCAmJiBfdGhpcyRoZWFkZXIzICE9PSB2b2lkIDAgJiYgX3RoaXMkaGVhZGVyMy5oaWRlZik7CgkJfQoKCQlnZXQgY29tcHJlc3NlZCgpIHsKCQkJdmFyIF90aGlzJGhlYWRlcjQ7CgoJCQlyZXR1cm4gISEoKF90aGlzJGhlYWRlcjQgPSB0aGlzLmhlYWRlcikgIT09IG51bGwgJiYgX3RoaXMkaGVhZGVyNCAhPT0gdm9pZCAwICYmIF90aGlzJGhlYWRlcjQuY29tcHJlc3NlZCk7CgkJfQoKCQlnZXQgY29udGVudFR5cGUoKSB7CgkJCWxldCB7CgkJCQlleHBvcnQ6IHJhdwoJCQl9ID0gdGhpcy5jb250ZW50OwoJCQlpZiAocmF3ICE9PSB1bmRlZmluZWQpIHJldHVybiByYXcudHlwZTsKCQkJcmV0dXJuICJKU09OIjsKCQl9CgoJCWdldCByYXdDb250ZW50KCkgewoJCQlsZXQgewoJCQkJZXhwb3J0OiByYXcKCQkJfSA9IHRoaXMuY29udGVudDsKCQkJaWYgKHJhdyAhPT0gdW5kZWZpbmVkKSByZXR1cm4gcmF3LmRhdGE7CgkJCXJldHVybiBKU09OLnN0cmluZ2lmeSh0aGlzLmNvbnRlbnQsIChrZXksIHZhbHVlKSA9PiB7CgkJCQlpZiAoa2V5ID09PSAiZXhwb3J0IikgcmV0dXJuIHZhbHVlLnR5cGU7CgkJCQlyZXR1cm4gdmFsdWU7CgkJCX0sIDQpOwoJCX0KCgkJc3RyaW5naWZ5KCkgewoJCQlyZXR1cm4gSlNPTi5zdHJpbmdpZnkoewoJCQkJaGVhZGVyOiB0aGlzLmhlYWRlciwKCQkJCXJlYWRlcnM6IHRoaXMucmVhZGVycywKCQkJCWNvbnRlbnQ6IHRoaXMuY29udGVudAoJCQl9LCBudWxsLCA0KTsKCQl9CgoJCXRvU3RyaW5nKCkgewoJCQlyZXR1cm4gdGhpcy5zdHJpbmdpZnkoKTsKCQl9CgoJfQoKCWZ1bmN0aW9uIGV4dGVuc2lvblRvRGF0YXR5cGUoZXh0ZW5zaW9uKSB7CgkJc3dpdGNoIChleHRlbnNpb24pIHsKCQkJY2FzZSAianNvbiI6CgkJCQlyZXR1cm4gIkpTT04iOwoKCQkJY2FzZSAieWFtbCI6CgkJCQlyZXR1cm4gInlhbWwiOwoKCQkJY2FzZSAicG5nIjoKCQkJCXJldHVybiAiVGV4dHVyZTJEIjsKCgkJCWNhc2UgImNzbyI6CgkJCQlyZXR1cm4gIkVmZmVjdCI7CgoJCQljYXNlICd0YmluJzoKCQkJCXJldHVybiAiVEJpbiI7CgoJCQljYXNlICd4bWwnOgoJCQkJcmV0dXJuICJCbUZvbnQiOwoJCX0KCgkJcmV0dXJuICJPdGhlcnMiOwoJfQoKCWNsYXNzIFhuYkNvbnRlbnQgewoJCWNvbnN0cnVjdG9yKGRhdGEsIGV4dCkgewoJCQl0aGlzLnR5cGUgPSBleHRlbnNpb25Ub0RhdGF0eXBlKGV4dCk7CgkJCXRoaXMuY29udGVudCA9IGRhdGE7CgkJfQoKCX0KCgljb25zdCBISURFRl9NQVNLID0gMHgxOwoJY29uc3QgQ09NUFJFU1NFRF9MWjRfTUFTSyA9IDB4NDA7Cgljb25zdCBDT01QUkVTU0VEX0xaWF9NQVNLID0gMHg4MDsKCWNvbnN0IFhOQl9DT01QUkVTU0VEX1BST0xPR1VFX1NJWkUgPSAxNDsKCgljbGFzcyBYbmJDb252ZXJ0ZXIgewoJCWNvbnN0cnVjdG9yKCkgewoJCQl0aGlzLnRhcmdldCA9ICcnOwoJCQl0aGlzLmZvcm1hdFZlcnNpb24gPSAwOwoJCQl0aGlzLmhpZGVmID0gZmFsc2U7CgkJCXRoaXMuY29tcHJlc3NlZCA9IGZhbHNlOwoJCQl0aGlzLmNvbXByZXNzaW9uVHlwZSA9IDA7CgkJCXRoaXMuYnVmZmVyID0gbnVsbDsKCQkJdGhpcy5maWxlU2l6ZSA9IDA7CgkJCXRoaXMucmVhZGVycyA9IFtdOwoJCQl0aGlzLnNoYXJlZFJlc291cmNlcyA9IFtdOwoJCX0KCgkJbG9hZChhcnJheUJ1ZmZlcikgewoJCQl0aGlzLmJ1ZmZlciA9IG5ldyBCdWZmZXJSZWFkZXIoYXJyYXlCdWZmZXIpOwoKCQkJdGhpcy5fdmFsaWRhdGVIZWFkZXIoKTsKCgkJCWNvbnNvbGUuaW5mbygnWE5CIGZpbGUgdmFsaWRhdGVkIHN1Y2Nlc3NmdWxseSEnKTsKCQkJdGhpcy5maWxlU2l6ZSA9IHRoaXMuYnVmZmVyLnJlYWRVSW50MzIoKTsKCQkJaWYgKHRoaXMuYnVmZmVyLnNpemUgIT0gdGhpcy5maWxlU2l6ZSkgdGhyb3cgbmV3IFhuYkVycm9yKCdYTkIgZmlsZSBoYXMgYmVlbiB0cnVuY2F0ZWQhJyk7CgoJCQlpZiAodGhpcy5jb21wcmVzc2VkKSB7CgkJCQljb25zdCBkZWNvbXByZXNzZWRTaXplID0gdGhpcy5idWZmZXIucmVhZFVJbnQzMigpOwoKCQkJCWlmICh0aGlzLmNvbXByZXNzaW9uVHlwZSA9PSBDT01QUkVTU0VEX0xaWF9NQVNLKSB7CgkJCQkJY29uc3QgY29tcHJlc3NlZFRvZG8gPSB0aGlzLmZpbGVTaXplIC0gWE5CX0NPTVBSRVNTRURfUFJPTE9HVUVfU0laRTsKCQkJCQljb25zdCBkZWNvbXByZXNzZWQgPSBQcmVzc2VyLmRlY29tcHJlc3ModGhpcy5idWZmZXIsIGNvbXByZXNzZWRUb2RvLCBkZWNvbXByZXNzZWRTaXplKTsKCQkJCQl0aGlzLmJ1ZmZlci5jb3B5RnJvbShkZWNvbXByZXNzZWQsIFhOQl9DT01QUkVTU0VEX1BST0xPR1VFX1NJWkUsIDAsIGRlY29tcHJlc3NlZFNpemUpOwoJCQkJCXRoaXMuYnVmZmVyLmJ5dGVQb3NpdGlvbiA9IFhOQl9DT01QUkVTU0VEX1BST0xPR1VFX1NJWkU7CgkJCQl9IGVsc2UgaWYgKHRoaXMuY29tcHJlc3Npb25UeXBlID09IENPTVBSRVNTRURfTFo0X01BU0spIHsKCQkJCQljb25zdCB0cmltbWVkID0gdGhpcy5idWZmZXIuYnVmZmVyLnNsaWNlKFhOQl9DT01QUkVTU0VEX1BST0xPR1VFX1NJWkUpOwoJCQkJCWNvbnN0IHRyaW1tZWRBcnJheSA9IG5ldyBVaW50OEFycmF5KHRyaW1tZWQpOwoJCQkJCWNvbnN0IGRlY29tcHJlc3NlZCA9IG5ldyBVaW50OEFycmF5KGRlY29tcHJlc3NlZFNpemUpOwoJCQkJCWRlY29tcHJlc3NCbG9jayh0cmltbWVkQXJyYXksIGRlY29tcHJlc3NlZCk7CgkJCQkJdGhpcy5idWZmZXIuY29weUZyb20oZGVjb21wcmVzc2VkLCBYTkJfQ09NUFJFU1NFRF9QUk9MT0dVRV9TSVpFLCAwLCBkZWNvbXByZXNzZWRTaXplKTsKCQkJCQl0aGlzLmJ1ZmZlci5ieXRlUG9zaXRpb24gPSBYTkJfQ09NUFJFU1NFRF9QUk9MT0dVRV9TSVpFOwoJCQkJfQoJCQl9CgoJCQlsZXQgY291bnQgPSB0aGlzLmJ1ZmZlci5yZWFkN0JpdE51bWJlcigpOwoJCQljb25zdCBzdHJpbmdSZWFkZXIgPSBuZXcgU3RyaW5nUmVhZGVyQ29yZSgpOwoJCQljb25zdCByZWFkZXJzID0gW107CgoJCQlmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyBpKyspIHsKCQkJCWNvbnN0IHR5cGUgPSBzdHJpbmdSZWFkZXIucmVhZCh0aGlzLmJ1ZmZlcik7CgkJCQljb25zdCB2ZXJzaW9uID0gdGhpcy5idWZmZXIucmVhZEludDMyKCk7CgkJCQljb25zdCByZWFkZXIgPSBUeXBlUmVhZGVyLmdldFJlYWRlckZyb21SYXcodHlwZSk7CgkJCQl0aGlzLnJlYWRlcnMucHVzaChyZWFkZXIpOwoJCQkJcmVhZGVycy5wdXNoKHsKCQkJCQl0eXBlLAoJCQkJCXZlcnNpb24KCQkJCX0pOwoJCQl9CgoJCQljb25zdCBzaGFyZWQgPSB0aGlzLmJ1ZmZlci5yZWFkN0JpdE51bWJlcigpOwoJCQlpZiAoc2hhcmVkICE9IDApIHRocm93IG5ldyBYbmJFcnJvcigiVW5leHBlY3RlZCAoIi5jb25jYXQoc2hhcmVkLCAiKSBzaGFyZWQgcmVzb3VyY2VzLiIpKTsKCQkJY29uc3QgY29udGVudCA9IG5ldyBSZWFkZXJSZXNvbHZlcih0aGlzLnJlYWRlcnMpOwoJCQljb25zdCByZXN1bHQgPSBjb250ZW50LnJlYWQodGhpcy5idWZmZXIpOwoJCQljb25zb2xlLmxvZygnU3VjY2Vzc2Z1bHkgcmVhZCBYTkIgZmlsZSEnKTsKCQkJcmV0dXJuIG5ldyBYbmJEYXRhKHsKCQkJCXRhcmdldDogdGhpcy50YXJnZXQsCgkJCQlmb3JtYXRWZXJzaW9uOiB0aGlzLmZvcm1hdFZlcnNpb24sCgkJCQloaWRlZjogdGhpcy5oaWRlZiwKCQkJCWNvbXByZXNzZWQ6IHRoaXMuY29tcHJlc3NlZAoJCQl9LCByZWFkZXJzLCByZXN1bHQpOwoJCX0KCgkJY29udmVydChqc29uKSB7CgkJCWNvbnN0IGJ1ZmZlciA9IG5ldyBCdWZmZXJXcml0ZXIoKTsKCQkJY29uc3Qgc3RyaW5nUmVhZGVyID0gbmV3IFN0cmluZ1JlYWRlckNvcmUoKTsKCQkJbGV0IHsKCQkJCXRhcmdldCwKCQkJCWZvcm1hdFZlcnNpb24sCgkJCQloaWRlZiwKCQkJCWNvbXByZXNzZWQKCQkJfSA9IGpzb24uaGVhZGVyOwoJCQl0aGlzLnRhcmdldCA9IHRhcmdldDsKCQkJdGhpcy5mb3JtYXRWZXJzaW9uID0gZm9ybWF0VmVyc2lvbjsKCQkJdGhpcy5oaWRlZiA9IGhpZGVmOwoJCQljb25zdCBsejRDb21wcmVzc2lvbiA9IHRoaXMudGFyZ2V0ID09ICdhJyB8fCB0aGlzLnRhcmdldCA9PSAnaScgfHwgKGNvbXByZXNzZWQgJiBDT01QUkVTU0VEX0xaNF9NQVNLKSAhPSAwOwoJCQl0aGlzLmNvbXByZXNzZWQgPSBsejRDb21wcmVzc2lvbiA/IHRydWUgOiBmYWxzZTsKCQkJYnVmZmVyLndyaXRlU3RyaW5nKCJYTkIiKTsKCQkJYnVmZmVyLndyaXRlU3RyaW5nKHRoaXMudGFyZ2V0KTsKCQkJYnVmZmVyLndyaXRlQnl0ZSh0aGlzLmZvcm1hdFZlcnNpb24pOwoJCQlidWZmZXIud3JpdGVCeXRlKHRoaXMuaGlkZWYgfCAodGhpcy5jb21wcmVzc2VkICYmIGx6NENvbXByZXNzaW9uID8gQ09NUFJFU1NFRF9MWjRfTUFTSyA6IDApKTsKCQkJYnVmZmVyLndyaXRlVUludDMyKDApOwoJCQlpZiAobHo0Q29tcHJlc3Npb24pIGJ1ZmZlci53cml0ZVVJbnQzMigwKTsKCQkJYnVmZmVyLndyaXRlN0JpdE51bWJlcihqc29uLnJlYWRlcnMubGVuZ3RoKTsKCgkJCWZvciAobGV0IHJlYWRlciBvZiBqc29uLnJlYWRlcnMpIHsKCQkJCXRoaXMucmVhZGVycy5wdXNoKFR5cGVSZWFkZXIuZ2V0UmVhZGVyRnJvbVJhdyhyZWFkZXIudHlwZSkpOwoJCQkJc3RyaW5nUmVhZGVyLndyaXRlKGJ1ZmZlciwgcmVhZGVyLnR5cGUpOwoJCQkJYnVmZmVyLndyaXRlVUludDMyKHJlYWRlci52ZXJzaW9uKTsKCQkJfQoKCQkJYnVmZmVyLndyaXRlN0JpdE51bWJlcigwKTsKCQkJY29uc3QgY29udGVudCA9IG5ldyBSZWFkZXJSZXNvbHZlcih0aGlzLnJlYWRlcnMpOwoJCQljb250ZW50LndyaXRlKGJ1ZmZlciwganNvbi5jb250ZW50KTsKCQkJYnVmZmVyLnRyaW0oKTsKCgkJCWlmIChsejRDb21wcmVzc2lvbikgewoJCQkJY29uc3QgdHJpbW1lZCA9IGJ1ZmZlci5idWZmZXIuc2xpY2UoWE5CX0NPTVBSRVNTRURfUFJPTE9HVUVfU0laRSk7CgkJCQljb25zdCB0cmltbWVkQXJyYXkgPSBuZXcgVWludDhBcnJheSh0cmltbWVkKTsKCQkJCWxldCBjb21wcmVzc2VkU2l6ZSA9IGNvbXByZXNzQm91bmQodHJpbW1lZEFycmF5Lmxlbmd0aCk7CgkJCQlsZXQgY29tcHJlc3NlZCA9IG5ldyBVaW50OEFycmF5KGNvbXByZXNzZWRTaXplKTsKCQkJCWNvbXByZXNzZWRTaXplID0gY29tcHJlc3NTaW5nbGVCbG9jayh0cmltbWVkQXJyYXksIGNvbXByZXNzZWQpOwoJCQkJY29tcHJlc3NlZCA9IGNvbXByZXNzZWQuc2xpY2UoMCwgY29tcHJlc3NlZFNpemUpOwoJCQkJYnVmZmVyLmJ5dGVQb3NpdGlvbiA9IDY7CgkJCQlidWZmZXIud3JpdGVVSW50MzIoWE5CX0NPTVBSRVNTRURfUFJPTE9HVUVfU0laRSArIGNvbXByZXNzZWRTaXplKTsKCQkJCWJ1ZmZlci53cml0ZVVJbnQzMih0cmltbWVkQXJyYXkubGVuZ3RoKTsKCQkJCWJ1ZmZlci5jb25jYXQoY29tcHJlc3NlZCk7CgkJCQlsZXQgcmV0dXJuQnVmZmVyID0gYnVmZmVyLmJ1ZmZlci5zbGljZSgwLCBYTkJfQ09NUFJFU1NFRF9QUk9MT0dVRV9TSVpFICsgY29tcHJlc3NlZFNpemUpOwoJCQkJcmV0dXJuIHJldHVybkJ1ZmZlcjsKCQkJfQoKCQkJbGV0IGZpbGVTaXplID0gYnVmZmVyLmJ5dGVQb3NpdGlvbjsKCQkJYnVmZmVyLmJ5dGVQb3NpdGlvbiA9IDY7CgkJCWJ1ZmZlci53cml0ZVVJbnQzMihmaWxlU2l6ZSwgNik7CgkJCXJldHVybiBidWZmZXIuYnVmZmVyOwoJCX0KCgkJX3ZhbGlkYXRlSGVhZGVyKCkgewoJCQlpZiAodGhpcy5idWZmZXIgPT0gbnVsbCkgdGhyb3cgbmV3IFhuYkVycm9yKCdCdWZmZXIgaXMgbnVsbCcpOwoJCQljb25zdCBtYWdpYyA9IHRoaXMuYnVmZmVyLnJlYWRTdHJpbmcoMyk7CgkJCWlmIChtYWdpYyAhPSAnWE5CJykgdGhyb3cgbmV3IFhuYkVycm9yKCJJbnZhbGlkIGZpbGUgbWFnaWMgZm91bmQsIGV4cGVjdGluZyBcIlhOQlwiLCBmb3VuZCBcIiIuY29uY2F0KG1hZ2ljLCAiXCIiKSk7CgkJCXRoaXMudGFyZ2V0ID0gdGhpcy5idWZmZXIucmVhZFN0cmluZygxKS50b0xvd2VyQ2FzZSgpOwoJCQl0aGlzLmZvcm1hdFZlcnNpb24gPSB0aGlzLmJ1ZmZlci5yZWFkQnl0ZSgpOwoJCQljb25zdCBmbGFncyA9IHRoaXMuYnVmZmVyLnJlYWRCeXRlKDEpOwoJCQl0aGlzLmhpZGVmID0gKGZsYWdzICYgSElERUZfTUFTSykgIT0gMDsKCQkJdGhpcy5jb21wcmVzc2VkID0gZmxhZ3MgJiBDT01QUkVTU0VEX0xaWF9NQVNLIHx8IChmbGFncyAmIENPTVBSRVNTRURfTFo0X01BU0spICE9IDA7CgkJCXRoaXMuY29tcHJlc3Npb25UeXBlID0gKGZsYWdzICYgQ09NUFJFU1NFRF9MWlhfTUFTSykgIT0gMCA/IENPTVBSRVNTRURfTFpYX01BU0sgOiBmbGFncyAmIENPTVBSRVNTRURfTFo0X01BU0sgPyBDT01QUkVTU0VEX0xaNF9NQVNLIDogMDsKCQl9CgoJfQoKCXZhciB0ID0gewoJCTM5NjogZnVuY3Rpb24gXygpIHsKCQkJIWZ1bmN0aW9uICh0KSB7CgkJCQlpZiAodC5UZXh0RW5jb2RlciAmJiB0LlRleHREZWNvZGVyKSByZXR1cm4gITE7CgoJCQkJZnVuY3Rpb24gZSgpIHsKCQkJCQlsZXQgdCA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogInV0Zi04IjsKCQkJCQlpZiAoInV0Zi04IiAhPT0gdCkgdGhyb3cgbmV3IFJhbmdlRXJyb3IoIkZhaWxlZCB0byBjb25zdHJ1Y3QgJ1RleHRFbmNvZGVyJzogVGhlIGVuY29kaW5nIGxhYmVsIHByb3ZpZGVkICgnIi5jb25jYXQodCwgIicpIGlzIGludmFsaWQuIikpOwoJCQkJfQoKCQkJCWZ1bmN0aW9uIGkoKSB7CgkJCQkJbGV0IHQgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6ICJ1dGYtOCI7CgkJCQkJbGV0IGUgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHsKCQkJCQkJZmF0YWw6ICExCgkJCQkJfTsKCQkJCQlpZiAoInV0Zi04IiAhPT0gdCkgdGhyb3cgbmV3IFJhbmdlRXJyb3IoIkZhaWxlZCB0byBjb25zdHJ1Y3QgJ1RleHREZWNvZGVyJzogVGhlIGVuY29kaW5nIGxhYmVsIHByb3ZpZGVkICgnIi5jb25jYXQodCwgIicpIGlzIGludmFsaWQuIikpOwoJCQkJCWlmIChlLmZhdGFsKSB0aHJvdyBuZXcgRXJyb3IoIkZhaWxlZCB0byBjb25zdHJ1Y3QgJ1RleHREZWNvZGVyJzogdGhlICdmYXRhbCcgb3B0aW9uIGlzIHVuc3VwcG9ydGVkLiIpOwoJCQkJfQoKCQkJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLnByb3RvdHlwZSwgImVuY29kaW5nIiwgewoJCQkJCXZhbHVlOiAidXRmLTgiCgkJCQl9KSwgZS5wcm90b3R5cGUuZW5jb2RlID0gZnVuY3Rpb24gKHQpIHsKCQkJCQlsZXQgZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogewoJCQkJCQlzdHJlYW06ICExCgkJCQkJfTsKCQkJCQlpZiAoZS5zdHJlYW0pIHRocm93IG5ldyBFcnJvcigiRmFpbGVkIHRvIGVuY29kZTogdGhlICdzdHJlYW0nIG9wdGlvbiBpcyB1bnN1cHBvcnRlZC4iKTsKCQkJCQlsZXQgaSA9IDA7CgkJCQkJY29uc3QgbiA9IHQubGVuZ3RoOwoJCQkJCWxldCByID0gMCwKCQkJCQkJCXMgPSBNYXRoLm1heCgzMiwgbiArIChuID4+IDEpICsgNyksCgkJCQkJCQlhID0gbmV3IFVpbnQ4QXJyYXkocyA+PiAzIDw8IDMpOwoKCQkJCQlmb3IgKDsgaSA8IG47KSB7CgkJCQkJCWxldCBlID0gdC5jaGFyQ29kZUF0KGkrKyk7CgoJCQkJCQlpZiAoZSA+PSA1NTI5NiAmJiBlIDw9IDU2MzE5KSB7CgkJCQkJCQlpZiAoaSA8IG4pIHsKCQkJCQkJCQljb25zdCBuID0gdC5jaGFyQ29kZUF0KGkpOwoJCQkJCQkJCTU2MzIwID09ICg2NDUxMiAmIG4pICYmICgrK2ksIGUgPSAoKDEwMjMgJiBlKSA8PCAxMCkgKyAoMTAyMyAmIG4pICsgNjU1MzYpOwoJCQkJCQkJfQoKCQkJCQkJCWlmIChlID49IDU1Mjk2ICYmIGUgPD0gNTYzMTkpIGNvbnRpbnVlOwoJCQkJCQl9CgoJCQkJCQlpZiAociArIDQgPiBhLmxlbmd0aCkgewoJCQkJCQkJcyArPSA4LCBzICo9IDEgKyBpIC8gdC5sZW5ndGggKiAyLCBzID0gcyA+PiAzIDw8IDM7CgkJCQkJCQljb25zdCBlID0gbmV3IFVpbnQ4QXJyYXkocyk7CgkJCQkJCQllLnNldChhKSwgYSA9IGU7CgkJCQkJCX0KCgkJCQkJCWlmICgwICE9ICg0Mjk0OTY3MTY4ICYgZSkpIHsKCQkJCQkJCWlmICgwID09ICg0Mjk0OTY1MjQ4ICYgZSkpIGFbcisrXSA9IGUgPj4gNiAmIDMxIHwgMTkyO2Vsc2UgaWYgKDAgPT0gKDQyOTQ5MDE3NjAgJiBlKSkgYVtyKytdID0gZSA+PiAxMiAmIDE1IHwgMjI0LCBhW3IrK10gPSBlID4+IDYgJiA2MyB8IDEyODtlbHNlIHsKCQkJCQkJCQlpZiAoMCAhPSAoNDI5Mjg3MDE0NCAmIGUpKSBjb250aW51ZTsKCQkJCQkJCQlhW3IrK10gPSBlID4+IDE4ICYgNyB8IDI0MCwgYVtyKytdID0gZSA+PiAxMiAmIDYzIHwgMTI4LCBhW3IrK10gPSBlID4+IDYgJiA2MyB8IDEyODsKCQkJCQkJCX0KCQkJCQkJCWFbcisrXSA9IDYzICYgZSB8IDEyODsKCQkJCQkJfSBlbHNlIGFbcisrXSA9IGU7CgkJCQkJfQoKCQkJCQlyZXR1cm4gYS5zbGljZSgwLCByKTsKCQkJCX0sIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShpLnByb3RvdHlwZSwgImVuY29kaW5nIiwgewoJCQkJCXZhbHVlOiAidXRmLTgiCgkJCQl9KSwgT2JqZWN0LmRlZmluZVByb3BlcnR5KGkucHJvdG90eXBlLCAiZmF0YWwiLCB7CgkJCQkJdmFsdWU6ICExCgkJCQl9KSwgT2JqZWN0LmRlZmluZVByb3BlcnR5KGkucHJvdG90eXBlLCAiaWdub3JlQk9NIiwgewoJCQkJCXZhbHVlOiAhMQoJCQkJfSksIGkucHJvdG90eXBlLmRlY29kZSA9IGZ1bmN0aW9uICh0KSB7CgkJCQkJbGV0IGUgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHsKCQkJCQkJc3RyZWFtOiAhMQoJCQkJCX07CgkJCQkJaWYgKGUuc3RyZWFtKSB0aHJvdyBuZXcgRXJyb3IoIkZhaWxlZCB0byBkZWNvZGU6IHRoZSAnc3RyZWFtJyBvcHRpb24gaXMgdW5zdXBwb3J0ZWQuIik7CgkJCQkJY29uc3QgaSA9IG5ldyBVaW50OEFycmF5KHQpOwoJCQkJCWxldCBuID0gMDsKCQkJCQljb25zdCByID0gaS5sZW5ndGgsCgkJCQkJCQkJcyA9IFtdOwoKCQkJCQlmb3IgKDsgbiA8IHI7KSB7CgkJCQkJCWNvbnN0IHQgPSBpW24rK107CgkJCQkJCWlmICgwID09PSB0KSBicmVhazsKCQkJCQkJaWYgKDAgPT0gKDEyOCAmIHQpKSBzLnB1c2godCk7ZWxzZSBpZiAoMTkyID09ICgyMjQgJiB0KSkgewoJCQkJCQkJY29uc3QgZSA9IDYzICYgaVtuKytdOwoJCQkJCQkJcy5wdXNoKCgzMSAmIHQpIDw8IDYgfCBlKTsKCQkJCQkJfSBlbHNlIGlmICgyMjQgPT0gKDI0MCAmIHQpKSB7CgkJCQkJCQljb25zdCBlID0gNjMgJiBpW24rK10sCgkJCQkJCQkJCQlyID0gNjMgJiBpW24rK107CgkJCQkJCQlzLnB1c2goKDMxICYgdCkgPDwgMTIgfCBlIDw8IDYgfCByKTsKCQkJCQkJfSBlbHNlIGlmICgyNDAgPT0gKDI0OCAmIHQpKSB7CgkJCQkJCQlsZXQgZSA9ICg3ICYgdCkgPDwgMTggfCAoNjMgJiBpW24rK10pIDw8IDEyIHwgKDYzICYgaVtuKytdKSA8PCA2IHwgNjMgJiBpW24rK107CgkJCQkJCQllID4gNjU1MzUgJiYgKGUgLT0gNjU1MzYsIHMucHVzaChlID4+PiAxMCAmIDEwMjMgfCA1NTI5NiksIGUgPSA1NjMyMCB8IDEwMjMgJiBlKSwgcy5wdXNoKGUpOwoJCQkJCQl9CgkJCQkJfQoKCQkJCQlyZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLCBzKTsKCQkJCX0sIHQuVGV4dEVuY29kZXIgPSBlLCB0LlRleHREZWNvZGVyID0gaTsKCQkJfSgidW5kZWZpbmVkIiAhPSB0eXBlb2Ygd2luZG93ID8gd2luZG93IDogInVuZGVmaW5lZCIgIT0gdHlwZW9mIHNlbGYgPyBzZWxmIDogdGhpcyk7CgkJfQoJfSwKCQkJZSA9IHt9OwoKCWZ1bmN0aW9uIGkobikgewoJCXZhciByID0gZVtuXTsKCQlpZiAodm9pZCAwICE9PSByKSByZXR1cm4gci5leHBvcnRzOwoJCXZhciBzID0gZVtuXSA9IHsKCQkJZXhwb3J0czoge30KCQl9OwoJCXJldHVybiB0W25dLmNhbGwocy5leHBvcnRzLCBzLCBzLmV4cG9ydHMsIGkpLCBzLmV4cG9ydHM7Cgl9CgoJaS5kID0gKHQsIGUpID0+IHsKCQlmb3IgKHZhciBuIGluIGUpIGkubyhlLCBuKSAmJiAhaS5vKHQsIG4pICYmIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LCBuLCB7CgkJCWVudW1lcmFibGU6ICEwLAoJCQlnZXQ6IGVbbl0KCQl9KTsKCX0sIGkubyA9ICh0LCBlKSA9PiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwodCwgZSk7Cgl2YXIgbiA9IHt9OwoKCSgoKSA9PiB7CgkJaS5kKG4sIHsKCQkJUDogKCkgPT4gTWksCgkJCW06ICgpID0+IEZpCgkJfSksIGkoMzk2KTsKCQljb25zdCB0ID0gbmV3IFRleHREZWNvZGVyKCJ1dGYtOCIpLAoJCQkJCWUgPSBuZXcgVGV4dEVuY29kZXIoKTsKCgkJY2xhc3MgciB7CgkJCWNvbnN0cnVjdG9yKCkgewoJCQkJbGV0IHQgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IDgxOTI7CgkJCQlsZXQgZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDoge307CgkJCQlsZXQgaSA9ICExOwoJCQkJIm51bWJlciIgPT0gdHlwZW9mIHQgPyB0ID0gbmV3IEFycmF5QnVmZmVyKHQpIDogKGkgPSAhMCwgdGhpcy5sYXN0V3JpdHRlbkJ5dGUgPSB0LmJ5dGVMZW5ndGgpOwoJCQkJY29uc3QgbiA9IGUub2Zmc2V0ID8gZS5vZmZzZXQgPj4+IDAgOiAwLAoJCQkJCQkJcyA9IHQuYnl0ZUxlbmd0aCAtIG47CgkJCQlsZXQgYSA9IG47CgkJCQkoQXJyYXlCdWZmZXIuaXNWaWV3KHQpIHx8IHQgaW5zdGFuY2VvZiByKSAmJiAodC5ieXRlTGVuZ3RoICE9PSB0LmJ1ZmZlci5ieXRlTGVuZ3RoICYmIChhID0gdC5ieXRlT2Zmc2V0ICsgbiksIHQgPSB0LmJ1ZmZlciksIHRoaXMubGFzdFdyaXR0ZW5CeXRlID0gaSA/IHMgOiAwLCB0aGlzLmJ1ZmZlciA9IHQsIHRoaXMubGVuZ3RoID0gcywgdGhpcy5ieXRlTGVuZ3RoID0gcywgdGhpcy5ieXRlT2Zmc2V0ID0gYSwgdGhpcy5vZmZzZXQgPSAwLCB0aGlzLmxpdHRsZUVuZGlhbiA9ICEwLCB0aGlzLl9kYXRhID0gbmV3IERhdGFWaWV3KHRoaXMuYnVmZmVyLCBhLCBzKSwgdGhpcy5fbWFyayA9IDAsIHRoaXMuX21hcmtzID0gW107CgkJCX0KCgkJCWF2YWlsYWJsZSgpIHsKCQkJCWxldCB0ID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiAxOwoJCQkJcmV0dXJuIHRoaXMub2Zmc2V0ICsgdCA8PSB0aGlzLmxlbmd0aDsKCQkJfQoKCQkJaXNMaXR0bGVFbmRpYW4oKSB7CgkJCQlyZXR1cm4gdGhpcy5saXR0bGVFbmRpYW47CgkJCX0KCgkJCXNldExpdHRsZUVuZGlhbigpIHsKCQkJCXJldHVybiB0aGlzLmxpdHRsZUVuZGlhbiA9ICEwLCB0aGlzOwoJCQl9CgoJCQlpc0JpZ0VuZGlhbigpIHsKCQkJCXJldHVybiAhdGhpcy5saXR0bGVFbmRpYW47CgkJCX0KCgkJCXNldEJpZ0VuZGlhbigpIHsKCQkJCXJldHVybiB0aGlzLmxpdHRsZUVuZGlhbiA9ICExLCB0aGlzOwoJCQl9CgoJCQlza2lwKCkgewoJCQkJbGV0IHQgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IDE7CgkJCQlyZXR1cm4gdGhpcy5vZmZzZXQgKz0gdCwgdGhpczsKCQkJfQoKCQkJc2Vlayh0KSB7CgkJCQlyZXR1cm4gdGhpcy5vZmZzZXQgPSB0LCB0aGlzOwoJCQl9CgoJCQltYXJrKCkgewoJCQkJcmV0dXJuIHRoaXMuX21hcmsgPSB0aGlzLm9mZnNldCwgdGhpczsKCQkJfQoKCQkJcmVzZXQoKSB7CgkJCQlyZXR1cm4gdGhpcy5vZmZzZXQgPSB0aGlzLl9tYXJrLCB0aGlzOwoJCQl9CgoJCQlwdXNoTWFyaygpIHsKCQkJCXJldHVybiB0aGlzLl9tYXJrcy5wdXNoKHRoaXMub2Zmc2V0KSwgdGhpczsKCQkJfQoKCQkJcG9wTWFyaygpIHsKCQkJCWNvbnN0IHQgPSB0aGlzLl9tYXJrcy5wb3AoKTsKCgkJCQlpZiAodm9pZCAwID09PSB0KSB0aHJvdyBuZXcgRXJyb3IoIk1hcmsgc3RhY2sgZW1wdHkiKTsKCQkJCXJldHVybiB0aGlzLnNlZWsodCksIHRoaXM7CgkJCX0KCgkJCXJld2luZCgpIHsKCQkJCXJldHVybiB0aGlzLm9mZnNldCA9IDAsIHRoaXM7CgkJCX0KCgkJCWVuc3VyZUF2YWlsYWJsZSgpIHsKCQkJCWxldCB0ID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiAxOwoKCQkJCWlmICghdGhpcy5hdmFpbGFibGUodCkpIHsKCQkJCQljb25zdCBlID0gMiAqICh0aGlzLm9mZnNldCArIHQpLAoJCQkJCQkJCWkgPSBuZXcgVWludDhBcnJheShlKTsKCQkJCQlpLnNldChuZXcgVWludDhBcnJheSh0aGlzLmJ1ZmZlcikpLCB0aGlzLmJ1ZmZlciA9IGkuYnVmZmVyLCB0aGlzLmxlbmd0aCA9IHRoaXMuYnl0ZUxlbmd0aCA9IGUsIHRoaXMuX2RhdGEgPSBuZXcgRGF0YVZpZXcodGhpcy5idWZmZXIpOwoJCQkJfQoKCQkJCXJldHVybiB0aGlzOwoJCQl9CgoJCQlyZWFkQm9vbGVhbigpIHsKCQkJCXJldHVybiAwICE9PSB0aGlzLnJlYWRVaW50OCgpOwoJCQl9CgoJCQlyZWFkSW50OCgpIHsKCQkJCXJldHVybiB0aGlzLl9kYXRhLmdldEludDgodGhpcy5vZmZzZXQrKyk7CgkJCX0KCgkJCXJlYWRVaW50OCgpIHsKCQkJCXJldHVybiB0aGlzLl9kYXRhLmdldFVpbnQ4KHRoaXMub2Zmc2V0KyspOwoJCQl9CgoJCQlyZWFkQnl0ZSgpIHsKCQkJCXJldHVybiB0aGlzLnJlYWRVaW50OCgpOwoJCQl9CgoJCQlyZWFkQnl0ZXMoKSB7CgkJCQlsZXQgdCA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogMTsKCQkJCWNvbnN0IGUgPSBuZXcgVWludDhBcnJheSh0KTsKCgkJCQlmb3IgKGxldCBpID0gMDsgaSA8IHQ7IGkrKykgZVtpXSA9IHRoaXMucmVhZEJ5dGUoKTsKCgkJCQlyZXR1cm4gZTsKCQkJfQoKCQkJcmVhZEludDE2KCkgewoJCQkJY29uc3QgdCA9IHRoaXMuX2RhdGEuZ2V0SW50MTYodGhpcy5vZmZzZXQsIHRoaXMubGl0dGxlRW5kaWFuKTsKCgkJCQlyZXR1cm4gdGhpcy5vZmZzZXQgKz0gMiwgdDsKCQkJfQoKCQkJcmVhZFVpbnQxNigpIHsKCQkJCWNvbnN0IHQgPSB0aGlzLl9kYXRhLmdldFVpbnQxNih0aGlzLm9mZnNldCwgdGhpcy5saXR0bGVFbmRpYW4pOwoKCQkJCXJldHVybiB0aGlzLm9mZnNldCArPSAyLCB0OwoJCQl9CgoJCQlyZWFkSW50MzIoKSB7CgkJCQljb25zdCB0ID0gdGhpcy5fZGF0YS5nZXRJbnQzMih0aGlzLm9mZnNldCwgdGhpcy5saXR0bGVFbmRpYW4pOwoKCQkJCXJldHVybiB0aGlzLm9mZnNldCArPSA0LCB0OwoJCQl9CgoJCQlyZWFkVWludDMyKCkgewoJCQkJY29uc3QgdCA9IHRoaXMuX2RhdGEuZ2V0VWludDMyKHRoaXMub2Zmc2V0LCB0aGlzLmxpdHRsZUVuZGlhbik7CgoJCQkJcmV0dXJuIHRoaXMub2Zmc2V0ICs9IDQsIHQ7CgkJCX0KCgkJCXJlYWRGbG9hdDMyKCkgewoJCQkJY29uc3QgdCA9IHRoaXMuX2RhdGEuZ2V0RmxvYXQzMih0aGlzLm9mZnNldCwgdGhpcy5saXR0bGVFbmRpYW4pOwoKCQkJCXJldHVybiB0aGlzLm9mZnNldCArPSA0LCB0OwoJCQl9CgoJCQlyZWFkRmxvYXQ2NCgpIHsKCQkJCWNvbnN0IHQgPSB0aGlzLl9kYXRhLmdldEZsb2F0NjQodGhpcy5vZmZzZXQsIHRoaXMubGl0dGxlRW5kaWFuKTsKCgkJCQlyZXR1cm4gdGhpcy5vZmZzZXQgKz0gOCwgdDsKCQkJfQoKCQkJcmVhZEJpZ0ludDY0KCkgewoJCQkJY29uc3QgdCA9IHRoaXMuX2RhdGEuZ2V0QmlnSW50NjQodGhpcy5vZmZzZXQsIHRoaXMubGl0dGxlRW5kaWFuKTsKCgkJCQlyZXR1cm4gdGhpcy5vZmZzZXQgKz0gOCwgdDsKCQkJfQoKCQkJcmVhZEJpZ1VpbnQ2NCgpIHsKCQkJCWNvbnN0IHQgPSB0aGlzLl9kYXRhLmdldEJpZ1VpbnQ2NCh0aGlzLm9mZnNldCwgdGhpcy5saXR0bGVFbmRpYW4pOwoKCQkJCXJldHVybiB0aGlzLm9mZnNldCArPSA4LCB0OwoJCQl9CgoJCQlyZWFkQ2hhcigpIHsKCQkJCXJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKHRoaXMucmVhZEludDgoKSk7CgkJCX0KCgkJCXJlYWRDaGFycygpIHsKCQkJCWxldCB0ID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiAxOwoJCQkJbGV0IGUgPSAiIjsKCgkJCQlmb3IgKGxldCBpID0gMDsgaSA8IHQ7IGkrKykgZSArPSB0aGlzLnJlYWRDaGFyKCk7CgoJCQkJcmV0dXJuIGU7CgkJCX0KCgkJCXJlYWRVdGY4KCkgewoJCQkJbGV0IGUgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IDE7CgkJCQlyZXR1cm4gaSA9IHRoaXMucmVhZEJ5dGVzKGUpLCB0LmRlY29kZShpKTsKCQkJCXZhciBpOwoJCQl9CgoJCQl3cml0ZUJvb2xlYW4odCkgewoJCQkJcmV0dXJuIHRoaXMud3JpdGVVaW50OCh0ID8gMjU1IDogMCksIHRoaXM7CgkJCX0KCgkJCXdyaXRlSW50OCh0KSB7CgkJCQlyZXR1cm4gdGhpcy5lbnN1cmVBdmFpbGFibGUoMSksIHRoaXMuX2RhdGEuc2V0SW50OCh0aGlzLm9mZnNldCsrLCB0KSwgdGhpcy5fdXBkYXRlTGFzdFdyaXR0ZW5CeXRlKCksIHRoaXM7CgkJCX0KCgkJCXdyaXRlVWludDgodCkgewoJCQkJcmV0dXJuIHRoaXMuZW5zdXJlQXZhaWxhYmxlKDEpLCB0aGlzLl9kYXRhLnNldFVpbnQ4KHRoaXMub2Zmc2V0KyssIHQpLCB0aGlzLl91cGRhdGVMYXN0V3JpdHRlbkJ5dGUoKSwgdGhpczsKCQkJfQoKCQkJd3JpdGVCeXRlKHQpIHsKCQkJCXJldHVybiB0aGlzLndyaXRlVWludDgodCk7CgkJCX0KCgkJCXdyaXRlQnl0ZXModCkgewoJCQkJdGhpcy5lbnN1cmVBdmFpbGFibGUodC5sZW5ndGgpOwoKCQkJCWZvciAobGV0IGUgPSAwOyBlIDwgdC5sZW5ndGg7IGUrKykgdGhpcy5fZGF0YS5zZXRVaW50OCh0aGlzLm9mZnNldCsrLCB0W2VdKTsKCgkJCQlyZXR1cm4gdGhpcy5fdXBkYXRlTGFzdFdyaXR0ZW5CeXRlKCksIHRoaXM7CgkJCX0KCgkJCXdyaXRlSW50MTYodCkgewoJCQkJcmV0dXJuIHRoaXMuZW5zdXJlQXZhaWxhYmxlKDIpLCB0aGlzLl9kYXRhLnNldEludDE2KHRoaXMub2Zmc2V0LCB0LCB0aGlzLmxpdHRsZUVuZGlhbiksIHRoaXMub2Zmc2V0ICs9IDIsIHRoaXMuX3VwZGF0ZUxhc3RXcml0dGVuQnl0ZSgpLCB0aGlzOwoJCQl9CgoJCQl3cml0ZVVpbnQxNih0KSB7CgkJCQlyZXR1cm4gdGhpcy5lbnN1cmVBdmFpbGFibGUoMiksIHRoaXMuX2RhdGEuc2V0VWludDE2KHRoaXMub2Zmc2V0LCB0LCB0aGlzLmxpdHRsZUVuZGlhbiksIHRoaXMub2Zmc2V0ICs9IDIsIHRoaXMuX3VwZGF0ZUxhc3RXcml0dGVuQnl0ZSgpLCB0aGlzOwoJCQl9CgoJCQl3cml0ZUludDMyKHQpIHsKCQkJCXJldHVybiB0aGlzLmVuc3VyZUF2YWlsYWJsZSg0KSwgdGhpcy5fZGF0YS5zZXRJbnQzMih0aGlzLm9mZnNldCwgdCwgdGhpcy5saXR0bGVFbmRpYW4pLCB0aGlzLm9mZnNldCArPSA0LCB0aGlzLl91cGRhdGVMYXN0V3JpdHRlbkJ5dGUoKSwgdGhpczsKCQkJfQoKCQkJd3JpdGVVaW50MzIodCkgewoJCQkJcmV0dXJuIHRoaXMuZW5zdXJlQXZhaWxhYmxlKDQpLCB0aGlzLl9kYXRhLnNldFVpbnQzMih0aGlzLm9mZnNldCwgdCwgdGhpcy5saXR0bGVFbmRpYW4pLCB0aGlzLm9mZnNldCArPSA0LCB0aGlzLl91cGRhdGVMYXN0V3JpdHRlbkJ5dGUoKSwgdGhpczsKCQkJfQoKCQkJd3JpdGVGbG9hdDMyKHQpIHsKCQkJCXJldHVybiB0aGlzLmVuc3VyZUF2YWlsYWJsZSg0KSwgdGhpcy5fZGF0YS5zZXRGbG9hdDMyKHRoaXMub2Zmc2V0LCB0LCB0aGlzLmxpdHRsZUVuZGlhbiksIHRoaXMub2Zmc2V0ICs9IDQsIHRoaXMuX3VwZGF0ZUxhc3RXcml0dGVuQnl0ZSgpLCB0aGlzOwoJCQl9CgoJCQl3cml0ZUZsb2F0NjQodCkgewoJCQkJcmV0dXJuIHRoaXMuZW5zdXJlQXZhaWxhYmxlKDgpLCB0aGlzLl9kYXRhLnNldEZsb2F0NjQodGhpcy5vZmZzZXQsIHQsIHRoaXMubGl0dGxlRW5kaWFuKSwgdGhpcy5vZmZzZXQgKz0gOCwgdGhpcy5fdXBkYXRlTGFzdFdyaXR0ZW5CeXRlKCksIHRoaXM7CgkJCX0KCgkJCXdyaXRlQmlnSW50NjQodCkgewoJCQkJcmV0dXJuIHRoaXMuZW5zdXJlQXZhaWxhYmxlKDgpLCB0aGlzLl9kYXRhLnNldEJpZ0ludDY0KHRoaXMub2Zmc2V0LCB0LCB0aGlzLmxpdHRsZUVuZGlhbiksIHRoaXMub2Zmc2V0ICs9IDgsIHRoaXMuX3VwZGF0ZUxhc3RXcml0dGVuQnl0ZSgpLCB0aGlzOwoJCQl9CgoJCQl3cml0ZUJpZ1VpbnQ2NCh0KSB7CgkJCQlyZXR1cm4gdGhpcy5lbnN1cmVBdmFpbGFibGUoOCksIHRoaXMuX2RhdGEuc2V0QmlnVWludDY0KHRoaXMub2Zmc2V0LCB0LCB0aGlzLmxpdHRsZUVuZGlhbiksIHRoaXMub2Zmc2V0ICs9IDgsIHRoaXMuX3VwZGF0ZUxhc3RXcml0dGVuQnl0ZSgpLCB0aGlzOwoJCQl9CgoJCQl3cml0ZUNoYXIodCkgewoJCQkJcmV0dXJuIHRoaXMud3JpdGVVaW50OCh0LmNoYXJDb2RlQXQoMCkpOwoJCQl9CgoJCQl3cml0ZUNoYXJzKHQpIHsKCQkJCWZvciAobGV0IGUgPSAwOyBlIDwgdC5sZW5ndGg7IGUrKykgdGhpcy53cml0ZVVpbnQ4KHQuY2hhckNvZGVBdChlKSk7CgoJCQkJcmV0dXJuIHRoaXM7CgkJCX0KCgkJCXdyaXRlVXRmOCh0KSB7CgkJCQlyZXR1cm4gdGhpcy53cml0ZUJ5dGVzKGZ1bmN0aW9uICh0KSB7CgkJCQkJcmV0dXJuIGUuZW5jb2RlKHQpOwoJCQkJfSh0KSk7CgkJCX0KCgkJCXRvQXJyYXkoKSB7CgkJCQlyZXR1cm4gbmV3IFVpbnQ4QXJyYXkodGhpcy5idWZmZXIsIHRoaXMuYnl0ZU9mZnNldCwgdGhpcy5sYXN0V3JpdHRlbkJ5dGUpOwoJCQl9CgoJCQlfdXBkYXRlTGFzdFdyaXR0ZW5CeXRlKCkgewoJCQkJdGhpcy5vZmZzZXQgPiB0aGlzLmxhc3RXcml0dGVuQnl0ZSAmJiAodGhpcy5sYXN0V3JpdHRlbkJ5dGUgPSB0aGlzLm9mZnNldCk7CgkJCX0KCgkJfQoKCQlmdW5jdGlvbiBzKHQpIHsKCQkJbGV0IGUgPSB0Lmxlbmd0aDsKCgkJCWZvciAoOyAtLWUgPj0gMDspIHRbZV0gPSAwOwoJCX0KCgkJY29uc3QgYSA9IG5ldyBVaW50OEFycmF5KFswLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAxLCAxLCAxLCAxLCAyLCAyLCAyLCAyLCAzLCAzLCAzLCAzLCA0LCA0LCA0LCA0LCA1LCA1LCA1LCA1LCAwXSksCgkJCQkJbyA9IG5ldyBVaW50OEFycmF5KFswLCAwLCAwLCAwLCAxLCAxLCAyLCAyLCAzLCAzLCA0LCA0LCA1LCA1LCA2LCA2LCA3LCA3LCA4LCA4LCA5LCA5LCAxMCwgMTAsIDExLCAxMSwgMTIsIDEyLCAxMywgMTNdKSwKCQkJCQloID0gbmV3IFVpbnQ4QXJyYXkoWzAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDIsIDMsIDddKSwKCQkJCQlsID0gbmV3IFVpbnQ4QXJyYXkoWzE2LCAxNywgMTgsIDAsIDgsIDcsIDksIDYsIDEwLCA1LCAxMSwgNCwgMTIsIDMsIDEzLCAyLCAxNCwgMSwgMTVdKSwKCQkJCQlkID0gbmV3IEFycmF5KDU3Nik7CgkJcyhkKTsKCgkJY29uc3QgXyA9IG5ldyBBcnJheSg2MCk7CgoJCXMoXyk7CgkJY29uc3QgZiA9IG5ldyBBcnJheSg1MTIpOwoJCXMoZik7CgkJY29uc3QgYyA9IG5ldyBBcnJheSgyNTYpOwoJCXMoYyk7CgkJY29uc3QgdSA9IG5ldyBBcnJheSgyOSk7CgkJcyh1KTsKCQljb25zdCB3ID0gbmV3IEFycmF5KDMwKTsKCgkJZnVuY3Rpb24gcCh0LCBlLCBpLCBuLCByKSB7CgkJCXRoaXMuc3RhdGljX3RyZWUgPSB0LCB0aGlzLmV4dHJhX2JpdHMgPSBlLCB0aGlzLmV4dHJhX2Jhc2UgPSBpLCB0aGlzLmVsZW1zID0gbiwgdGhpcy5tYXhfbGVuZ3RoID0gciwgdGhpcy5oYXNfc3RyZWUgPSB0ICYmIHQubGVuZ3RoOwoJCX0KCgkJbGV0IGcsIGIsIG07CgoJCWZ1bmN0aW9uIGsodCwgZSkgewoJCQl0aGlzLmR5bl90cmVlID0gdCwgdGhpcy5tYXhfY29kZSA9IDAsIHRoaXMuc3RhdF9kZXNjID0gZTsKCQl9CgoJCXModyk7CgoJCWNvbnN0IHkgPSB0ID0+IHQgPCAyNTYgPyBmW3RdIDogZlsyNTYgKyAodCA+Pj4gNyldLAoJCQkJCXYgPSAodCwgZSkgPT4gewoJCQl0LnBlbmRpbmdfYnVmW3QucGVuZGluZysrXSA9IDI1NSAmIGUsIHQucGVuZGluZ19idWZbdC5wZW5kaW5nKytdID0gZSA+Pj4gOCAmIDI1NTsKCQl9LAoJCQkJCUUgPSAodCwgZSwgaSkgPT4gewoJCQl0LmJpX3ZhbGlkID4gMTYgLSBpID8gKHQuYmlfYnVmIHw9IGUgPDwgdC5iaV92YWxpZCAmIDY1NTM1LCB2KHQsIHQuYmlfYnVmKSwgdC5iaV9idWYgPSBlID4+IDE2IC0gdC5iaV92YWxpZCwgdC5iaV92YWxpZCArPSBpIC0gMTYpIDogKHQuYmlfYnVmIHw9IGUgPDwgdC5iaV92YWxpZCAmIDY1NTM1LCB0LmJpX3ZhbGlkICs9IGkpOwoJCX0sCgkJCQkJQSA9ICh0LCBlLCBpKSA9PiB7CgkJCUUodCwgaVsyICogZV0sIGlbMiAqIGUgKyAxXSk7CgkJfSwKCQkJCQl4ID0gKHQsIGUpID0+IHsKCQkJbGV0IGkgPSAwOwoKCQkJZG8gewoJCQkJaSB8PSAxICYgdCwgdCA+Pj49IDEsIGkgPDw9IDE7CgkJCX0gd2hpbGUgKC0tZSA+IDApOwoKCQkJcmV0dXJuIGkgPj4+IDE7CgkJfSwKCQkJCQlVID0gKHQsIGUsIGkpID0+IHsKCQkJY29uc3QgbiA9IG5ldyBBcnJheSgxNik7CgkJCWxldCByLAoJCQkJCXMsCgkJCQkJYSA9IDA7CgoJCQlmb3IgKHIgPSAxOyByIDw9IDE1OyByKyspIG5bcl0gPSBhID0gYSArIGlbciAtIDFdIDw8IDE7CgoJCQlmb3IgKHMgPSAwOyBzIDw9IGU7IHMrKykgewoJCQkJbGV0IGUgPSB0WzIgKiBzICsgMV07CgkJCQkwICE9PSBlICYmICh0WzIgKiBzXSA9IHgobltlXSsrLCBlKSk7CgkJCX0KCQl9LAoJCQkJCXogPSB0ID0+IHsKCQkJbGV0IGU7CgoJCQlmb3IgKGUgPSAwOyBlIDwgMjg2OyBlKyspIHQuZHluX2x0cmVlWzIgKiBlXSA9IDA7CgoJCQlmb3IgKGUgPSAwOyBlIDwgMzA7IGUrKykgdC5keW5fZHRyZWVbMiAqIGVdID0gMDsKCgkJCWZvciAoZSA9IDA7IGUgPCAxOTsgZSsrKSB0LmJsX3RyZWVbMiAqIGVdID0gMDsKCgkJCXQuZHluX2x0cmVlWzUxMl0gPSAxLCB0Lm9wdF9sZW4gPSB0LnN0YXRpY19sZW4gPSAwLCB0Lmxhc3RfbGl0ID0gdC5tYXRjaGVzID0gMDsKCQl9LAoJCQkJCVIgPSB0ID0+IHsKCQkJdC5iaV92YWxpZCA+IDggPyB2KHQsIHQuYmlfYnVmKSA6IHQuYmlfdmFsaWQgPiAwICYmICh0LnBlbmRpbmdfYnVmW3QucGVuZGluZysrXSA9IHQuYmlfYnVmKSwgdC5iaV9idWYgPSAwLCB0LmJpX3ZhbGlkID0gMDsKCQl9LAoJCQkJCU4gPSAodCwgZSwgaSwgbikgPT4gewoJCQljb25zdCByID0gMiAqIGUsCgkJCQkJCXMgPSAyICogaTsKCQkJcmV0dXJuIHRbcl0gPCB0W3NdIHx8IHRbcl0gPT09IHRbc10gJiYgbltlXSA8PSBuW2ldOwoJCX0sCgkJCQkJVCA9ICh0LCBlLCBpKSA9PiB7CgkJCWNvbnN0IG4gPSB0LmhlYXBbaV07CgkJCWxldCByID0gaSA8PCAxOwoKCQkJZm9yICg7IHIgPD0gdC5oZWFwX2xlbiAmJiAociA8IHQuaGVhcF9sZW4gJiYgTihlLCB0LmhlYXBbciArIDFdLCB0LmhlYXBbcl0sIHQuZGVwdGgpICYmIHIrKywgIU4oZSwgbiwgdC5oZWFwW3JdLCB0LmRlcHRoKSk7KSB0LmhlYXBbaV0gPSB0LmhlYXBbcl0sIGkgPSByLCByIDw8PSAxOwoKCQkJdC5oZWFwW2ldID0gbjsKCQl9LAoJCQkJCU8gPSAodCwgZSwgaSkgPT4gewoJCQlsZXQgbiwKCQkJCQlyLAoJCQkJCXMsCgkJCQkJaCwKCQkJCQlsID0gMDsKCQkJaWYgKDAgIT09IHQubGFzdF9saXQpIGRvIHsKCQkJCW4gPSB0LnBlbmRpbmdfYnVmW3QuZF9idWYgKyAyICogbF0gPDwgOCB8IHQucGVuZGluZ19idWZbdC5kX2J1ZiArIDIgKiBsICsgMV0sIHIgPSB0LnBlbmRpbmdfYnVmW3QubF9idWYgKyBsXSwgbCsrLCAwID09PSBuID8gQSh0LCByLCBlKSA6IChzID0gY1tyXSwgQSh0LCBzICsgMjU2ICsgMSwgZSksIGggPSBhW3NdLCAwICE9PSBoICYmIChyIC09IHVbc10sIEUodCwgciwgaCkpLCBuLS0sIHMgPSB5KG4pLCBBKHQsIHMsIGkpLCBoID0gb1tzXSwgMCAhPT0gaCAmJiAobiAtPSB3W3NdLCBFKHQsIG4sIGgpKSk7CgkJCX0gd2hpbGUgKGwgPCB0Lmxhc3RfbGl0KTsKCQkJQSh0LCAyNTYsIGUpOwoJCX0sCgkJCQkJTCA9ICh0LCBlKSA9PiB7CgkJCWNvbnN0IGkgPSBlLmR5bl90cmVlLAoJCQkJCQluID0gZS5zdGF0X2Rlc2Muc3RhdGljX3RyZWUsCgkJCQkJCXIgPSBlLnN0YXRfZGVzYy5oYXNfc3RyZWUsCgkJCQkJCXMgPSBlLnN0YXRfZGVzYy5lbGVtczsKCQkJbGV0IGEsCgkJCQkJbywKCQkJCQloLAoJCQkJCWwgPSAtMTsKCgkJCWZvciAodC5oZWFwX2xlbiA9IDAsIHQuaGVhcF9tYXggPSA1NzMsIGEgPSAwOyBhIDwgczsgYSsrKSAwICE9PSBpWzIgKiBhXSA/ICh0LmhlYXBbKyt0LmhlYXBfbGVuXSA9IGwgPSBhLCB0LmRlcHRoW2FdID0gMCkgOiBpWzIgKiBhICsgMV0gPSAwOwoKCQkJZm9yICg7IHQuaGVhcF9sZW4gPCAyOykgaCA9IHQuaGVhcFsrK3QuaGVhcF9sZW5dID0gbCA8IDIgPyArK2wgOiAwLCBpWzIgKiBoXSA9IDEsIHQuZGVwdGhbaF0gPSAwLCB0Lm9wdF9sZW4tLSwgciAmJiAodC5zdGF0aWNfbGVuIC09IG5bMiAqIGggKyAxXSk7CgoJCQlmb3IgKGUubWF4X2NvZGUgPSBsLCBhID0gdC5oZWFwX2xlbiA+PiAxOyBhID49IDE7IGEtLSkgVCh0LCBpLCBhKTsKCgkJCWggPSBzOwoKCQkJZG8gewoJCQkJYSA9IHQuaGVhcFsxXSwgdC5oZWFwWzFdID0gdC5oZWFwW3QuaGVhcF9sZW4tLV0sIFQodCwgaSwgMSksIG8gPSB0LmhlYXBbMV0sIHQuaGVhcFstLXQuaGVhcF9tYXhdID0gYSwgdC5oZWFwWy0tdC5oZWFwX21heF0gPSBvLCBpWzIgKiBoXSA9IGlbMiAqIGFdICsgaVsyICogb10sIHQuZGVwdGhbaF0gPSAodC5kZXB0aFthXSA+PSB0LmRlcHRoW29dID8gdC5kZXB0aFthXSA6IHQuZGVwdGhbb10pICsgMSwgaVsyICogYSArIDFdID0gaVsyICogbyArIDFdID0gaCwgdC5oZWFwWzFdID0gaCsrLCBUKHQsIGksIDEpOwoJCQl9IHdoaWxlICh0LmhlYXBfbGVuID49IDIpOwoKCQkJdC5oZWFwWy0tdC5oZWFwX21heF0gPSB0LmhlYXBbMV0sICgodCwgZSkgPT4gewoJCQkJY29uc3QgaSA9IGUuZHluX3RyZWUsCgkJCQkJCQluID0gZS5tYXhfY29kZSwKCQkJCQkJCXIgPSBlLnN0YXRfZGVzYy5zdGF0aWNfdHJlZSwKCQkJCQkJCXMgPSBlLnN0YXRfZGVzYy5oYXNfc3RyZWUsCgkJCQkJCQlhID0gZS5zdGF0X2Rlc2MuZXh0cmFfYml0cywKCQkJCQkJCW8gPSBlLnN0YXRfZGVzYy5leHRyYV9iYXNlLAoJCQkJCQkJaCA9IGUuc3RhdF9kZXNjLm1heF9sZW5ndGg7CgoJCQkJbGV0IGwsCgkJCQkJCWQsCgkJCQkJCV8sCgkJCQkJCWYsCgkJCQkJCWMsCgkJCQkJCXUsCgkJCQkJCXcgPSAwOwoKCQkJCWZvciAoZiA9IDA7IGYgPD0gMTU7IGYrKykgdC5ibF9jb3VudFtmXSA9IDA7CgoJCQkJZm9yIChpWzIgKiB0LmhlYXBbdC5oZWFwX21heF0gKyAxXSA9IDAsIGwgPSB0LmhlYXBfbWF4ICsgMTsgbCA8IDU3MzsgbCsrKSBkID0gdC5oZWFwW2xdLCBmID0gaVsyICogaVsyICogZCArIDFdICsgMV0gKyAxLCBmID4gaCAmJiAoZiA9IGgsIHcrKyksIGlbMiAqIGQgKyAxXSA9IGYsIGQgPiBuIHx8ICh0LmJsX2NvdW50W2ZdKyssIGMgPSAwLCBkID49IG8gJiYgKGMgPSBhW2QgLSBvXSksIHUgPSBpWzIgKiBkXSwgdC5vcHRfbGVuICs9IHUgKiAoZiArIGMpLCBzICYmICh0LnN0YXRpY19sZW4gKz0gdSAqIChyWzIgKiBkICsgMV0gKyBjKSkpOwoKCQkJCWlmICgwICE9PSB3KSB7CgkJCQkJZG8gewoJCQkJCQlmb3IgKGYgPSBoIC0gMTsgMCA9PT0gdC5ibF9jb3VudFtmXTspIGYtLTsKCgkJCQkJCXQuYmxfY291bnRbZl0tLSwgdC5ibF9jb3VudFtmICsgMV0gKz0gMiwgdC5ibF9jb3VudFtoXS0tLCB3IC09IDI7CgkJCQkJfSB3aGlsZSAodyA+IDApOwoKCQkJCQlmb3IgKGYgPSBoOyAwICE9PSBmOyBmLS0pIGZvciAoZCA9IHQuYmxfY291bnRbZl07IDAgIT09IGQ7KSBfID0gdC5oZWFwWy0tbF0sIF8gPiBuIHx8IChpWzIgKiBfICsgMV0gIT09IGYgJiYgKHQub3B0X2xlbiArPSAoZiAtIGlbMiAqIF8gKyAxXSkgKiBpWzIgKiBfXSwgaVsyICogXyArIDFdID0gZiksIGQtLSk7CgkJCQl9CgkJCX0pKHQsIGUpLCBVKGksIGwsIHQuYmxfY291bnQpOwoJCX0sCgkJCQkJQiA9ICh0LCBlLCBpKSA9PiB7CgkJCWxldCBuLAoJCQkJCXIsCgkJCQkJcyA9IC0xLAoJCQkJCWEgPSBlWzFdLAoJCQkJCW8gPSAwLAoJCQkJCWggPSA3LAoJCQkJCWwgPSA0OwoKCQkJZm9yICgwID09PSBhICYmIChoID0gMTM4LCBsID0gMyksIGVbMiAqIChpICsgMSkgKyAxXSA9IDY1NTM1LCBuID0gMDsgbiA8PSBpOyBuKyspIHIgPSBhLCBhID0gZVsyICogKG4gKyAxKSArIDFdLCArK28gPCBoICYmIHIgPT09IGEgfHwgKG8gPCBsID8gdC5ibF90cmVlWzIgKiByXSArPSBvIDogMCAhPT0gciA/IChyICE9PSBzICYmIHQuYmxfdHJlZVsyICogcl0rKywgdC5ibF90cmVlWzMyXSsrKSA6IG8gPD0gMTAgPyB0LmJsX3RyZWVbMzRdKysgOiB0LmJsX3RyZWVbMzZdKyssIG8gPSAwLCBzID0gciwgMCA9PT0gYSA/IChoID0gMTM4LCBsID0gMykgOiByID09PSBhID8gKGggPSA2LCBsID0gMykgOiAoaCA9IDcsIGwgPSA0KSk7CgkJfSwKCQkJCQlDID0gKHQsIGUsIGkpID0+IHsKCQkJbGV0IG4sCgkJCQkJciwKCQkJCQlzID0gLTEsCgkJCQkJYSA9IGVbMV0sCgkJCQkJbyA9IDAsCgkJCQkJaCA9IDcsCgkJCQkJbCA9IDQ7CgoJCQlmb3IgKDAgPT09IGEgJiYgKGggPSAxMzgsIGwgPSAzKSwgbiA9IDA7IG4gPD0gaTsgbisrKSBpZiAociA9IGEsIGEgPSBlWzIgKiAobiArIDEpICsgMV0sICEoKytvIDwgaCAmJiByID09PSBhKSkgewoJCQkJaWYgKG8gPCBsKSBkbyB7CgkJCQkJQSh0LCByLCB0LmJsX3RyZWUpOwoJCQkJfSB3aGlsZSAoMCAhPSAtLW8pO2Vsc2UgMCAhPT0gciA/IChyICE9PSBzICYmIChBKHQsIHIsIHQuYmxfdHJlZSksIG8tLSksIEEodCwgMTYsIHQuYmxfdHJlZSksIEUodCwgbyAtIDMsIDIpKSA6IG8gPD0gMTAgPyAoQSh0LCAxNywgdC5ibF90cmVlKSwgRSh0LCBvIC0gMywgMykpIDogKEEodCwgMTgsIHQuYmxfdHJlZSksIEUodCwgbyAtIDExLCA3KSk7CgkJCQlvID0gMCwgcyA9IHIsIDAgPT09IGEgPyAoaCA9IDEzOCwgbCA9IDMpIDogciA9PT0gYSA/IChoID0gNiwgbCA9IDMpIDogKGggPSA3LCBsID0gNCk7CgkJCX0KCQl9OwoKCQlsZXQgRCA9ICExOwoKCQljb25zdCBJID0gKHQsIGUsIGksIG4pID0+IHsKCQkJRSh0LCAwICsgKG4gPyAxIDogMCksIDMpLCAoKHQsIGUsIGksIG4pID0+IHsKCQkJCVIodCksIHYodCwgaSksIHYodCwgfmkpLCB0LnBlbmRpbmdfYnVmLnNldCh0LndpbmRvdy5zdWJhcnJheShlLCBlICsgaSksIHQucGVuZGluZyksIHQucGVuZGluZyArPSBpOwoJCQl9KSh0LCBlLCBpKTsKCQl9OwoKCQl2YXIgUyA9IHsKCQkJX3RyX2luaXQ6IHQgPT4gewoJCQkJRCB8fCAoKCgpID0+IHsKCQkJCQlsZXQgdCwgZSwgaSwgbiwgcjsKCQkJCQljb25zdCBzID0gbmV3IEFycmF5KDE2KTsKCgkJCQkJZm9yIChpID0gMCwgbiA9IDA7IG4gPCAyODsgbisrKSBmb3IgKHVbbl0gPSBpLCB0ID0gMDsgdCA8IDEgPDwgYVtuXTsgdCsrKSBjW2krK10gPSBuOwoKCQkJCQlmb3IgKGNbaSAtIDFdID0gbiwgciA9IDAsIG4gPSAwOyBuIDwgMTY7IG4rKykgZm9yICh3W25dID0gciwgdCA9IDA7IHQgPCAxIDw8IG9bbl07IHQrKykgZltyKytdID0gbjsKCgkJCQkJZm9yIChyID4+PSA3OyBuIDwgMzA7IG4rKykgZm9yICh3W25dID0gciA8PCA3LCB0ID0gMDsgdCA8IDEgPDwgb1tuXSAtIDc7IHQrKykgZlsyNTYgKyByKytdID0gbjsKCgkJCQkJZm9yIChlID0gMDsgZSA8PSAxNTsgZSsrKSBzW2VdID0gMDsKCgkJCQkJZm9yICh0ID0gMDsgdCA8PSAxNDM7KSBkWzIgKiB0ICsgMV0gPSA4LCB0KyssIHNbOF0rKzsKCgkJCQkJZm9yICg7IHQgPD0gMjU1OykgZFsyICogdCArIDFdID0gOSwgdCsrLCBzWzldKys7CgoJCQkJCWZvciAoOyB0IDw9IDI3OTspIGRbMiAqIHQgKyAxXSA9IDcsIHQrKywgc1s3XSsrOwoKCQkJCQlmb3IgKDsgdCA8PSAyODc7KSBkWzIgKiB0ICsgMV0gPSA4LCB0KyssIHNbOF0rKzsKCgkJCQkJZm9yIChVKGQsIDI4NywgcyksIHQgPSAwOyB0IDwgMzA7IHQrKykgX1syICogdCArIDFdID0gNSwgX1syICogdF0gPSB4KHQsIDUpOwoKCQkJCQlnID0gbmV3IHAoZCwgYSwgMjU3LCAyODYsIDE1KSwgYiA9IG5ldyBwKF8sIG8sIDAsIDMwLCAxNSksIG0gPSBuZXcgcChuZXcgQXJyYXkoMCksIGgsIDAsIDE5LCA3KTsKCQkJCX0pKCksIEQgPSAhMCksIHQubF9kZXNjID0gbmV3IGsodC5keW5fbHRyZWUsIGcpLCB0LmRfZGVzYyA9IG5ldyBrKHQuZHluX2R0cmVlLCBiKSwgdC5ibF9kZXNjID0gbmV3IGsodC5ibF90cmVlLCBtKSwgdC5iaV9idWYgPSAwLCB0LmJpX3ZhbGlkID0gMCwgeih0KTsKCQkJfSwKCQkJX3RyX3N0b3JlZF9ibG9jazogSSwKCQkJX3RyX2ZsdXNoX2Jsb2NrOiAodCwgZSwgaSwgbikgPT4gewoJCQkJbGV0IHIsCgkJCQkJCXMsCgkJCQkJCWEgPSAwOwoJCQkJdC5sZXZlbCA+IDAgPyAoMiA9PT0gdC5zdHJtLmRhdGFfdHlwZSAmJiAodC5zdHJtLmRhdGFfdHlwZSA9ICh0ID0+IHsKCQkJCQlsZXQgZSwKCQkJCQkJCWkgPSA0MDkzNjI0NDQ3OwoKCQkJCQlmb3IgKGUgPSAwOyBlIDw9IDMxOyBlKyssIGkgPj4+PSAxKSBpZiAoMSAmIGkgJiYgMCAhPT0gdC5keW5fbHRyZWVbMiAqIGVdKSByZXR1cm4gMDsKCgkJCQkJaWYgKDAgIT09IHQuZHluX2x0cmVlWzE4XSB8fCAwICE9PSB0LmR5bl9sdHJlZVsyMF0gfHwgMCAhPT0gdC5keW5fbHRyZWVbMjZdKSByZXR1cm4gMTsKCgkJCQkJZm9yIChlID0gMzI7IGUgPCAyNTY7IGUrKykgaWYgKDAgIT09IHQuZHluX2x0cmVlWzIgKiBlXSkgcmV0dXJuIDE7CgoJCQkJCXJldHVybiAwOwoJCQkJfSkodCkpLCBMKHQsIHQubF9kZXNjKSwgTCh0LCB0LmRfZGVzYyksIGEgPSAodCA9PiB7CgkJCQkJbGV0IGU7CgoJCQkJCWZvciAoQih0LCB0LmR5bl9sdHJlZSwgdC5sX2Rlc2MubWF4X2NvZGUpLCBCKHQsIHQuZHluX2R0cmVlLCB0LmRfZGVzYy5tYXhfY29kZSksIEwodCwgdC5ibF9kZXNjKSwgZSA9IDE4OyBlID49IDMgJiYgMCA9PT0gdC5ibF90cmVlWzIgKiBsW2VdICsgMV07IGUtLSk7CgoJCQkJCXJldHVybiB0Lm9wdF9sZW4gKz0gMyAqIChlICsgMSkgKyA1ICsgNSArIDQsIGU7CgkJCQl9KSh0KSwgciA9IHQub3B0X2xlbiArIDMgKyA3ID4+PiAzLCBzID0gdC5zdGF0aWNfbGVuICsgMyArIDcgPj4+IDMsIHMgPD0gciAmJiAociA9IHMpKSA6IHIgPSBzID0gaSArIDUsIGkgKyA0IDw9IHIgJiYgLTEgIT09IGUgPyBJKHQsIGUsIGksIG4pIDogNCA9PT0gdC5zdHJhdGVneSB8fCBzID09PSByID8gKEUodCwgMiArIChuID8gMSA6IDApLCAzKSwgTyh0LCBkLCBfKSkgOiAoRSh0LCA0ICsgKG4gPyAxIDogMCksIDMpLCAoKHQsIGUsIGksIG4pID0+IHsKCQkJCQlsZXQgcjsKCgkJCQkJZm9yIChFKHQsIGUgLSAyNTcsIDUpLCBFKHQsIGkgLSAxLCA1KSwgRSh0LCBuIC0gNCwgNCksIHIgPSAwOyByIDwgbjsgcisrKSBFKHQsIHQuYmxfdHJlZVsyICogbFtyXSArIDFdLCAzKTsKCgkJCQkJQyh0LCB0LmR5bl9sdHJlZSwgZSAtIDEpLCBDKHQsIHQuZHluX2R0cmVlLCBpIC0gMSk7CgkJCQl9KSh0LCB0LmxfZGVzYy5tYXhfY29kZSArIDEsIHQuZF9kZXNjLm1heF9jb2RlICsgMSwgYSArIDEpLCBPKHQsIHQuZHluX2x0cmVlLCB0LmR5bl9kdHJlZSkpLCB6KHQpLCBuICYmIFIodCk7CgkJCX0sCgkJCV90cl90YWxseTogKHQsIGUsIGkpID0+ICh0LnBlbmRpbmdfYnVmW3QuZF9idWYgKyAyICogdC5sYXN0X2xpdF0gPSBlID4+PiA4ICYgMjU1LCB0LnBlbmRpbmdfYnVmW3QuZF9idWYgKyAyICogdC5sYXN0X2xpdCArIDFdID0gMjU1ICYgZSwgdC5wZW5kaW5nX2J1Zlt0LmxfYnVmICsgdC5sYXN0X2xpdF0gPSAyNTUgJiBpLCB0Lmxhc3RfbGl0KyssIDAgPT09IGUgPyB0LmR5bl9sdHJlZVsyICogaV0rKyA6ICh0Lm1hdGNoZXMrKywgZS0tLCB0LmR5bl9sdHJlZVsyICogKGNbaV0gKyAyNTYgKyAxKV0rKywgdC5keW5fZHRyZWVbMiAqIHkoZSldKyspLCB0Lmxhc3RfbGl0ID09PSB0LmxpdF9idWZzaXplIC0gMSksCgkJCV90cl9hbGlnbjogdCA9PiB7CgkJCQlFKHQsIDIsIDMpLCBBKHQsIDI1NiwgZCksICh0ID0+IHsKCQkJCQkxNiA9PT0gdC5iaV92YWxpZCA/ICh2KHQsIHQuYmlfYnVmKSwgdC5iaV9idWYgPSAwLCB0LmJpX3ZhbGlkID0gMCkgOiB0LmJpX3ZhbGlkID49IDggJiYgKHQucGVuZGluZ19idWZbdC5wZW5kaW5nKytdID0gMjU1ICYgdC5iaV9idWYsIHQuYmlfYnVmID4+PSA4LCB0LmJpX3ZhbGlkIC09IDgpOwoJCQkJfSkodCk7CgkJCX0KCQl9LAoJCQkJWiA9ICh0LCBlLCBpLCBuKSA9PiB7CgkJCWxldCByID0gNjU1MzUgJiB0IHwgMCwKCQkJCQlzID0gdCA+Pj4gMTYgJiA2NTUzNSB8IDAsCgkJCQkJYSA9IDA7CgoJCQlmb3IgKDsgMCAhPT0gaTspIHsKCQkJCWEgPSBpID4gMmUzID8gMmUzIDogaSwgaSAtPSBhOwoKCQkJCWRvIHsKCQkJCQlyID0gciArIGVbbisrXSB8IDAsIHMgPSBzICsgciB8IDA7CgkJCQl9IHdoaWxlICgtLWEpOwoKCQkJCXIgJT0gNjU1MjEsIHMgJT0gNjU1MjE7CgkJCX0KCgkJCXJldHVybiByIHwgcyA8PCAxNiB8IDA7CgkJfTsKCgkJY29uc3QgRiA9IG5ldyBVaW50MzJBcnJheSgoKCkgPT4gewoJCQlsZXQgdCwKCQkJCQllID0gW107CgoJCQlmb3IgKHZhciBpID0gMDsgaSA8IDI1NjsgaSsrKSB7CgkJCQl0ID0gaTsKCgkJCQlmb3IgKHZhciBuID0gMDsgbiA8IDg7IG4rKykgdCA9IDEgJiB0ID8gMzk4ODI5MjM4NCBeIHQgPj4+IDEgOiB0ID4+PiAxOwoKCQkJCWVbaV0gPSB0OwoJCQl9CgoJCQlyZXR1cm4gZTsKCQl9KSgpKTsKCgkJdmFyIE0gPSAodCwgZSwgaSwgbikgPT4gewoJCQljb25zdCByID0gRiwKCQkJCQkJcyA9IG4gKyBpOwoJCQl0IF49IC0xOwoKCQkJZm9yIChsZXQgaSA9IG47IGkgPCBzOyBpKyspIHQgPSB0ID4+PiA4IF4gclsyNTUgJiAodCBeIGVbaV0pXTsKCgkJCXJldHVybiAtMSBeIHQ7CgkJfSwKCQkJCVAgPSB7CgkJCTI6ICJuZWVkIGRpY3Rpb25hcnkiLAoJCQkxOiAic3RyZWFtIGVuZCIsCgkJCTA6ICIiLAoJCQkiLTEiOiAiZmlsZSBlcnJvciIsCgkJCSItMiI6ICJzdHJlYW0gZXJyb3IiLAoJCQkiLTMiOiAiZGF0YSBlcnJvciIsCgkJCSItNCI6ICJpbnN1ZmZpY2llbnQgbWVtb3J5IiwKCQkJIi01IjogImJ1ZmZlciBlcnJvciIsCgkJCSItNiI6ICJpbmNvbXBhdGlibGUgdmVyc2lvbiIKCQl9LAoJCQkJSCA9IHsKCQkJWl9OT19GTFVTSDogMCwKCQkJWl9QQVJUSUFMX0ZMVVNIOiAxLAoJCQlaX1NZTkNfRkxVU0g6IDIsCgkJCVpfRlVMTF9GTFVTSDogMywKCQkJWl9GSU5JU0g6IDQsCgkJCVpfQkxPQ0s6IDUsCgkJCVpfVFJFRVM6IDYsCgkJCVpfT0s6IDAsCgkJCVpfU1RSRUFNX0VORDogMSwKCQkJWl9ORUVEX0RJQ1Q6IDIsCgkJCVpfRVJSTk86IC0xLAoJCQlaX1NUUkVBTV9FUlJPUjogLTIsCgkJCVpfREFUQV9FUlJPUjogLTMsCgkJCVpfTUVNX0VSUk9SOiAtNCwKCQkJWl9CVUZfRVJST1I6IC01LAoJCQlaX05PX0NPTVBSRVNTSU9OOiAwLAoJCQlaX0JFU1RfU1BFRUQ6IDEsCgkJCVpfQkVTVF9DT01QUkVTU0lPTjogOSwKCQkJWl9ERUZBVUxUX0NPTVBSRVNTSU9OOiAtMSwKCQkJWl9GSUxURVJFRDogMSwKCQkJWl9IVUZGTUFOX09OTFk6IDIsCgkJCVpfUkxFOiAzLAoJCQlaX0ZJWEVEOiA0LAoJCQlaX0RFRkFVTFRfU1RSQVRFR1k6IDAsCgkJCVpfQklOQVJZOiAwLAoJCQlaX1RFWFQ6IDEsCgkJCVpfVU5LTk9XTjogMiwKCQkJWl9ERUZMQVRFRDogOAoJCX07CgoJCWNvbnN0IHsKCQkJX3RyX2luaXQ6IFcsCgkJCV90cl9zdG9yZWRfYmxvY2s6IEssCgkJCV90cl9mbHVzaF9ibG9jazogJCwKCQkJX3RyX3RhbGx5OiBZLAoJCQlfdHJfYWxpZ246IGoKCQl9ID0gUywKCQkJCQl7CgkJCVpfTk9fRkxVU0g6IEcsCgkJCVpfUEFSVElBTF9GTFVTSDogWCwKCQkJWl9GVUxMX0ZMVVNIOiBWLAoJCQlaX0ZJTklTSDogcSwKCQkJWl9CTE9DSzogSiwKCQkJWl9PSzogUSwKCQkJWl9TVFJFQU1fRU5EOiB0dCwKCQkJWl9TVFJFQU1fRVJST1I6IGV0LAoJCQlaX0RBVEFfRVJST1I6IGl0LAoJCQlaX0JVRl9FUlJPUjogbnQsCgkJCVpfREVGQVVMVF9DT01QUkVTU0lPTjogcnQsCgkJCVpfRklMVEVSRUQ6IHN0LAoJCQlaX0hVRkZNQU5fT05MWTogYXQsCgkJCVpfUkxFOiBvdCwKCQkJWl9GSVhFRDogaHQsCgkJCVpfREVGQVVMVF9TVFJBVEVHWTogbHQsCgkJCVpfVU5LTk9XTjogZHQsCgkJCVpfREVGTEFURUQ6IF90CgkJfSA9IEgsCgkJCQkJZnQgPSAyNTgsCgkJCQkJY3QgPSAyNjIsCgkJCQkJdXQgPSAxMDMsCgkJCQkJd3QgPSAxMTMsCgkJCQkJcHQgPSA2NjYsCgkJCQkJZ3QgPSAodCwgZSkgPT4gKHQubXNnID0gUFtlXSwgZSksCgkJCQkJYnQgPSB0ID0+ICh0IDw8IDEpIC0gKHQgPiA0ID8gOSA6IDApLAoJCQkJCW10ID0gdCA9PiB7CgkJCWxldCBlID0gdC5sZW5ndGg7CgoJCQlmb3IgKDsgLS1lID49IDA7KSB0W2VdID0gMDsKCQl9OwoKCQlsZXQga3QgPSAodCwgZSwgaSkgPT4gKGUgPDwgdC5oYXNoX3NoaWZ0IF4gaSkgJiB0Lmhhc2hfbWFzazsKCgkJY29uc3QgeXQgPSB0ID0+IHsKCQkJY29uc3QgZSA9IHQuc3RhdGU7CgkJCWxldCBpID0gZS5wZW5kaW5nOwoJCQlpID4gdC5hdmFpbF9vdXQgJiYgKGkgPSB0LmF2YWlsX291dCksIDAgIT09IGkgJiYgKHQub3V0cHV0LnNldChlLnBlbmRpbmdfYnVmLnN1YmFycmF5KGUucGVuZGluZ19vdXQsIGUucGVuZGluZ19vdXQgKyBpKSwgdC5uZXh0X291dCksIHQubmV4dF9vdXQgKz0gaSwgZS5wZW5kaW5nX291dCArPSBpLCB0LnRvdGFsX291dCArPSBpLCB0LmF2YWlsX291dCAtPSBpLCBlLnBlbmRpbmcgLT0gaSwgMCA9PT0gZS5wZW5kaW5nICYmIChlLnBlbmRpbmdfb3V0ID0gMCkpOwoJCX0sCgkJCQkJdnQgPSAodCwgZSkgPT4gewoJCQkkKHQsIHQuYmxvY2tfc3RhcnQgPj0gMCA/IHQuYmxvY2tfc3RhcnQgOiAtMSwgdC5zdHJzdGFydCAtIHQuYmxvY2tfc3RhcnQsIGUpLCB0LmJsb2NrX3N0YXJ0ID0gdC5zdHJzdGFydCwgeXQodC5zdHJtKTsKCQl9LAoJCQkJCUV0ID0gKHQsIGUpID0+IHsKCQkJdC5wZW5kaW5nX2J1Zlt0LnBlbmRpbmcrK10gPSBlOwoJCX0sCgkJCQkJQXQgPSAodCwgZSkgPT4gewoJCQl0LnBlbmRpbmdfYnVmW3QucGVuZGluZysrXSA9IGUgPj4+IDggJiAyNTUsIHQucGVuZGluZ19idWZbdC5wZW5kaW5nKytdID0gMjU1ICYgZTsKCQl9LAoJCQkJCXh0ID0gKHQsIGUsIGksIG4pID0+IHsKCQkJbGV0IHIgPSB0LmF2YWlsX2luOwoJCQlyZXR1cm4gciA+IG4gJiYgKHIgPSBuKSwgMCA9PT0gciA/IDAgOiAodC5hdmFpbF9pbiAtPSByLCBlLnNldCh0LmlucHV0LnN1YmFycmF5KHQubmV4dF9pbiwgdC5uZXh0X2luICsgciksIGkpLCAxID09PSB0LnN0YXRlLndyYXAgPyB0LmFkbGVyID0gWih0LmFkbGVyLCBlLCByLCBpKSA6IDIgPT09IHQuc3RhdGUud3JhcCAmJiAodC5hZGxlciA9IE0odC5hZGxlciwgZSwgciwgaSkpLCB0Lm5leHRfaW4gKz0gciwgdC50b3RhbF9pbiArPSByLCByKTsKCQl9LAoJCQkJCVV0ID0gKHQsIGUpID0+IHsKCQkJbGV0IGksCgkJCQkJbiwKCQkJCQlyID0gdC5tYXhfY2hhaW5fbGVuZ3RoLAoJCQkJCXMgPSB0LnN0cnN0YXJ0LAoJCQkJCWEgPSB0LnByZXZfbGVuZ3RoLAoJCQkJCW8gPSB0Lm5pY2VfbWF0Y2g7CgkJCWNvbnN0IGggPSB0LnN0cnN0YXJ0ID4gdC53X3NpemUgLSBjdCA/IHQuc3Ryc3RhcnQgLSAodC53X3NpemUgLSBjdCkgOiAwLAoJCQkJCQlsID0gdC53aW5kb3csCgkJCQkJCWQgPSB0LndfbWFzaywKCQkJCQkJXyA9IHQucHJldiwKCQkJCQkJZiA9IHQuc3Ryc3RhcnQgKyBmdDsKCQkJbGV0IGMgPSBsW3MgKyBhIC0gMV0sCgkJCQkJdSA9IGxbcyArIGFdOwoJCQl0LnByZXZfbGVuZ3RoID49IHQuZ29vZF9tYXRjaCAmJiAociA+Pj0gMiksIG8gPiB0Lmxvb2thaGVhZCAmJiAobyA9IHQubG9va2FoZWFkKTsKCgkJCWRvIHsKCQkJCWlmIChpID0gZSwgbFtpICsgYV0gPT09IHUgJiYgbFtpICsgYSAtIDFdID09PSBjICYmIGxbaV0gPT09IGxbc10gJiYgbFsrK2ldID09PSBsW3MgKyAxXSkgewoJCQkJCXMgKz0gMiwgaSsrOwoKCQkJCQlkbyB7fSB3aGlsZSAobFsrK3NdID09PSBsWysraV0gJiYgbFsrK3NdID09PSBsWysraV0gJiYgbFsrK3NdID09PSBsWysraV0gJiYgbFsrK3NdID09PSBsWysraV0gJiYgbFsrK3NdID09PSBsWysraV0gJiYgbFsrK3NdID09PSBsWysraV0gJiYgbFsrK3NdID09PSBsWysraV0gJiYgbFsrK3NdID09PSBsWysraV0gJiYgcyA8IGYpOwoKCQkJCQlpZiAobiA9IGZ0IC0gKGYgLSBzKSwgcyA9IGYgLSBmdCwgbiA+IGEpIHsKCQkJCQkJaWYgKHQubWF0Y2hfc3RhcnQgPSBlLCBhID0gbiwgbiA+PSBvKSBicmVhazsKCQkJCQkJYyA9IGxbcyArIGEgLSAxXSwgdSA9IGxbcyArIGFdOwoJCQkJCX0KCQkJCX0KCQkJfSB3aGlsZSAoKGUgPSBfW2UgJiBkXSkgPiBoICYmIDAgIT0gLS1yKTsKCgkJCXJldHVybiBhIDw9IHQubG9va2FoZWFkID8gYSA6IHQubG9va2FoZWFkOwoJCX0sCgkJCQkJenQgPSB0ID0+IHsKCQkJY29uc3QgZSA9IHQud19zaXplOwoJCQlsZXQgaSwgbiwgciwgcywgYTsKCgkJCWRvIHsKCQkJCWlmIChzID0gdC53aW5kb3dfc2l6ZSAtIHQubG9va2FoZWFkIC0gdC5zdHJzdGFydCwgdC5zdHJzdGFydCA+PSBlICsgKGUgLSBjdCkpIHsKCQkJCQl0LndpbmRvdy5zZXQodC53aW5kb3cuc3ViYXJyYXkoZSwgZSArIGUpLCAwKSwgdC5tYXRjaF9zdGFydCAtPSBlLCB0LnN0cnN0YXJ0IC09IGUsIHQuYmxvY2tfc3RhcnQgLT0gZSwgbiA9IHQuaGFzaF9zaXplLCBpID0gbjsKCgkJCQkJZG8gewoJCQkJCQlyID0gdC5oZWFkWy0taV0sIHQuaGVhZFtpXSA9IHIgPj0gZSA/IHIgLSBlIDogMDsKCQkJCQl9IHdoaWxlICgtLW4pOwoKCQkJCQluID0gZSwgaSA9IG47CgoJCQkJCWRvIHsKCQkJCQkJciA9IHQucHJldlstLWldLCB0LnByZXZbaV0gPSByID49IGUgPyByIC0gZSA6IDA7CgkJCQkJfSB3aGlsZSAoLS1uKTsKCgkJCQkJcyArPSBlOwoJCQkJfQoKCQkJCWlmICgwID09PSB0LnN0cm0uYXZhaWxfaW4pIGJyZWFrOwoJCQkJaWYgKG4gPSB4dCh0LnN0cm0sIHQud2luZG93LCB0LnN0cnN0YXJ0ICsgdC5sb29rYWhlYWQsIHMpLCB0Lmxvb2thaGVhZCArPSBuLCB0Lmxvb2thaGVhZCArIHQuaW5zZXJ0ID49IDMpIGZvciAoYSA9IHQuc3Ryc3RhcnQgLSB0Lmluc2VydCwgdC5pbnNfaCA9IHQud2luZG93W2FdLCB0Lmluc19oID0ga3QodCwgdC5pbnNfaCwgdC53aW5kb3dbYSArIDFdKTsgdC5pbnNlcnQgJiYgKHQuaW5zX2ggPSBrdCh0LCB0Lmluc19oLCB0LndpbmRvd1thICsgMyAtIDFdKSwgdC5wcmV2W2EgJiB0LndfbWFza10gPSB0LmhlYWRbdC5pbnNfaF0sIHQuaGVhZFt0Lmluc19oXSA9IGEsIGErKywgdC5pbnNlcnQtLSwgISh0Lmxvb2thaGVhZCArIHQuaW5zZXJ0IDwgMykpOyk7CgkJCX0gd2hpbGUgKHQubG9va2FoZWFkIDwgY3QgJiYgMCAhPT0gdC5zdHJtLmF2YWlsX2luKTsKCQl9LAoJCQkJCVJ0ID0gKHQsIGUpID0+IHsKCQkJbGV0IGksIG47CgoJCQlmb3IgKDs7KSB7CgkJCQlpZiAodC5sb29rYWhlYWQgPCBjdCkgewoJCQkJCWlmICh6dCh0KSwgdC5sb29rYWhlYWQgPCBjdCAmJiBlID09PSBHKSByZXR1cm4gMTsKCQkJCQlpZiAoMCA9PT0gdC5sb29rYWhlYWQpIGJyZWFrOwoJCQkJfQoKCQkJCWlmIChpID0gMCwgdC5sb29rYWhlYWQgPj0gMyAmJiAodC5pbnNfaCA9IGt0KHQsIHQuaW5zX2gsIHQud2luZG93W3Quc3Ryc3RhcnQgKyAzIC0gMV0pLCBpID0gdC5wcmV2W3Quc3Ryc3RhcnQgJiB0LndfbWFza10gPSB0LmhlYWRbdC5pbnNfaF0sIHQuaGVhZFt0Lmluc19oXSA9IHQuc3Ryc3RhcnQpLCAwICE9PSBpICYmIHQuc3Ryc3RhcnQgLSBpIDw9IHQud19zaXplIC0gY3QgJiYgKHQubWF0Y2hfbGVuZ3RoID0gVXQodCwgaSkpLCB0Lm1hdGNoX2xlbmd0aCA+PSAzKSB7CgkJCQkJaWYgKG4gPSBZKHQsIHQuc3Ryc3RhcnQgLSB0Lm1hdGNoX3N0YXJ0LCB0Lm1hdGNoX2xlbmd0aCAtIDMpLCB0Lmxvb2thaGVhZCAtPSB0Lm1hdGNoX2xlbmd0aCwgdC5tYXRjaF9sZW5ndGggPD0gdC5tYXhfbGF6eV9tYXRjaCAmJiB0Lmxvb2thaGVhZCA+PSAzKSB7CgkJCQkJCXQubWF0Y2hfbGVuZ3RoLS07CgoJCQkJCQlkbyB7CgkJCQkJCQl0LnN0cnN0YXJ0KyssIHQuaW5zX2ggPSBrdCh0LCB0Lmluc19oLCB0LndpbmRvd1t0LnN0cnN0YXJ0ICsgMyAtIDFdKSwgaSA9IHQucHJldlt0LnN0cnN0YXJ0ICYgdC53X21hc2tdID0gdC5oZWFkW3QuaW5zX2hdLCB0LmhlYWRbdC5pbnNfaF0gPSB0LnN0cnN0YXJ0OwoJCQkJCQl9IHdoaWxlICgwICE9IC0tdC5tYXRjaF9sZW5ndGgpOwoKCQkJCQkJdC5zdHJzdGFydCsrOwoJCQkJCX0gZWxzZSB0LnN0cnN0YXJ0ICs9IHQubWF0Y2hfbGVuZ3RoLCB0Lm1hdGNoX2xlbmd0aCA9IDAsIHQuaW5zX2ggPSB0LndpbmRvd1t0LnN0cnN0YXJ0XSwgdC5pbnNfaCA9IGt0KHQsIHQuaW5zX2gsIHQud2luZG93W3Quc3Ryc3RhcnQgKyAxXSk7CgkJCQl9IGVsc2UgbiA9IFkodCwgMCwgdC53aW5kb3dbdC5zdHJzdGFydF0pLCB0Lmxvb2thaGVhZC0tLCB0LnN0cnN0YXJ0Kys7CgkJCQlpZiAobiAmJiAodnQodCwgITEpLCAwID09PSB0LnN0cm0uYXZhaWxfb3V0KSkgcmV0dXJuIDE7CgkJCX0KCgkJCXJldHVybiB0Lmluc2VydCA9IHQuc3Ryc3RhcnQgPCAyID8gdC5zdHJzdGFydCA6IDIsIGUgPT09IHEgPyAodnQodCwgITApLCAwID09PSB0LnN0cm0uYXZhaWxfb3V0ID8gMyA6IDQpIDogdC5sYXN0X2xpdCAmJiAodnQodCwgITEpLCAwID09PSB0LnN0cm0uYXZhaWxfb3V0KSA/IDEgOiAyOwoJCX0sCgkJCQkJTnQgPSAodCwgZSkgPT4gewoJCQlsZXQgaSwgbiwgcjsKCgkJCWZvciAoOzspIHsKCQkJCWlmICh0Lmxvb2thaGVhZCA8IGN0KSB7CgkJCQkJaWYgKHp0KHQpLCB0Lmxvb2thaGVhZCA8IGN0ICYmIGUgPT09IEcpIHJldHVybiAxOwoJCQkJCWlmICgwID09PSB0Lmxvb2thaGVhZCkgYnJlYWs7CgkJCQl9CgoJCQkJaWYgKGkgPSAwLCB0Lmxvb2thaGVhZCA+PSAzICYmICh0Lmluc19oID0ga3QodCwgdC5pbnNfaCwgdC53aW5kb3dbdC5zdHJzdGFydCArIDMgLSAxXSksIGkgPSB0LnByZXZbdC5zdHJzdGFydCAmIHQud19tYXNrXSA9IHQuaGVhZFt0Lmluc19oXSwgdC5oZWFkW3QuaW5zX2hdID0gdC5zdHJzdGFydCksIHQucHJldl9sZW5ndGggPSB0Lm1hdGNoX2xlbmd0aCwgdC5wcmV2X21hdGNoID0gdC5tYXRjaF9zdGFydCwgdC5tYXRjaF9sZW5ndGggPSAyLCAwICE9PSBpICYmIHQucHJldl9sZW5ndGggPCB0Lm1heF9sYXp5X21hdGNoICYmIHQuc3Ryc3RhcnQgLSBpIDw9IHQud19zaXplIC0gY3QgJiYgKHQubWF0Y2hfbGVuZ3RoID0gVXQodCwgaSksIHQubWF0Y2hfbGVuZ3RoIDw9IDUgJiYgKHQuc3RyYXRlZ3kgPT09IHN0IHx8IDMgPT09IHQubWF0Y2hfbGVuZ3RoICYmIHQuc3Ryc3RhcnQgLSB0Lm1hdGNoX3N0YXJ0ID4gNDA5NikgJiYgKHQubWF0Y2hfbGVuZ3RoID0gMikpLCB0LnByZXZfbGVuZ3RoID49IDMgJiYgdC5tYXRjaF9sZW5ndGggPD0gdC5wcmV2X2xlbmd0aCkgewoJCQkJCXIgPSB0LnN0cnN0YXJ0ICsgdC5sb29rYWhlYWQgLSAzLCBuID0gWSh0LCB0LnN0cnN0YXJ0IC0gMSAtIHQucHJldl9tYXRjaCwgdC5wcmV2X2xlbmd0aCAtIDMpLCB0Lmxvb2thaGVhZCAtPSB0LnByZXZfbGVuZ3RoIC0gMSwgdC5wcmV2X2xlbmd0aCAtPSAyOwoKCQkJCQlkbyB7CgkJCQkJCSsrdC5zdHJzdGFydCA8PSByICYmICh0Lmluc19oID0ga3QodCwgdC5pbnNfaCwgdC53aW5kb3dbdC5zdHJzdGFydCArIDMgLSAxXSksIGkgPSB0LnByZXZbdC5zdHJzdGFydCAmIHQud19tYXNrXSA9IHQuaGVhZFt0Lmluc19oXSwgdC5oZWFkW3QuaW5zX2hdID0gdC5zdHJzdGFydCk7CgkJCQkJfSB3aGlsZSAoMCAhPSAtLXQucHJldl9sZW5ndGgpOwoKCQkJCQlpZiAodC5tYXRjaF9hdmFpbGFibGUgPSAwLCB0Lm1hdGNoX2xlbmd0aCA9IDIsIHQuc3Ryc3RhcnQrKywgbiAmJiAodnQodCwgITEpLCAwID09PSB0LnN0cm0uYXZhaWxfb3V0KSkgcmV0dXJuIDE7CgkJCQl9IGVsc2UgaWYgKHQubWF0Y2hfYXZhaWxhYmxlKSB7CgkJCQkJaWYgKG4gPSBZKHQsIDAsIHQud2luZG93W3Quc3Ryc3RhcnQgLSAxXSksIG4gJiYgdnQodCwgITEpLCB0LnN0cnN0YXJ0KyssIHQubG9va2FoZWFkLS0sIDAgPT09IHQuc3RybS5hdmFpbF9vdXQpIHJldHVybiAxOwoJCQkJfSBlbHNlIHQubWF0Y2hfYXZhaWxhYmxlID0gMSwgdC5zdHJzdGFydCsrLCB0Lmxvb2thaGVhZC0tOwoJCQl9CgoJCQlyZXR1cm4gdC5tYXRjaF9hdmFpbGFibGUgJiYgKG4gPSBZKHQsIDAsIHQud2luZG93W3Quc3Ryc3RhcnQgLSAxXSksIHQubWF0Y2hfYXZhaWxhYmxlID0gMCksIHQuaW5zZXJ0ID0gdC5zdHJzdGFydCA8IDIgPyB0LnN0cnN0YXJ0IDogMiwgZSA9PT0gcSA/ICh2dCh0LCAhMCksIDAgPT09IHQuc3RybS5hdmFpbF9vdXQgPyAzIDogNCkgOiB0Lmxhc3RfbGl0ICYmICh2dCh0LCAhMSksIDAgPT09IHQuc3RybS5hdmFpbF9vdXQpID8gMSA6IDI7CgkJfTsKCgkJZnVuY3Rpb24gVHQodCwgZSwgaSwgbiwgcikgewoJCQl0aGlzLmdvb2RfbGVuZ3RoID0gdCwgdGhpcy5tYXhfbGF6eSA9IGUsIHRoaXMubmljZV9sZW5ndGggPSBpLCB0aGlzLm1heF9jaGFpbiA9IG4sIHRoaXMuZnVuYyA9IHI7CgkJfQoKCQljb25zdCBPdCA9IFtuZXcgVHQoMCwgMCwgMCwgMCwgKHQsIGUpID0+IHsKCQkJbGV0IGkgPSA2NTUzNTsKCgkJCWZvciAoaSA+IHQucGVuZGluZ19idWZfc2l6ZSAtIDUgJiYgKGkgPSB0LnBlbmRpbmdfYnVmX3NpemUgLSA1KTs7KSB7CgkJCQlpZiAodC5sb29rYWhlYWQgPD0gMSkgewoJCQkJCWlmICh6dCh0KSwgMCA9PT0gdC5sb29rYWhlYWQgJiYgZSA9PT0gRykgcmV0dXJuIDE7CgkJCQkJaWYgKDAgPT09IHQubG9va2FoZWFkKSBicmVhazsKCQkJCX0KCgkJCQl0LnN0cnN0YXJ0ICs9IHQubG9va2FoZWFkLCB0Lmxvb2thaGVhZCA9IDA7CgkJCQljb25zdCBuID0gdC5ibG9ja19zdGFydCArIGk7CgkJCQlpZiAoKDAgPT09IHQuc3Ryc3RhcnQgfHwgdC5zdHJzdGFydCA+PSBuKSAmJiAodC5sb29rYWhlYWQgPSB0LnN0cnN0YXJ0IC0gbiwgdC5zdHJzdGFydCA9IG4sIHZ0KHQsICExKSwgMCA9PT0gdC5zdHJtLmF2YWlsX291dCkpIHJldHVybiAxOwoJCQkJaWYgKHQuc3Ryc3RhcnQgLSB0LmJsb2NrX3N0YXJ0ID49IHQud19zaXplIC0gY3QgJiYgKHZ0KHQsICExKSwgMCA9PT0gdC5zdHJtLmF2YWlsX291dCkpIHJldHVybiAxOwoJCQl9CgoJCQlyZXR1cm4gdC5pbnNlcnQgPSAwLCBlID09PSBxID8gKHZ0KHQsICEwKSwgMCA9PT0gdC5zdHJtLmF2YWlsX291dCA/IDMgOiA0KSA6ICh0LnN0cnN0YXJ0ID4gdC5ibG9ja19zdGFydCAmJiAodnQodCwgITEpLCB0LnN0cm0uYXZhaWxfb3V0KSwgMSk7CgkJfSksIG5ldyBUdCg0LCA0LCA4LCA0LCBSdCksIG5ldyBUdCg0LCA1LCAxNiwgOCwgUnQpLCBuZXcgVHQoNCwgNiwgMzIsIDMyLCBSdCksIG5ldyBUdCg0LCA0LCAxNiwgMTYsIE50KSwgbmV3IFR0KDgsIDE2LCAzMiwgMzIsIE50KSwgbmV3IFR0KDgsIDE2LCAxMjgsIDEyOCwgTnQpLCBuZXcgVHQoOCwgMzIsIDEyOCwgMjU2LCBOdCksIG5ldyBUdCgzMiwgMTI4LCAyNTgsIDEwMjQsIE50KSwgbmV3IFR0KDMyLCAyNTgsIDI1OCwgNDA5NiwgTnQpXTsKCgkJZnVuY3Rpb24gTHQoKSB7CgkJCXRoaXMuc3RybSA9IG51bGwsIHRoaXMuc3RhdHVzID0gMCwgdGhpcy5wZW5kaW5nX2J1ZiA9IG51bGwsIHRoaXMucGVuZGluZ19idWZfc2l6ZSA9IDAsIHRoaXMucGVuZGluZ19vdXQgPSAwLCB0aGlzLnBlbmRpbmcgPSAwLCB0aGlzLndyYXAgPSAwLCB0aGlzLmd6aGVhZCA9IG51bGwsIHRoaXMuZ3ppbmRleCA9IDAsIHRoaXMubWV0aG9kID0gX3QsIHRoaXMubGFzdF9mbHVzaCA9IC0xLCB0aGlzLndfc2l6ZSA9IDAsIHRoaXMud19iaXRzID0gMCwgdGhpcy53X21hc2sgPSAwLCB0aGlzLndpbmRvdyA9IG51bGwsIHRoaXMud2luZG93X3NpemUgPSAwLCB0aGlzLnByZXYgPSBudWxsLCB0aGlzLmhlYWQgPSBudWxsLCB0aGlzLmluc19oID0gMCwgdGhpcy5oYXNoX3NpemUgPSAwLCB0aGlzLmhhc2hfYml0cyA9IDAsIHRoaXMuaGFzaF9tYXNrID0gMCwgdGhpcy5oYXNoX3NoaWZ0ID0gMCwgdGhpcy5ibG9ja19zdGFydCA9IDAsIHRoaXMubWF0Y2hfbGVuZ3RoID0gMCwgdGhpcy5wcmV2X21hdGNoID0gMCwgdGhpcy5tYXRjaF9hdmFpbGFibGUgPSAwLCB0aGlzLnN0cnN0YXJ0ID0gMCwgdGhpcy5tYXRjaF9zdGFydCA9IDAsIHRoaXMubG9va2FoZWFkID0gMCwgdGhpcy5wcmV2X2xlbmd0aCA9IDAsIHRoaXMubWF4X2NoYWluX2xlbmd0aCA9IDAsIHRoaXMubWF4X2xhenlfbWF0Y2ggPSAwLCB0aGlzLmxldmVsID0gMCwgdGhpcy5zdHJhdGVneSA9IDAsIHRoaXMuZ29vZF9tYXRjaCA9IDAsIHRoaXMubmljZV9tYXRjaCA9IDAsIHRoaXMuZHluX2x0cmVlID0gbmV3IFVpbnQxNkFycmF5KDExNDYpLCB0aGlzLmR5bl9kdHJlZSA9IG5ldyBVaW50MTZBcnJheSgxMjIpLCB0aGlzLmJsX3RyZWUgPSBuZXcgVWludDE2QXJyYXkoNzgpLCBtdCh0aGlzLmR5bl9sdHJlZSksIG10KHRoaXMuZHluX2R0cmVlKSwgbXQodGhpcy5ibF90cmVlKSwgdGhpcy5sX2Rlc2MgPSBudWxsLCB0aGlzLmRfZGVzYyA9IG51bGwsIHRoaXMuYmxfZGVzYyA9IG51bGwsIHRoaXMuYmxfY291bnQgPSBuZXcgVWludDE2QXJyYXkoMTYpLCB0aGlzLmhlYXAgPSBuZXcgVWludDE2QXJyYXkoNTczKSwgbXQodGhpcy5oZWFwKSwgdGhpcy5oZWFwX2xlbiA9IDAsIHRoaXMuaGVhcF9tYXggPSAwLCB0aGlzLmRlcHRoID0gbmV3IFVpbnQxNkFycmF5KDU3MyksIG10KHRoaXMuZGVwdGgpLCB0aGlzLmxfYnVmID0gMCwgdGhpcy5saXRfYnVmc2l6ZSA9IDAsIHRoaXMubGFzdF9saXQgPSAwLCB0aGlzLmRfYnVmID0gMCwgdGhpcy5vcHRfbGVuID0gMCwgdGhpcy5zdGF0aWNfbGVuID0gMCwgdGhpcy5tYXRjaGVzID0gMCwgdGhpcy5pbnNlcnQgPSAwLCB0aGlzLmJpX2J1ZiA9IDAsIHRoaXMuYmlfdmFsaWQgPSAwOwoJCX0KCgkJY29uc3QgQnQgPSB0ID0+IHsKCQkJaWYgKCF0IHx8ICF0LnN0YXRlKSByZXR1cm4gZ3QodCwgZXQpOwoJCQl0LnRvdGFsX2luID0gdC50b3RhbF9vdXQgPSAwLCB0LmRhdGFfdHlwZSA9IGR0OwoJCQljb25zdCBlID0gdC5zdGF0ZTsKCQkJcmV0dXJuIGUucGVuZGluZyA9IDAsIGUucGVuZGluZ19vdXQgPSAwLCBlLndyYXAgPCAwICYmIChlLndyYXAgPSAtZS53cmFwKSwgZS5zdGF0dXMgPSBlLndyYXAgPyA0MiA6IHd0LCB0LmFkbGVyID0gMiA9PT0gZS53cmFwID8gMCA6IDEsIGUubGFzdF9mbHVzaCA9IEcsIFcoZSksIFE7CgkJfSwKCQkJCQlDdCA9IHQgPT4gewoJCQljb25zdCBlID0gQnQodCk7CgkJCXZhciBpOwoJCQlyZXR1cm4gZSA9PT0gUSAmJiAoKGkgPSB0LnN0YXRlKS53aW5kb3dfc2l6ZSA9IDIgKiBpLndfc2l6ZSwgbXQoaS5oZWFkKSwgaS5tYXhfbGF6eV9tYXRjaCA9IE90W2kubGV2ZWxdLm1heF9sYXp5LCBpLmdvb2RfbWF0Y2ggPSBPdFtpLmxldmVsXS5nb29kX2xlbmd0aCwgaS5uaWNlX21hdGNoID0gT3RbaS5sZXZlbF0ubmljZV9sZW5ndGgsIGkubWF4X2NoYWluX2xlbmd0aCA9IE90W2kubGV2ZWxdLm1heF9jaGFpbiwgaS5zdHJzdGFydCA9IDAsIGkuYmxvY2tfc3RhcnQgPSAwLCBpLmxvb2thaGVhZCA9IDAsIGkuaW5zZXJ0ID0gMCwgaS5tYXRjaF9sZW5ndGggPSBpLnByZXZfbGVuZ3RoID0gMiwgaS5tYXRjaF9hdmFpbGFibGUgPSAwLCBpLmluc19oID0gMCksIGU7CgkJfSwKCQkJCQlEdCA9ICh0LCBlLCBpLCBuLCByLCBzKSA9PiB7CgkJCWlmICghdCkgcmV0dXJuIGV0OwoJCQlsZXQgYSA9IDE7CgkJCWlmIChlID09PSBydCAmJiAoZSA9IDYpLCBuIDwgMCA/IChhID0gMCwgbiA9IC1uKSA6IG4gPiAxNSAmJiAoYSA9IDIsIG4gLT0gMTYpLCByIDwgMSB8fCByID4gOSB8fCBpICE9PSBfdCB8fCBuIDwgOCB8fCBuID4gMTUgfHwgZSA8IDAgfHwgZSA+IDkgfHwgcyA8IDAgfHwgcyA+IGh0KSByZXR1cm4gZ3QodCwgZXQpOwoJCQk4ID09PSBuICYmIChuID0gOSk7CgkJCWNvbnN0IG8gPSBuZXcgTHQoKTsKCQkJcmV0dXJuIHQuc3RhdGUgPSBvLCBvLnN0cm0gPSB0LCBvLndyYXAgPSBhLCBvLmd6aGVhZCA9IG51bGwsIG8ud19iaXRzID0gbiwgby53X3NpemUgPSAxIDw8IG8ud19iaXRzLCBvLndfbWFzayA9IG8ud19zaXplIC0gMSwgby5oYXNoX2JpdHMgPSByICsgNywgby5oYXNoX3NpemUgPSAxIDw8IG8uaGFzaF9iaXRzLCBvLmhhc2hfbWFzayA9IG8uaGFzaF9zaXplIC0gMSwgby5oYXNoX3NoaWZ0ID0gfn4oKG8uaGFzaF9iaXRzICsgMyAtIDEpIC8gMyksIG8ud2luZG93ID0gbmV3IFVpbnQ4QXJyYXkoMiAqIG8ud19zaXplKSwgby5oZWFkID0gbmV3IFVpbnQxNkFycmF5KG8uaGFzaF9zaXplKSwgby5wcmV2ID0gbmV3IFVpbnQxNkFycmF5KG8ud19zaXplKSwgby5saXRfYnVmc2l6ZSA9IDEgPDwgciArIDYsIG8ucGVuZGluZ19idWZfc2l6ZSA9IDQgKiBvLmxpdF9idWZzaXplLCBvLnBlbmRpbmdfYnVmID0gbmV3IFVpbnQ4QXJyYXkoby5wZW5kaW5nX2J1Zl9zaXplKSwgby5kX2J1ZiA9IDEgKiBvLmxpdF9idWZzaXplLCBvLmxfYnVmID0gMyAqIG8ubGl0X2J1ZnNpemUsIG8ubGV2ZWwgPSBlLCBvLnN0cmF0ZWd5ID0gcywgby5tZXRob2QgPSBpLCBDdCh0KTsKCQl9OwoKCQl2YXIgSXQgPSBEdCwKCQkJCVN0ID0gKHQsIGUpID0+IHQgJiYgdC5zdGF0ZSA/IDIgIT09IHQuc3RhdGUud3JhcCA/IGV0IDogKHQuc3RhdGUuZ3poZWFkID0gZSwgUSkgOiBldCwKCQkJCVp0ID0gKHQsIGUpID0+IHsKCQkJbGV0IGksIG47CgkJCWlmICghdCB8fCAhdC5zdGF0ZSB8fCBlID4gSiB8fCBlIDwgMCkgcmV0dXJuIHQgPyBndCh0LCBldCkgOiBldDsKCQkJY29uc3QgciA9IHQuc3RhdGU7CgkJCWlmICghdC5vdXRwdXQgfHwgIXQuaW5wdXQgJiYgMCAhPT0gdC5hdmFpbF9pbiB8fCByLnN0YXR1cyA9PT0gcHQgJiYgZSAhPT0gcSkgcmV0dXJuIGd0KHQsIDAgPT09IHQuYXZhaWxfb3V0ID8gbnQgOiBldCk7CgkJCXIuc3RybSA9IHQ7CgkJCWNvbnN0IHMgPSByLmxhc3RfZmx1c2g7CgkJCWlmIChyLmxhc3RfZmx1c2ggPSBlLCA0MiA9PT0gci5zdGF0dXMpIGlmICgyID09PSByLndyYXApIHQuYWRsZXIgPSAwLCBFdChyLCAzMSksIEV0KHIsIDEzOSksIEV0KHIsIDgpLCByLmd6aGVhZCA/IChFdChyLCAoci5nemhlYWQudGV4dCA/IDEgOiAwKSArIChyLmd6aGVhZC5oY3JjID8gMiA6IDApICsgKHIuZ3poZWFkLmV4dHJhID8gNCA6IDApICsgKHIuZ3poZWFkLm5hbWUgPyA4IDogMCkgKyAoci5nemhlYWQuY29tbWVudCA/IDE2IDogMCkpLCBFdChyLCAyNTUgJiByLmd6aGVhZC50aW1lKSwgRXQociwgci5nemhlYWQudGltZSA+PiA4ICYgMjU1KSwgRXQociwgci5nemhlYWQudGltZSA+PiAxNiAmIDI1NSksIEV0KHIsIHIuZ3poZWFkLnRpbWUgPj4gMjQgJiAyNTUpLCBFdChyLCA5ID09PSByLmxldmVsID8gMiA6IHIuc3RyYXRlZ3kgPj0gYXQgfHwgci5sZXZlbCA8IDIgPyA0IDogMCksIEV0KHIsIDI1NSAmIHIuZ3poZWFkLm9zKSwgci5nemhlYWQuZXh0cmEgJiYgci5nemhlYWQuZXh0cmEubGVuZ3RoICYmIChFdChyLCAyNTUgJiByLmd6aGVhZC5leHRyYS5sZW5ndGgpLCBFdChyLCByLmd6aGVhZC5leHRyYS5sZW5ndGggPj4gOCAmIDI1NSkpLCByLmd6aGVhZC5oY3JjICYmICh0LmFkbGVyID0gTSh0LmFkbGVyLCByLnBlbmRpbmdfYnVmLCByLnBlbmRpbmcsIDApKSwgci5nemluZGV4ID0gMCwgci5zdGF0dXMgPSA2OSkgOiAoRXQociwgMCksIEV0KHIsIDApLCBFdChyLCAwKSwgRXQociwgMCksIEV0KHIsIDApLCBFdChyLCA5ID09PSByLmxldmVsID8gMiA6IHIuc3RyYXRlZ3kgPj0gYXQgfHwgci5sZXZlbCA8IDIgPyA0IDogMCksIEV0KHIsIDMpLCByLnN0YXR1cyA9IHd0KTtlbHNlIHsKCQkJCWxldCBlID0gX3QgKyAoci53X2JpdHMgLSA4IDw8IDQpIDw8IDgsCgkJCQkJCWkgPSAtMTsKCQkJCWkgPSByLnN0cmF0ZWd5ID49IGF0IHx8IHIubGV2ZWwgPCAyID8gMCA6IHIubGV2ZWwgPCA2ID8gMSA6IDYgPT09IHIubGV2ZWwgPyAyIDogMywgZSB8PSBpIDw8IDYsIDAgIT09IHIuc3Ryc3RhcnQgJiYgKGUgfD0gMzIpLCBlICs9IDMxIC0gZSAlIDMxLCByLnN0YXR1cyA9IHd0LCBBdChyLCBlKSwgMCAhPT0gci5zdHJzdGFydCAmJiAoQXQociwgdC5hZGxlciA+Pj4gMTYpLCBBdChyLCA2NTUzNSAmIHQuYWRsZXIpKSwgdC5hZGxlciA9IDE7CgkJCX0KCQkJaWYgKDY5ID09PSByLnN0YXR1cykgaWYgKHIuZ3poZWFkLmV4dHJhKSB7CgkJCQlmb3IgKGkgPSByLnBlbmRpbmc7IHIuZ3ppbmRleCA8ICg2NTUzNSAmIHIuZ3poZWFkLmV4dHJhLmxlbmd0aCkgJiYgKHIucGVuZGluZyAhPT0gci5wZW5kaW5nX2J1Zl9zaXplIHx8IChyLmd6aGVhZC5oY3JjICYmIHIucGVuZGluZyA+IGkgJiYgKHQuYWRsZXIgPSBNKHQuYWRsZXIsIHIucGVuZGluZ19idWYsIHIucGVuZGluZyAtIGksIGkpKSwgeXQodCksIGkgPSByLnBlbmRpbmcsIHIucGVuZGluZyAhPT0gci5wZW5kaW5nX2J1Zl9zaXplKSk7KSBFdChyLCAyNTUgJiByLmd6aGVhZC5leHRyYVtyLmd6aW5kZXhdKSwgci5nemluZGV4Kys7CgoJCQkJci5nemhlYWQuaGNyYyAmJiByLnBlbmRpbmcgPiBpICYmICh0LmFkbGVyID0gTSh0LmFkbGVyLCByLnBlbmRpbmdfYnVmLCByLnBlbmRpbmcgLSBpLCBpKSksIHIuZ3ppbmRleCA9PT0gci5nemhlYWQuZXh0cmEubGVuZ3RoICYmIChyLmd6aW5kZXggPSAwLCByLnN0YXR1cyA9IDczKTsKCQkJfSBlbHNlIHIuc3RhdHVzID0gNzM7CgkJCWlmICg3MyA9PT0gci5zdGF0dXMpIGlmIChyLmd6aGVhZC5uYW1lKSB7CgkJCQlpID0gci5wZW5kaW5nOwoKCQkJCWRvIHsKCQkJCQlpZiAoci5wZW5kaW5nID09PSByLnBlbmRpbmdfYnVmX3NpemUgJiYgKHIuZ3poZWFkLmhjcmMgJiYgci5wZW5kaW5nID4gaSAmJiAodC5hZGxlciA9IE0odC5hZGxlciwgci5wZW5kaW5nX2J1Ziwgci5wZW5kaW5nIC0gaSwgaSkpLCB5dCh0KSwgaSA9IHIucGVuZGluZywgci5wZW5kaW5nID09PSByLnBlbmRpbmdfYnVmX3NpemUpKSB7CgkJCQkJCW4gPSAxOwoJCQkJCQlicmVhazsKCQkJCQl9CgoJCQkJCW4gPSByLmd6aW5kZXggPCByLmd6aGVhZC5uYW1lLmxlbmd0aCA/IDI1NSAmIHIuZ3poZWFkLm5hbWUuY2hhckNvZGVBdChyLmd6aW5kZXgrKykgOiAwLCBFdChyLCBuKTsKCQkJCX0gd2hpbGUgKDAgIT09IG4pOwoKCQkJCXIuZ3poZWFkLmhjcmMgJiYgci5wZW5kaW5nID4gaSAmJiAodC5hZGxlciA9IE0odC5hZGxlciwgci5wZW5kaW5nX2J1Ziwgci5wZW5kaW5nIC0gaSwgaSkpLCAwID09PSBuICYmIChyLmd6aW5kZXggPSAwLCByLnN0YXR1cyA9IDkxKTsKCQkJfSBlbHNlIHIuc3RhdHVzID0gOTE7CgkJCWlmICg5MSA9PT0gci5zdGF0dXMpIGlmIChyLmd6aGVhZC5jb21tZW50KSB7CgkJCQlpID0gci5wZW5kaW5nOwoKCQkJCWRvIHsKCQkJCQlpZiAoci5wZW5kaW5nID09PSByLnBlbmRpbmdfYnVmX3NpemUgJiYgKHIuZ3poZWFkLmhjcmMgJiYgci5wZW5kaW5nID4gaSAmJiAodC5hZGxlciA9IE0odC5hZGxlciwgci5wZW5kaW5nX2J1Ziwgci5wZW5kaW5nIC0gaSwgaSkpLCB5dCh0KSwgaSA9IHIucGVuZGluZywgci5wZW5kaW5nID09PSByLnBlbmRpbmdfYnVmX3NpemUpKSB7CgkJCQkJCW4gPSAxOwoJCQkJCQlicmVhazsKCQkJCQl9CgoJCQkJCW4gPSByLmd6aW5kZXggPCByLmd6aGVhZC5jb21tZW50Lmxlbmd0aCA/IDI1NSAmIHIuZ3poZWFkLmNvbW1lbnQuY2hhckNvZGVBdChyLmd6aW5kZXgrKykgOiAwLCBFdChyLCBuKTsKCQkJCX0gd2hpbGUgKDAgIT09IG4pOwoKCQkJCXIuZ3poZWFkLmhjcmMgJiYgci5wZW5kaW5nID4gaSAmJiAodC5hZGxlciA9IE0odC5hZGxlciwgci5wZW5kaW5nX2J1Ziwgci5wZW5kaW5nIC0gaSwgaSkpLCAwID09PSBuICYmIChyLnN0YXR1cyA9IHV0KTsKCQkJfSBlbHNlIHIuc3RhdHVzID0gdXQ7CgoJCQlpZiAoci5zdGF0dXMgPT09IHV0ICYmIChyLmd6aGVhZC5oY3JjID8gKHIucGVuZGluZyArIDIgPiByLnBlbmRpbmdfYnVmX3NpemUgJiYgeXQodCksIHIucGVuZGluZyArIDIgPD0gci5wZW5kaW5nX2J1Zl9zaXplICYmIChFdChyLCAyNTUgJiB0LmFkbGVyKSwgRXQociwgdC5hZGxlciA+PiA4ICYgMjU1KSwgdC5hZGxlciA9IDAsIHIuc3RhdHVzID0gd3QpKSA6IHIuc3RhdHVzID0gd3QpLCAwICE9PSByLnBlbmRpbmcpIHsKCQkJCWlmICh5dCh0KSwgMCA9PT0gdC5hdmFpbF9vdXQpIHJldHVybiByLmxhc3RfZmx1c2ggPSAtMSwgUTsKCQkJfSBlbHNlIGlmICgwID09PSB0LmF2YWlsX2luICYmIGJ0KGUpIDw9IGJ0KHMpICYmIGUgIT09IHEpIHJldHVybiBndCh0LCBudCk7CgoJCQlpZiAoci5zdGF0dXMgPT09IHB0ICYmIDAgIT09IHQuYXZhaWxfaW4pIHJldHVybiBndCh0LCBudCk7CgoJCQlpZiAoMCAhPT0gdC5hdmFpbF9pbiB8fCAwICE9PSByLmxvb2thaGVhZCB8fCBlICE9PSBHICYmIHIuc3RhdHVzICE9PSBwdCkgewoJCQkJbGV0IGkgPSByLnN0cmF0ZWd5ID09PSBhdCA/ICgodCwgZSkgPT4gewoJCQkJCWxldCBpOwoKCQkJCQlmb3IgKDs7KSB7CgkJCQkJCWlmICgwID09PSB0Lmxvb2thaGVhZCAmJiAoenQodCksIDAgPT09IHQubG9va2FoZWFkKSkgewoJCQkJCQkJaWYgKGUgPT09IEcpIHJldHVybiAxOwoJCQkJCQkJYnJlYWs7CgkJCQkJCX0KCgkJCQkJCWlmICh0Lm1hdGNoX2xlbmd0aCA9IDAsIGkgPSBZKHQsIDAsIHQud2luZG93W3Quc3Ryc3RhcnRdKSwgdC5sb29rYWhlYWQtLSwgdC5zdHJzdGFydCsrLCBpICYmICh2dCh0LCAhMSksIDAgPT09IHQuc3RybS5hdmFpbF9vdXQpKSByZXR1cm4gMTsKCQkJCQl9CgoJCQkJCXJldHVybiB0Lmluc2VydCA9IDAsIGUgPT09IHEgPyAodnQodCwgITApLCAwID09PSB0LnN0cm0uYXZhaWxfb3V0ID8gMyA6IDQpIDogdC5sYXN0X2xpdCAmJiAodnQodCwgITEpLCAwID09PSB0LnN0cm0uYXZhaWxfb3V0KSA/IDEgOiAyOwoJCQkJfSkociwgZSkgOiByLnN0cmF0ZWd5ID09PSBvdCA/ICgodCwgZSkgPT4gewoJCQkJCWxldCBpLCBuLCByLCBzOwoJCQkJCWNvbnN0IGEgPSB0LndpbmRvdzsKCgkJCQkJZm9yICg7OykgewoJCQkJCQlpZiAodC5sb29rYWhlYWQgPD0gZnQpIHsKCQkJCQkJCWlmICh6dCh0KSwgdC5sb29rYWhlYWQgPD0gZnQgJiYgZSA9PT0gRykgcmV0dXJuIDE7CgkJCQkJCQlpZiAoMCA9PT0gdC5sb29rYWhlYWQpIGJyZWFrOwoJCQkJCQl9CgoJCQkJCQlpZiAodC5tYXRjaF9sZW5ndGggPSAwLCB0Lmxvb2thaGVhZCA+PSAzICYmIHQuc3Ryc3RhcnQgPiAwICYmIChyID0gdC5zdHJzdGFydCAtIDEsIG4gPSBhW3JdLCBuID09PSBhWysrcl0gJiYgbiA9PT0gYVsrK3JdICYmIG4gPT09IGFbKytyXSkpIHsKCQkJCQkJCXMgPSB0LnN0cnN0YXJ0ICsgZnQ7CgoJCQkJCQkJZG8ge30gd2hpbGUgKG4gPT09IGFbKytyXSAmJiBuID09PSBhWysrcl0gJiYgbiA9PT0gYVsrK3JdICYmIG4gPT09IGFbKytyXSAmJiBuID09PSBhWysrcl0gJiYgbiA9PT0gYVsrK3JdICYmIG4gPT09IGFbKytyXSAmJiBuID09PSBhWysrcl0gJiYgciA8IHMpOwoKCQkJCQkJCXQubWF0Y2hfbGVuZ3RoID0gZnQgLSAocyAtIHIpLCB0Lm1hdGNoX2xlbmd0aCA+IHQubG9va2FoZWFkICYmICh0Lm1hdGNoX2xlbmd0aCA9IHQubG9va2FoZWFkKTsKCQkJCQkJfQoKCQkJCQkJaWYgKHQubWF0Y2hfbGVuZ3RoID49IDMgPyAoaSA9IFkodCwgMSwgdC5tYXRjaF9sZW5ndGggLSAzKSwgdC5sb29rYWhlYWQgLT0gdC5tYXRjaF9sZW5ndGgsIHQuc3Ryc3RhcnQgKz0gdC5tYXRjaF9sZW5ndGgsIHQubWF0Y2hfbGVuZ3RoID0gMCkgOiAoaSA9IFkodCwgMCwgdC53aW5kb3dbdC5zdHJzdGFydF0pLCB0Lmxvb2thaGVhZC0tLCB0LnN0cnN0YXJ0KyspLCBpICYmICh2dCh0LCAhMSksIDAgPT09IHQuc3RybS5hdmFpbF9vdXQpKSByZXR1cm4gMTsKCQkJCQl9CgoJCQkJCXJldHVybiB0Lmluc2VydCA9IDAsIGUgPT09IHEgPyAodnQodCwgITApLCAwID09PSB0LnN0cm0uYXZhaWxfb3V0ID8gMyA6IDQpIDogdC5sYXN0X2xpdCAmJiAodnQodCwgITEpLCAwID09PSB0LnN0cm0uYXZhaWxfb3V0KSA/IDEgOiAyOwoJCQkJfSkociwgZSkgOiBPdFtyLmxldmVsXS5mdW5jKHIsIGUpOwoJCQkJaWYgKDMgIT09IGkgJiYgNCAhPT0gaSB8fCAoci5zdGF0dXMgPSBwdCksIDEgPT09IGkgfHwgMyA9PT0gaSkgcmV0dXJuIDAgPT09IHQuYXZhaWxfb3V0ICYmIChyLmxhc3RfZmx1c2ggPSAtMSksIFE7CgkJCQlpZiAoMiA9PT0gaSAmJiAoZSA9PT0gWCA/IGoocikgOiBlICE9PSBKICYmIChLKHIsIDAsIDAsICExKSwgZSA9PT0gViAmJiAobXQoci5oZWFkKSwgMCA9PT0gci5sb29rYWhlYWQgJiYgKHIuc3Ryc3RhcnQgPSAwLCByLmJsb2NrX3N0YXJ0ID0gMCwgci5pbnNlcnQgPSAwKSkpLCB5dCh0KSwgMCA9PT0gdC5hdmFpbF9vdXQpKSByZXR1cm4gci5sYXN0X2ZsdXNoID0gLTEsIFE7CgkJCX0KCgkJCXJldHVybiBlICE9PSBxID8gUSA6IHIud3JhcCA8PSAwID8gdHQgOiAoMiA9PT0gci53cmFwID8gKEV0KHIsIDI1NSAmIHQuYWRsZXIpLCBFdChyLCB0LmFkbGVyID4+IDggJiAyNTUpLCBFdChyLCB0LmFkbGVyID4+IDE2ICYgMjU1KSwgRXQociwgdC5hZGxlciA+PiAyNCAmIDI1NSksIEV0KHIsIDI1NSAmIHQudG90YWxfaW4pLCBFdChyLCB0LnRvdGFsX2luID4+IDggJiAyNTUpLCBFdChyLCB0LnRvdGFsX2luID4+IDE2ICYgMjU1KSwgRXQociwgdC50b3RhbF9pbiA+PiAyNCAmIDI1NSkpIDogKEF0KHIsIHQuYWRsZXIgPj4+IDE2KSwgQXQociwgNjU1MzUgJiB0LmFkbGVyKSksIHl0KHQpLCByLndyYXAgPiAwICYmIChyLndyYXAgPSAtci53cmFwKSwgMCAhPT0gci5wZW5kaW5nID8gUSA6IHR0KTsKCQl9LAoJCQkJRnQgPSB0ID0+IHsKCQkJaWYgKCF0IHx8ICF0LnN0YXRlKSByZXR1cm4gZXQ7CgkJCWNvbnN0IGUgPSB0LnN0YXRlLnN0YXR1czsKCQkJcmV0dXJuIDQyICE9PSBlICYmIDY5ICE9PSBlICYmIDczICE9PSBlICYmIDkxICE9PSBlICYmIGUgIT09IHV0ICYmIGUgIT09IHd0ICYmIGUgIT09IHB0ID8gZ3QodCwgZXQpIDogKHQuc3RhdGUgPSBudWxsLCBlID09PSB3dCA/IGd0KHQsIGl0KSA6IFEpOwoJCX0sCgkJCQlNdCA9ICh0LCBlKSA9PiB7CgkJCWxldCBpID0gZS5sZW5ndGg7CgkJCWlmICghdCB8fCAhdC5zdGF0ZSkgcmV0dXJuIGV0OwoJCQljb25zdCBuID0gdC5zdGF0ZSwKCQkJCQkJciA9IG4ud3JhcDsKCQkJaWYgKDIgPT09IHIgfHwgMSA9PT0gciAmJiA0MiAhPT0gbi5zdGF0dXMgfHwgbi5sb29rYWhlYWQpIHJldHVybiBldDsKCgkJCWlmICgxID09PSByICYmICh0LmFkbGVyID0gWih0LmFkbGVyLCBlLCBpLCAwKSksIG4ud3JhcCA9IDAsIGkgPj0gbi53X3NpemUpIHsKCQkJCTAgPT09IHIgJiYgKG10KG4uaGVhZCksIG4uc3Ryc3RhcnQgPSAwLCBuLmJsb2NrX3N0YXJ0ID0gMCwgbi5pbnNlcnQgPSAwKTsKCQkJCWxldCB0ID0gbmV3IFVpbnQ4QXJyYXkobi53X3NpemUpOwoJCQkJdC5zZXQoZS5zdWJhcnJheShpIC0gbi53X3NpemUsIGkpLCAwKSwgZSA9IHQsIGkgPSBuLndfc2l6ZTsKCQkJfQoKCQkJY29uc3QgcyA9IHQuYXZhaWxfaW4sCgkJCQkJCWEgPSB0Lm5leHRfaW4sCgkJCQkJCW8gPSB0LmlucHV0OwoKCQkJZm9yICh0LmF2YWlsX2luID0gaSwgdC5uZXh0X2luID0gMCwgdC5pbnB1dCA9IGUsIHp0KG4pOyBuLmxvb2thaGVhZCA+PSAzOykgewoJCQkJbGV0IHQgPSBuLnN0cnN0YXJ0LAoJCQkJCQllID0gbi5sb29rYWhlYWQgLSAyOwoKCQkJCWRvIHsKCQkJCQluLmluc19oID0ga3Qobiwgbi5pbnNfaCwgbi53aW5kb3dbdCArIDMgLSAxXSksIG4ucHJldlt0ICYgbi53X21hc2tdID0gbi5oZWFkW24uaW5zX2hdLCBuLmhlYWRbbi5pbnNfaF0gPSB0LCB0Kys7CgkJCQl9IHdoaWxlICgtLWUpOwoKCQkJCW4uc3Ryc3RhcnQgPSB0LCBuLmxvb2thaGVhZCA9IDIsIHp0KG4pOwoJCQl9CgoJCQlyZXR1cm4gbi5zdHJzdGFydCArPSBuLmxvb2thaGVhZCwgbi5ibG9ja19zdGFydCA9IG4uc3Ryc3RhcnQsIG4uaW5zZXJ0ID0gbi5sb29rYWhlYWQsIG4ubG9va2FoZWFkID0gMCwgbi5tYXRjaF9sZW5ndGggPSBuLnByZXZfbGVuZ3RoID0gMiwgbi5tYXRjaF9hdmFpbGFibGUgPSAwLCB0Lm5leHRfaW4gPSBhLCB0LmlucHV0ID0gbywgdC5hdmFpbF9pbiA9IHMsIG4ud3JhcCA9IHIsIFE7CgkJfTsKCgkJY29uc3QgUHQgPSAodCwgZSkgPT4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHQsIGUpOwoKCQl2YXIgSHQgPSBmdW5jdGlvbiBIdCh0KSB7CgkJCWNvbnN0IGUgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpOwoKCQkJZm9yICg7IGUubGVuZ3RoOykgewoJCQkJY29uc3QgaSA9IGUuc2hpZnQoKTsKCgkJCQlpZiAoaSkgewoJCQkJCWlmICgib2JqZWN0IiAhPSB0eXBlb2YgaSkgdGhyb3cgbmV3IFR5cGVFcnJvcihpICsgIm11c3QgYmUgbm9uLW9iamVjdCIpOwoKCQkJCQlmb3IgKGNvbnN0IGUgaW4gaSkgUHQoaSwgZSkgJiYgKHRbZV0gPSBpW2VdKTsKCQkJCX0KCQkJfQoKCQkJcmV0dXJuIHQ7CgkJfSwKCQkJCVd0ID0gdCA9PiB7CgkJCWxldCBlID0gMDsKCgkJCWZvciAobGV0IGkgPSAwLCBuID0gdC5sZW5ndGg7IGkgPCBuOyBpKyspIGUgKz0gdFtpXS5sZW5ndGg7CgoJCQljb25zdCBpID0gbmV3IFVpbnQ4QXJyYXkoZSk7CgoJCQlmb3IgKGxldCBlID0gMCwgbiA9IDAsIHIgPSB0Lmxlbmd0aDsgZSA8IHI7IGUrKykgewoJCQkJbGV0IHIgPSB0W2VdOwoJCQkJaS5zZXQociwgbiksIG4gKz0gci5sZW5ndGg7CgkJCX0KCgkJCXJldHVybiBpOwoJCX07CgoJCWxldCBLdCA9ICEwOwoKCQl0cnkgewoJCQlTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsIG5ldyBVaW50OEFycmF5KDEpKTsKCQl9IGNhdGNoICh0KSB7CgkJCUt0ID0gITE7CgkJfQoKCQljb25zdCAkdCA9IG5ldyBVaW50OEFycmF5KDI1Nik7CgoJCWZvciAobGV0IHQgPSAwOyB0IDwgMjU2OyB0KyspICR0W3RdID0gdCA+PSAyNTIgPyA2IDogdCA+PSAyNDggPyA1IDogdCA+PSAyNDAgPyA0IDogdCA+PSAyMjQgPyAzIDogdCA+PSAxOTIgPyAyIDogMTsKCgkJJHRbMjU0XSA9ICR0WzI1NF0gPSAxOwoKCQl2YXIgWXQgPSB0ID0+IHsKCQkJaWYgKCJmdW5jdGlvbiIgPT0gdHlwZW9mIFRleHRFbmNvZGVyICYmIFRleHRFbmNvZGVyLnByb3RvdHlwZS5lbmNvZGUpIHJldHVybiBuZXcgVGV4dEVuY29kZXIoKS5lbmNvZGUodCk7CgkJCWxldCBlLAoJCQkJCWksCgkJCQkJbiwKCQkJCQlyLAoJCQkJCXMsCgkJCQkJYSA9IHQubGVuZ3RoLAoJCQkJCW8gPSAwOwoKCQkJZm9yIChyID0gMDsgciA8IGE7IHIrKykgaSA9IHQuY2hhckNvZGVBdChyKSwgNTUyOTYgPT0gKDY0NTEyICYgaSkgJiYgciArIDEgPCBhICYmIChuID0gdC5jaGFyQ29kZUF0KHIgKyAxKSwgNTYzMjAgPT0gKDY0NTEyICYgbikgJiYgKGkgPSA2NTUzNiArIChpIC0gNTUyOTYgPDwgMTApICsgKG4gLSA1NjMyMCksIHIrKykpLCBvICs9IGkgPCAxMjggPyAxIDogaSA8IDIwNDggPyAyIDogaSA8IDY1NTM2ID8gMyA6IDQ7CgoJCQlmb3IgKGUgPSBuZXcgVWludDhBcnJheShvKSwgcyA9IDAsIHIgPSAwOyBzIDwgbzsgcisrKSBpID0gdC5jaGFyQ29kZUF0KHIpLCA1NTI5NiA9PSAoNjQ1MTIgJiBpKSAmJiByICsgMSA8IGEgJiYgKG4gPSB0LmNoYXJDb2RlQXQociArIDEpLCA1NjMyMCA9PSAoNjQ1MTIgJiBuKSAmJiAoaSA9IDY1NTM2ICsgKGkgLSA1NTI5NiA8PCAxMCkgKyAobiAtIDU2MzIwKSwgcisrKSksIGkgPCAxMjggPyBlW3MrK10gPSBpIDogaSA8IDIwNDggPyAoZVtzKytdID0gMTkyIHwgaSA+Pj4gNiwgZVtzKytdID0gMTI4IHwgNjMgJiBpKSA6IGkgPCA2NTUzNiA/IChlW3MrK10gPSAyMjQgfCBpID4+PiAxMiwgZVtzKytdID0gMTI4IHwgaSA+Pj4gNiAmIDYzLCBlW3MrK10gPSAxMjggfCA2MyAmIGkpIDogKGVbcysrXSA9IDI0MCB8IGkgPj4+IDE4LCBlW3MrK10gPSAxMjggfCBpID4+PiAxMiAmIDYzLCBlW3MrK10gPSAxMjggfCBpID4+PiA2ICYgNjMsIGVbcysrXSA9IDEyOCB8IDYzICYgaSk7CgoJCQlyZXR1cm4gZTsKCQl9LAoJCQkJanQgPSAodCwgZSkgPT4gewoJCQljb25zdCBpID0gZSB8fCB0Lmxlbmd0aDsKCQkJaWYgKCJmdW5jdGlvbiIgPT0gdHlwZW9mIFRleHREZWNvZGVyICYmIFRleHREZWNvZGVyLnByb3RvdHlwZS5kZWNvZGUpIHJldHVybiBuZXcgVGV4dERlY29kZXIoKS5kZWNvZGUodC5zdWJhcnJheSgwLCBlKSk7CgkJCWxldCBuLCByOwoJCQljb25zdCBzID0gbmV3IEFycmF5KDIgKiBpKTsKCgkJCWZvciAociA9IDAsIG4gPSAwOyBuIDwgaTspIHsKCQkJCWxldCBlID0gdFtuKytdOwoKCQkJCWlmIChlIDwgMTI4KSB7CgkJCQkJc1tyKytdID0gZTsKCQkJCQljb250aW51ZTsKCQkJCX0KCgkJCQlsZXQgYSA9ICR0W2VdOwoJCQkJaWYgKGEgPiA0KSBzW3IrK10gPSA2NTUzMywgbiArPSBhIC0gMTtlbHNlIHsKCQkJCQlmb3IgKGUgJj0gMiA9PT0gYSA/IDMxIDogMyA9PT0gYSA/IDE1IDogNzsgYSA+IDEgJiYgbiA8IGk7KSBlID0gZSA8PCA2IHwgNjMgJiB0W24rK10sIGEtLTsKCgkJCQkJYSA+IDEgPyBzW3IrK10gPSA2NTUzMyA6IGUgPCA2NTUzNiA/IHNbcisrXSA9IGUgOiAoZSAtPSA2NTUzNiwgc1tyKytdID0gNTUyOTYgfCBlID4+IDEwICYgMTAyMywgc1tyKytdID0gNTYzMjAgfCAxMDIzICYgZSk7CgkJCQl9CgkJCX0KCgkJCXJldHVybiAoKHQsIGUpID0+IHsKCQkJCWlmIChlIDwgNjU1MzQgJiYgdC5zdWJhcnJheSAmJiBLdCkgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkobnVsbCwgdC5sZW5ndGggPT09IGUgPyB0IDogdC5zdWJhcnJheSgwLCBlKSk7CgkJCQlsZXQgaSA9ICIiOwoKCQkJCWZvciAobGV0IG4gPSAwOyBuIDwgZTsgbisrKSBpICs9IFN0cmluZy5mcm9tQ2hhckNvZGUodFtuXSk7CgoJCQkJcmV0dXJuIGk7CgkJCX0pKHMsIHIpOwoJCX0sCgkJCQlHdCA9ICh0LCBlKSA9PiB7CgkJCShlID0gZSB8fCB0Lmxlbmd0aCkgPiB0Lmxlbmd0aCAmJiAoZSA9IHQubGVuZ3RoKTsKCQkJbGV0IGkgPSBlIC0gMTsKCgkJCWZvciAoOyBpID49IDAgJiYgMTI4ID09ICgxOTIgJiB0W2ldKTspIGktLTsKCgkJCXJldHVybiBpIDwgMCB8fCAwID09PSBpID8gZSA6IGkgKyAkdFt0W2ldXSA+IGUgPyBpIDogZTsKCQl9LAoJCQkJWHQgPSBmdW5jdGlvbiBYdCgpIHsKCQkJdGhpcy5pbnB1dCA9IG51bGwsIHRoaXMubmV4dF9pbiA9IDAsIHRoaXMuYXZhaWxfaW4gPSAwLCB0aGlzLnRvdGFsX2luID0gMCwgdGhpcy5vdXRwdXQgPSBudWxsLCB0aGlzLm5leHRfb3V0ID0gMCwgdGhpcy5hdmFpbF9vdXQgPSAwLCB0aGlzLnRvdGFsX291dCA9IDAsIHRoaXMubXNnID0gIiIsIHRoaXMuc3RhdGUgPSBudWxsLCB0aGlzLmRhdGFfdHlwZSA9IDIsIHRoaXMuYWRsZXIgPSAwOwoJCX07CgoJCWNvbnN0IFZ0ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZywKCQkJCQl7CgkJCVpfTk9fRkxVU0g6IHF0LAoJCQlaX1NZTkNfRkxVU0g6IEp0LAoJCQlaX0ZVTExfRkxVU0g6IFF0LAoJCQlaX0ZJTklTSDogdGUsCgkJCVpfT0s6IGVlLAoJCQlaX1NUUkVBTV9FTkQ6IGllLAoJCQlaX0RFRkFVTFRfQ09NUFJFU1NJT046IG5lLAoJCQlaX0RFRkFVTFRfU1RSQVRFR1k6IHJlLAoJCQlaX0RFRkxBVEVEOiBzZQoJCX0gPSBIOwoKCQlmdW5jdGlvbiBhZSh0KSB7CgkJCXRoaXMub3B0aW9ucyA9IEh0KHsKCQkJCWxldmVsOiBuZSwKCQkJCW1ldGhvZDogc2UsCgkJCQljaHVua1NpemU6IDE2Mzg0LAoJCQkJd2luZG93Qml0czogMTUsCgkJCQltZW1MZXZlbDogOCwKCQkJCXN0cmF0ZWd5OiByZQoJCQl9LCB0IHx8IHt9KTsKCQkJbGV0IGUgPSB0aGlzLm9wdGlvbnM7CgkJCWUucmF3ICYmIGUud2luZG93Qml0cyA+IDAgPyBlLndpbmRvd0JpdHMgPSAtZS53aW5kb3dCaXRzIDogZS5nemlwICYmIGUud2luZG93Qml0cyA+IDAgJiYgZS53aW5kb3dCaXRzIDwgMTYgJiYgKGUud2luZG93Qml0cyArPSAxNiksIHRoaXMuZXJyID0gMCwgdGhpcy5tc2cgPSAiIiwgdGhpcy5lbmRlZCA9ICExLCB0aGlzLmNodW5rcyA9IFtdLCB0aGlzLnN0cm0gPSBuZXcgWHQoKSwgdGhpcy5zdHJtLmF2YWlsX291dCA9IDA7CgkJCWxldCBpID0gSXQodGhpcy5zdHJtLCBlLmxldmVsLCBlLm1ldGhvZCwgZS53aW5kb3dCaXRzLCBlLm1lbUxldmVsLCBlLnN0cmF0ZWd5KTsKCQkJaWYgKGkgIT09IGVlKSB0aHJvdyBuZXcgRXJyb3IoUFtpXSk7CgoJCQlpZiAoZS5oZWFkZXIgJiYgU3QodGhpcy5zdHJtLCBlLmhlYWRlciksIGUuZGljdGlvbmFyeSkgewoJCQkJbGV0IHQ7CgkJCQlpZiAodCA9ICJzdHJpbmciID09IHR5cGVvZiBlLmRpY3Rpb25hcnkgPyBZdChlLmRpY3Rpb25hcnkpIDogIltvYmplY3QgQXJyYXlCdWZmZXJdIiA9PT0gVnQuY2FsbChlLmRpY3Rpb25hcnkpID8gbmV3IFVpbnQ4QXJyYXkoZS5kaWN0aW9uYXJ5KSA6IGUuZGljdGlvbmFyeSwgaSA9IE10KHRoaXMuc3RybSwgdCksIGkgIT09IGVlKSB0aHJvdyBuZXcgRXJyb3IoUFtpXSk7CgkJCQl0aGlzLl9kaWN0X3NldCA9ICEwOwoJCQl9CgkJfQoKCQlmdW5jdGlvbiBvZSh0LCBlKSB7CgkJCWNvbnN0IGkgPSBuZXcgYWUoZSk7CgkJCWlmIChpLnB1c2godCwgITApLCBpLmVycikgdGhyb3cgaS5tc2cgfHwgUFtpLmVycl07CgkJCXJldHVybiBpLnJlc3VsdDsKCQl9CgoJCWFlLnByb3RvdHlwZS5wdXNoID0gZnVuY3Rpb24gKHQsIGUpIHsKCQkJY29uc3QgaSA9IHRoaXMuc3RybSwKCQkJCQkJbiA9IHRoaXMub3B0aW9ucy5jaHVua1NpemU7CgkJCWxldCByLCBzOwoJCQlpZiAodGhpcy5lbmRlZCkgcmV0dXJuICExOwoKCQkJZm9yIChzID0gZSA9PT0gfn5lID8gZSA6ICEwID09PSBlID8gdGUgOiBxdCwgInN0cmluZyIgPT0gdHlwZW9mIHQgPyBpLmlucHV0ID0gWXQodCkgOiAiW29iamVjdCBBcnJheUJ1ZmZlcl0iID09PSBWdC5jYWxsKHQpID8gaS5pbnB1dCA9IG5ldyBVaW50OEFycmF5KHQpIDogaS5pbnB1dCA9IHQsIGkubmV4dF9pbiA9IDAsIGkuYXZhaWxfaW4gPSBpLmlucHV0Lmxlbmd0aDs7KSBpZiAoMCA9PT0gaS5hdmFpbF9vdXQgJiYgKGkub3V0cHV0ID0gbmV3IFVpbnQ4QXJyYXkobiksIGkubmV4dF9vdXQgPSAwLCBpLmF2YWlsX291dCA9IG4pLCAocyA9PT0gSnQgfHwgcyA9PT0gUXQpICYmIGkuYXZhaWxfb3V0IDw9IDYpIHRoaXMub25EYXRhKGkub3V0cHV0LnN1YmFycmF5KDAsIGkubmV4dF9vdXQpKSwgaS5hdmFpbF9vdXQgPSAwO2Vsc2UgewoJCQkJaWYgKHIgPSBadChpLCBzKSwgciA9PT0gaWUpIHJldHVybiBpLm5leHRfb3V0ID4gMCAmJiB0aGlzLm9uRGF0YShpLm91dHB1dC5zdWJhcnJheSgwLCBpLm5leHRfb3V0KSksIHIgPSBGdCh0aGlzLnN0cm0pLCB0aGlzLm9uRW5kKHIpLCB0aGlzLmVuZGVkID0gITAsIHIgPT09IGVlOwoKCQkJCWlmICgwICE9PSBpLmF2YWlsX291dCkgewoJCQkJCWlmIChzID4gMCAmJiBpLm5leHRfb3V0ID4gMCkgdGhpcy5vbkRhdGEoaS5vdXRwdXQuc3ViYXJyYXkoMCwgaS5uZXh0X291dCkpLCBpLmF2YWlsX291dCA9IDA7ZWxzZSBpZiAoMCA9PT0gaS5hdmFpbF9pbikgYnJlYWs7CgkJCQl9IGVsc2UgdGhpcy5vbkRhdGEoaS5vdXRwdXQpOwoJCQl9CgoJCQlyZXR1cm4gITA7CgkJfSwgYWUucHJvdG90eXBlLm9uRGF0YSA9IGZ1bmN0aW9uICh0KSB7CgkJCXRoaXMuY2h1bmtzLnB1c2godCk7CgkJfSwgYWUucHJvdG90eXBlLm9uRW5kID0gZnVuY3Rpb24gKHQpIHsKCQkJdCA9PT0gZWUgJiYgKHRoaXMucmVzdWx0ID0gV3QodGhpcy5jaHVua3MpKSwgdGhpcy5jaHVua3MgPSBbXSwgdGhpcy5lcnIgPSB0LCB0aGlzLm1zZyA9IHRoaXMuc3RybS5tc2c7CgkJfTsKCgkJdmFyIGhlID0gewoJCQlEZWZsYXRlOiBhZSwKCQkJZGVmbGF0ZTogb2UsCgkJCWRlZmxhdGVSYXc6IGZ1bmN0aW9uIGRlZmxhdGVSYXcodCwgZSkgewoJCQkJcmV0dXJuIChlID0gZSB8fCB7fSkucmF3ID0gITAsIG9lKHQsIGUpOwoJCQl9LAoJCQlnemlwOiBmdW5jdGlvbiBnemlwKHQsIGUpIHsKCQkJCXJldHVybiAoZSA9IGUgfHwge30pLmd6aXAgPSAhMCwgb2UodCwgZSk7CgkJCX0sCgkJCWNvbnN0YW50czogSAoJCX0sCgkJCQlsZSA9IGZ1bmN0aW9uIGxlKHQsIGUpIHsKCQkJbGV0IGksIG4sIHIsIHMsIGEsIG8sIGgsIGwsIGQsIF8sIGYsIGMsIHUsIHcsIHAsIGcsIGIsIG0sIGssIHksIHYsIEUsIEEsIHg7CgoJCQljb25zdCBVID0gdC5zdGF0ZTsKCQkJaSA9IHQubmV4dF9pbiwgQSA9IHQuaW5wdXQsIG4gPSBpICsgKHQuYXZhaWxfaW4gLSA1KSwgciA9IHQubmV4dF9vdXQsIHggPSB0Lm91dHB1dCwgcyA9IHIgLSAoZSAtIHQuYXZhaWxfb3V0KSwgYSA9IHIgKyAodC5hdmFpbF9vdXQgLSAyNTcpLCBvID0gVS5kbWF4LCBoID0gVS53c2l6ZSwgbCA9IFUud2hhdmUsIGQgPSBVLnduZXh0LCBfID0gVS53aW5kb3csIGYgPSBVLmhvbGQsIGMgPSBVLmJpdHMsIHUgPSBVLmxlbmNvZGUsIHcgPSBVLmRpc3Rjb2RlLCBwID0gKDEgPDwgVS5sZW5iaXRzKSAtIDEsIGcgPSAoMSA8PCBVLmRpc3RiaXRzKSAtIDE7CgoJCQl0OiBkbyB7CgkJCQljIDwgMTUgJiYgKGYgKz0gQVtpKytdIDw8IGMsIGMgKz0gOCwgZiArPSBBW2krK10gPDwgYywgYyArPSA4KSwgYiA9IHVbZiAmIHBdOwoKCQkJCWU6IGZvciAoOzspIHsKCQkJCQlpZiAobSA9IGIgPj4+IDI0LCBmID4+Pj0gbSwgYyAtPSBtLCBtID0gYiA+Pj4gMTYgJiAyNTUsIDAgPT09IG0pIHhbcisrXSA9IDY1NTM1ICYgYjtlbHNlIHsKCQkJCQkJaWYgKCEoMTYgJiBtKSkgewoJCQkJCQkJaWYgKDAgPT0gKDY0ICYgbSkpIHsKCQkJCQkJCQliID0gdVsoNjU1MzUgJiBiKSArIChmICYgKDEgPDwgbSkgLSAxKV07CgkJCQkJCQkJY29udGludWUgZTsKCQkJCQkJCX0KCgkJCQkJCQlpZiAoMzIgJiBtKSB7CgkJCQkJCQkJVS5tb2RlID0gMTI7CgkJCQkJCQkJYnJlYWsgdDsKCQkJCQkJCX0KCgkJCQkJCQl0Lm1zZyA9ICJpbnZhbGlkIGxpdGVyYWwvbGVuZ3RoIGNvZGUiLCBVLm1vZGUgPSAzMDsKCQkJCQkJCWJyZWFrIHQ7CgkJCQkJCX0KCgkJCQkJCWsgPSA2NTUzNSAmIGIsIG0gJj0gMTUsIG0gJiYgKGMgPCBtICYmIChmICs9IEFbaSsrXSA8PCBjLCBjICs9IDgpLCBrICs9IGYgJiAoMSA8PCBtKSAtIDEsIGYgPj4+PSBtLCBjIC09IG0pLCBjIDwgMTUgJiYgKGYgKz0gQVtpKytdIDw8IGMsIGMgKz0gOCwgZiArPSBBW2krK10gPDwgYywgYyArPSA4KSwgYiA9IHdbZiAmIGddOwoKCQkJCQkJaTogZm9yICg7OykgewoJCQkJCQkJaWYgKG0gPSBiID4+PiAyNCwgZiA+Pj49IG0sIGMgLT0gbSwgbSA9IGIgPj4+IDE2ICYgMjU1LCAhKDE2ICYgbSkpIHsKCQkJCQkJCQlpZiAoMCA9PSAoNjQgJiBtKSkgewoJCQkJCQkJCQliID0gd1soNjU1MzUgJiBiKSArIChmICYgKDEgPDwgbSkgLSAxKV07CgkJCQkJCQkJCWNvbnRpbnVlIGk7CgkJCQkJCQkJfQoKCQkJCQkJCQl0Lm1zZyA9ICJpbnZhbGlkIGRpc3RhbmNlIGNvZGUiLCBVLm1vZGUgPSAzMDsKCQkJCQkJCQlicmVhayB0OwoJCQkJCQkJfQoKCQkJCQkJCWlmICh5ID0gNjU1MzUgJiBiLCBtICY9IDE1LCBjIDwgbSAmJiAoZiArPSBBW2krK10gPDwgYywgYyArPSA4LCBjIDwgbSAmJiAoZiArPSBBW2krK10gPDwgYywgYyArPSA4KSksIHkgKz0gZiAmICgxIDw8IG0pIC0gMSwgeSA+IG8pIHsKCQkJCQkJCQl0Lm1zZyA9ICJpbnZhbGlkIGRpc3RhbmNlIHRvbyBmYXIgYmFjayIsIFUubW9kZSA9IDMwOwoJCQkJCQkJCWJyZWFrIHQ7CgkJCQkJCQl9CgoJCQkJCQkJaWYgKGYgPj4+PSBtLCBjIC09IG0sIG0gPSByIC0gcywgeSA+IG0pIHsKCQkJCQkJCQlpZiAobSA9IHkgLSBtLCBtID4gbCAmJiBVLnNhbmUpIHsKCQkJCQkJCQkJdC5tc2cgPSAiaW52YWxpZCBkaXN0YW5jZSB0b28gZmFyIGJhY2siLCBVLm1vZGUgPSAzMDsKCQkJCQkJCQkJYnJlYWsgdDsKCQkJCQkJCQl9CgoJCQkJCQkJCWlmICh2ID0gMCwgRSA9IF8sIDAgPT09IGQpIHsKCQkJCQkJCQkJaWYgKHYgKz0gaCAtIG0sIG0gPCBrKSB7CgkJCQkJCQkJCQlrIC09IG07CgoJCQkJCQkJCQkJZG8gewoJCQkJCQkJCQkJCXhbcisrXSA9IF9bdisrXTsKCQkJCQkJCQkJCX0gd2hpbGUgKC0tbSk7CgoJCQkJCQkJCQkJdiA9IHIgLSB5LCBFID0geDsKCQkJCQkJCQkJfQoJCQkJCQkJCX0gZWxzZSBpZiAoZCA8IG0pIHsKCQkJCQkJCQkJaWYgKHYgKz0gaCArIGQgLSBtLCBtIC09IGQsIG0gPCBrKSB7CgkJCQkJCQkJCQlrIC09IG07CgoJCQkJCQkJCQkJZG8gewoJCQkJCQkJCQkJCXhbcisrXSA9IF9bdisrXTsKCQkJCQkJCQkJCX0gd2hpbGUgKC0tbSk7CgoJCQkJCQkJCQkJaWYgKHYgPSAwLCBkIDwgaykgewoJCQkJCQkJCQkJCW0gPSBkLCBrIC09IG07CgoJCQkJCQkJCQkJCWRvIHsKCQkJCQkJCQkJCQkJeFtyKytdID0gX1t2KytdOwoJCQkJCQkJCQkJCX0gd2hpbGUgKC0tbSk7CgoJCQkJCQkJCQkJCXYgPSByIC0geSwgRSA9IHg7CgkJCQkJCQkJCQl9CgkJCQkJCQkJCX0KCQkJCQkJCQl9IGVsc2UgaWYgKHYgKz0gZCAtIG0sIG0gPCBrKSB7CgkJCQkJCQkJCWsgLT0gbTsKCgkJCQkJCQkJCWRvIHsKCQkJCQkJCQkJCXhbcisrXSA9IF9bdisrXTsKCQkJCQkJCQkJfSB3aGlsZSAoLS1tKTsKCgkJCQkJCQkJCXYgPSByIC0geSwgRSA9IHg7CgkJCQkJCQkJfQoKCQkJCQkJCQlmb3IgKDsgayA+IDI7KSB4W3IrK10gPSBFW3YrK10sIHhbcisrXSA9IEVbdisrXSwgeFtyKytdID0gRVt2KytdLCBrIC09IDM7CgoJCQkJCQkJCWsgJiYgKHhbcisrXSA9IEVbdisrXSwgayA+IDEgJiYgKHhbcisrXSA9IEVbdisrXSkpOwoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQl2ID0gciAtIHk7CgoJCQkJCQkJCWRvIHsKCQkJCQkJCQkJeFtyKytdID0geFt2KytdLCB4W3IrK10gPSB4W3YrK10sIHhbcisrXSA9IHhbdisrXSwgayAtPSAzOwoJCQkJCQkJCX0gd2hpbGUgKGsgPiAyKTsKCgkJCQkJCQkJayAmJiAoeFtyKytdID0geFt2KytdLCBrID4gMSAmJiAoeFtyKytdID0geFt2KytdKSk7CgkJCQkJCQl9CgoJCQkJCQkJYnJlYWs7CgkJCQkJCX0KCQkJCQl9CgkJCQkJYnJlYWs7CgkJCQl9CgkJCX0gd2hpbGUgKGkgPCBuICYmIHIgPCBhKTsKCgkJCWsgPSBjID4+IDMsIGkgLT0gaywgYyAtPSBrIDw8IDMsIGYgJj0gKDEgPDwgYykgLSAxLCB0Lm5leHRfaW4gPSBpLCB0Lm5leHRfb3V0ID0gciwgdC5hdmFpbF9pbiA9IGkgPCBuID8gbiAtIGkgKyA1IDogNSAtIChpIC0gbiksIHQuYXZhaWxfb3V0ID0gciA8IGEgPyBhIC0gciArIDI1NyA6IDI1NyAtIChyIC0gYSksIFUuaG9sZCA9IGYsIFUuYml0cyA9IGM7CgkJfTsKCgkJY29uc3QgZGUgPSBuZXcgVWludDE2QXJyYXkoWzMsIDQsIDUsIDYsIDcsIDgsIDksIDEwLCAxMSwgMTMsIDE1LCAxNywgMTksIDIzLCAyNywgMzEsIDM1LCA0MywgNTEsIDU5LCA2NywgODMsIDk5LCAxMTUsIDEzMSwgMTYzLCAxOTUsIDIyNywgMjU4LCAwLCAwXSksCgkJCQkJX2UgPSBuZXcgVWludDhBcnJheShbMTYsIDE2LCAxNiwgMTYsIDE2LCAxNiwgMTYsIDE2LCAxNywgMTcsIDE3LCAxNywgMTgsIDE4LCAxOCwgMTgsIDE5LCAxOSwgMTksIDE5LCAyMCwgMjAsIDIwLCAyMCwgMjEsIDIxLCAyMSwgMjEsIDE2LCA3MiwgNzhdKSwKCQkJCQlmZSA9IG5ldyBVaW50MTZBcnJheShbMSwgMiwgMywgNCwgNSwgNywgOSwgMTMsIDE3LCAyNSwgMzMsIDQ5LCA2NSwgOTcsIDEyOSwgMTkzLCAyNTcsIDM4NSwgNTEzLCA3NjksIDEwMjUsIDE1MzcsIDIwNDksIDMwNzMsIDQwOTcsIDYxNDUsIDgxOTMsIDEyMjg5LCAxNjM4NSwgMjQ1NzcsIDAsIDBdKSwKCQkJCQljZSA9IG5ldyBVaW50OEFycmF5KFsxNiwgMTYsIDE2LCAxNiwgMTcsIDE3LCAxOCwgMTgsIDE5LCAxOSwgMjAsIDIwLCAyMSwgMjEsIDIyLCAyMiwgMjMsIDIzLCAyNCwgMjQsIDI1LCAyNSwgMjYsIDI2LCAyNywgMjcsIDI4LCAyOCwgMjksIDI5LCA2NCwgNjRdKTsKCgkJdmFyIHVlID0gKHQsIGUsIGksIG4sIHIsIHMsIGEsIG8pID0+IHsKCQkJY29uc3QgaCA9IG8uYml0czsKCgkJCWxldCBsLAoJCQkJCWQsCgkJCQkJXywKCQkJCQlmLAoJCQkJCWMsCgkJCQkJdSwKCQkJCQl3ID0gMCwKCQkJCQlwID0gMCwKCQkJCQlnID0gMCwKCQkJCQliID0gMCwKCQkJCQltID0gMCwKCQkJCQlrID0gMCwKCQkJCQl5ID0gMCwKCQkJCQl2ID0gMCwKCQkJCQlFID0gMCwKCQkJCQlBID0gMCwKCQkJCQl4ID0gbnVsbCwKCQkJCQlVID0gMDsKCgkJCWNvbnN0IHogPSBuZXcgVWludDE2QXJyYXkoMTYpLAoJCQkJCQlSID0gbmV3IFVpbnQxNkFycmF5KDE2KTsKCQkJbGV0IE4sCgkJCQkJVCwKCQkJCQlPLAoJCQkJCUwgPSBudWxsLAoJCQkJCUIgPSAwOwoKCQkJZm9yICh3ID0gMDsgdyA8PSAxNTsgdysrKSB6W3ddID0gMDsKCgkJCWZvciAocCA9IDA7IHAgPCBuOyBwKyspIHpbZVtpICsgcF1dKys7CgoJCQlmb3IgKG0gPSBoLCBiID0gMTU7IGIgPj0gMSAmJiAwID09PSB6W2JdOyBiLS0pOwoKCQkJaWYgKG0gPiBiICYmIChtID0gYiksIDAgPT09IGIpIHJldHVybiByW3MrK10gPSAyMDk3MTUyMCwgcltzKytdID0gMjA5NzE1MjAsIG8uYml0cyA9IDEsIDA7CgoJCQlmb3IgKGcgPSAxOyBnIDwgYiAmJiAwID09PSB6W2ddOyBnKyspOwoKCQkJZm9yIChtIDwgZyAmJiAobSA9IGcpLCB2ID0gMSwgdyA9IDE7IHcgPD0gMTU7IHcrKykgaWYgKHYgPDw9IDEsIHYgLT0gelt3XSwgdiA8IDApIHJldHVybiAtMTsKCgkJCWlmICh2ID4gMCAmJiAoMCA9PT0gdCB8fCAxICE9PSBiKSkgcmV0dXJuIC0xOwoKCQkJZm9yIChSWzFdID0gMCwgdyA9IDE7IHcgPCAxNTsgdysrKSBSW3cgKyAxXSA9IFJbd10gKyB6W3ddOwoKCQkJZm9yIChwID0gMDsgcCA8IG47IHArKykgMCAhPT0gZVtpICsgcF0gJiYgKGFbUltlW2kgKyBwXV0rK10gPSBwKTsKCgkJCWlmICgwID09PSB0ID8gKHggPSBMID0gYSwgdSA9IDE5KSA6IDEgPT09IHQgPyAoeCA9IGRlLCBVIC09IDI1NywgTCA9IF9lLCBCIC09IDI1NywgdSA9IDI1NikgOiAoeCA9IGZlLCBMID0gY2UsIHUgPSAtMSksIEEgPSAwLCBwID0gMCwgdyA9IGcsIGMgPSBzLCBrID0gbSwgeSA9IDAsIF8gPSAtMSwgRSA9IDEgPDwgbSwgZiA9IEUgLSAxLCAxID09PSB0ICYmIEUgPiA4NTIgfHwgMiA9PT0gdCAmJiBFID4gNTkyKSByZXR1cm4gMTsKCgkJCWZvciAoOzspIHsKCQkJCU4gPSB3IC0geSwgYVtwXSA8IHUgPyAoVCA9IDAsIE8gPSBhW3BdKSA6IGFbcF0gPiB1ID8gKFQgPSBMW0IgKyBhW3BdXSwgTyA9IHhbVSArIGFbcF1dKSA6IChUID0gOTYsIE8gPSAwKSwgbCA9IDEgPDwgdyAtIHksIGQgPSAxIDw8IGssIGcgPSBkOwoKCQkJCWRvIHsKCQkJCQlkIC09IGwsIHJbYyArIChBID4+IHkpICsgZF0gPSBOIDw8IDI0IHwgVCA8PCAxNiB8IE8gfCAwOwoJCQkJfSB3aGlsZSAoMCAhPT0gZCk7CgoJCQkJZm9yIChsID0gMSA8PCB3IC0gMTsgQSAmIGw7KSBsID4+PSAxOwoKCQkJCWlmICgwICE9PSBsID8gKEEgJj0gbCAtIDEsIEEgKz0gbCkgOiBBID0gMCwgcCsrLCAwID09IC0telt3XSkgewoJCQkJCWlmICh3ID09PSBiKSBicmVhazsKCQkJCQl3ID0gZVtpICsgYVtwXV07CgkJCQl9CgoJCQkJaWYgKHcgPiBtICYmIChBICYgZikgIT09IF8pIHsKCQkJCQlmb3IgKDAgPT09IHkgJiYgKHkgPSBtKSwgYyArPSBnLCBrID0gdyAtIHksIHYgPSAxIDw8IGs7IGsgKyB5IDwgYiAmJiAodiAtPSB6W2sgKyB5XSwgISh2IDw9IDApKTspIGsrKywgdiA8PD0gMTsKCgkJCQkJaWYgKEUgKz0gMSA8PCBrLCAxID09PSB0ICYmIEUgPiA4NTIgfHwgMiA9PT0gdCAmJiBFID4gNTkyKSByZXR1cm4gMTsKCQkJCQlfID0gQSAmIGYsIHJbX10gPSBtIDw8IDI0IHwgayA8PCAxNiB8IGMgLSBzIHwgMDsKCQkJCX0KCQkJfQoKCQkJcmV0dXJuIDAgIT09IEEgJiYgKHJbYyArIEFdID0gdyAtIHkgPDwgMjQgfCA2NCA8PCAxNiB8IDApLCBvLmJpdHMgPSBtLCAwOwoJCX07CgoJCWNvbnN0IHsKCQkJWl9GSU5JU0g6IHdlLAoJCQlaX0JMT0NLOiBwZSwKCQkJWl9UUkVFUzogZ2UsCgkJCVpfT0s6IGJlLAoJCQlaX1NUUkVBTV9FTkQ6IG1lLAoJCQlaX05FRURfRElDVDoga2UsCgkJCVpfU1RSRUFNX0VSUk9SOiB5ZSwKCQkJWl9EQVRBX0VSUk9SOiB2ZSwKCQkJWl9NRU1fRVJST1I6IEVlLAoJCQlaX0JVRl9FUlJPUjogQWUsCgkJCVpfREVGTEFURUQ6IHhlCgkJfSA9IEgsCgkJCQkJVWUgPSAxMiwKCQkJCQl6ZSA9IDMwLAoJCQkJCVJlID0gdCA9PiAodCA+Pj4gMjQgJiAyNTUpICsgKHQgPj4+IDggJiA2NTI4MCkgKyAoKDY1MjgwICYgdCkgPDwgOCkgKyAoKDI1NSAmIHQpIDw8IDI0KTsKCgkJZnVuY3Rpb24gTmUoKSB7CgkJCXRoaXMubW9kZSA9IDAsIHRoaXMubGFzdCA9ICExLCB0aGlzLndyYXAgPSAwLCB0aGlzLmhhdmVkaWN0ID0gITEsIHRoaXMuZmxhZ3MgPSAwLCB0aGlzLmRtYXggPSAwLCB0aGlzLmNoZWNrID0gMCwgdGhpcy50b3RhbCA9IDAsIHRoaXMuaGVhZCA9IG51bGwsIHRoaXMud2JpdHMgPSAwLCB0aGlzLndzaXplID0gMCwgdGhpcy53aGF2ZSA9IDAsIHRoaXMud25leHQgPSAwLCB0aGlzLndpbmRvdyA9IG51bGwsIHRoaXMuaG9sZCA9IDAsIHRoaXMuYml0cyA9IDAsIHRoaXMubGVuZ3RoID0gMCwgdGhpcy5vZmZzZXQgPSAwLCB0aGlzLmV4dHJhID0gMCwgdGhpcy5sZW5jb2RlID0gbnVsbCwgdGhpcy5kaXN0Y29kZSA9IG51bGwsIHRoaXMubGVuYml0cyA9IDAsIHRoaXMuZGlzdGJpdHMgPSAwLCB0aGlzLm5jb2RlID0gMCwgdGhpcy5ubGVuID0gMCwgdGhpcy5uZGlzdCA9IDAsIHRoaXMuaGF2ZSA9IDAsIHRoaXMubmV4dCA9IG51bGwsIHRoaXMubGVucyA9IG5ldyBVaW50MTZBcnJheSgzMjApLCB0aGlzLndvcmsgPSBuZXcgVWludDE2QXJyYXkoMjg4KSwgdGhpcy5sZW5keW4gPSBudWxsLCB0aGlzLmRpc3RkeW4gPSBudWxsLCB0aGlzLnNhbmUgPSAwLCB0aGlzLmJhY2sgPSAwLCB0aGlzLndhcyA9IDA7CgkJfQoKCQljb25zdCBUZSA9IHQgPT4gewoJCQlpZiAoIXQgfHwgIXQuc3RhdGUpIHJldHVybiB5ZTsKCQkJY29uc3QgZSA9IHQuc3RhdGU7CgkJCXJldHVybiB0LnRvdGFsX2luID0gdC50b3RhbF9vdXQgPSBlLnRvdGFsID0gMCwgdC5tc2cgPSAiIiwgZS53cmFwICYmICh0LmFkbGVyID0gMSAmIGUud3JhcCksIGUubW9kZSA9IDEsIGUubGFzdCA9IDAsIGUuaGF2ZWRpY3QgPSAwLCBlLmRtYXggPSAzMjc2OCwgZS5oZWFkID0gbnVsbCwgZS5ob2xkID0gMCwgZS5iaXRzID0gMCwgZS5sZW5jb2RlID0gZS5sZW5keW4gPSBuZXcgSW50MzJBcnJheSg4NTIpLCBlLmRpc3Rjb2RlID0gZS5kaXN0ZHluID0gbmV3IEludDMyQXJyYXkoNTkyKSwgZS5zYW5lID0gMSwgZS5iYWNrID0gLTEsIGJlOwoJCX0sCgkJCQkJT2UgPSB0ID0+IHsKCQkJaWYgKCF0IHx8ICF0LnN0YXRlKSByZXR1cm4geWU7CgkJCWNvbnN0IGUgPSB0LnN0YXRlOwoJCQlyZXR1cm4gZS53c2l6ZSA9IDAsIGUud2hhdmUgPSAwLCBlLnduZXh0ID0gMCwgVGUodCk7CgkJfSwKCQkJCQlMZSA9ICh0LCBlKSA9PiB7CgkJCWxldCBpOwoJCQlpZiAoIXQgfHwgIXQuc3RhdGUpIHJldHVybiB5ZTsKCQkJY29uc3QgbiA9IHQuc3RhdGU7CgkJCXJldHVybiBlIDwgMCA/IChpID0gMCwgZSA9IC1lKSA6IChpID0gMSArIChlID4+IDQpLCBlIDwgNDggJiYgKGUgJj0gMTUpKSwgZSAmJiAoZSA8IDggfHwgZSA+IDE1KSA/IHllIDogKG51bGwgIT09IG4ud2luZG93ICYmIG4ud2JpdHMgIT09IGUgJiYgKG4ud2luZG93ID0gbnVsbCksIG4ud3JhcCA9IGksIG4ud2JpdHMgPSBlLCBPZSh0KSk7CgkJfSwKCQkJCQlCZSA9ICh0LCBlKSA9PiB7CgkJCWlmICghdCkgcmV0dXJuIHllOwoJCQljb25zdCBpID0gbmV3IE5lKCk7CgkJCXQuc3RhdGUgPSBpLCBpLndpbmRvdyA9IG51bGw7CgkJCWNvbnN0IG4gPSBMZSh0LCBlKTsKCQkJcmV0dXJuIG4gIT09IGJlICYmICh0LnN0YXRlID0gbnVsbCksIG47CgkJfTsKCgkJbGV0IENlLAoJCQkJRGUsCgkJCQlJZSA9ICEwOwoKCQljb25zdCBTZSA9IHQgPT4gewoJCQlpZiAoSWUpIHsKCQkJCUNlID0gbmV3IEludDMyQXJyYXkoNTEyKSwgRGUgPSBuZXcgSW50MzJBcnJheSgzMik7CgkJCQlsZXQgZSA9IDA7CgoJCQkJZm9yICg7IGUgPCAxNDQ7KSB0LmxlbnNbZSsrXSA9IDg7CgoJCQkJZm9yICg7IGUgPCAyNTY7KSB0LmxlbnNbZSsrXSA9IDk7CgoJCQkJZm9yICg7IGUgPCAyODA7KSB0LmxlbnNbZSsrXSA9IDc7CgoJCQkJZm9yICg7IGUgPCAyODg7KSB0LmxlbnNbZSsrXSA9IDg7CgoJCQkJZm9yICh1ZSgxLCB0LmxlbnMsIDAsIDI4OCwgQ2UsIDAsIHQud29yaywgewoJCQkJCWJpdHM6IDkKCQkJCX0pLCBlID0gMDsgZSA8IDMyOykgdC5sZW5zW2UrK10gPSA1OwoKCQkJCXVlKDIsIHQubGVucywgMCwgMzIsIERlLCAwLCB0LndvcmssIHsKCQkJCQliaXRzOiA1CgkJCQl9KSwgSWUgPSAhMTsKCQkJfQoKCQkJdC5sZW5jb2RlID0gQ2UsIHQubGVuYml0cyA9IDksIHQuZGlzdGNvZGUgPSBEZSwgdC5kaXN0Yml0cyA9IDU7CgkJfSwKCQkJCQlaZSA9ICh0LCBlLCBpLCBuKSA9PiB7CgkJCWxldCByOwoJCQljb25zdCBzID0gdC5zdGF0ZTsKCQkJcmV0dXJuIG51bGwgPT09IHMud2luZG93ICYmIChzLndzaXplID0gMSA8PCBzLndiaXRzLCBzLnduZXh0ID0gMCwgcy53aGF2ZSA9IDAsIHMud2luZG93ID0gbmV3IFVpbnQ4QXJyYXkocy53c2l6ZSkpLCBuID49IHMud3NpemUgPyAocy53aW5kb3cuc2V0KGUuc3ViYXJyYXkoaSAtIHMud3NpemUsIGkpLCAwKSwgcy53bmV4dCA9IDAsIHMud2hhdmUgPSBzLndzaXplKSA6IChyID0gcy53c2l6ZSAtIHMud25leHQsIHIgPiBuICYmIChyID0gbiksIHMud2luZG93LnNldChlLnN1YmFycmF5KGkgLSBuLCBpIC0gbiArIHIpLCBzLnduZXh0KSwgKG4gLT0gcikgPyAocy53aW5kb3cuc2V0KGUuc3ViYXJyYXkoaSAtIG4sIGkpLCAwKSwgcy53bmV4dCA9IG4sIHMud2hhdmUgPSBzLndzaXplKSA6IChzLnduZXh0ICs9IHIsIHMud25leHQgPT09IHMud3NpemUgJiYgKHMud25leHQgPSAwKSwgcy53aGF2ZSA8IHMud3NpemUgJiYgKHMud2hhdmUgKz0gcikpKSwgMDsKCQl9OwoKCQl2YXIgRmUgPSBPZSwKCQkJCU1lID0gQmUsCgkJCQlQZSA9ICh0LCBlKSA9PiB7CgkJCWxldCBpLAoJCQkJCW4sCgkJCQkJciwKCQkJCQlzLAoJCQkJCWEsCgkJCQkJbywKCQkJCQloLAoJCQkJCWwsCgkJCQkJZCwKCQkJCQlfLAoJCQkJCWYsCgkJCQkJYywKCQkJCQl1LAoJCQkJCXcsCgkJCQkJcCwKCQkJCQlnLAoJCQkJCWIsCgkJCQkJbSwKCQkJCQlrLAoJCQkJCXksCgkJCQkJdiwKCQkJCQlFLAoJCQkJCUEgPSAwOwoKCQkJY29uc3QgeCA9IG5ldyBVaW50OEFycmF5KDQpOwoJCQlsZXQgVSwgejsKCQkJY29uc3QgUiA9IG5ldyBVaW50OEFycmF5KFsxNiwgMTcsIDE4LCAwLCA4LCA3LCA5LCA2LCAxMCwgNSwgMTEsIDQsIDEyLCAzLCAxMywgMiwgMTQsIDEsIDE1XSk7CgkJCWlmICghdCB8fCAhdC5zdGF0ZSB8fCAhdC5vdXRwdXQgfHwgIXQuaW5wdXQgJiYgMCAhPT0gdC5hdmFpbF9pbikgcmV0dXJuIHllOwoJCQlpID0gdC5zdGF0ZSwgaS5tb2RlID09PSBVZSAmJiAoaS5tb2RlID0gMTMpLCBhID0gdC5uZXh0X291dCwgciA9IHQub3V0cHV0LCBoID0gdC5hdmFpbF9vdXQsIHMgPSB0Lm5leHRfaW4sIG4gPSB0LmlucHV0LCBvID0gdC5hdmFpbF9pbiwgbCA9IGkuaG9sZCwgZCA9IGkuYml0cywgXyA9IG8sIGYgPSBoLCBFID0gYmU7CgoJCQl0OiBmb3IgKDs7KSBzd2l0Y2ggKGkubW9kZSkgewoJCQkJY2FzZSAxOgoJCQkJCWlmICgwID09PSBpLndyYXApIHsKCQkJCQkJaS5tb2RlID0gMTM7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCgkJCQkJZm9yICg7IGQgPCAxNjspIHsKCQkJCQkJaWYgKDAgPT09IG8pIGJyZWFrIHQ7CgkJCQkJCW8tLSwgbCArPSBuW3MrK10gPDwgZCwgZCArPSA4OwoJCQkJCX0KCgkJCQkJaWYgKDIgJiBpLndyYXAgJiYgMzU2MTUgPT09IGwpIHsKCQkJCQkJaS5jaGVjayA9IDAsIHhbMF0gPSAyNTUgJiBsLCB4WzFdID0gbCA+Pj4gOCAmIDI1NSwgaS5jaGVjayA9IE0oaS5jaGVjaywgeCwgMiwgMCksIGwgPSAwLCBkID0gMCwgaS5tb2RlID0gMjsKCQkJCQkJYnJlYWs7CgkJCQkJfQoKCQkJCQlpZiAoaS5mbGFncyA9IDAsIGkuaGVhZCAmJiAoaS5oZWFkLmRvbmUgPSAhMSksICEoMSAmIGkud3JhcCkgfHwgKCgoMjU1ICYgbCkgPDwgOCkgKyAobCA+PiA4KSkgJSAzMSkgewoJCQkJCQl0Lm1zZyA9ICJpbmNvcnJlY3QgaGVhZGVyIGNoZWNrIiwgaS5tb2RlID0gemU7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCgkJCQkJaWYgKCgxNSAmIGwpICE9PSB4ZSkgewoJCQkJCQl0Lm1zZyA9ICJ1bmtub3duIGNvbXByZXNzaW9uIG1ldGhvZCIsIGkubW9kZSA9IHplOwoJCQkJCQlicmVhazsKCQkJCQl9CgoJCQkJCWlmIChsID4+Pj0gNCwgZCAtPSA0LCB2ID0gOCArICgxNSAmIGwpLCAwID09PSBpLndiaXRzKSBpLndiaXRzID0gdjtlbHNlIGlmICh2ID4gaS53Yml0cykgewoJCQkJCQl0Lm1zZyA9ICJpbnZhbGlkIHdpbmRvdyBzaXplIiwgaS5tb2RlID0gemU7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCQkJCQlpLmRtYXggPSAxIDw8IGkud2JpdHMsIHQuYWRsZXIgPSBpLmNoZWNrID0gMSwgaS5tb2RlID0gNTEyICYgbCA/IDEwIDogVWUsIGwgPSAwLCBkID0gMDsKCQkJCQlicmVhazsKCgkJCQljYXNlIDI6CgkJCQkJZm9yICg7IGQgPCAxNjspIHsKCQkJCQkJaWYgKDAgPT09IG8pIGJyZWFrIHQ7CgkJCQkJCW8tLSwgbCArPSBuW3MrK10gPDwgZCwgZCArPSA4OwoJCQkJCX0KCgkJCQkJaWYgKGkuZmxhZ3MgPSBsLCAoMjU1ICYgaS5mbGFncykgIT09IHhlKSB7CgkJCQkJCXQubXNnID0gInVua25vd24gY29tcHJlc3Npb24gbWV0aG9kIiwgaS5tb2RlID0gemU7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCgkJCQkJaWYgKDU3MzQ0ICYgaS5mbGFncykgewoJCQkJCQl0Lm1zZyA9ICJ1bmtub3duIGhlYWRlciBmbGFncyBzZXQiLCBpLm1vZGUgPSB6ZTsKCQkJCQkJYnJlYWs7CgkJCQkJfQoKCQkJCQlpLmhlYWQgJiYgKGkuaGVhZC50ZXh0ID0gbCA+PiA4ICYgMSksIDUxMiAmIGkuZmxhZ3MgJiYgKHhbMF0gPSAyNTUgJiBsLCB4WzFdID0gbCA+Pj4gOCAmIDI1NSwgaS5jaGVjayA9IE0oaS5jaGVjaywgeCwgMiwgMCkpLCBsID0gMCwgZCA9IDAsIGkubW9kZSA9IDM7CgoJCQkJY2FzZSAzOgoJCQkJCWZvciAoOyBkIDwgMzI7KSB7CgkJCQkJCWlmICgwID09PSBvKSBicmVhayB0OwoJCQkJCQlvLS0sIGwgKz0gbltzKytdIDw8IGQsIGQgKz0gODsKCQkJCQl9CgoJCQkJCWkuaGVhZCAmJiAoaS5oZWFkLnRpbWUgPSBsKSwgNTEyICYgaS5mbGFncyAmJiAoeFswXSA9IDI1NSAmIGwsIHhbMV0gPSBsID4+PiA4ICYgMjU1LCB4WzJdID0gbCA+Pj4gMTYgJiAyNTUsIHhbM10gPSBsID4+PiAyNCAmIDI1NSwgaS5jaGVjayA9IE0oaS5jaGVjaywgeCwgNCwgMCkpLCBsID0gMCwgZCA9IDAsIGkubW9kZSA9IDQ7CgoJCQkJY2FzZSA0OgoJCQkJCWZvciAoOyBkIDwgMTY7KSB7CgkJCQkJCWlmICgwID09PSBvKSBicmVhayB0OwoJCQkJCQlvLS0sIGwgKz0gbltzKytdIDw8IGQsIGQgKz0gODsKCQkJCQl9CgoJCQkJCWkuaGVhZCAmJiAoaS5oZWFkLnhmbGFncyA9IDI1NSAmIGwsIGkuaGVhZC5vcyA9IGwgPj4gOCksIDUxMiAmIGkuZmxhZ3MgJiYgKHhbMF0gPSAyNTUgJiBsLCB4WzFdID0gbCA+Pj4gOCAmIDI1NSwgaS5jaGVjayA9IE0oaS5jaGVjaywgeCwgMiwgMCkpLCBsID0gMCwgZCA9IDAsIGkubW9kZSA9IDU7CgoJCQkJY2FzZSA1OgoJCQkJCWlmICgxMDI0ICYgaS5mbGFncykgewoJCQkJCQlmb3IgKDsgZCA8IDE2OykgewoJCQkJCQkJaWYgKDAgPT09IG8pIGJyZWFrIHQ7CgkJCQkJCQlvLS0sIGwgKz0gbltzKytdIDw8IGQsIGQgKz0gODsKCQkJCQkJfQoKCQkJCQkJaS5sZW5ndGggPSBsLCBpLmhlYWQgJiYgKGkuaGVhZC5leHRyYV9sZW4gPSBsKSwgNTEyICYgaS5mbGFncyAmJiAoeFswXSA9IDI1NSAmIGwsIHhbMV0gPSBsID4+PiA4ICYgMjU1LCBpLmNoZWNrID0gTShpLmNoZWNrLCB4LCAyLCAwKSksIGwgPSAwLCBkID0gMDsKCQkJCQl9IGVsc2UgaS5oZWFkICYmIChpLmhlYWQuZXh0cmEgPSBudWxsKTsKCgkJCQkJaS5tb2RlID0gNjsKCgkJCQljYXNlIDY6CgkJCQkJaWYgKDEwMjQgJiBpLmZsYWdzICYmIChjID0gaS5sZW5ndGgsIGMgPiBvICYmIChjID0gbyksIGMgJiYgKGkuaGVhZCAmJiAodiA9IGkuaGVhZC5leHRyYV9sZW4gLSBpLmxlbmd0aCwgaS5oZWFkLmV4dHJhIHx8IChpLmhlYWQuZXh0cmEgPSBuZXcgVWludDhBcnJheShpLmhlYWQuZXh0cmFfbGVuKSksIGkuaGVhZC5leHRyYS5zZXQobi5zdWJhcnJheShzLCBzICsgYyksIHYpKSwgNTEyICYgaS5mbGFncyAmJiAoaS5jaGVjayA9IE0oaS5jaGVjaywgbiwgYywgcykpLCBvIC09IGMsIHMgKz0gYywgaS5sZW5ndGggLT0gYyksIGkubGVuZ3RoKSkgYnJlYWsgdDsKCQkJCQlpLmxlbmd0aCA9IDAsIGkubW9kZSA9IDc7CgoJCQkJY2FzZSA3OgoJCQkJCWlmICgyMDQ4ICYgaS5mbGFncykgewoJCQkJCQlpZiAoMCA9PT0gbykgYnJlYWsgdDsKCQkJCQkJYyA9IDA7CgoJCQkJCQlkbyB7CgkJCQkJCQl2ID0gbltzICsgYysrXSwgaS5oZWFkICYmIHYgJiYgaS5sZW5ndGggPCA2NTUzNiAmJiAoaS5oZWFkLm5hbWUgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSh2KSk7CgkJCQkJCX0gd2hpbGUgKHYgJiYgYyA8IG8pOwoKCQkJCQkJaWYgKDUxMiAmIGkuZmxhZ3MgJiYgKGkuY2hlY2sgPSBNKGkuY2hlY2ssIG4sIGMsIHMpKSwgbyAtPSBjLCBzICs9IGMsIHYpIGJyZWFrIHQ7CgkJCQkJfSBlbHNlIGkuaGVhZCAmJiAoaS5oZWFkLm5hbWUgPSBudWxsKTsKCgkJCQkJaS5sZW5ndGggPSAwLCBpLm1vZGUgPSA4OwoKCQkJCWNhc2UgODoKCQkJCQlpZiAoNDA5NiAmIGkuZmxhZ3MpIHsKCQkJCQkJaWYgKDAgPT09IG8pIGJyZWFrIHQ7CgkJCQkJCWMgPSAwOwoKCQkJCQkJZG8gewoJCQkJCQkJdiA9IG5bcyArIGMrK10sIGkuaGVhZCAmJiB2ICYmIGkubGVuZ3RoIDwgNjU1MzYgJiYgKGkuaGVhZC5jb21tZW50ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUodikpOwoJCQkJCQl9IHdoaWxlICh2ICYmIGMgPCBvKTsKCgkJCQkJCWlmICg1MTIgJiBpLmZsYWdzICYmIChpLmNoZWNrID0gTShpLmNoZWNrLCBuLCBjLCBzKSksIG8gLT0gYywgcyArPSBjLCB2KSBicmVhayB0OwoJCQkJCX0gZWxzZSBpLmhlYWQgJiYgKGkuaGVhZC5jb21tZW50ID0gbnVsbCk7CgoJCQkJCWkubW9kZSA9IDk7CgoJCQkJY2FzZSA5OgoJCQkJCWlmICg1MTIgJiBpLmZsYWdzKSB7CgkJCQkJCWZvciAoOyBkIDwgMTY7KSB7CgkJCQkJCQlpZiAoMCA9PT0gbykgYnJlYWsgdDsKCQkJCQkJCW8tLSwgbCArPSBuW3MrK10gPDwgZCwgZCArPSA4OwoJCQkJCQl9CgoJCQkJCQlpZiAobCAhPT0gKDY1NTM1ICYgaS5jaGVjaykpIHsKCQkJCQkJCXQubXNnID0gImhlYWRlciBjcmMgbWlzbWF0Y2giLCBpLm1vZGUgPSB6ZTsKCQkJCQkJCWJyZWFrOwoJCQkJCQl9CgoJCQkJCQlsID0gMCwgZCA9IDA7CgkJCQkJfQoKCQkJCQlpLmhlYWQgJiYgKGkuaGVhZC5oY3JjID0gaS5mbGFncyA+PiA5ICYgMSwgaS5oZWFkLmRvbmUgPSAhMCksIHQuYWRsZXIgPSBpLmNoZWNrID0gMCwgaS5tb2RlID0gVWU7CgkJCQkJYnJlYWs7CgoJCQkJY2FzZSAxMDoKCQkJCQlmb3IgKDsgZCA8IDMyOykgewoJCQkJCQlpZiAoMCA9PT0gbykgYnJlYWsgdDsKCQkJCQkJby0tLCBsICs9IG5bcysrXSA8PCBkLCBkICs9IDg7CgkJCQkJfQoKCQkJCQl0LmFkbGVyID0gaS5jaGVjayA9IFJlKGwpLCBsID0gMCwgZCA9IDAsIGkubW9kZSA9IDExOwoKCQkJCWNhc2UgMTE6CgkJCQkJaWYgKDAgPT09IGkuaGF2ZWRpY3QpIHJldHVybiB0Lm5leHRfb3V0ID0gYSwgdC5hdmFpbF9vdXQgPSBoLCB0Lm5leHRfaW4gPSBzLCB0LmF2YWlsX2luID0gbywgaS5ob2xkID0gbCwgaS5iaXRzID0gZCwga2U7CgkJCQkJdC5hZGxlciA9IGkuY2hlY2sgPSAxLCBpLm1vZGUgPSBVZTsKCgkJCQljYXNlIFVlOgoJCQkJCWlmIChlID09PSBwZSB8fCBlID09PSBnZSkgYnJlYWsgdDsKCgkJCQljYXNlIDEzOgoJCQkJCWlmIChpLmxhc3QpIHsKCQkJCQkJbCA+Pj49IDcgJiBkLCBkIC09IDcgJiBkLCBpLm1vZGUgPSAyNzsKCQkJCQkJYnJlYWs7CgkJCQkJfQoKCQkJCQlmb3IgKDsgZCA8IDM7KSB7CgkJCQkJCWlmICgwID09PSBvKSBicmVhayB0OwoJCQkJCQlvLS0sIGwgKz0gbltzKytdIDw8IGQsIGQgKz0gODsKCQkJCQl9CgoJCQkJCXN3aXRjaCAoaS5sYXN0ID0gMSAmIGwsIGwgPj4+PSAxLCBkIC09IDEsIDMgJiBsKSB7CgkJCQkJCWNhc2UgMDoKCQkJCQkJCWkubW9kZSA9IDE0OwoJCQkJCQkJYnJlYWs7CgoJCQkJCQljYXNlIDE6CgkJCQkJCQlpZiAoU2UoaSksIGkubW9kZSA9IDIwLCBlID09PSBnZSkgewoJCQkJCQkJCWwgPj4+PSAyLCBkIC09IDI7CgkJCQkJCQkJYnJlYWsgdDsKCQkJCQkJCX0KCgkJCQkJCQlicmVhazsKCgkJCQkJCWNhc2UgMjoKCQkJCQkJCWkubW9kZSA9IDE3OwoJCQkJCQkJYnJlYWs7CgoJCQkJCQljYXNlIDM6CgkJCQkJCQl0Lm1zZyA9ICJpbnZhbGlkIGJsb2NrIHR5cGUiLCBpLm1vZGUgPSB6ZTsKCQkJCQl9CgoJCQkJCWwgPj4+PSAyLCBkIC09IDI7CgkJCQkJYnJlYWs7CgoJCQkJY2FzZSAxNDoKCQkJCQlmb3IgKGwgPj4+PSA3ICYgZCwgZCAtPSA3ICYgZDsgZCA8IDMyOykgewoJCQkJCQlpZiAoMCA9PT0gbykgYnJlYWsgdDsKCQkJCQkJby0tLCBsICs9IG5bcysrXSA8PCBkLCBkICs9IDg7CgkJCQkJfQoKCQkJCQlpZiAoKDY1NTM1ICYgbCkgIT0gKGwgPj4+IDE2IF4gNjU1MzUpKSB7CgkJCQkJCXQubXNnID0gImludmFsaWQgc3RvcmVkIGJsb2NrIGxlbmd0aHMiLCBpLm1vZGUgPSB6ZTsKCQkJCQkJYnJlYWs7CgkJCQkJfQoKCQkJCQlpZiAoaS5sZW5ndGggPSA2NTUzNSAmIGwsIGwgPSAwLCBkID0gMCwgaS5tb2RlID0gMTUsIGUgPT09IGdlKSBicmVhayB0OwoKCQkJCWNhc2UgMTU6CgkJCQkJaS5tb2RlID0gMTY7CgoJCQkJY2FzZSAxNjoKCQkJCQlpZiAoYyA9IGkubGVuZ3RoLCBjKSB7CgkJCQkJCWlmIChjID4gbyAmJiAoYyA9IG8pLCBjID4gaCAmJiAoYyA9IGgpLCAwID09PSBjKSBicmVhayB0OwoJCQkJCQlyLnNldChuLnN1YmFycmF5KHMsIHMgKyBjKSwgYSksIG8gLT0gYywgcyArPSBjLCBoIC09IGMsIGEgKz0gYywgaS5sZW5ndGggLT0gYzsKCQkJCQkJYnJlYWs7CgkJCQkJfQoKCQkJCQlpLm1vZGUgPSBVZTsKCQkJCQlicmVhazsKCgkJCQljYXNlIDE3OgoJCQkJCWZvciAoOyBkIDwgMTQ7KSB7CgkJCQkJCWlmICgwID09PSBvKSBicmVhayB0OwoJCQkJCQlvLS0sIGwgKz0gbltzKytdIDw8IGQsIGQgKz0gODsKCQkJCQl9CgoJCQkJCWlmIChpLm5sZW4gPSAyNTcgKyAoMzEgJiBsKSwgbCA+Pj49IDUsIGQgLT0gNSwgaS5uZGlzdCA9IDEgKyAoMzEgJiBsKSwgbCA+Pj49IDUsIGQgLT0gNSwgaS5uY29kZSA9IDQgKyAoMTUgJiBsKSwgbCA+Pj49IDQsIGQgLT0gNCwgaS5ubGVuID4gMjg2IHx8IGkubmRpc3QgPiAzMCkgewoJCQkJCQl0Lm1zZyA9ICJ0b28gbWFueSBsZW5ndGggb3IgZGlzdGFuY2Ugc3ltYm9scyIsIGkubW9kZSA9IHplOwoJCQkJCQlicmVhazsKCQkJCQl9CgoJCQkJCWkuaGF2ZSA9IDAsIGkubW9kZSA9IDE4OwoKCQkJCWNhc2UgMTg6CgkJCQkJZm9yICg7IGkuaGF2ZSA8IGkubmNvZGU7KSB7CgkJCQkJCWZvciAoOyBkIDwgMzspIHsKCQkJCQkJCWlmICgwID09PSBvKSBicmVhayB0OwoJCQkJCQkJby0tLCBsICs9IG5bcysrXSA8PCBkLCBkICs9IDg7CgkJCQkJCX0KCgkJCQkJCWkubGVuc1tSW2kuaGF2ZSsrXV0gPSA3ICYgbCwgbCA+Pj49IDMsIGQgLT0gMzsKCQkJCQl9CgoJCQkJCWZvciAoOyBpLmhhdmUgPCAxOTspIGkubGVuc1tSW2kuaGF2ZSsrXV0gPSAwOwoKCQkJCQlpZiAoaS5sZW5jb2RlID0gaS5sZW5keW4sIGkubGVuYml0cyA9IDcsIFUgPSB7CgkJCQkJCWJpdHM6IGkubGVuYml0cwoJCQkJCX0sIEUgPSB1ZSgwLCBpLmxlbnMsIDAsIDE5LCBpLmxlbmNvZGUsIDAsIGkud29yaywgVSksIGkubGVuYml0cyA9IFUuYml0cywgRSkgewoJCQkJCQl0Lm1zZyA9ICJpbnZhbGlkIGNvZGUgbGVuZ3RocyBzZXQiLCBpLm1vZGUgPSB6ZTsKCQkJCQkJYnJlYWs7CgkJCQkJfQoKCQkJCQlpLmhhdmUgPSAwLCBpLm1vZGUgPSAxOTsKCgkJCQljYXNlIDE5OgoJCQkJCWZvciAoOyBpLmhhdmUgPCBpLm5sZW4gKyBpLm5kaXN0OykgewoJCQkJCQlmb3IgKDsgQSA9IGkubGVuY29kZVtsICYgKDEgPDwgaS5sZW5iaXRzKSAtIDFdLCBwID0gQSA+Pj4gMjQsIGcgPSBBID4+PiAxNiAmIDI1NSwgYiA9IDY1NTM1ICYgQSwgIShwIDw9IGQpOykgewoJCQkJCQkJaWYgKDAgPT09IG8pIGJyZWFrIHQ7CgkJCQkJCQlvLS0sIGwgKz0gbltzKytdIDw8IGQsIGQgKz0gODsKCQkJCQkJfQoKCQkJCQkJaWYgKGIgPCAxNikgbCA+Pj49IHAsIGQgLT0gcCwgaS5sZW5zW2kuaGF2ZSsrXSA9IGI7ZWxzZSB7CgkJCQkJCQlpZiAoMTYgPT09IGIpIHsKCQkJCQkJCQlmb3IgKHogPSBwICsgMjsgZCA8IHo7KSB7CgkJCQkJCQkJCWlmICgwID09PSBvKSBicmVhayB0OwoJCQkJCQkJCQlvLS0sIGwgKz0gbltzKytdIDw8IGQsIGQgKz0gODsKCQkJCQkJCQl9CgoJCQkJCQkJCWlmIChsID4+Pj0gcCwgZCAtPSBwLCAwID09PSBpLmhhdmUpIHsKCQkJCQkJCQkJdC5tc2cgPSAiaW52YWxpZCBiaXQgbGVuZ3RoIHJlcGVhdCIsIGkubW9kZSA9IHplOwoJCQkJCQkJCQlicmVhazsKCQkJCQkJCQl9CgoJCQkJCQkJCXYgPSBpLmxlbnNbaS5oYXZlIC0gMV0sIGMgPSAzICsgKDMgJiBsKSwgbCA+Pj49IDIsIGQgLT0gMjsKCQkJCQkJCX0gZWxzZSBpZiAoMTcgPT09IGIpIHsKCQkJCQkJCQlmb3IgKHogPSBwICsgMzsgZCA8IHo7KSB7CgkJCQkJCQkJCWlmICgwID09PSBvKSBicmVhayB0OwoJCQkJCQkJCQlvLS0sIGwgKz0gbltzKytdIDw8IGQsIGQgKz0gODsKCQkJCQkJCQl9CgoJCQkJCQkJCWwgPj4+PSBwLCBkIC09IHAsIHYgPSAwLCBjID0gMyArICg3ICYgbCksIGwgPj4+PSAzLCBkIC09IDM7CgkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCWZvciAoeiA9IHAgKyA3OyBkIDwgejspIHsKCQkJCQkJCQkJaWYgKDAgPT09IG8pIGJyZWFrIHQ7CgkJCQkJCQkJCW8tLSwgbCArPSBuW3MrK10gPDwgZCwgZCArPSA4OwoJCQkJCQkJCX0KCgkJCQkJCQkJbCA+Pj49IHAsIGQgLT0gcCwgdiA9IDAsIGMgPSAxMSArICgxMjcgJiBsKSwgbCA+Pj49IDcsIGQgLT0gNzsKCQkJCQkJCX0KCgkJCQkJCQlpZiAoaS5oYXZlICsgYyA+IGkubmxlbiArIGkubmRpc3QpIHsKCQkJCQkJCQl0Lm1zZyA9ICJpbnZhbGlkIGJpdCBsZW5ndGggcmVwZWF0IiwgaS5tb2RlID0gemU7CgkJCQkJCQkJYnJlYWs7CgkJCQkJCQl9CgoJCQkJCQkJZm9yICg7IGMtLTspIGkubGVuc1tpLmhhdmUrK10gPSB2OwoJCQkJCQl9CgkJCQkJfQoKCQkJCQlpZiAoaS5tb2RlID09PSB6ZSkgYnJlYWs7CgoJCQkJCWlmICgwID09PSBpLmxlbnNbMjU2XSkgewoJCQkJCQl0Lm1zZyA9ICJpbnZhbGlkIGNvZGUgLS0gbWlzc2luZyBlbmQtb2YtYmxvY2siLCBpLm1vZGUgPSB6ZTsKCQkJCQkJYnJlYWs7CgkJCQkJfQoKCQkJCQlpZiAoaS5sZW5iaXRzID0gOSwgVSA9IHsKCQkJCQkJYml0czogaS5sZW5iaXRzCgkJCQkJfSwgRSA9IHVlKDEsIGkubGVucywgMCwgaS5ubGVuLCBpLmxlbmNvZGUsIDAsIGkud29yaywgVSksIGkubGVuYml0cyA9IFUuYml0cywgRSkgewoJCQkJCQl0Lm1zZyA9ICJpbnZhbGlkIGxpdGVyYWwvbGVuZ3RocyBzZXQiLCBpLm1vZGUgPSB6ZTsKCQkJCQkJYnJlYWs7CgkJCQkJfQoKCQkJCQlpZiAoaS5kaXN0Yml0cyA9IDYsIGkuZGlzdGNvZGUgPSBpLmRpc3RkeW4sIFUgPSB7CgkJCQkJCWJpdHM6IGkuZGlzdGJpdHMKCQkJCQl9LCBFID0gdWUoMiwgaS5sZW5zLCBpLm5sZW4sIGkubmRpc3QsIGkuZGlzdGNvZGUsIDAsIGkud29yaywgVSksIGkuZGlzdGJpdHMgPSBVLmJpdHMsIEUpIHsKCQkJCQkJdC5tc2cgPSAiaW52YWxpZCBkaXN0YW5jZXMgc2V0IiwgaS5tb2RlID0gemU7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCgkJCQkJaWYgKGkubW9kZSA9IDIwLCBlID09PSBnZSkgYnJlYWsgdDsKCgkJCQljYXNlIDIwOgoJCQkJCWkubW9kZSA9IDIxOwoKCQkJCWNhc2UgMjE6CgkJCQkJaWYgKG8gPj0gNiAmJiBoID49IDI1OCkgewoJCQkJCQl0Lm5leHRfb3V0ID0gYSwgdC5hdmFpbF9vdXQgPSBoLCB0Lm5leHRfaW4gPSBzLCB0LmF2YWlsX2luID0gbywgaS5ob2xkID0gbCwgaS5iaXRzID0gZCwgbGUodCwgZiksIGEgPSB0Lm5leHRfb3V0LCByID0gdC5vdXRwdXQsIGggPSB0LmF2YWlsX291dCwgcyA9IHQubmV4dF9pbiwgbiA9IHQuaW5wdXQsIG8gPSB0LmF2YWlsX2luLCBsID0gaS5ob2xkLCBkID0gaS5iaXRzLCBpLm1vZGUgPT09IFVlICYmIChpLmJhY2sgPSAtMSk7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCgkJCQkJZm9yIChpLmJhY2sgPSAwOyBBID0gaS5sZW5jb2RlW2wgJiAoMSA8PCBpLmxlbmJpdHMpIC0gMV0sIHAgPSBBID4+PiAyNCwgZyA9IEEgPj4+IDE2ICYgMjU1LCBiID0gNjU1MzUgJiBBLCAhKHAgPD0gZCk7KSB7CgkJCQkJCWlmICgwID09PSBvKSBicmVhayB0OwoJCQkJCQlvLS0sIGwgKz0gbltzKytdIDw8IGQsIGQgKz0gODsKCQkJCQl9CgoJCQkJCWlmIChnICYmIDAgPT0gKDI0MCAmIGcpKSB7CgkJCQkJCWZvciAobSA9IHAsIGsgPSBnLCB5ID0gYjsgQSA9IGkubGVuY29kZVt5ICsgKChsICYgKDEgPDwgbSArIGspIC0gMSkgPj4gbSldLCBwID0gQSA+Pj4gMjQsIGcgPSBBID4+PiAxNiAmIDI1NSwgYiA9IDY1NTM1ICYgQSwgIShtICsgcCA8PSBkKTspIHsKCQkJCQkJCWlmICgwID09PSBvKSBicmVhayB0OwoJCQkJCQkJby0tLCBsICs9IG5bcysrXSA8PCBkLCBkICs9IDg7CgkJCQkJCX0KCgkJCQkJCWwgPj4+PSBtLCBkIC09IG0sIGkuYmFjayArPSBtOwoJCQkJCX0KCgkJCQkJaWYgKGwgPj4+PSBwLCBkIC09IHAsIGkuYmFjayArPSBwLCBpLmxlbmd0aCA9IGIsIDAgPT09IGcpIHsKCQkJCQkJaS5tb2RlID0gMjY7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCgkJCQkJaWYgKDMyICYgZykgewoJCQkJCQlpLmJhY2sgPSAtMSwgaS5tb2RlID0gVWU7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCgkJCQkJaWYgKDY0ICYgZykgewoJCQkJCQl0Lm1zZyA9ICJpbnZhbGlkIGxpdGVyYWwvbGVuZ3RoIGNvZGUiLCBpLm1vZGUgPSB6ZTsKCQkJCQkJYnJlYWs7CgkJCQkJfQoKCQkJCQlpLmV4dHJhID0gMTUgJiBnLCBpLm1vZGUgPSAyMjsKCgkJCQljYXNlIDIyOgoJCQkJCWlmIChpLmV4dHJhKSB7CgkJCQkJCWZvciAoeiA9IGkuZXh0cmE7IGQgPCB6OykgewoJCQkJCQkJaWYgKDAgPT09IG8pIGJyZWFrIHQ7CgkJCQkJCQlvLS0sIGwgKz0gbltzKytdIDw8IGQsIGQgKz0gODsKCQkJCQkJfQoKCQkJCQkJaS5sZW5ndGggKz0gbCAmICgxIDw8IGkuZXh0cmEpIC0gMSwgbCA+Pj49IGkuZXh0cmEsIGQgLT0gaS5leHRyYSwgaS5iYWNrICs9IGkuZXh0cmE7CgkJCQkJfQoKCQkJCQlpLndhcyA9IGkubGVuZ3RoLCBpLm1vZGUgPSAyMzsKCgkJCQljYXNlIDIzOgoJCQkJCWZvciAoOyBBID0gaS5kaXN0Y29kZVtsICYgKDEgPDwgaS5kaXN0Yml0cykgLSAxXSwgcCA9IEEgPj4+IDI0LCBnID0gQSA+Pj4gMTYgJiAyNTUsIGIgPSA2NTUzNSAmIEEsICEocCA8PSBkKTspIHsKCQkJCQkJaWYgKDAgPT09IG8pIGJyZWFrIHQ7CgkJCQkJCW8tLSwgbCArPSBuW3MrK10gPDwgZCwgZCArPSA4OwoJCQkJCX0KCgkJCQkJaWYgKDAgPT0gKDI0MCAmIGcpKSB7CgkJCQkJCWZvciAobSA9IHAsIGsgPSBnLCB5ID0gYjsgQSA9IGkuZGlzdGNvZGVbeSArICgobCAmICgxIDw8IG0gKyBrKSAtIDEpID4+IG0pXSwgcCA9IEEgPj4+IDI0LCBnID0gQSA+Pj4gMTYgJiAyNTUsIGIgPSA2NTUzNSAmIEEsICEobSArIHAgPD0gZCk7KSB7CgkJCQkJCQlpZiAoMCA9PT0gbykgYnJlYWsgdDsKCQkJCQkJCW8tLSwgbCArPSBuW3MrK10gPDwgZCwgZCArPSA4OwoJCQkJCQl9CgoJCQkJCQlsID4+Pj0gbSwgZCAtPSBtLCBpLmJhY2sgKz0gbTsKCQkJCQl9CgoJCQkJCWlmIChsID4+Pj0gcCwgZCAtPSBwLCBpLmJhY2sgKz0gcCwgNjQgJiBnKSB7CgkJCQkJCXQubXNnID0gImludmFsaWQgZGlzdGFuY2UgY29kZSIsIGkubW9kZSA9IHplOwoJCQkJCQlicmVhazsKCQkJCQl9CgoJCQkJCWkub2Zmc2V0ID0gYiwgaS5leHRyYSA9IDE1ICYgZywgaS5tb2RlID0gMjQ7CgoJCQkJY2FzZSAyNDoKCQkJCQlpZiAoaS5leHRyYSkgewoJCQkJCQlmb3IgKHogPSBpLmV4dHJhOyBkIDwgejspIHsKCQkJCQkJCWlmICgwID09PSBvKSBicmVhayB0OwoJCQkJCQkJby0tLCBsICs9IG5bcysrXSA8PCBkLCBkICs9IDg7CgkJCQkJCX0KCgkJCQkJCWkub2Zmc2V0ICs9IGwgJiAoMSA8PCBpLmV4dHJhKSAtIDEsIGwgPj4+PSBpLmV4dHJhLCBkIC09IGkuZXh0cmEsIGkuYmFjayArPSBpLmV4dHJhOwoJCQkJCX0KCgkJCQkJaWYgKGkub2Zmc2V0ID4gaS5kbWF4KSB7CgkJCQkJCXQubXNnID0gImludmFsaWQgZGlzdGFuY2UgdG9vIGZhciBiYWNrIiwgaS5tb2RlID0gemU7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCgkJCQkJaS5tb2RlID0gMjU7CgoJCQkJY2FzZSAyNToKCQkJCQlpZiAoMCA9PT0gaCkgYnJlYWsgdDsKCgkJCQkJaWYgKGMgPSBmIC0gaCwgaS5vZmZzZXQgPiBjKSB7CgkJCQkJCWlmIChjID0gaS5vZmZzZXQgLSBjLCBjID4gaS53aGF2ZSAmJiBpLnNhbmUpIHsKCQkJCQkJCXQubXNnID0gImludmFsaWQgZGlzdGFuY2UgdG9vIGZhciBiYWNrIiwgaS5tb2RlID0gemU7CgkJCQkJCQlicmVhazsKCQkJCQkJfQoKCQkJCQkJYyA+IGkud25leHQgPyAoYyAtPSBpLnduZXh0LCB1ID0gaS53c2l6ZSAtIGMpIDogdSA9IGkud25leHQgLSBjLCBjID4gaS5sZW5ndGggJiYgKGMgPSBpLmxlbmd0aCksIHcgPSBpLndpbmRvdzsKCQkJCQl9IGVsc2UgdyA9IHIsIHUgPSBhIC0gaS5vZmZzZXQsIGMgPSBpLmxlbmd0aDsKCgkJCQkJYyA+IGggJiYgKGMgPSBoKSwgaCAtPSBjLCBpLmxlbmd0aCAtPSBjOwoKCQkJCQlkbyB7CgkJCQkJCXJbYSsrXSA9IHdbdSsrXTsKCQkJCQl9IHdoaWxlICgtLWMpOwoKCQkJCQkwID09PSBpLmxlbmd0aCAmJiAoaS5tb2RlID0gMjEpOwoJCQkJCWJyZWFrOwoKCQkJCWNhc2UgMjY6CgkJCQkJaWYgKDAgPT09IGgpIGJyZWFrIHQ7CgkJCQkJclthKytdID0gaS5sZW5ndGgsIGgtLSwgaS5tb2RlID0gMjE7CgkJCQkJYnJlYWs7CgoJCQkJY2FzZSAyNzoKCQkJCQlpZiAoaS53cmFwKSB7CgkJCQkJCWZvciAoOyBkIDwgMzI7KSB7CgkJCQkJCQlpZiAoMCA9PT0gbykgYnJlYWsgdDsKCQkJCQkJCW8tLSwgbCB8PSBuW3MrK10gPDwgZCwgZCArPSA4OwoJCQkJCQl9CgoJCQkJCQlpZiAoZiAtPSBoLCB0LnRvdGFsX291dCArPSBmLCBpLnRvdGFsICs9IGYsIGYgJiYgKHQuYWRsZXIgPSBpLmNoZWNrID0gaS5mbGFncyA/IE0oaS5jaGVjaywgciwgZiwgYSAtIGYpIDogWihpLmNoZWNrLCByLCBmLCBhIC0gZikpLCBmID0gaCwgKGkuZmxhZ3MgPyBsIDogUmUobCkpICE9PSBpLmNoZWNrKSB7CgkJCQkJCQl0Lm1zZyA9ICJpbmNvcnJlY3QgZGF0YSBjaGVjayIsIGkubW9kZSA9IHplOwoJCQkJCQkJYnJlYWs7CgkJCQkJCX0KCgkJCQkJCWwgPSAwLCBkID0gMDsKCQkJCQl9CgoJCQkJCWkubW9kZSA9IDI4OwoKCQkJCWNhc2UgMjg6CgkJCQkJaWYgKGkud3JhcCAmJiBpLmZsYWdzKSB7CgkJCQkJCWZvciAoOyBkIDwgMzI7KSB7CgkJCQkJCQlpZiAoMCA9PT0gbykgYnJlYWsgdDsKCQkJCQkJCW8tLSwgbCArPSBuW3MrK10gPDwgZCwgZCArPSA4OwoJCQkJCQl9CgoJCQkJCQlpZiAobCAhPT0gKDQyOTQ5NjcyOTUgJiBpLnRvdGFsKSkgewoJCQkJCQkJdC5tc2cgPSAiaW5jb3JyZWN0IGxlbmd0aCBjaGVjayIsIGkubW9kZSA9IHplOwoJCQkJCQkJYnJlYWs7CgkJCQkJCX0KCgkJCQkJCWwgPSAwLCBkID0gMDsKCQkJCQl9CgoJCQkJCWkubW9kZSA9IDI5OwoKCQkJCWNhc2UgMjk6CgkJCQkJRSA9IG1lOwoJCQkJCWJyZWFrIHQ7CgoJCQkJY2FzZSB6ZToKCQkJCQlFID0gdmU7CgkJCQkJYnJlYWsgdDsKCgkJCQljYXNlIDMxOgoJCQkJCXJldHVybiBFZTsKCgkJCQlkZWZhdWx0OgoJCQkJCXJldHVybiB5ZTsKCQkJfQoKCQkJcmV0dXJuIHQubmV4dF9vdXQgPSBhLCB0LmF2YWlsX291dCA9IGgsIHQubmV4dF9pbiA9IHMsIHQuYXZhaWxfaW4gPSBvLCBpLmhvbGQgPSBsLCBpLmJpdHMgPSBkLCAoaS53c2l6ZSB8fCBmICE9PSB0LmF2YWlsX291dCAmJiBpLm1vZGUgPCB6ZSAmJiAoaS5tb2RlIDwgMjcgfHwgZSAhPT0gd2UpKSAmJiBaZSh0LCB0Lm91dHB1dCwgdC5uZXh0X291dCwgZiAtIHQuYXZhaWxfb3V0KSwgXyAtPSB0LmF2YWlsX2luLCBmIC09IHQuYXZhaWxfb3V0LCB0LnRvdGFsX2luICs9IF8sIHQudG90YWxfb3V0ICs9IGYsIGkudG90YWwgKz0gZiwgaS53cmFwICYmIGYgJiYgKHQuYWRsZXIgPSBpLmNoZWNrID0gaS5mbGFncyA/IE0oaS5jaGVjaywgciwgZiwgdC5uZXh0X291dCAtIGYpIDogWihpLmNoZWNrLCByLCBmLCB0Lm5leHRfb3V0IC0gZikpLCB0LmRhdGFfdHlwZSA9IGkuYml0cyArIChpLmxhc3QgPyA2NCA6IDApICsgKGkubW9kZSA9PT0gVWUgPyAxMjggOiAwKSArICgyMCA9PT0gaS5tb2RlIHx8IDE1ID09PSBpLm1vZGUgPyAyNTYgOiAwKSwgKDAgPT09IF8gJiYgMCA9PT0gZiB8fCBlID09PSB3ZSkgJiYgRSA9PT0gYmUgJiYgKEUgPSBBZSksIEU7CgkJfSwKCQkJCUhlID0gdCA9PiB7CgkJCWlmICghdCB8fCAhdC5zdGF0ZSkgcmV0dXJuIHllOwoJCQlsZXQgZSA9IHQuc3RhdGU7CgkJCXJldHVybiBlLndpbmRvdyAmJiAoZS53aW5kb3cgPSBudWxsKSwgdC5zdGF0ZSA9IG51bGwsIGJlOwoJCX0sCgkJCQlXZSA9ICh0LCBlKSA9PiB7CgkJCWlmICghdCB8fCAhdC5zdGF0ZSkgcmV0dXJuIHllOwoJCQljb25zdCBpID0gdC5zdGF0ZTsKCQkJcmV0dXJuIDAgPT0gKDIgJiBpLndyYXApID8geWUgOiAoaS5oZWFkID0gZSwgZS5kb25lID0gITEsIGJlKTsKCQl9LAoJCQkJS2UgPSAodCwgZSkgPT4gewoJCQljb25zdCBpID0gZS5sZW5ndGg7CgkJCWxldCBuLCByLCBzOwoJCQlyZXR1cm4gdCAmJiB0LnN0YXRlID8gKG4gPSB0LnN0YXRlLCAwICE9PSBuLndyYXAgJiYgMTEgIT09IG4ubW9kZSA/IHllIDogMTEgPT09IG4ubW9kZSAmJiAociA9IDEsIHIgPSBaKHIsIGUsIGksIDApLCByICE9PSBuLmNoZWNrKSA/IHZlIDogKHMgPSBaZSh0LCBlLCBpLCBpKSwgcyA/IChuLm1vZGUgPSAzMSwgRWUpIDogKG4uaGF2ZWRpY3QgPSAxLCBiZSkpKSA6IHllOwoJCX0sCgkJCQkkZSA9IGZ1bmN0aW9uICRlKCkgewoJCQl0aGlzLnRleHQgPSAwLCB0aGlzLnRpbWUgPSAwLCB0aGlzLnhmbGFncyA9IDAsIHRoaXMub3MgPSAwLCB0aGlzLmV4dHJhID0gbnVsbCwgdGhpcy5leHRyYV9sZW4gPSAwLCB0aGlzLm5hbWUgPSAiIiwgdGhpcy5jb21tZW50ID0gIiIsIHRoaXMuaGNyYyA9IDAsIHRoaXMuZG9uZSA9ICExOwoJCX07CgoJCWNvbnN0IFllID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZywKCQkJCQl7CgkJCVpfTk9fRkxVU0g6IGplLAoJCQlaX0ZJTklTSDogR2UsCgkJCVpfT0s6IFhlLAoJCQlaX1NUUkVBTV9FTkQ6IFZlLAoJCQlaX05FRURfRElDVDogcWUsCgkJCVpfU1RSRUFNX0VSUk9SOiBKZSwKCQkJWl9EQVRBX0VSUk9SOiBRZSwKCQkJWl9NRU1fRVJST1I6IHRpCgkJfSA9IEg7CgoJCWZ1bmN0aW9uIGVpKHQpIHsKCQkJdGhpcy5vcHRpb25zID0gSHQoewoJCQkJY2h1bmtTaXplOiA2NTUzNiwKCQkJCXdpbmRvd0JpdHM6IDE1LAoJCQkJdG86ICIiCgkJCX0sIHQgfHwge30pOwoJCQljb25zdCBlID0gdGhpcy5vcHRpb25zOwoJCQllLnJhdyAmJiBlLndpbmRvd0JpdHMgPj0gMCAmJiBlLndpbmRvd0JpdHMgPCAxNiAmJiAoZS53aW5kb3dCaXRzID0gLWUud2luZG93Qml0cywgMCA9PT0gZS53aW5kb3dCaXRzICYmIChlLndpbmRvd0JpdHMgPSAtMTUpKSwgIShlLndpbmRvd0JpdHMgPj0gMCAmJiBlLndpbmRvd0JpdHMgPCAxNikgfHwgdCAmJiB0LndpbmRvd0JpdHMgfHwgKGUud2luZG93Qml0cyArPSAzMiksIGUud2luZG93Qml0cyA+IDE1ICYmIGUud2luZG93Qml0cyA8IDQ4ICYmIDAgPT0gKDE1ICYgZS53aW5kb3dCaXRzKSAmJiAoZS53aW5kb3dCaXRzIHw9IDE1KSwgdGhpcy5lcnIgPSAwLCB0aGlzLm1zZyA9ICIiLCB0aGlzLmVuZGVkID0gITEsIHRoaXMuY2h1bmtzID0gW10sIHRoaXMuc3RybSA9IG5ldyBYdCgpLCB0aGlzLnN0cm0uYXZhaWxfb3V0ID0gMDsKCQkJbGV0IGkgPSBNZSh0aGlzLnN0cm0sIGUud2luZG93Qml0cyk7CgkJCWlmIChpICE9PSBYZSkgdGhyb3cgbmV3IEVycm9yKFBbaV0pOwoJCQlpZiAodGhpcy5oZWFkZXIgPSBuZXcgJGUoKSwgV2UodGhpcy5zdHJtLCB0aGlzLmhlYWRlciksIGUuZGljdGlvbmFyeSAmJiAoInN0cmluZyIgPT0gdHlwZW9mIGUuZGljdGlvbmFyeSA/IGUuZGljdGlvbmFyeSA9IFl0KGUuZGljdGlvbmFyeSkgOiAiW29iamVjdCBBcnJheUJ1ZmZlcl0iID09PSBZZS5jYWxsKGUuZGljdGlvbmFyeSkgJiYgKGUuZGljdGlvbmFyeSA9IG5ldyBVaW50OEFycmF5KGUuZGljdGlvbmFyeSkpLCBlLnJhdyAmJiAoaSA9IEtlKHRoaXMuc3RybSwgZS5kaWN0aW9uYXJ5KSwgaSAhPT0gWGUpKSkgdGhyb3cgbmV3IEVycm9yKFBbaV0pOwoJCX0KCgkJZnVuY3Rpb24gaWkodCwgZSkgewoJCQljb25zdCBpID0gbmV3IGVpKGUpOwoJCQlpZiAoaS5wdXNoKHQpLCBpLmVycikgdGhyb3cgaS5tc2cgfHwgUFtpLmVycl07CgkJCXJldHVybiBpLnJlc3VsdDsKCQl9CgoJCWVpLnByb3RvdHlwZS5wdXNoID0gZnVuY3Rpb24gKHQsIGUpIHsKCQkJY29uc3QgaSA9IHRoaXMuc3RybSwKCQkJCQkJbiA9IHRoaXMub3B0aW9ucy5jaHVua1NpemUsCgkJCQkJCXIgPSB0aGlzLm9wdGlvbnMuZGljdGlvbmFyeTsKCQkJbGV0IHMsIGEsIG87CgkJCWlmICh0aGlzLmVuZGVkKSByZXR1cm4gITE7CgoJCQlmb3IgKGEgPSBlID09PSB+fmUgPyBlIDogITAgPT09IGUgPyBHZSA6IGplLCAiW29iamVjdCBBcnJheUJ1ZmZlcl0iID09PSBZZS5jYWxsKHQpID8gaS5pbnB1dCA9IG5ldyBVaW50OEFycmF5KHQpIDogaS5pbnB1dCA9IHQsIGkubmV4dF9pbiA9IDAsIGkuYXZhaWxfaW4gPSBpLmlucHV0Lmxlbmd0aDs7KSB7CgkJCQlmb3IgKDAgPT09IGkuYXZhaWxfb3V0ICYmIChpLm91dHB1dCA9IG5ldyBVaW50OEFycmF5KG4pLCBpLm5leHRfb3V0ID0gMCwgaS5hdmFpbF9vdXQgPSBuKSwgcyA9IFBlKGksIGEpLCBzID09PSBxZSAmJiByICYmIChzID0gS2UoaSwgciksIHMgPT09IFhlID8gcyA9IFBlKGksIGEpIDogcyA9PT0gUWUgJiYgKHMgPSBxZSkpOyBpLmF2YWlsX2luID4gMCAmJiBzID09PSBWZSAmJiBpLnN0YXRlLndyYXAgPiAwICYmIDAgIT09IHRbaS5uZXh0X2luXTspIEZlKGkpLCBzID0gUGUoaSwgYSk7CgoJCQkJc3dpdGNoIChzKSB7CgkJCQkJY2FzZSBKZToKCQkJCQljYXNlIFFlOgoJCQkJCWNhc2UgcWU6CgkJCQkJY2FzZSB0aToKCQkJCQkJcmV0dXJuIHRoaXMub25FbmQocyksIHRoaXMuZW5kZWQgPSAhMCwgITE7CgkJCQl9CgoJCQkJaWYgKG8gPSBpLmF2YWlsX291dCwgaS5uZXh0X291dCAmJiAoMCA9PT0gaS5hdmFpbF9vdXQgfHwgcyA9PT0gVmUpKSBpZiAoInN0cmluZyIgPT09IHRoaXMub3B0aW9ucy50bykgewoJCQkJCWxldCB0ID0gR3QoaS5vdXRwdXQsIGkubmV4dF9vdXQpLAoJCQkJCQkJZSA9IGkubmV4dF9vdXQgLSB0LAoJCQkJCQkJciA9IGp0KGkub3V0cHV0LCB0KTsKCQkJCQlpLm5leHRfb3V0ID0gZSwgaS5hdmFpbF9vdXQgPSBuIC0gZSwgZSAmJiBpLm91dHB1dC5zZXQoaS5vdXRwdXQuc3ViYXJyYXkodCwgdCArIGUpLCAwKSwgdGhpcy5vbkRhdGEocik7CgkJCQl9IGVsc2UgdGhpcy5vbkRhdGEoaS5vdXRwdXQubGVuZ3RoID09PSBpLm5leHRfb3V0ID8gaS5vdXRwdXQgOiBpLm91dHB1dC5zdWJhcnJheSgwLCBpLm5leHRfb3V0KSk7CgoJCQkJaWYgKHMgIT09IFhlIHx8IDAgIT09IG8pIHsKCQkJCQlpZiAocyA9PT0gVmUpIHJldHVybiBzID0gSGUodGhpcy5zdHJtKSwgdGhpcy5vbkVuZChzKSwgdGhpcy5lbmRlZCA9ICEwLCAhMDsKCQkJCQlpZiAoMCA9PT0gaS5hdmFpbF9pbikgYnJlYWs7CgkJCQl9CgkJCX0KCgkJCXJldHVybiAhMDsKCQl9LCBlaS5wcm90b3R5cGUub25EYXRhID0gZnVuY3Rpb24gKHQpIHsKCQkJdGhpcy5jaHVua3MucHVzaCh0KTsKCQl9LCBlaS5wcm90b3R5cGUub25FbmQgPSBmdW5jdGlvbiAodCkgewoJCQl0ID09PSBYZSAmJiAoInN0cmluZyIgPT09IHRoaXMub3B0aW9ucy50byA/IHRoaXMucmVzdWx0ID0gdGhpcy5jaHVua3Muam9pbigiIikgOiB0aGlzLnJlc3VsdCA9IFd0KHRoaXMuY2h1bmtzKSksIHRoaXMuY2h1bmtzID0gW10sIHRoaXMuZXJyID0gdCwgdGhpcy5tc2cgPSB0aGlzLnN0cm0ubXNnOwoJCX07CgkJdmFyIG5pID0gewoJCQlJbmZsYXRlOiBlaSwKCQkJaW5mbGF0ZTogaWksCgkJCWluZmxhdGVSYXc6IGZ1bmN0aW9uIGluZmxhdGVSYXcodCwgZSkgewoJCQkJcmV0dXJuIChlID0gZSB8fCB7fSkucmF3ID0gITAsIGlpKHQsIGUpOwoJCQl9LAoJCQl1bmd6aXA6IGlpLAoJCQljb25zdGFudHM6IEgKCQl9OwoJCWNvbnN0IHsKCQkJRGVmbGF0ZTogcmksCgkJCWRlZmxhdGU6IHNpLAoJCQlkZWZsYXRlUmF3OiBhaSwKCQkJZ3ppcDogb2kKCQl9ID0gaGUsCgkJCQkJewoJCQlJbmZsYXRlOiBoaSwKCQkJaW5mbGF0ZTogbGksCgkJCWluZmxhdGVSYXc6IGRpLAoJCQl1bmd6aXA6IF9pCgkJfSA9IG5pOwoJCXZhciBmaSA9IHNpLAoJCQkJY2kgPSBoaSwKCQkJCXVpID0gbGk7CgkJY29uc3Qgd2kgPSBbMTM3LCA4MCwgNzgsIDcxLCAxMywgMTAsIDI2LCAxMF0sCgkJCQkJcGkgPSBbXTsKCgkJZm9yIChsZXQgdCA9IDA7IHQgPCAyNTY7IHQrKykgewoJCQlsZXQgZSA9IHQ7CgoJCQlmb3IgKGxldCB0ID0gMDsgdCA8IDg7IHQrKykgMSAmIGUgPyBlID0gMzk4ODI5MjM4NCBeIGUgPj4+IDEgOiBlID4+Pj0gMTsKCgkJCXBpW3RdID0gZTsKCQl9CgoJCWNvbnN0IGdpID0gNDI5NDk2NzI5NTsKCgkJZnVuY3Rpb24gYmkodCwgZSkgewoJCQlyZXR1cm4gKGZ1bmN0aW9uICh0LCBlLCBpKSB7CgkJCQlsZXQgbiA9IDQyOTQ5NjcyOTU7CgoJCQkJZm9yIChsZXQgdCA9IDA7IHQgPCBpOyB0KyspIG4gPSBwaVsyNTUgJiAobiBeIGVbdF0pXSBeIG4gPj4+IDg7CgoJCQkJcmV0dXJuIG47CgkJCX0oMCwgdCwgZSkgXiBnaSkgPj4+IDA7CgkJfQoKCQl2YXIgbWksIGtpLCB5aSwgdmk7CgkJIWZ1bmN0aW9uICh0KSB7CgkJCXRbdC5VTktOT1dOID0gLTFdID0gIlVOS05PV04iLCB0W3QuR1JFWVNDQUxFID0gMF0gPSAiR1JFWVNDQUxFIiwgdFt0LlRSVUVDT0xPVVIgPSAyXSA9ICJUUlVFQ09MT1VSIiwgdFt0LklOREVYRURfQ09MT1VSID0gM10gPSAiSU5ERVhFRF9DT0xPVVIiLCB0W3QuR1JFWVNDQUxFX0FMUEhBID0gNF0gPSAiR1JFWVNDQUxFX0FMUEhBIiwgdFt0LlRSVUVDT0xPVVJfQUxQSEEgPSA2XSA9ICJUUlVFQ09MT1VSX0FMUEhBIjsKCQl9KG1pIHx8IChtaSA9IHt9KSksIGZ1bmN0aW9uICh0KSB7CgkJCXRbdC5VTktOT1dOID0gLTFdID0gIlVOS05PV04iLCB0W3QuREVGTEFURSA9IDBdID0gIkRFRkxBVEUiOwoJCX0oa2kgfHwgKGtpID0ge30pKSwgZnVuY3Rpb24gKHQpIHsKCQkJdFt0LlVOS05PV04gPSAtMV0gPSAiVU5LTk9XTiIsIHRbdC5BREFQVElWRSA9IDBdID0gIkFEQVBUSVZFIjsKCQl9KHlpIHx8ICh5aSA9IHt9KSksIGZ1bmN0aW9uICh0KSB7CgkJCXRbdC5VTktOT1dOID0gLTFdID0gIlVOS05PV04iLCB0W3QuTk9fSU5URVJMQUNFID0gMF0gPSAiTk9fSU5URVJMQUNFIiwgdFt0LkFEQU03ID0gMV0gPSAiQURBTTciOwoJCX0odmkgfHwgKHZpID0ge30pKTsKCQljb25zdCBFaSA9IG5ldyBVaW50OEFycmF5KDApLAoJCQkJCUFpID0gbmV3IFVpbnQxNkFycmF5KFsyNTVdKSwKCQkJCQl4aSA9IDI1NSA9PT0gbmV3IFVpbnQ4QXJyYXkoQWkuYnVmZmVyKVswXTsKCgkJY2xhc3MgVWkgZXh0ZW5kcyByIHsKCQkJY29uc3RydWN0b3IodCkgewoJCQkJbGV0IGUgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHt9OwoJCQkJc3VwZXIodCk7CgkJCQljb25zdCB7CgkJCQkJY2hlY2tDcmM6IGkgPSAhMQoJCQkJfSA9IGU7CgkJCQl0aGlzLl9jaGVja0NyYyA9IGksIHRoaXMuX2luZmxhdG9yID0gbmV3IGNpKCksIHRoaXMuX3BuZyA9IHsKCQkJCQl3aWR0aDogLTEsCgkJCQkJaGVpZ2h0OiAtMSwKCQkJCQljaGFubmVsczogLTEsCgkJCQkJZGF0YTogbmV3IFVpbnQ4QXJyYXkoMCksCgkJCQkJZGVwdGg6IDEsCgkJCQkJdGV4dDoge30KCQkJCX0sIHRoaXMuX2VuZCA9ICExLCB0aGlzLl9oYXNQYWxldHRlID0gITEsIHRoaXMuX3BhbGV0dGUgPSBbXSwgdGhpcy5fY29tcHJlc3Npb25NZXRob2QgPSBraS5VTktOT1dOLCB0aGlzLl9maWx0ZXJNZXRob2QgPSB5aS5VTktOT1dOLCB0aGlzLl9pbnRlcmxhY2VNZXRob2QgPSB2aS5VTktOT1dOLCB0aGlzLl9jb2xvclR5cGUgPSAtMSwgdGhpcy5zZXRCaWdFbmRpYW4oKTsKCQkJfQoKCQkJZGVjb2RlKCkgewoJCQkJZm9yICh0aGlzLmRlY29kZVNpZ25hdHVyZSgpOyAhdGhpcy5fZW5kOykgdGhpcy5kZWNvZGVDaHVuaygpOwoKCQkJCXJldHVybiB0aGlzLmRlY29kZUltYWdlKCksIHRoaXMuX3BuZzsKCQkJfQoKCQkJZGVjb2RlU2lnbmF0dXJlKCkgewoJCQkJZm9yIChsZXQgdCA9IDA7IHQgPCB3aS5sZW5ndGg7IHQrKykgaWYgKHRoaXMucmVhZFVpbnQ4KCkgIT09IHdpW3RdKSB0aHJvdyBuZXcgRXJyb3IoIndyb25nIFBORyBzaWduYXR1cmUuIEJ5dGUgYXQgIi5jb25jYXQodCwgIiBzaG91bGQgYmUgIikuY29uY2F0KHdpW3RdLCAiLiIpKTsKCQkJfQoKCQkJZGVjb2RlQ2h1bmsoKSB7CgkJCQljb25zdCB0ID0gdGhpcy5yZWFkVWludDMyKCksCgkJCQkJCQllID0gdGhpcy5yZWFkQ2hhcnMoNCksCgkJCQkJCQlpID0gdGhpcy5vZmZzZXQ7CgoJCQkJc3dpdGNoIChlKSB7CgkJCQkJY2FzZSAiSUhEUiI6CgkJCQkJCXRoaXMuZGVjb2RlSUhEUigpOwoJCQkJCQlicmVhazsKCgkJCQkJY2FzZSAiUExURSI6CgkJCQkJCXRoaXMuZGVjb2RlUExURSh0KTsKCQkJCQkJYnJlYWs7CgoJCQkJCWNhc2UgIklEQVQiOgoJCQkJCQl0aGlzLmRlY29kZUlEQVQodCk7CgkJCQkJCWJyZWFrOwoKCQkJCQljYXNlICJJRU5EIjoKCQkJCQkJdGhpcy5fZW5kID0gITA7CgkJCQkJCWJyZWFrOwoKCQkJCQljYXNlICJ0Uk5TIjoKCQkJCQkJdGhpcy5kZWNvZGV0Uk5TKHQpOwoJCQkJCQlicmVhazsKCgkJCQkJY2FzZSAiaUNDUCI6CgkJCQkJCXRoaXMuZGVjb2RlaUNDUCh0KTsKCQkJCQkJYnJlYWs7CgoJCQkJCWNhc2UgInRFWHQiOgoJCQkJCQl0aGlzLmRlY29kZXRFWHQodCk7CgkJCQkJCWJyZWFrOwoKCQkJCQljYXNlICJwSFlzIjoKCQkJCQkJdGhpcy5kZWNvZGVwSFlzKCk7CgkJCQkJCWJyZWFrOwoKCQkJCQlkZWZhdWx0OgoJCQkJCQl0aGlzLnNraXAodCk7CgkJCQl9CgoJCQkJaWYgKHRoaXMub2Zmc2V0IC0gaSAhPT0gdCkgdGhyb3cgbmV3IEVycm9yKCJMZW5ndGggbWlzbWF0Y2ggd2hpbGUgZGVjb2RpbmcgY2h1bmsgIi5jb25jYXQoZSkpOwoKCQkJCWlmICh0aGlzLl9jaGVja0NyYykgewoJCQkJCWNvbnN0IGkgPSB0aGlzLnJlYWRVaW50MzIoKSwKCQkJCQkJCQluID0gdCArIDQsCgkJCQkJCQkJciA9IGJpKG5ldyBVaW50OEFycmF5KHRoaXMuYnVmZmVyLCB0aGlzLmJ5dGVPZmZzZXQgKyB0aGlzLm9mZnNldCAtIG4gLSA0LCBuKSwgbik7CgkJCQkJaWYgKHIgIT09IGkpIHRocm93IG5ldyBFcnJvcigiQ1JDIG1pc21hdGNoIGZvciBjaHVuayAiLmNvbmNhdChlLCAiLiBFeHBlY3RlZCAiKS5jb25jYXQoaSwgIiwgZm91bmQgIikuY29uY2F0KHIpKTsKCQkJCX0gZWxzZSB0aGlzLnNraXAoNCk7CgkJCX0KCgkJCWRlY29kZUlIRFIoKSB7CgkJCQljb25zdCB0ID0gdGhpcy5fcG5nOwoJCQkJdC53aWR0aCA9IHRoaXMucmVhZFVpbnQzMigpLCB0LmhlaWdodCA9IHRoaXMucmVhZFVpbnQzMigpLCB0LmRlcHRoID0gZnVuY3Rpb24gKHQpIHsKCQkJCQlpZiAoMSAhPT0gdCAmJiAyICE9PSB0ICYmIDQgIT09IHQgJiYgOCAhPT0gdCAmJiAxNiAhPT0gdCkgdGhyb3cgbmV3IEVycm9yKCJpbnZhbGlkIGJpdCBkZXB0aDogIi5jb25jYXQodCkpOwoJCQkJCXJldHVybiB0OwoJCQkJfSh0aGlzLnJlYWRVaW50OCgpKTsKCQkJCWNvbnN0IGUgPSB0aGlzLnJlYWRVaW50OCgpOwoJCQkJbGV0IGk7CgoJCQkJc3dpdGNoICh0aGlzLl9jb2xvclR5cGUgPSBlLCBlKSB7CgkJCQkJY2FzZSBtaS5HUkVZU0NBTEU6CgkJCQkJCWkgPSAxOwoJCQkJCQlicmVhazsKCgkJCQkJY2FzZSBtaS5UUlVFQ09MT1VSOgoJCQkJCQlpID0gMzsKCQkJCQkJYnJlYWs7CgoJCQkJCWNhc2UgbWkuSU5ERVhFRF9DT0xPVVI6CgkJCQkJCWkgPSAxOwoJCQkJCQlicmVhazsKCgkJCQkJY2FzZSBtaS5HUkVZU0NBTEVfQUxQSEE6CgkJCQkJCWkgPSAyOwoJCQkJCQlicmVhazsKCgkJCQkJY2FzZSBtaS5UUlVFQ09MT1VSX0FMUEhBOgoJCQkJCQlpID0gNDsKCQkJCQkJYnJlYWs7CgoJCQkJCWRlZmF1bHQ6CgkJCQkJCXRocm93IG5ldyBFcnJvcigiVW5rbm93biBjb2xvciB0eXBlOiAiLmNvbmNhdChlKSk7CgkJCQl9CgoJCQkJaWYgKHRoaXMuX3BuZy5jaGFubmVscyA9IGksIHRoaXMuX2NvbXByZXNzaW9uTWV0aG9kID0gdGhpcy5yZWFkVWludDgoKSwgdGhpcy5fY29tcHJlc3Npb25NZXRob2QgIT09IGtpLkRFRkxBVEUpIHRocm93IG5ldyBFcnJvcigiVW5zdXBwb3J0ZWQgY29tcHJlc3Npb24gbWV0aG9kOiAiLmNvbmNhdCh0aGlzLl9jb21wcmVzc2lvbk1ldGhvZCkpOwoJCQkJdGhpcy5fZmlsdGVyTWV0aG9kID0gdGhpcy5yZWFkVWludDgoKSwgdGhpcy5faW50ZXJsYWNlTWV0aG9kID0gdGhpcy5yZWFkVWludDgoKTsKCQkJfQoKCQkJZGVjb2RlUExURSh0KSB7CgkJCQlpZiAodCAlIDMgIT0gMCkgdGhyb3cgbmV3IFJhbmdlRXJyb3IoIlBMVEUgZmllbGQgbGVuZ3RoIG11c3QgYmUgYSBtdWx0aXBsZSBvZiAzLiBHb3QgIi5jb25jYXQodCkpOwoJCQkJY29uc3QgZSA9IHQgLyAzOwoJCQkJdGhpcy5faGFzUGFsZXR0ZSA9ICEwOwoJCQkJY29uc3QgaSA9IFtdOwoJCQkJdGhpcy5fcGFsZXR0ZSA9IGk7CgoJCQkJZm9yIChsZXQgdCA9IDA7IHQgPCBlOyB0KyspIGkucHVzaChbdGhpcy5yZWFkVWludDgoKSwgdGhpcy5yZWFkVWludDgoKSwgdGhpcy5yZWFkVWludDgoKV0pOwoJCQl9CgoJCQlkZWNvZGVJREFUKHQpIHsKCQkJCXRoaXMuX2luZmxhdG9yLnB1c2gobmV3IFVpbnQ4QXJyYXkodGhpcy5idWZmZXIsIHRoaXMub2Zmc2V0ICsgdGhpcy5ieXRlT2Zmc2V0LCB0KSksIHRoaXMuc2tpcCh0KTsKCQkJfQoKCQkJZGVjb2RldFJOUyh0KSB7CgkJCQlpZiAoMyA9PT0gdGhpcy5fY29sb3JUeXBlKSB7CgkJCQkJaWYgKHQgPiB0aGlzLl9wYWxldHRlLmxlbmd0aCkgdGhyb3cgbmV3IEVycm9yKCJ0Uk5TIGNodW5rIGNvbnRhaW5zIG1vcmUgYWxwaGEgdmFsdWVzIHRoYW4gdGhlcmUgYXJlIHBhbGV0dGUgY29sb3JzICgiLmNvbmNhdCh0LCAiIHZzICIpLmNvbmNhdCh0aGlzLl9wYWxldHRlLmxlbmd0aCwgIikiKSk7CgkJCQkJbGV0IGUgPSAwOwoKCQkJCQlmb3IgKDsgZSA8IHQ7IGUrKykgewoJCQkJCQljb25zdCB0ID0gdGhpcy5yZWFkQnl0ZSgpOwoKCQkJCQkJdGhpcy5fcGFsZXR0ZVtlXS5wdXNoKHQpOwoJCQkJCX0KCgkJCQkJZm9yICg7IGUgPCB0aGlzLl9wYWxldHRlLmxlbmd0aDsgZSsrKSB0aGlzLl9wYWxldHRlW2VdLnB1c2goMjU1KTsKCQkJCX0KCQkJfQoKCQkJZGVjb2RlaUNDUCh0KSB7CgkJCQlsZXQgZSwKCQkJCQkJaSA9ICIiOwoKCQkJCWZvciAoOyAiXDAiICE9PSAoZSA9IHRoaXMucmVhZENoYXIoKSk7KSBpICs9IGU7CgoJCQkJY29uc3QgbiA9IHRoaXMucmVhZFVpbnQ4KCk7CgkJCQlpZiAobiAhPT0ga2kuREVGTEFURSkgdGhyb3cgbmV3IEVycm9yKCJVbnN1cHBvcnRlZCBpQ0NQIGNvbXByZXNzaW9uIG1ldGhvZDogIi5jb25jYXQobikpOwoJCQkJY29uc3QgciA9IHRoaXMucmVhZEJ5dGVzKHQgLSBpLmxlbmd0aCAtIDIpOwoJCQkJdGhpcy5fcG5nLmljY0VtYmVkZGVkUHJvZmlsZSA9IHsKCQkJCQluYW1lOiBpLAoJCQkJCXByb2ZpbGU6IHVpKHIpCgkJCQl9OwoJCQl9CgoJCQlkZWNvZGV0RVh0KHQpIHsKCQkJCWxldCBlLAoJCQkJCQlpID0gIiI7CgoJCQkJZm9yICg7ICJcMCIgIT09IChlID0gdGhpcy5yZWFkQ2hhcigpKTspIGkgKz0gZTsKCgkJCQl0aGlzLl9wbmcudGV4dFtpXSA9IHRoaXMucmVhZENoYXJzKHQgLSBpLmxlbmd0aCAtIDEpOwoJCQl9CgoJCQlkZWNvZGVwSFlzKCkgewoJCQkJY29uc3QgdCA9IHRoaXMucmVhZFVpbnQzMigpLAoJCQkJCQkJZSA9IHRoaXMucmVhZFVpbnQzMigpLAoJCQkJCQkJaSA9IHRoaXMucmVhZEJ5dGUoKTsKCQkJCXRoaXMuX3BuZy5yZXNvbHV0aW9uID0gewoJCQkJCXg6IHQsCgkJCQkJeTogZSwKCQkJCQl1bml0OiBpCgkJCQl9OwoJCQl9CgoJCQlkZWNvZGVJbWFnZSgpIHsKCQkJCWlmICh0aGlzLl9pbmZsYXRvci5lcnIpIHRocm93IG5ldyBFcnJvcigiRXJyb3Igd2hpbGUgZGVjb21wcmVzc2luZyB0aGUgZGF0YTogIi5jb25jYXQodGhpcy5faW5mbGF0b3IuZXJyKSk7CgkJCQljb25zdCB0ID0gdGhpcy5faW5mbGF0b3IucmVzdWx0OwoJCQkJaWYgKHRoaXMuX2ZpbHRlck1ldGhvZCAhPT0geWkuQURBUFRJVkUpIHRocm93IG5ldyBFcnJvcigiRmlsdGVyIG1ldGhvZCAiLmNvbmNhdCh0aGlzLl9maWx0ZXJNZXRob2QsICIgbm90IHN1cHBvcnRlZCIpKTsKCQkJCWlmICh0aGlzLl9pbnRlcmxhY2VNZXRob2QgIT09IHZpLk5PX0lOVEVSTEFDRSkgdGhyb3cgbmV3IEVycm9yKCJJbnRlcmxhY2UgbWV0aG9kICIuY29uY2F0KHRoaXMuX2ludGVybGFjZU1ldGhvZCwgIiBub3Qgc3VwcG9ydGVkIikpOwoJCQkJdGhpcy5kZWNvZGVJbnRlcmxhY2VOdWxsKHQpOwoJCQl9CgoJCQlkZWNvZGVJbnRlcmxhY2VOdWxsKHQpIHsKCQkJCWNvbnN0IGUgPSB0aGlzLl9wbmcuaGVpZ2h0LAoJCQkJCQkJaSA9IHRoaXMuX3BuZy5jaGFubmVscyAqIHRoaXMuX3BuZy5kZXB0aCAvIDgsCgkJCQkJCQluID0gdGhpcy5fcG5nLndpZHRoICogaSwKCQkJCQkJCXIgPSBuZXcgVWludDhBcnJheSh0aGlzLl9wbmcuaGVpZ2h0ICogbik7CgkJCQlsZXQgcywKCQkJCQkJYSwKCQkJCQkJbyA9IEVpLAoJCQkJCQloID0gMDsKCgkJCQlmb3IgKGxldCBsID0gMDsgbCA8IGU7IGwrKykgewoJCQkJCXN3aXRjaCAocyA9IHQuc3ViYXJyYXkoaCArIDEsIGggKyAxICsgbiksIGEgPSByLnN1YmFycmF5KGwgKiBuLCAobCArIDEpICogbiksIHRbaF0pIHsKCQkJCQkJY2FzZSAwOgoJCQkJCQkJemkocywgYSwgbik7CgkJCQkJCQlicmVhazsKCgkJCQkJCWNhc2UgMToKCQkJCQkJCVJpKHMsIGEsIG4sIGkpOwoJCQkJCQkJYnJlYWs7CgoJCQkJCQljYXNlIDI6CgkJCQkJCQlOaShzLCBhLCBvLCBuKTsKCQkJCQkJCWJyZWFrOwoKCQkJCQkJY2FzZSAzOgoJCQkJCQkJVGkocywgYSwgbywgbiwgaSk7CgkJCQkJCQlicmVhazsKCgkJCQkJCWNhc2UgNDoKCQkJCQkJCU9pKHMsIGEsIG8sIG4sIGkpOwoJCQkJCQkJYnJlYWs7CgoJCQkJCQlkZWZhdWx0OgoJCQkJCQkJdGhyb3cgbmV3IEVycm9yKCJVbnN1cHBvcnRlZCBmaWx0ZXI6ICIuY29uY2F0KHRbaF0pKTsKCQkJCQl9CgoJCQkJCW8gPSBhLCBoICs9IG4gKyAxOwoJCQkJfQoKCQkJCWlmICh0aGlzLl9oYXNQYWxldHRlICYmICh0aGlzLl9wbmcucGFsZXR0ZSA9IHRoaXMuX3BhbGV0dGUpLCAxNiA9PT0gdGhpcy5fcG5nLmRlcHRoKSB7CgkJCQkJY29uc3QgdCA9IG5ldyBVaW50MTZBcnJheShyLmJ1ZmZlcik7CgkJCQkJaWYgKHhpKSBmb3IgKGxldCBlID0gMDsgZSA8IHQubGVuZ3RoOyBlKyspIHRbZV0gPSAoMjU1ICYgKGwgPSB0W2VdKSkgPDwgOCB8IGwgPj4gOCAmIDI1NTsKCQkJCQl0aGlzLl9wbmcuZGF0YSA9IHQ7CgkJCQl9IGVsc2UgdGhpcy5fcG5nLmRhdGEgPSByOwoKCQkJCXZhciBsOwoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gemkodCwgZSwgaSkgewoJCQlmb3IgKGxldCBuID0gMDsgbiA8IGk7IG4rKykgZVtuXSA9IHRbbl07CgkJfQoKCQlmdW5jdGlvbiBSaSh0LCBlLCBpLCBuKSB7CgkJCWxldCByID0gMDsKCgkJCWZvciAoOyByIDwgbjsgcisrKSBlW3JdID0gdFtyXTsKCgkJCWZvciAoOyByIDwgaTsgcisrKSBlW3JdID0gdFtyXSArIGVbciAtIG5dICYgMjU1OwoJCX0KCgkJZnVuY3Rpb24gTmkodCwgZSwgaSwgbikgewoJCQlsZXQgciA9IDA7CgkJCWlmICgwID09PSBpLmxlbmd0aCkgZm9yICg7IHIgPCBuOyByKyspIGVbcl0gPSB0W3JdO2Vsc2UgZm9yICg7IHIgPCBuOyByKyspIGVbcl0gPSB0W3JdICsgaVtyXSAmIDI1NTsKCQl9CgoJCWZ1bmN0aW9uIFRpKHQsIGUsIGksIG4sIHIpIHsKCQkJbGV0IHMgPSAwOwoKCQkJaWYgKDAgPT09IGkubGVuZ3RoKSB7CgkJCQlmb3IgKDsgcyA8IHI7IHMrKykgZVtzXSA9IHRbc107CgoJCQkJZm9yICg7IHMgPCBuOyBzKyspIGVbc10gPSB0W3NdICsgKGVbcyAtIHJdID4+IDEpICYgMjU1OwoJCQl9IGVsc2UgewoJCQkJZm9yICg7IHMgPCByOyBzKyspIGVbc10gPSB0W3NdICsgKGlbc10gPj4gMSkgJiAyNTU7CgoJCQkJZm9yICg7IHMgPCBuOyBzKyspIGVbc10gPSB0W3NdICsgKGVbcyAtIHJdICsgaVtzXSA+PiAxKSAmIDI1NTsKCQkJfQoJCX0KCgkJZnVuY3Rpb24gT2kodCwgZSwgaSwgbiwgcikgewoJCQlsZXQgcyA9IDA7CgoJCQlpZiAoMCA9PT0gaS5sZW5ndGgpIHsKCQkJCWZvciAoOyBzIDwgcjsgcysrKSBlW3NdID0gdFtzXTsKCgkJCQlmb3IgKDsgcyA8IG47IHMrKykgZVtzXSA9IHRbc10gKyBlW3MgLSByXSAmIDI1NTsKCQkJfSBlbHNlIHsKCQkJCWZvciAoOyBzIDwgcjsgcysrKSBlW3NdID0gdFtzXSArIGlbc10gJiAyNTU7CgoJCQkJZm9yICg7IHMgPCBuOyBzKyspIGVbc10gPSB0W3NdICsgTGkoZVtzIC0gcl0sIGlbc10sIGlbcyAtIHJdKSAmIDI1NTsKCQkJfQoJCX0KCgkJZnVuY3Rpb24gTGkodCwgZSwgaSkgewoJCQljb25zdCBuID0gdCArIGUgLSBpLAoJCQkJCQlyID0gTWF0aC5hYnMobiAtIHQpLAoJCQkJCQlzID0gTWF0aC5hYnMobiAtIGUpLAoJCQkJCQlhID0gTWF0aC5hYnMobiAtIGkpOwoJCQlyZXR1cm4gciA8PSBzICYmIHIgPD0gYSA/IHQgOiBzIDw9IGEgPyBlIDogaTsKCQl9CgoJCWNvbnN0IEJpID0gewoJCQlsZXZlbDogMwoJCX07CgoJCWNsYXNzIENpIGV4dGVuZHMgciB7CgkJCWNvbnN0cnVjdG9yKHQpIHsKCQkJCWxldCBlID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiB7fTsKCQkJCXN1cGVyKCksIHRoaXMuX2NvbG9yVHlwZSA9IG1pLlVOS05PV04sIHRoaXMuX3psaWJPcHRpb25zID0gX29iamVjdFNwcmVhZDIoX29iamVjdFNwcmVhZDIoe30sIEJpKSwgZS56bGliKSwgdGhpcy5fcG5nID0gdGhpcy5fY2hlY2tEYXRhKHQpLCB0aGlzLnNldEJpZ0VuZGlhbigpOwoJCQl9CgoJCQllbmNvZGUoKSB7CgkJCQlyZXR1cm4gdGhpcy5lbmNvZGVTaWduYXR1cmUoKSwgdGhpcy5lbmNvZGVJSERSKCksIHRoaXMuZW5jb2RlRGF0YSgpLCB0aGlzLmVuY29kZUlFTkQoKSwgdGhpcy50b0FycmF5KCk7CgkJCX0KCgkJCWVuY29kZVNpZ25hdHVyZSgpIHsKCQkJCXRoaXMud3JpdGVCeXRlcyh3aSk7CgkJCX0KCgkJCWVuY29kZUlIRFIoKSB7CgkJCQl0aGlzLndyaXRlVWludDMyKDEzKSwgdGhpcy53cml0ZUNoYXJzKCJJSERSIiksIHRoaXMud3JpdGVVaW50MzIodGhpcy5fcG5nLndpZHRoKSwgdGhpcy53cml0ZVVpbnQzMih0aGlzLl9wbmcuaGVpZ2h0KSwgdGhpcy53cml0ZUJ5dGUodGhpcy5fcG5nLmRlcHRoKSwgdGhpcy53cml0ZUJ5dGUodGhpcy5fY29sb3JUeXBlKSwgdGhpcy53cml0ZUJ5dGUoa2kuREVGTEFURSksIHRoaXMud3JpdGVCeXRlKHlpLkFEQVBUSVZFKSwgdGhpcy53cml0ZUJ5dGUodmkuTk9fSU5URVJMQUNFKSwgdGhpcy53cml0ZUNyYygxNyk7CgkJCX0KCgkJCWVuY29kZUlFTkQoKSB7CgkJCQl0aGlzLndyaXRlVWludDMyKDApLCB0aGlzLndyaXRlQ2hhcnMoIklFTkQiKSwgdGhpcy53cml0ZUNyYyg0KTsKCQkJfQoKCQkJZW5jb2RlSURBVCh0KSB7CgkJCQl0aGlzLndyaXRlVWludDMyKHQubGVuZ3RoKSwgdGhpcy53cml0ZUNoYXJzKCJJREFUIiksIHRoaXMud3JpdGVCeXRlcyh0KSwgdGhpcy53cml0ZUNyYyh0Lmxlbmd0aCArIDQpOwoJCQl9CgoJCQllbmNvZGVEYXRhKCkgewoJCQkJY29uc3QgewoJCQkJCXdpZHRoOiB0LAoJCQkJCWhlaWdodDogZSwKCQkJCQljaGFubmVsczogaSwKCQkJCQlkZXB0aDogbiwKCQkJCQlkYXRhOiBzCgkJCQl9ID0gdGhpcy5fcG5nLAoJCQkJCQkJYSA9IGkgKiB0LAoJCQkJCQkJbyA9IG5ldyByKCkuc2V0QmlnRW5kaWFuKCk7CgkJCQlsZXQgaCA9IDA7CgoJCQkJZm9yIChsZXQgdCA9IDA7IHQgPCBlOyB0KyspIGlmIChvLndyaXRlQnl0ZSgwKSwgOCA9PT0gbikgaCA9IElpKHMsIG8sIGEsIGgpO2Vsc2UgewoJCQkJCWlmICgxNiAhPT0gbikgdGhyb3cgbmV3IEVycm9yKCJ1bnJlYWNoYWJsZSIpOwoJCQkJCWggPSBTaShzLCBvLCBhLCBoKTsKCQkJCX0KCgkJCQljb25zdCBsID0gby50b0FycmF5KCksCgkJCQkJCQlkID0gZmkobCwgdGhpcy5femxpYk9wdGlvbnMpOwoJCQkJdGhpcy5lbmNvZGVJREFUKGQpOwoJCQl9CgoJCQlfY2hlY2tEYXRhKHQpIHsKCQkJCWNvbnN0IHsKCQkJCQljb2xvclR5cGU6IGUsCgkJCQkJY2hhbm5lbHM6IGksCgkJCQkJZGVwdGg6IG4KCQkJCX0gPSBmdW5jdGlvbiAodCkgewoJCQkJCWNvbnN0IHsKCQkJCQkJY2hhbm5lbHM6IGUgPSA0LAoJCQkJCQlkZXB0aDogaSA9IDgKCQkJCQl9ID0gdDsKCQkJCQlpZiAoNCAhPT0gZSAmJiAzICE9PSBlICYmIDIgIT09IGUgJiYgMSAhPT0gZSkgdGhyb3cgbmV3IFJhbmdlRXJyb3IoInVuc3VwcG9ydGVkIG51bWJlciBvZiBjaGFubmVsczogIi5jb25jYXQoZSkpOwoJCQkJCWlmICg4ICE9PSBpICYmIDE2ICE9PSBpKSB0aHJvdyBuZXcgUmFuZ2VFcnJvcigidW5zdXBwb3J0ZWQgYml0IGRlcHRoOiAiLmNvbmNhdChpKSk7CgkJCQkJY29uc3QgbiA9IHsKCQkJCQkJY2hhbm5lbHM6IGUsCgkJCQkJCWRlcHRoOiBpLAoJCQkJCQljb2xvclR5cGU6IG1pLlVOS05PV04KCQkJCQl9OwoKCQkJCQlzd2l0Y2ggKGUpIHsKCQkJCQkJY2FzZSA0OgoJCQkJCQkJbi5jb2xvclR5cGUgPSBtaS5UUlVFQ09MT1VSX0FMUEhBOwoJCQkJCQkJYnJlYWs7CgoJCQkJCQljYXNlIDM6CgkJCQkJCQluLmNvbG9yVHlwZSA9IG1pLlRSVUVDT0xPVVI7CgkJCQkJCQlicmVhazsKCgkJCQkJCWNhc2UgMToKCQkJCQkJCW4uY29sb3JUeXBlID0gbWkuR1JFWVNDQUxFOwoJCQkJCQkJYnJlYWs7CgoJCQkJCQljYXNlIDI6CgkJCQkJCQluLmNvbG9yVHlwZSA9IG1pLkdSRVlTQ0FMRV9BTFBIQTsKCQkJCQkJCWJyZWFrOwoKCQkJCQkJZGVmYXVsdDoKCQkJCQkJCXRocm93IG5ldyBFcnJvcigidW5zdXBwb3J0ZWQgbnVtYmVyIG9mIGNoYW5uZWxzIik7CgkJCQkJfQoKCQkJCQlyZXR1cm4gbjsKCQkJCX0odCksCgkJCQkJCQlyID0gewoJCQkJCXdpZHRoOiBEaSh0LndpZHRoLCAid2lkdGgiKSwKCQkJCQloZWlnaHQ6IERpKHQuaGVpZ2h0LCAiaGVpZ2h0IiksCgkJCQkJY2hhbm5lbHM6IGksCgkJCQkJZGF0YTogdC5kYXRhLAoJCQkJCWRlcHRoOiBuLAoJCQkJCXRleHQ6IHt9CgkJCQl9OwoKCQkJCXRoaXMuX2NvbG9yVHlwZSA9IGU7CgkJCQljb25zdCBzID0gci53aWR0aCAqIHIuaGVpZ2h0ICogaTsKCQkJCWlmIChyLmRhdGEubGVuZ3RoICE9PSBzKSB0aHJvdyBuZXcgUmFuZ2VFcnJvcigid3JvbmcgZGF0YSBzaXplLiBGb3VuZCAiLmNvbmNhdChyLmRhdGEubGVuZ3RoLCAiLCBleHBlY3RlZCAiKS5jb25jYXQocykpOwoJCQkJcmV0dXJuIHI7CgkJCX0KCgkJCXdyaXRlQ3JjKHQpIHsKCQkJCXRoaXMud3JpdGVVaW50MzIoYmkobmV3IFVpbnQ4QXJyYXkodGhpcy5idWZmZXIsIHRoaXMuYnl0ZU9mZnNldCArIHRoaXMub2Zmc2V0IC0gdCwgdCksIHQpKTsKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIERpKHQsIGUpIHsKCQkJaWYgKE51bWJlci5pc0ludGVnZXIodCkgJiYgdCA+IDApIHJldHVybiB0OwoJCQl0aHJvdyBuZXcgVHlwZUVycm9yKCIiLmNvbmNhdChlLCAiIG11c3QgYmUgYSBwb3NpdGl2ZSBpbnRlZ2VyIikpOwoJCX0KCgkJZnVuY3Rpb24gSWkodCwgZSwgaSwgbikgewoJCQlmb3IgKGxldCByID0gMDsgciA8IGk7IHIrKykgZS53cml0ZUJ5dGUodFtuKytdKTsKCgkJCXJldHVybiBuOwoJCX0KCgkJZnVuY3Rpb24gU2kodCwgZSwgaSwgbikgewoJCQlmb3IgKGxldCByID0gMDsgciA8IGk7IHIrKykgZS53cml0ZVVpbnQxNih0W24rK10pOwoKCQkJcmV0dXJuIG47CgkJfQoKCQl2YXIgWmk7CgkJIWZ1bmN0aW9uICh0KSB7CgkJCXRbdC5VTktOT1dOID0gMF0gPSAiVU5LTk9XTiIsIHRbdC5NRVRSRSA9IDFdID0gIk1FVFJFIjsKCQl9KFppIHx8IChaaSA9IHt9KSk7CgoJCWNvbnN0IEZpID0gKHQsIGUsIGkpID0+IG5ldyBDaSh7CgkJCXdpZHRoOiB0LAoJCQloZWlnaHQ6IGUsCgkJCWRhdGE6IGkKCQl9LCB1bmRlZmluZWQpLmVuY29kZSgpLAoJCQkJCU1pID0gdCA9PiBmdW5jdGlvbiAodCwgZSkgewoJCQlyZXR1cm4gbmV3IFVpKHQsIHZvaWQgMCkuZGVjb2RlKCk7CgkJfSh0KTsKCX0pKCk7CgoJbi5QOwoJCQl2YXIgcyA9IG4ubTsKCglmdW5jdGlvbiBzZWFyY2hFbGVtZW50KHBhcmVudCwgZWxlbWVudCkgewoJCWlmICghcGFyZW50IHx8IHR5cGVvZiBwYXJlbnQgIT0gJ29iamVjdCcpIHJldHVybjsKCgkJaWYgKHBhcmVudC5oYXNPd25Qcm9wZXJ0eShlbGVtZW50KSkgewoJCQlyZXR1cm4gewoJCQkJcGFyZW50LAoJCQkJdmFsdWU6IHBhcmVudFtlbGVtZW50XQoJCQl9OwoJCX0KCgkJZm9yIChsZXQgY2hpbGQgb2YgT2JqZWN0LnZhbHVlcyhwYXJlbnQpKSB7CgkJCWlmICghIWNoaWxkIHx8IHR5cGVvZiBjaGlsZCA9PSAnb2JqZWN0JykgewoJCQkJbGV0IGZvdW5kID0gc2VhcmNoRWxlbWVudChjaGlsZCwgZWxlbWVudCk7CgkJCQlpZiAoZm91bmQpIHJldHVybiBmb3VuZDsKCQkJfQoJCX0KCgkJcmV0dXJuIG51bGw7Cgl9CgoJZnVuY3Rpb24gZ2V0RXh0ZW5zaW9uKGRhdGFUeXBlKSB7CgkJc3dpdGNoIChkYXRhVHlwZSkgewoJCQljYXNlICJKU09OIjoKCQkJCXJldHVybiAianNvbiI7CgoJCQljYXNlICJ5YW1sIjoKCQkJCXJldHVybiAieWFtbCI7CgoJCQljYXNlICJUZXh0dXJlMkQiOgoJCQkJcmV0dXJuICJwbmciOwoKCQkJY2FzZSAiRWZmZWN0IjoKCQkJCXJldHVybiAiY3NvIjsKCgkJCWNhc2UgJ1RCaW4nOgoJCQkJcmV0dXJuICJ0YmluIjsKCgkJCWNhc2UgJ0JtRm9udCc6CgkJCQlyZXR1cm4gInhtbCI7CgkJfQoKCQlyZXR1cm4gImJpbiI7Cgl9CgoJZnVuY3Rpb24gZ2V0TWltZVR5cGUoZGF0YVR5cGUpIHsKCQlzd2l0Y2ggKGRhdGFUeXBlKSB7CgkJCWNhc2UgIkpTT04iOgoJCQkJcmV0dXJuICJhcHBsaWNhdGlvbi9qc29uIjsKCgkJCWNhc2UgInlhbWwiOgoJCQkJcmV0dXJuICJ0ZXh0L3BsYWluIjsKCgkJCWNhc2UgIlRleHR1cmUyRCI6CgkJCQlyZXR1cm4gImltYWdlL3BuZyI7CgoJCQljYXNlICJFZmZlY3QiOgoJCQkJcmV0dXJuICJhcHBsaWNhdGlvbi94LWNzbyI7CgoJCQljYXNlICdCbUZvbnQnOgoJCQkJcmV0dXJuICJhcHBsaWNhdGlvbi94bWwiOwoJCX0KCgkJcmV0dXJuICJhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0iOwoJfQoKCWZ1bmN0aW9uIG1ha2VCbG9iKGRhdGEsIGRhdGFUeXBlKSB7CgkJaWYgKHR5cGVvZiBCbG9iID09PSAiZnVuY3Rpb24iKSByZXR1cm4gewoJCQlkYXRhOiBuZXcgQmxvYihbZGF0YV0sIHsKCQkJCXR5cGU6IGdldE1pbWVUeXBlKGRhdGFUeXBlKQoJCQl9KSwKCQkJZXh0ZW5zaW9uOiBnZXRFeHRlbnNpb24oZGF0YVR5cGUpCgkJfTsKCQlyZXR1cm4gewoJCQlkYXRhOiBkYXRhLAoJCQlleHRlbnNpb246IGdldEV4dGVuc2lvbihkYXRhVHlwZSkKCQl9OwoJfQoKCWZ1bmN0aW9uIGV4cG9ydENvbnRlbnQoY29udGVudCkgewoJCWxldCBqc29uQ29udGVudCA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogZmFsc2U7CgkJbGV0IGZvdW5kID0gc2VhcmNoRWxlbWVudChjb250ZW50LCAiZXhwb3J0Iik7CgoJCWlmIChmb3VuZCkgewoJCQljb25zdCB7CgkJCQl2YWx1ZQoJCQl9ID0gZm91bmQ7CgkJCWxldCB7CgkJCQl0eXBlOiBkYXRhVHlwZSwKCQkJCWRhdGEKCQkJfSA9IHZhbHVlOwoKCQkJaWYgKGRhdGFUeXBlID09PSAiVGV4dHVyZTJEIikgewoJCQkJZGF0YSA9IHModmFsdWUud2lkdGgsIHZhbHVlLmhlaWdodCwgbmV3IFVpbnQ4QXJyYXkoZGF0YSkpOwoJCQl9CgoJCQlyZXR1cm4gbWFrZUJsb2IoZGF0YSwgZGF0YVR5cGUpOwoJCX0KCgkJaWYgKGpzb25Db250ZW50KSB7CgkJCWxldCBjb250ZW50SnNvbiA9IEpTT04uc3RyaW5naWZ5KGNvbnRlbnQsIG51bGwsIDQpOwoJCQlyZXR1cm4gbWFrZUJsb2IoY29udGVudEpzb24sICJKU09OIik7CgkJfQoKCQlyZXR1cm4gbnVsbDsKCX0KCS8qKiBAYXBpCgkgKiByZWFkcyB0aGUgYnVmZmVyIGFuZCB0aGVuIHVucGFja3MuCgkgKiBhcnJheUJ1ZmZlciAtPiBYbmJEYXRhCgkgKiBAcGFyYW0ge0FycmF5QnVmZmVyfSBidWZmZXIKCSAqIEByZXR1cm4ge1huYkRhdGF9IHRoZSBsb2FkZWQgWE5CIGpzb24KCSAqLwoKCglmdW5jdGlvbiBidWZmZXJUb1huYihidWZmZXIpIHsKCQljb25zdCB4bmIgPSBuZXcgWG5iQ29udmVydGVyKCk7CgkJcmV0dXJuIHhuYi5sb2FkKGJ1ZmZlcik7Cgl9CgkvKiogQGFwaQoJICogcmVtb3ZlIGhlYWRlciBmcm9tIHRoZSBsb2FkZWQgWE5CIE9iamVjdAoJICogWG5iRGF0YSAtPiBDb250ZW50CgkgKiBAcGFyYW0ge1huYkRhdGF9IHRoZSBsb2FkZWQgWE5CIG9iamVjdCBpbmNsdWRlIGhlYWRlcnMKCSAqIEByZXR1cm4ge1huYkNvbnRlbnR9IGV4cG9ydGVkIENvbnRlbnQgT2JqZWN0CgkgKi8KCgoJZnVuY3Rpb24geG5iRGF0YVRvQ29udGVudChsb2FkZWRYbmIpIHsKCQljb25zdCB7CgkJCWNvbnRlbnQKCQl9ID0gbG9hZGVkWG5iOwoJCWNvbnN0IHsKCQkJZGF0YSwKCQkJZXh0ZW5zaW9uCgkJfSA9IGV4cG9ydENvbnRlbnQoY29udGVudCwgdHJ1ZSk7CgkJcmV0dXJuIG5ldyBYbmJDb250ZW50KGRhdGEsIGV4dGVuc2lvbik7Cgl9CgoJZnVuY3Rpb24gc2V0UmVhZGVycyhyZWFkZXJzKSB7CgkJcmV0dXJuIFR5cGVSZWFkZXIuc2V0UmVhZGVycyhyZWFkZXJzKTsKCX0KCgkvKiogCgkgKiB4bmIuanMgMS4yLjAKCSAqIG1hZGUgYnkgTHliZWxsKCBodHRwczovL2dpdGh1Yi5jb20vbHliZWxsLWFydC8gKQoJICogVGhpcyBsaWJyYXJ5IGlzIGJhc2VkIG9uIHRoZSBYbmJDbGkgbWFkZSBieSBMZW9uYmxhZGUuCgkgKiAKCSAqIHhuYi5qcyBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTEdQTCAzLjAgTGljZW5zZS4KCSAqIAoJKi8KCgljbGFzcyBCYXNlUmVhZGVyIHsKCQlzdGF0aWMgaXNUeXBlT2YodHlwZSkgewoJCQlyZXR1cm4gZmFsc2U7CgkJfQoKCQlzdGF0aWMgaGFzU3ViVHlwZSgpIHsKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCgkJc3RhdGljIHBhcnNlVHlwZUxpc3QoKSB7CgkJCXJldHVybiBbdGhpcy50eXBlKCldOwoJCX0KCgkJc3RhdGljIHR5cGUoKSB7CgkJCXJldHVybiB0aGlzLm5hbWUuc2xpY2UoMCwgLTYpOwoJCX0KCgkJaXNWYWx1ZVR5cGUoKSB7CgkJCXJldHVybiB0cnVlOwoJCX0KCgkJZ2V0IHR5cGUoKSB7CgkJCXJldHVybiB0aGlzLmNvbnN0cnVjdG9yLnR5cGUoKTsKCQl9CgoJCXJlYWQoYnVmZmVyLCByZXNvbHZlcikgewoJCQl0aHJvdyBuZXcgRXJyb3IoJ0Nhbm5vdCBpbnZva2UgbWV0aG9kcyBvbiBhYnN0cmFjdCBjbGFzcy4nKTsKCQl9CgoJCXdyaXRlKGJ1ZmZlciwgY29udGVudCwgcmVzb2x2ZXIpIHsKCQkJdGhyb3cgbmV3IEVycm9yKCdDYW5ub3QgaW52b2tlIG1ldGhvZHMgb24gYWJzdHJhY3QgY2xhc3MuJyk7CgkJfQoKCQl3cml0ZUluZGV4KGJ1ZmZlciwgcmVzb2x2ZXIpIHsKCQkJaWYgKHJlc29sdmVyICE9IG51bGwpIGJ1ZmZlci53cml0ZTdCaXROdW1iZXIoTnVtYmVyLnBhcnNlSW50KHJlc29sdmVyLmdldEluZGV4KHRoaXMpKSArIDEpOwoJCX0KCgkJdG9TdHJpbmcoKSB7CgkJCXJldHVybiB0aGlzLnR5cGU7CgkJfQoKCQlwYXJzZVR5cGVMaXN0KCkgewoJCQlyZXR1cm4gdGhpcy5jb25zdHJ1Y3Rvci5wYXJzZVR5cGVMaXN0KCk7CgkJfQoKCX0KCgljbGFzcyBVSW50MzJSZWFkZXIgZXh0ZW5kcyBCYXNlUmVhZGVyIHsKCQlzdGF0aWMgaXNUeXBlT2YodHlwZSkgewoJCQlzd2l0Y2ggKHR5cGUpIHsKCQkJCWNhc2UgJ01pY3Jvc29mdC5YbmEuRnJhbWV3b3JrLkNvbnRlbnQuVUludDMyUmVhZGVyJzoKCQkJCWNhc2UgJ1N5c3RlbS5VSW50MzInOgoJCQkJCXJldHVybiB0cnVlOwoKCQkJCWRlZmF1bHQ6CgkJCQkJcmV0dXJuIGZhbHNlOwoJCQl9CgkJfQoKCQlyZWFkKGJ1ZmZlcikgewoJCQlyZXR1cm4gYnVmZmVyLnJlYWRVSW50MzIoKTsKCQl9CgoJCXdyaXRlKGJ1ZmZlciwgY29udGVudCwgcmVzb2x2ZXIpIHsKCQkJdGhpcy53cml0ZUluZGV4KGJ1ZmZlciwgcmVzb2x2ZXIpOwoJCQlidWZmZXIud3JpdGVVSW50MzIoY29udGVudCk7CgkJfQoKCX0KCgljb25zdCBVVEYxNl9CSVRFUyA9IFsweEQ4MDAsIDB4REMwMF07Cgljb25zdCBVVEYxNl9NQVNLID0gMGIxMTExMTExMTExOwoKCWZ1bmN0aW9uIFVURjE2RGVjb2RlKGNvZGVTZXQpIHsKCQl2YXIgX2NvZGVTZXQyOwoKCQlpZiAodHlwZW9mIGNvZGVTZXQgPT09ICJudW1iZXIiKSBjb2RlU2V0ID0gW2NvZGVTZXRdOwoJCWlmICghKChfY29kZVNldDIgPSBjb2RlU2V0KSAhPT0gbnVsbCAmJiBfY29kZVNldDIgIT09IHZvaWQgMCAmJiBfY29kZVNldDIubGVuZ3RoKSkgdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIGNvZGVzZXQhIik7CgkJY29uc3QgY29kZVNldFJhbmdlID0gY29kZVNldC5sZW5ndGg7CgkJaWYgKGNvZGVTZXRSYW5nZSA9PT0gMSkgcmV0dXJuIGNvZGVTZXRbMF07CgkJcmV0dXJuICgoY29kZVNldFswXSAmIFVURjE2X01BU0spIDw8IDEwKSArIChjb2RlU2V0WzFdICYgVVRGMTZfTUFTSykgKyAweDEwMDAwOwoJfQoKCWZ1bmN0aW9uIHN0cmluZ1RvVW5pY29kZShzdHIpIHsKCQljb25zdCB1dGYxNk1hcCA9IEFycmF5LmZyb20oewoJCQlsZW5ndGg6IHN0ci5sZW5ndGgKCQl9LCAoXywgaSkgPT4gc3RyLmNoYXJDb2RlQXQoaSkpOwoJCWNvbnN0IHJlc3VsdCA9IFtdOwoJCWxldCBpbmRleCA9IDA7CgoJCXdoaWxlIChpbmRleCA8IHN0ci5sZW5ndGgpIHsKCQkJbGV0IGNvZGUgPSB1dGYxNk1hcFtpbmRleF07CgoJCQlpZiAoKFVURjE2X0JJVEVTWzBdICYgY29kZSkgIT09IFVURjE2X0JJVEVTWzBdKSB7CgkJCQlyZXN1bHQucHVzaChjb2RlKTsKCQkJCWluZGV4Kys7CgkJCX0gZWxzZSB7CgkJCQlyZXN1bHQucHVzaChVVEYxNkRlY29kZSh1dGYxNk1hcC5zbGljZShpbmRleCwgaW5kZXggKyAyKSkpOwoJCQkJaW5kZXggKz0gMjsKCQkJfQoJCX0KCgkJcmV0dXJuIHJlc3VsdDsKCX0KCglmdW5jdGlvbiBVVEY4TGVuZ3RoKHN0cikgewoJCWNvbnN0IGNvZGVzID0gc3RyaW5nVG9Vbmljb2RlKHN0cik7CgkJcmV0dXJuIGNvZGVzLnJlZHVjZSgoc3VtLCB1bmljb2RlKSA9PiB7CgkJCWlmICh1bmljb2RlIDwgMHg4MCkgcmV0dXJuIHN1bSArIDE7CgkJCWlmICh1bmljb2RlIDwgMHg4MDApIHJldHVybiBzdW0gKyAyOwoJCQlpZiAodW5pY29kZSA8IDB4MTAwMDApIHJldHVybiBzdW0gKyAzOwoJCQlyZXR1cm4gc3VtICsgNDsKCQl9LCAwKTsKCX0KCgljbGFzcyBTdHJpbmdSZWFkZXIgZXh0ZW5kcyBCYXNlUmVhZGVyIHsKCQlzdGF0aWMgaXNUeXBlT2YodHlwZSkgewoJCQlzd2l0Y2ggKHR5cGUpIHsKCQkJCWNhc2UgJ01pY3Jvc29mdC5YbmEuRnJhbWV3b3JrLkNvbnRlbnQuU3RyaW5nUmVhZGVyJzoKCQkJCWNhc2UgJ1N5c3RlbS5TdHJpbmcnOgoJCQkJCXJldHVybiB0cnVlOwoKCQkJCWRlZmF1bHQ6CgkJCQkJcmV0dXJuIGZhbHNlOwoJCQl9CgkJfQoKCQlyZWFkKGJ1ZmZlcikgewoJCQlsZXQgbGVuZ3RoID0gYnVmZmVyLnJlYWQ3Qml0TnVtYmVyKCk7CgkJCXJldHVybiBidWZmZXIucmVhZFN0cmluZyhsZW5ndGgpOwoJCX0KCgkJd3JpdGUoYnVmZmVyLCBzdHJpbmcsIHJlc29sdmVyKSB7CgkJCXRoaXMud3JpdGVJbmRleChidWZmZXIsIHJlc29sdmVyKTsKCQkJY29uc3Qgc2l6ZSA9IFVURjhMZW5ndGgoc3RyaW5nKTsKCQkJYnVmZmVyLndyaXRlN0JpdE51bWJlcihzaXplKTsKCQkJYnVmZmVyLndyaXRlU3RyaW5nKHN0cmluZyk7CgkJfQoKCQlpc1ZhbHVlVHlwZSgpIHsKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCgl9CgoJY2xhc3MgRGljdGlvbmFyeVJlYWRlciBleHRlbmRzIEJhc2VSZWFkZXIgewoJCXN0YXRpYyBpc1R5cGVPZih0eXBlKSB7CgkJCXN3aXRjaCAodHlwZSkgewoJCQkJY2FzZSAnTWljcm9zb2Z0LlhuYS5GcmFtZXdvcmsuQ29udGVudC5EaWN0aW9uYXJ5UmVhZGVyJzoKCQkJCQlyZXR1cm4gdHJ1ZTsKCgkJCQlkZWZhdWx0OgoJCQkJCXJldHVybiBmYWxzZTsKCQkJfQoJCX0KCgkJc3RhdGljIGhhc1N1YlR5cGUoKSB7CgkJCXJldHVybiB0cnVlOwoJCX0KCgkJY29uc3RydWN0b3Ioa2V5LCB2YWx1ZSkgewoJCQlpZiAoa2V5ID09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PSB1bmRlZmluZWQpIHRocm93IG5ldyBFcnJvcignQ2Fubm90IGNyZWF0ZSBpbnN0YW5jZSBvZiBEaWN0aW9uYXJ5UmVhZGVyIHdpdGhvdXQgS2V5IGFuZCBWYWx1ZS4nKTsKCQkJc3VwZXIoKTsKCQkJdGhpcy5rZXkgPSBrZXk7CgkJCXRoaXMudmFsdWUgPSB2YWx1ZTsKCQl9CgoJCXJlYWQoYnVmZmVyLCByZXNvbHZlcikgewoJCQlsZXQgZGljdGlvbmFyeSA9IHt9OwoJCQljb25zdCB1aW50MzJSZWFkZXIgPSBuZXcgVUludDMyUmVhZGVyKCk7CgkJCWNvbnN0IHNpemUgPSB1aW50MzJSZWFkZXIucmVhZChidWZmZXIpOwoKCQkJZm9yIChsZXQgaSA9IDA7IGkgPCBzaXplOyBpKyspIHsKCQkJCWxldCBrZXkgPSB0aGlzLmtleS5pc1ZhbHVlVHlwZSgpID8gdGhpcy5rZXkucmVhZChidWZmZXIpIDogcmVzb2x2ZXIucmVhZChidWZmZXIpOwoJCQkJbGV0IHZhbHVlID0gdGhpcy52YWx1ZS5pc1ZhbHVlVHlwZSgpID8gdGhpcy52YWx1ZS5yZWFkKGJ1ZmZlcikgOiByZXNvbHZlci5yZWFkKGJ1ZmZlcik7CgkJCQlkaWN0aW9uYXJ5W2tleV0gPSB2YWx1ZTsKCQkJfQoKCQkJcmV0dXJuIGRpY3Rpb25hcnk7CgkJfQoKCQl3cml0ZShidWZmZXIsIGNvbnRlbnQsIHJlc29sdmVyKSB7CgkJCXRoaXMud3JpdGVJbmRleChidWZmZXIsIHJlc29sdmVyKTsKCQkJYnVmZmVyLndyaXRlVUludDMyKE9iamVjdC5rZXlzKGNvbnRlbnQpLmxlbmd0aCk7CgoJCQlmb3IgKGxldCBrZXkgb2YgT2JqZWN0LmtleXMoY29udGVudCkpIHsKCQkJCXRoaXMua2V5LndyaXRlKGJ1ZmZlciwga2V5LCB0aGlzLmtleS5pc1ZhbHVlVHlwZSgpID8gbnVsbCA6IHJlc29sdmVyKTsKCQkJCXRoaXMudmFsdWUud3JpdGUoYnVmZmVyLCBjb250ZW50W2tleV0sIHRoaXMudmFsdWUuaXNWYWx1ZVR5cGUoKSA/IG51bGwgOiByZXNvbHZlcik7CgkJCX0KCQl9CgoJCWlzVmFsdWVUeXBlKCkgewoJCQlyZXR1cm4gZmFsc2U7CgkJfQoKCQlnZXQgdHlwZSgpIHsKCQkJcmV0dXJuICJEaWN0aW9uYXJ5PCIuY29uY2F0KHRoaXMua2V5LnR5cGUsICIsIikuY29uY2F0KHRoaXMudmFsdWUudHlwZSwgIj4iKTsKCQl9CgoJCXBhcnNlVHlwZUxpc3QoKSB7CgkJCXJldHVybiBbdGhpcy50eXBlLCAuLi50aGlzLmtleS5wYXJzZVR5cGVMaXN0KCksIC4uLnRoaXMudmFsdWUucGFyc2VUeXBlTGlzdCgpXTsKCQl9CgoJfQoKCWNsYXNzIEludDMyUmVhZGVyIGV4dGVuZHMgQmFzZVJlYWRlciB7CgkJc3RhdGljIGlzVHlwZU9mKHR5cGUpIHsKCQkJc3dpdGNoICh0eXBlKSB7CgkJCQljYXNlICdNaWNyb3NvZnQuWG5hLkZyYW1ld29yay5Db250ZW50LkludDMyUmVhZGVyJzoKCQkJCWNhc2UgJ1N5c3RlbS5JbnQzMic6CgkJCQkJcmV0dXJuIHRydWU7CgoJCQkJZGVmYXVsdDoKCQkJCQlyZXR1cm4gZmFsc2U7CgkJCX0KCQl9CgoJCXJlYWQoYnVmZmVyKSB7CgkJCXJldHVybiBidWZmZXIucmVhZEludDMyKCk7CgkJfQoKCQl3cml0ZShidWZmZXIsIGNvbnRlbnQsIHJlc29sdmVyKSB7CgkJCXRoaXMud3JpdGVJbmRleChidWZmZXIsIHJlc29sdmVyKTsKCQkJYnVmZmVyLndyaXRlSW50MzIoY29udGVudCk7CgkJfQoKCX0KCgljbGFzcyBMaXN0UmVhZGVyIGV4dGVuZHMgQmFzZVJlYWRlciB7CgkJc3RhdGljIGlzVHlwZU9mKHR5cGUpIHsKCQkJc3dpdGNoICh0eXBlKSB7CgkJCQljYXNlICdNaWNyb3NvZnQuWG5hLkZyYW1ld29yay5Db250ZW50Lkxpc3RSZWFkZXInOgoJCQkJY2FzZSAnU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWMuTGlzdCc6CgkJCQkJcmV0dXJuIHRydWU7CgoJCQkJZGVmYXVsdDoKCQkJCQlyZXR1cm4gZmFsc2U7CgkJCX0KCQl9CgoJCXN0YXRpYyBoYXNTdWJUeXBlKCkgewoJCQlyZXR1cm4gdHJ1ZTsKCQl9CgoJCWNvbnN0cnVjdG9yKHJlYWRlcikgewoJCQlzdXBlcigpOwoJCQl0aGlzLnJlYWRlciA9IHJlYWRlcjsKCQl9CgoJCXJlYWQoYnVmZmVyLCByZXNvbHZlcikgewoJCQljb25zdCB1aW50MzJSZWFkZXIgPSBuZXcgVUludDMyUmVhZGVyKCk7CgkJCWNvbnN0IHNpemUgPSB1aW50MzJSZWFkZXIucmVhZChidWZmZXIpOwoJCQljb25zdCBsaXN0ID0gW107CgoJCQlmb3IgKGxldCBpID0gMDsgaSA8IHNpemU7IGkrKykgewoJCQkJY29uc3QgdmFsdWUgPSB0aGlzLnJlYWRlci5pc1ZhbHVlVHlwZSgpID8gdGhpcy5yZWFkZXIucmVhZChidWZmZXIpIDogcmVzb2x2ZXIucmVhZChidWZmZXIpOwoJCQkJbGlzdC5wdXNoKHZhbHVlKTsKCQkJfQoKCQkJcmV0dXJuIGxpc3Q7CgkJfQoKCQl3cml0ZShidWZmZXIsIGNvbnRlbnQsIHJlc29sdmVyKSB7CgkJCXRoaXMud3JpdGVJbmRleChidWZmZXIsIHJlc29sdmVyKTsKCQkJY29uc3QgdWludDMyUmVhZGVyID0gbmV3IFVJbnQzMlJlYWRlcigpOwoJCQl1aW50MzJSZWFkZXIud3JpdGUoYnVmZmVyLCBjb250ZW50Lmxlbmd0aCwgbnVsbCk7CgoJCQlmb3IgKGxldCBkYXRhIG9mIE9iamVjdC52YWx1ZXMoY29udGVudCkpIHsKCQkJCXRoaXMucmVhZGVyLndyaXRlKGJ1ZmZlciwgZGF0YSwgdGhpcy5yZWFkZXIuaXNWYWx1ZVR5cGUoKSA/IG51bGwgOiByZXNvbHZlcik7CgkJCX0KCQl9CgoJCWlzVmFsdWVUeXBlKCkgewoJCQlyZXR1cm4gZmFsc2U7CgkJfQoKCQlnZXQgdHlwZSgpIHsKCQkJcmV0dXJuICJMaXN0PCIuY29uY2F0KHRoaXMucmVhZGVyLnR5cGUsICI+Iik7CgkJfQoKCQlwYXJzZVR5cGVMaXN0KCkgewoJCQlyZXR1cm4gW3RoaXMudHlwZSwgLi4udGhpcy5yZWFkZXIucGFyc2VUeXBlTGlzdCgpXTsKCQl9CgoJfQoKCWNsYXNzIExpZ2h0d2VpZ2h0VGV4dHVyZTJEUmVhZGVyIGV4dGVuZHMgQmFzZVJlYWRlciB7CgkJc3RhdGljIGlzVHlwZU9mKHR5cGUpIHsKCQkJc3dpdGNoICh0eXBlKSB7CgkJCQljYXNlICdNaWNyb3NvZnQuWG5hLkZyYW1ld29yay5Db250ZW50LlRleHR1cmUyRFJlYWRlcic6CgkJCQkJcmV0dXJuIHRydWU7CgoJCQkJZGVmYXVsdDoKCQkJCQlyZXR1cm4gZmFsc2U7CgkJCX0KCQl9CgoJCXN0YXRpYyB0eXBlKCkgewoJCQlyZXR1cm4gIlRleHR1cmUyRCI7CgkJfQoKCQlyZWFkKGJ1ZmZlcikgewoJCQljb25zdCBpbnQzMlJlYWRlciA9IG5ldyBJbnQzMlJlYWRlcigpOwoJCQljb25zdCB1aW50MzJSZWFkZXIgPSBuZXcgVUludDMyUmVhZGVyKCk7CgkJCWxldCBmb3JtYXQgPSBpbnQzMlJlYWRlci5yZWFkKGJ1ZmZlcik7CgkJCWxldCB3aWR0aCA9IHVpbnQzMlJlYWRlci5yZWFkKGJ1ZmZlcik7CgkJCWxldCBoZWlnaHQgPSB1aW50MzJSZWFkZXIucmVhZChidWZmZXIpOwoJCQlsZXQgbWlwQ291bnQgPSB1aW50MzJSZWFkZXIucmVhZChidWZmZXIpOwoJCQlpZiAobWlwQ291bnQgPiAxKSBjb25zb2xlLndhcm4oIkZvdW5kIG1pcGNvdW50IG9mICIuY29uY2F0KG1pcENvdW50LCAiLCBvbmx5IHRoZSBmaXJzdCB3aWxsIGJlIHVzZWQuIikpOwoJCQlsZXQgZGF0YVNpemUgPSB1aW50MzJSZWFkZXIucmVhZChidWZmZXIpOwoJCQlsZXQgZGF0YSA9IGJ1ZmZlci5yZWFkKGRhdGFTaXplKTsKCQkJZGF0YSA9IG5ldyBVaW50OEFycmF5KGRhdGEpOwoJCQlpZiAoZm9ybWF0ICE9IDApIHRocm93IG5ldyBFcnJvcigiQ29tcHJlc3NlZCB0ZXh0dXJlIGZvcm1hdCBpcyBub3Qgc3VwcG9ydGVkISIpOwoKCQkJZm9yIChsZXQgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSArPSA0KSB7CgkJCQlsZXQgaW52ZXJzZUFscGhhID0gMjU1IC8gZGF0YVtpICsgM107CgkJCQlkYXRhW2ldID0gTWF0aC5taW4oTWF0aC5jZWlsKGRhdGFbaV0gKiBpbnZlcnNlQWxwaGEpLCAyNTUpOwoJCQkJZGF0YVtpICsgMV0gPSBNYXRoLm1pbihNYXRoLmNlaWwoZGF0YVtpICsgMV0gKiBpbnZlcnNlQWxwaGEpLCAyNTUpOwoJCQkJZGF0YVtpICsgMl0gPSBNYXRoLm1pbihNYXRoLmNlaWwoZGF0YVtpICsgMl0gKiBpbnZlcnNlQWxwaGEpLCAyNTUpOwoJCQl9CgoJCQlyZXR1cm4gewoJCQkJZm9ybWF0LAoJCQkJZXhwb3J0OiB7CgkJCQkJdHlwZTogdGhpcy50eXBlLAoJCQkJCWRhdGEsCgkJCQkJd2lkdGgsCgkJCQkJaGVpZ2h0CgkJCQl9CgkJCX07CgkJfQoKCQl3cml0ZShidWZmZXIsIGNvbnRlbnQsIHJlc29sdmVyKSB7CgkJCWlmIChjb250ZW50LmZvcm1hdCAhPSAwKSB0aHJvdyBuZXcgRXJyb3IoIkNvbXByZXNzZWQgdGV4dHVyZSBmb3JtYXQgaXMgbm90IHN1cHBvcnRlZCEiKTsKCQkJY29uc3QgaW50MzJSZWFkZXIgPSBuZXcgSW50MzJSZWFkZXIoKTsKCQkJY29uc3QgdWludDMyUmVhZGVyID0gbmV3IFVJbnQzMlJlYWRlcigpOwoJCQl0aGlzLndyaXRlSW5kZXgoYnVmZmVyLCByZXNvbHZlcik7CgkJCWNvbnRlbnQuZXhwb3J0LndpZHRoOwoJCQljb250ZW50LmV4cG9ydC5oZWlnaHQ7CgkJCWludDMyUmVhZGVyLndyaXRlKGJ1ZmZlciwgY29udGVudC5mb3JtYXQsIG51bGwpOwoJCQl1aW50MzJSZWFkZXIud3JpdGUoYnVmZmVyLCBjb250ZW50LmV4cG9ydC53aWR0aCwgbnVsbCk7CgkJCXVpbnQzMlJlYWRlci53cml0ZShidWZmZXIsIGNvbnRlbnQuZXhwb3J0LmhlaWdodCwgbnVsbCk7CgkJCXVpbnQzMlJlYWRlci53cml0ZShidWZmZXIsIDEsIG51bGwpOwoJCQlsZXQgZGF0YSA9IGNvbnRlbnQuZXhwb3J0LmRhdGE7CgoJCQlmb3IgKGxldCBpID0gMDsgaSA8IGRhdGEubGVuZ3RoOyBpICs9IDQpIHsKCQkJCWNvbnN0IGFscGhhID0gZGF0YVtpICsgM10gLyAyNTU7CgkJCQlkYXRhW2ldID0gTWF0aC5mbG9vcihkYXRhW2ldICogYWxwaGEpOwoJCQkJZGF0YVtpICsgMV0gPSBNYXRoLmZsb29yKGRhdGFbaSArIDFdICogYWxwaGEpOwoJCQkJZGF0YVtpICsgMl0gPSBNYXRoLmZsb29yKGRhdGFbaSArIDJdICogYWxwaGEpOwoJCQl9CgoJCQl1aW50MzJSZWFkZXIud3JpdGUoYnVmZmVyLCBkYXRhLmxlbmd0aCwgbnVsbCk7CgkJCWJ1ZmZlci5jb25jYXQoZGF0YSk7CgkJfQoKCQlpc1ZhbHVlVHlwZSgpIHsKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCgkJZ2V0IHR5cGUoKSB7CgkJCXJldHVybiAiVGV4dHVyZTJEIjsKCQl9CgoJfQoKCXNldFJlYWRlcnMoewoJCURpY3Rpb25hcnlSZWFkZXIsCgkJTGlzdFJlYWRlciwKCQlJbnQzMlJlYWRlciwKCQlUZXh0dXJlMkRSZWFkZXI6IExpZ2h0d2VpZ2h0VGV4dHVyZTJEUmVhZGVyLAoJCVN0cmluZ1JlYWRlcgoJfSk7CgoJbGV0IGtJc05vZGVKUyA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh0eXBlb2YgcHJvY2VzcyAhPT0gJ3VuZGVmaW5lZCcgPyBwcm9jZXNzIDogMCkgPT09ICdbb2JqZWN0IHByb2Nlc3NdJzsNCg0KCWZ1bmN0aW9uIGlzTm9kZUpTKCkgew0KCQlyZXR1cm4ga0lzTm9kZUpTOw0KCX0NCg0KCWNvbnN0IFdvcmtlclRocmVhZHMgPQ0KCQl0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyAmJiB0eXBlb2YgbW9kdWxlLnJlcXVpcmUgPT09ICdmdW5jdGlvbicgJiYgbW9kdWxlLnJlcXVpcmUoJ3dvcmtlcl90aHJlYWRzJykgfHwNCgkJdHlwZW9mIF9fbm9uX3dlYnBhY2tfcmVxdWlyZV9fID09PSAnZnVuY3Rpb24nICYmIF9fbm9uX3dlYnBhY2tfcmVxdWlyZV9fKCd3b3JrZXJfdGhyZWFkcycpIHx8DQoJCXR5cGVvZiByZXF1aXJlID09PSAnZnVuY3Rpb24nICYmIHJlcXVpcmUoJ3dvcmtlcl90aHJlYWRzJyk7DQoNCglmdW5jdGlvbiB3b3JrZXJNYWtlcih3b3JrZXJGdW5jKQ0KCXsNCgkJLy8gbm9kZS1qcyBlbnZpcm9ubWVudA0KCQlpZihpc05vZGVKUygpKQ0KCQl7DQoJCQljb25zdCB7cGFyZW50UG9ydH0gPSBXb3JrZXJUaHJlYWRzOw0KCQkJcGFyZW50UG9ydC5vbignbWVzc2FnZScsIChlKT0+d29ya2VyRnVuYyhlLCBwYXJlbnRQb3J0KSk7DQoJCX0NCgkJLy8gYnJvd3NlciBlbnZpcm9ubWVudA0KCQllbHNlDQoJCXsNCgkJCW9ubWVzc2FnZSA9IGZ1bmN0aW9uKGUpew0KCQkJCXdvcmtlckZ1bmMoZS5kYXRhLCB0aGlzKTsNCgkJCX07DQoJCX0NCgl9CgoJZnVuY3Rpb24gXyhlLCBwYXJlbnQpew0KCQljb25zdCB7dHlwZSwgZGF0YX0gPSBlOw0KCQlpZih0eXBlID09PSAiYnVmZmVyVG9YbmIiKSBwYXJlbnQucG9zdE1lc3NhZ2UoYnVmZmVyVG9YbmIoZGF0YSkpOw0KCQllbHNlIHBhcmVudC5wb3N0TWVzc2FnZSh4bmJEYXRhVG9Db250ZW50KGRhdGEpKTsNCgkJcGFyZW50LmNsb3NlKCk7DQoJfQ0KDQoJd29ya2VyTWFrZXIoXyk7Cgp9KSgpOwoK', null, false);
/* eslint-enable */

class XnbData {
	constructor(header, readers, content) {
		let {
			target,
			formatVersion,
			hidef,
			compressed
		} = header;
		this.header = {
			target,
			formatVersion,
			hidef,
			compressed
		};
		this.readers = readers;
		this.content = content;
	}

	get target() {
		var _this$header;

		switch ((_this$header = this.header) === null || _this$header === void 0 ? void 0 : _this$header.target) {
			case 'w':
				return "Microsoft Windows";

			case 'm':
				return "Windows Phone 7";

			case 'x':
				return "Xbox 360";

			case 'a':
				return "Android";

			case 'i':
				return "iOS";

			default:
				return "Unknown";
		}
	}

	get formatVersion() {
		var _this$header2;

		switch ((_this$header2 = this.header) === null || _this$header2 === void 0 ? void 0 : _this$header2.formatVersion) {
			case 0x3:
				return "XNA Game Studio 3.0";

			case 0x4:
				return "XNA Game Studio 3.1";

			case 0x5:
				return "XNA Game Studio 4.0";

			default:
				return "Unknown";
		}
	}

	get hidef() {
		var _this$header3;

		return !!((_this$header3 = this.header) !== null && _this$header3 !== void 0 && _this$header3.hidef);
	}

	get compressed() {
		var _this$header4;

		return !!((_this$header4 = this.header) !== null && _this$header4 !== void 0 && _this$header4.compressed);
	}

	get contentType() {
		let {
			export: raw
		} = this.content;
		if (raw !== undefined) return raw.type;
		return "JSON";
	}

	get rawContent() {
		let {
			export: raw
		} = this.content;
		if (raw !== undefined) return raw.data;
		return JSON.stringify(this.content, (key, value) => {
			if (key === "export") return value.type;
			return value;
		}, 4);
	}

	stringify() {
		return JSON.stringify({
			header: this.header,
			readers: this.readers,
			content: this.content
		}, null, 4);
	}

	toString() {
		return this.stringify();
	}

}

class XnbContent {
	constructor(data, type) {
		this.type = type;
		this.content = data;
	}
}

function workerPromise(worker, sendData)
{
	return new Promise( (resolve, reject)=>{
		worker.postMessage(sendData);
		worker.addEventListener("message", (e)=>resolve(e.data));
		worker.addEventListener("error", (e)=>reject(e.message));
	});
}

const bufferToXnb = function(data)
{
	const worker = new WorkerFactory();
	return workerPromise(worker, {type:"bufferToXnb", data}).
		then( ( {header, readers, content} )=>new XnbData(header, readers, content) );
};

const xnbDataToContent = function(data)
{
	const worker = new WorkerFactory();
	return workerPromise(worker, {type:"xnbDataToContent", data})
		.then( ( {content, type} )=>new XnbContent(content, type) );
};

export { bufferToXnb, xnbDataToContent };
